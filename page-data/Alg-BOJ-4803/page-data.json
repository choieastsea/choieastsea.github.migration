{"componentChunkName":"component---src-templates-blog-template-js","path":"/Alg-BOJ-4803/","result":{"data":{"cur":{"id":"7d785e68-c5ae-51f9-a8be-c5643fcfd740","html":"<h1 id=\"intuition\" style=\"position:relative;\"><a href=\"#intuition\" aria-label=\"intuition permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intuition</h1>\n<p>ì—£ì§€ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, íŠ¸ë¦¬ê°€ ëª‡ê°œ ì¡´ì¬í•˜ëŠ”ì§€ ì¶œë ¥í•˜ëŠ” ë¬¸ì œì´ë‹¤. <a href=\"https://www.acmicpc.net/problem/4803\">ë§í¬</a></p>\n<p>ì…ë ¥ì´ ê·€ì°®ì§€ë§Œ, íŠ¸ë¦¬ì˜ ì¡°ê±´ì„ ì˜ ìƒê°í•˜ë©´ ì—£ì§€ë“¤ë¡œë§Œ íŠ¸ë¦¬ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.</p>\n<h1 id=\"approach\" style=\"position:relative;\"><a href=\"#approach\" aria-label=\"approach permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Approach</h1>\n<ol>\n<li>\n<p>ì²˜ìŒ ë– ì˜¬ë¦° ë°©ë²•ì€ Union Findì´ë‹¤. edgeì— ë‚˜ì˜¤ëŠ” ë…¸ë“œë“¤ì„ union ì—°ì‚°ì„ í•´ì£¼ë©´ ëª‡ê°œì˜ setì´ ìƒê¸°ëŠ”ì§€ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ì´í›„, cycleì´ ìƒê¸°ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•˜ë©´ íŠ¸ë¦¬ì˜ ê°¯ìˆ˜ë¥¼ êµ¬í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ, ì´ ë°©ë²•ì€ cycle checkì—ì„œ ë§ì€ ì‹œê°„ì´ ê±¸ë¦´ ê²ƒ ê°™ì•„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤.</p>\n</li>\n<li>\n<p>DFSë‚˜ BFSê°™ì€ íƒìƒ‰ì„ ì´ìš©í•´ë³¼ ìˆ˜ ìˆë‹¤. í•œ ë…¸ë“œì—ì„œ ì¶œë°œí•˜ì—¬ ì´ì–´ì§„ ê³³ì„ ë”°ë¼ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ë©° íŠ¸ë¦¬ë¥¼ ë§Œë“¤ë„ë¡ í•œë‹¤. ì—¬ê¸°ì„œ í•œ ë…¸ë“œì˜ ë¶€ëª¨ ë…¸ë“œë„ ê¸°ì–µí•˜ë„ë¡ í•˜ì—¬ <strong>ë¶€ëª¨ ë…¸ë“œê°€ ì•„ë‹Œë° ì´ë¯¸ ë°©ë¬¸í•œ ë…¸ë“œì™€ ì—°ê²°ë˜ì–´ ìˆëŠ” ê²½ìš°</strong>ë¥¼ ì‚¬ì´í´ì´ë¼ê³  íŒë‹¨í•˜ì˜€ë‹¤. ì–‘ë°©í–¥ ê·¸ë˜í”„ì´ë¯€ë¡œ í•œ ë…¸ë“œì—ì„œ ì—°ê²°ëœ ë…¸ë“œë“¤ ì¤‘ì—ëŠ” ë¶€ëª¨ë…¸ë“œì™€ ê·¸ê²ƒì´ ì•„ë‹Œ ë…¸ë“œê°€ ìˆì„í…ë°, ë¶€ëª¨ ë…¸ë“œê°€ ì•„ë‹Œë° ì´ë¯¸ ë°©ë¬¸í•˜ì˜€ë‹¤ë©´ ì—­ë°©í–¥ìœ¼ë¡œ ì˜¬ë¼ê°€ëŠ” ì‚¬ì´í´ì´ ìƒì„±ë˜ê¸° ë•Œë¬¸ì´ë‹¤.!</p>\n</li>\n</ol>\n<h1 id=\"complexity\" style=\"position:relative;\"><a href=\"#complexity\" aria-label=\"complexity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Complexity</h1>\n<ul>\n<li>\n<p>Time complexity: O(m)</p>\n<p>ëª¨ë“  ì—£ì§€ë¥¼ íƒìƒ‰í•˜ë¯€ë¡œ ì—£ì§€ì˜ ê°¯ìˆ˜ì¸ mì— ë¹„ë¡€í•œ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°–ëŠ”ë‹¤.</p>\n</li>\n<li>\n<p>Space complexity: O(n)</p>\n<p>visitedì™€ stackì˜ ì‚¬ì´ì¦ˆëŠ” ë…¸ë“œì˜ ê°¯ìˆ˜ì— ë¹„ë¡€í•  ê²ƒì´ë‹¤.</p>\n</li>\n</ul>\n<h1 id=\"code\" style=\"position:relative;\"><a href=\"#code\" aria-label=\"code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code</h1>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sys <span class=\"token keyword\">import</span> stdin\n<span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> defaultdict\n\n<span class=\"token builtin\">input</span> <span class=\"token operator\">=</span> stdin<span class=\"token punctuation\">.</span>readline\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">findTrees</span><span class=\"token punctuation\">(</span>graph<span class=\"token punctuation\">:</span> defaultdict<span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    graphì˜ ì—£ì§€ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, treeì˜ ê°¯ìˆ˜ë¥¼ ë¦¬í„´í•œë‹¤ \n    \"\"\"</span>\n    cnt <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    visited <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token boolean\">False</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># nodeì—ì„œë¶€í„° dfs í•˜ì—¬ ì™„ë£Œëœë‹¤ë©´ 1 ë¦¬í„´</span>\n        <span class=\"token comment\"># ë˜ ë§ˆì£¼ì¹˜ëŠ” ê²½ìš° ìˆë‹¤ë©´(íŠ¸ë¦¬ ì•„ë‹ˆë¯€ë¡œ) 0 ë¦¬í„´í•œë‹¤!</span>\n        stack <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># node ë²ˆí˜¸, ì§ì „ parent</span>\n        visited<span class=\"token punctuation\">[</span>node<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n        <span class=\"token keyword\">while</span> stack<span class=\"token punctuation\">:</span>\n            cur<span class=\"token punctuation\">,</span> parent <span class=\"token operator\">=</span> stack<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">for</span> adj_node <span class=\"token keyword\">in</span> graph<span class=\"token punctuation\">[</span>cur<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> visited<span class=\"token punctuation\">[</span>adj_node<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># not visited</span>\n                    visited<span class=\"token punctuation\">[</span>adj_node<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n                    stack<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>adj_node<span class=\"token punctuation\">,</span>cur<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">elif</span> visited<span class=\"token punctuation\">[</span>adj_node<span class=\"token punctuation\">]</span> <span class=\"token keyword\">and</span> adj_node <span class=\"token operator\">!=</span> parent<span class=\"token punctuation\">:</span>  <span class=\"token comment\"># ì´ë¯¸ ë°©ë¬¸í•œ ê²½ìš°</span>\n                    <span class=\"token comment\"># cycle</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n                <span class=\"token keyword\">elif</span> adj_node <span class=\"token operator\">==</span> cur<span class=\"token punctuation\">:</span>\n                    <span class=\"token comment\"># self cycle</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\n        <span class=\"token comment\"># í˜„ì¬ê¹Œì§€ íŠ¸ë¦¬ ë°©ë¬¸ì²˜ë¦¬í•˜ê³  1 ë¦¬í„´í•˜ë©´ ë¨(í•˜ë‚˜ì˜ íŠ¸ë¦¬ë¼ê³  ê°„ì£¼ ê°€ëŠ¥)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> visited<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># iì—ì„œë¶€í„° dfs</span>\n            cnt <span class=\"token operator\">+=</span> dfs<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cnt\n\ncase_num <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    n<span class=\"token punctuation\">,</span> m <span class=\"token operator\">=</span> <span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># ì •ì  ê°¯ìˆ˜(&lt;=500), ì—£ì§€ ìˆ˜</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span>\n    graph <span class=\"token operator\">=</span> defaultdict<span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        a<span class=\"token punctuation\">,</span> b <span class=\"token operator\">=</span> <span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        graph<span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>b<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        graph<span class=\"token punctuation\">[</span>b<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>a<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    trees <span class=\"token operator\">=</span> findTrees<span class=\"token punctuation\">(</span>graph<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> trees <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n        comment <span class=\"token operator\">=</span> <span class=\"token string\">'No trees.'</span>\n    <span class=\"token keyword\">elif</span> trees <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n        comment <span class=\"token operator\">=</span> <span class=\"token string\">'There is one tree.'</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        comment <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f'A forest of </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>trees<span class=\"token punctuation\">}</span></span><span class=\"token string\"> trees.'</span></span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Case </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>case_num<span class=\"token punctuation\">}</span></span><span class=\"token string\">: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>comment<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n    case_num <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n</code></pre></div>\n<p>DFS í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¼ì„ í•œë‹¤.</p>\n<ul>\n<li>íƒìƒ‰í•˜ë©´ì„œ ë°©ë¬¸í•œ ë…¸ë“œë¥¼ ë°©ë¬¸ ì²˜ë¦¬í•œë‹¤.</li>\n<li>ë” ì´ìƒ ê°ˆ ìˆ˜ ì—†ë‹¤ë©´ 1ì„ ë¦¬í„´í•œë‹¤. ì—¬ê¸°ì„œ ë°©ë¬¸ ì²˜ë¦¬ëœ ë…¸ë“œë“¤ë¼ë¦¬ ê°™ì€ í•˜ë‚˜ì˜ íŠ¸ë¦¬ë¼ê³  ê°„ì£¼í•  ìˆ˜ ìˆë‹¤.</li>\n<li>ì‚¬ì´í´ì´ ìƒê¸´ë‹¤ë©´ 0ì„ ë¦¬í„´í•œë‹¤. (ë¶€ëª¨ê°€ ì•„ë‹Œ ë…¸ë“œë¥¼ ì¬ë°©ë¬¸ í•˜ê±°ë‚˜, í˜„ì¬ ë…¸ë“œê°€ self cycleì„ ê°–ëŠ” ê²½ìš°)</li>\n</ul>\n<p>ê·¸ë¦¬ê³ , ëª¨ë“  ë…¸ë“œì— ëŒ€í•˜ì—¬ ë°©ë¬¸í•˜ì§€ ì•Šì•˜ë‹¤ë©´ (ì–´ë– í•œ íŠ¸ë¦¬ì— ì†í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´) DFSë¥¼ ìˆ˜í–‰í•œë‹¤.</p>\n<p>BFSë¥¼ ì‚¬ìš©í• ìˆ˜ë„ ìˆì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ ê³µê°„ë³µì¡ë„ê°€ ë” ë†’ìœ¼ë¯€ë¡œ ê°„ë‹¨í•˜ê²Œ DFSë¡œ êµ¬í˜„í•˜ì˜€ë‹¤.</p>","excerpt":"Intuition ì—£ì§€ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, íŠ¸ë¦¬ê°€ ëª‡ê°œ ì¡´ì¬í•˜ëŠ”ì§€ ì¶œë ¥í•˜ëŠ” ë¬¸ì œì´ë‹¤. ë§í¬ ì…ë ¥ì´ ê·€ì°®ì§€ë§Œ, íŠ¸ë¦¬ì˜ ì¡°ê±´ì„ ì˜ ìƒê°í•˜ë©´ ì—£ì§€ë“¤ë¡œë§Œ íŠ¸ë¦¬ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. Approach ì²˜ìŒ ë– ì˜¬ë¦° ë°©ë²•ì€ Union Findì´ë‹¤. edgeì— ë‚˜ì˜¤ëŠ” ë…¸ë“œë“¤ì„ union ì—°ì‚°ì„ í•´ì£¼ë©´ ëª‡ê°œì˜ setì´ ìƒê¸°ëŠ”ì§€ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ì´í›„, cycleì´ ìƒê¸°ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•˜ë©´ íŠ¸ë¦¬ì˜ ê°¯ìˆ˜ë¥¼ êµ¬í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ, ì´ ë°©ë²•ì€ cycle checkì—ì„œ ë§ì€ ì‹œê°„ì´ ê±¸ë¦´ ê²ƒ ê°™ì•„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤. DFSë‚˜ BFSê°™ì€ íƒìƒ‰ì„ ì´ìš©í•´ë³¼ ìˆ˜ ìˆë‹¤. í•œ ë…¸ë“œì—ì„œ ì¶œë°œí•˜ì—¬ ì´ì–´ì§„ ê³³ì„ ë”°ë¼ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ë©° íŠ¸ë¦¬ë¥¼ ë§Œë“¤ë„ë¡ í•œë‹¤. ì—¬ê¸°ì„œ í•œ ë…¸ë“œì˜ ë¶€ëª¨ ë…¸ë“œë„ ê¸°ì–µí•˜ë„ë¡ í•˜ì—¬ ë¶€ëª¨ ë…¸ë“œê°€ ì•„ë‹Œë° ì´ë¯¸ ë°©ë¬¸í•œ ë…¸ë“œì™€ ì—°ê²°ë˜ì–´ ìˆëŠ” ê²½ìš°ë¥¼ ì‚¬ì´í´ì´ë¼ê³  íŒë‹¨í•˜ì˜€ë‹¤. ì–‘ë°©í–¥ ê·¸ë˜í”„ì´ë¯€ë¡œ í•œ ë…¸ë“œì—ì„œ ì—°ê²°ëœ ë…¸ë“œë“¤ ì¤‘ì—ëŠ” ë¶€ëª¨ë…¸ë“œì™€ ê·¸ê²ƒì´ ì•„ë‹Œ ë…¸ë“œê°€ ìˆì„í…ë°, ë¶€ëª¨ ë…¸ë“œê°€ ì•„ë‹Œë° ì´ë¯¸ ë°©ë¬¸í•˜â€¦","frontmatter":{"date":"October 12, 2023","title":"(Alg) BOJ 4803. íŠ¸ë¦¬ ê°¯ìˆ˜","categories":"Alg","author":"choieastsea","emoji":"ğŸ« "},"fields":{"slug":"/Alg-BOJ-4803/"}},"next":{"id":"a26f7892-88be-58c2-9916-889cabcf5f72","html":"<p>ì˜¤ëŠ˜ì€ jwt tokenì„ êµ¬í˜„í•´ë³´ëŠ” ë‚ ì´ë‹¤. ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ êµ¬í˜„í•˜ë¯€ë¡œ, ê°œë…ë§Œ ì±™ê²¨ê°€ë„ ì¢‹ì„ ê²ƒì´ë‹¤!</p>\n<p>ìš°ì„  ì„œë²„ë¶€í„° êµ¬í˜„í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤. <code class=\"language-text\">fast api</code>ì—ì„œëŠ” /docs urlì„ í†µí•œ <code class=\"language-text\">swagger ui</code>ë¡œ ê±°ì˜ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë¯€ë¡œ í¸í•˜ë‹¤.</p>\n<p>ì°¸ê³ ë¡œ fast apiì„œë²„ëŠ” 8000ë²ˆ, reactëŠ” 3000ë²ˆ í¬íŠ¸ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ì˜€ë‹¤.</p>\n<h1 id=\"fastapiì—ì„œ-í•´ì¤˜ì•¼-í• -ê²ƒë“¤\" style=\"position:relative;\"><a href=\"#fastapi%EC%97%90%EC%84%9C-%ED%95%B4%EC%A4%98%EC%95%BC-%ED%95%A0-%EA%B2%83%EB%93%A4\" aria-label=\"fastapiì—ì„œ í•´ì¤˜ì•¼ í•  ê²ƒë“¤ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fastapiì—ì„œ í•´ì¤˜ì•¼ í•  ê²ƒë“¤</h1>\n<p><a href=\"https://fastapi.tiangolo.com/tutorial/security/\">ê³µì‹ë¬¸ì„œ</a>ê°€ ë§¤ìš° ì¹œì ˆí•œ fast apiì— <code class=\"language-text\">OAuth2.0</code> ì¸ì¦ê³¼ ê´€ë ¨í•œ ë¬¸ì„œì™€ ëª¨ë“ˆë“¤ì´ ì œê³µëœë‹¤. ê³µì‹ë¬¸ì„œì—ì„œëŠ” <code class=\"language-text\">access token</code>ë§Œ ìˆì–´ ì´ë¥¼ ì‘ìš©í•˜ì—¬ <code class=\"language-text\">refresh token</code>ì„ ë§Œë“¤ì–´ë³¼ ìˆ˜ ìˆë‹¤.</p>\n<p>ì¶”ê°€ì ìœ¼ë¡œ, refresh tokenì€ <strong>response header</strong>ë¥¼ í†µí•˜ì—¬ <code class=\"language-text\">set-cookie</code>ë¡œ ì „ë‹¬í•˜ë©°, access token ì€ <strong>response body</strong>ë¥¼ í†µí•˜ì—¬ bearer í† í°ì„ SPAì˜ variableë¡œ ê°–ê³  ìˆì„ ìˆ˜ ìˆë„ë¡ ì „ë‹¬í•´ì£¼ë©´ ëœë‹¤.</p>\n<h2 id=\"ì˜µì…˜-cors--credentials\" style=\"position:relative;\"><a href=\"#%EC%98%B5%EC%85%98-cors--credentials\" aria-label=\"ì˜µì…˜ cors  credentials permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì˜µì…˜ (CORS &#x26; credentials)</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># main.py</span>\n<span class=\"token keyword\">from</span> fastapi <span class=\"token keyword\">import</span> FastAPI\n<span class=\"token keyword\">from</span> fastapi<span class=\"token punctuation\">.</span>middleware<span class=\"token punctuation\">.</span>cors <span class=\"token keyword\">import</span> CORSMiddleware\n\napp <span class=\"token operator\">=</span> FastAPI<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span>add_middleware<span class=\"token punctuation\">(</span>\n    CORSMiddleware<span class=\"token punctuation\">,</span>\n    allow_origins<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"http://localhost:3000\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    allow_credentials<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n    allow_methods<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    allow_headers<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>í´ë¼ì´ì–¸íŠ¸ëŠ” 3000, ì„œë²„ëŠ” 8000ë²ˆ í¬íŠ¸ì—ì„œ ì„œë¹™ë˜ë¯€ë¡œ CROSS ORIGINì´ë‹¤. ì´ì— ëŒ€í•œ ì„¤ì •ì„ í•´ì¤„ í•„ìš”ê°€ ìˆë‹¤.</p>\n<ul>\n<li>refresh tokenì€ <code class=\"language-text\">set-cookie</code>ë¡œ ë„£ì–´ì¤„ ê²ƒì´ë¯€ë¡œ, cross originì—ì„œ set-cookieë¥¼ í•˜ê³  ì´í›„ì— cookie ê°’ì„ ë°›ì•„ì˜¤ë ¤ë©´ <code class=\"language-text\">allow_credentials</code> ì„¤ì •ì„ í™œì„±í™”í•´ì•¼í•œë‹¤. <em>í´ë¼ì´ì–¸íŠ¸ëŠ” credential ì •ë³´ë¥¼ includeí•œ AJAX ìš”ì²­ì„ ë³´ë‚´ì•¼ í•  ê²ƒ</em>ì´ë‹¤.</li>\n<li><code class=\"language-text\">allow_credential</code> ì˜µì…˜ì„ í™œì„±í™”í•˜ì˜€ë‹¤ë©´ <code class=\"language-text\">allow_origins</code>ë¥¼ â€*â€œê°€ ì•„ë‹Œ ì •í•´ì§„ ì£¼ì†Œë“¤ì˜ ë°°ì—´ë¡œ ì •í•´ì¤˜ì•¼ í•  ê²ƒì´ë‹¤.</li>\n</ul>\n<h2 id=\"í† í°-ì •ë³´-ë°-ìƒì„±\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0-%EC%A0%95%EB%B3%B4-%EB%B0%8F-%EC%83%9D%EC%84%B1\" aria-label=\"í† í° ì •ë³´ ë° ìƒì„± permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>í† í° ì •ë³´ ë° ìƒì„±</h2>\n<p>ì´ì œ í† í°ì„ ìœ„í•œ ìƒìˆ˜ë¥¼ ì„ ì–¸í•˜ì. ìš°ì„ , access tokenê³¼ refresh token ëª¨ë‘ <code class=\"language-text\">JWT</code>ë¡œ ë§Œë“¤ ê²ƒì´ê³ , ê°ê° ë‹¤ë¥¸ secret keyë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤. ì•„ë˜ì˜ í‚¤ëŠ” ë…¸ì¶œë˜ëŠ” ìˆœê°„ ë³´ì•ˆì€ ëì´ë¯€ë¡œ, ì¡°ì‹¬íˆ ë³´ê´€í•˜ë„ë¡ í•˜ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Final\n\nACCESS_TOKEN_SECRET_KEY <span class=\"token punctuation\">:</span> Final<span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"7f13039fb7c2d98fbbc8440794c2b6c006e066909190c3d055f7c13475e5a052\"</span>\nREFRESH_TOKEN_SECRET_KEY <span class=\"token punctuation\">:</span> Final<span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"3b78bb05f22b376a2938a9483afccb5f5797b8611ede32004e735c19e6056245\"</span>\n\nALGORITHM <span class=\"token punctuation\">:</span> Final<span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"HS256\"</span>\nACCESS_TOKEN_EXPIRE_MINUTES <span class=\"token punctuation\">:</span> Final<span class=\"token punctuation\">[</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">30</span>\nREFRESH_TOKEN_EXPIRE_MINUTES <span class=\"token punctuation\">:</span> Final<span class=\"token punctuation\">[</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span> <span class=\"token operator\">*</span> <span class=\"token number\">7</span></code></pre></div>\n<p>ì´ì œ í† í°ì„ ìƒì„±í•˜ëŠ” ë¡œì§ì„ ì§œë³´ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\n<span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime<span class=\"token punctuation\">,</span> timedelta\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Union\n<span class=\"token keyword\">from</span> jose <span class=\"token keyword\">import</span> jwt\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_access_token</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    data : payload dictionary\n    \"\"\"</span>\n    to_encode <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    expire <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>utcnow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span>ACCESS_TOKEN_EXPIRE_MINUTES<span class=\"token punctuation\">)</span>\n    to_encode<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"exp\"</span><span class=\"token punctuation\">:</span> expire<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    encoded_jwt <span class=\"token operator\">=</span> jwt<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span>to_encode<span class=\"token punctuation\">,</span> ACCESS_TOKEN_SECRET_KEY<span class=\"token punctuation\">,</span> algorithm<span class=\"token operator\">=</span>ALGORITHM<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> encoded_jwt\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_refresh_token</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span><span class=\"token builtin\">dict</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    data : payload dictionary\n    \"\"\"</span>\n    to_encode <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    expire <span class=\"token operator\">=</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span>REFRESH_TOKEN_EXPIRE_MINUTES<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> datetime<span class=\"token punctuation\">.</span>utcnow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    to_encode<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"exp\"</span><span class=\"token punctuation\">:</span> expire<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    encoded_jwt <span class=\"token operator\">=</span> jwt<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span>to_encode<span class=\"token punctuation\">,</span> REFRESH_TOKEN_SECRET_KEY<span class=\"token punctuation\">,</span> algorithm<span class=\"token operator\">=</span>ALGORITHM<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> encoded_jwt</code></pre></div>\n<p>JWTë¡œ ë§Œë“¤ ë°ì´í„°ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„, ìœ íš¨ê¸°ê°„ì„ ì¶”ê°€í•œ ë°ì´í„°ë¡œ í† í°ì„ ë§Œë“¤ì–´ì£¼ëŠ” í•¨ìˆ˜ì´ë‹¤. ê³µì‹ë¬¸ì„œì—ì„œëŠ” <code class=\"language-text\">python-jose</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì˜€ë‹¤.</p>\n<p>í† í°ì„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ í† í°ì„ í•´ì„(decode)í•˜ëŠ” ë¡œì§ë„ ë§Œë“¤ì–´ë³´ì. ì‚¬ì‹¤ í† í°ì€ ê·¸ëƒ¥ <code class=\"language-text\">BASE64</code>ì´ë¯€ë¡œ í•´ì„ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, <strong>secret keyë¥¼ ì´ìš©í•˜ì—¬ ê²€ì¦í•˜ê³ , expire ì‹œê°„ì´ ìœ íš¨í•œì§€ í™•ì¸í•˜ëŠ” ë¡œì§ë„ í¬í•¨</strong>í•œ ê²ƒì´ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\n<span class=\"token keyword\">from</span> fastapi<span class=\"token punctuation\">.</span>security <span class=\"token keyword\">import</span> OAuth2PasswordBearer\n\n<span class=\"token comment\"># headerì— ìˆëŠ” bearer(access token)ê°’ ì½ì–´ì™€ í† í° ê°’ì„ ì œê³µí•œë‹¤.</span>\noauth2_scheme <span class=\"token operator\">=</span> OAuth2PasswordBearer<span class=\"token punctuation\">(</span>tokenUrl<span class=\"token operator\">=</span><span class=\"token string\">\"/login/\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">get_token_data</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">(</span>oauth2_scheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token builtin\">dict</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    tokenì˜ payloadë¥¼ ë¦¬í„´í•œë‹¤\n    ë§Œì•½ oauth2_schemeì—ì„œ í† í° ì •ë³´ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ë‹¤ë©´ 401 Not Authenticatedë¥¼ ë¦¬í„´í•  ê²ƒì„\n    \"\"\"</span>\n    credentials_exception <span class=\"token operator\">=</span> HTTPException<span class=\"token punctuation\">(</span>\n        status_code<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_401_UNAUTHORIZED<span class=\"token punctuation\">,</span>\n        detail<span class=\"token operator\">=</span><span class=\"token string\">\"Could not validate credentials\"</span><span class=\"token punctuation\">,</span>\n        headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"WWW-Authenticate\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        payload <span class=\"token operator\">=</span> jwt<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">,</span> ACCESS_TOKEN_SECRET_KEY<span class=\"token punctuation\">,</span>\n                             algorithms<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>ALGORITHM<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> payload\n    <span class=\"token keyword\">except</span> JWTError<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> credentials_exception</code></pre></div>\n<p><code class=\"language-text\">jwt.decode()</code>í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ í† í° ì •ë³´ë¥¼ ì–»ì–´ì˜¬ ìˆ˜ ìˆë‹¤. <code class=\"language-text\">oauth2_scheme</code>ì„ í†µí•˜ì—¬ <code class=\"language-text\">bearer</code>ë¡œ ì‹œì‘í•˜ëŠ” Authorization header ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ, <strong>ì´ ì˜ì¡´ì„± í•¨ìˆ˜ë¥¼ ì£¼ì…í•´ì¤Œìœ¼ë¡œì¨ í† í° ê°’ì„ ì´ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤</strong>.</p>\n<p><code class=\"language-text\">OAuth2PasswordBearer</code>ê°€ token_urlê³¼ í•¨ê»˜ ìˆëŠ” ê²ƒì´ í—·ê°ˆë¦¬ëŠ”ë°, ì•„ë§ˆ swagger ë“±ì„ í†µí•œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ì‹œ, lock ë²„íŠ¼ìœ¼ë¡œ authorizeì¸ì¦ì„ ê°„ë‹¨í•˜ê²Œ í•˜ë„ë¡ í•˜ê¸° ìœ„í•¨ìœ¼ë¡œ ì•Œë©´ í¸í•˜ë‹¤. ë¡œê·¸ì¸ê¹Œì§€ ê°€ë©´ ì´í•´í•  ìˆ˜ ìˆëŠ”ë°, ì¼ë‹¨ login router urlì„ ì ì–´ì£¼ë©´ ëœë‹¤ê³  ìƒê°í•˜ì.</p>\n<h2 id=\"ë¡œê·¸ì¸-ë°-í† í°-ë°œê¸‰response\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EB%B0%8F-%ED%86%A0%ED%81%B0-%EB%B0%9C%EA%B8%89response\" aria-label=\"ë¡œê·¸ì¸ ë° í† í° ë°œê¸‰response permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë¡œê·¸ì¸ ë° í† í° ë°œê¸‰(response)</h2>\n<p>ì´ì œ ë¡œê·¸ì¸ ë¡œì§ì„ ë§Œë“¤ì–´ì£¼ì. ë¡œê·¸ì¸ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ usernameê³¼ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ì™€ ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ì˜ í•´ì‹œê°’ì´ ê°™ì€ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. ê°™ë‹¤ë©´ ë¡œê·¸ì¸ì´ ì„±ê³µí•˜ì˜€ìœ¼ë¯€ë¡œ access_tokenê³¼ refresh_tokenì„ ë°œê¸‰í•œë‹¤.</p>\n<ol>\n<li>\n<p>OAuth2PasswordBearer ì´ˆê¸°í™”</p>\n<p>ë¡œê·¸ì¸ì‹œ, í† í°ì´ ë°œê¸‰ë˜ëŠ” token_urlì„ ì…ë ¥í•´ì¤€ë‹¤. ì´ ì¢…ì†ì„±í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ í—¤ë”ì— ìˆëŠ” Bearer í† í°ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ í•¨ìˆ˜ê°€ <strong>ì£¼ì…ëœ í•¨ìˆ˜ëŠ” ì¸ì¦ì„ ê±°ì³ì•¼ í•˜ëŠ” í•¨ìˆ˜ë¡œ ê°„ì£¼</strong>ëœë‹¤.</p>\n</li>\n<li>\n<p>ë¡œê·¸ì¸ api ë§Œë“¤ê¸°</p>\n<ul>\n<li>\n<p>ë¹„ë°€ë²ˆí˜¸ í•´ì‹±</p>\n<p>íšŒì›ê°€ì…ì‹œ ë¹„ë°€ë²ˆí˜¸ëŠ” í•´ì‹±ë˜ì–´ ì €ì¥ë  ê²ƒì´ë‹¤(ì•”í˜¸í™”í•˜ì§€ ì•Šìœ¼ë©´ ì ˆëŒ€ ì•ˆëœë‹¤). ë¡œê·¸ì¸ ì‹œì—ëŠ” ì…ë ¥ê°’ê³¼ DBê°’ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í•´ì‹±ì„ í†µí•˜ì—¬ ê²€ì¦í•˜ë¯€ë¡œ ì´ì— ëŒ€í•œ contextê°€ í•„ìš”í•˜ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\n<span class=\"token keyword\">from</span> passlib<span class=\"token punctuation\">.</span>context <span class=\"token keyword\">import</span> CryptContext\n\npwd_context <span class=\"token operator\">=</span> CryptContext<span class=\"token punctuation\">(</span>schemes<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"bcrypt\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> deprecated<span class=\"token operator\">=</span><span class=\"token string\">\"auto\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>ë¡œê·¸ì¸ í•¨ìˆ˜ <code class=\"language-text\">authenticate_user</code></p>\n<p>username, passwordë¥¼ ì…ë ¥ë°›ì•„ ë¡œê·¸ì¸ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">verify_password</span><span class=\"token punctuation\">(</span>plain_password<span class=\"token punctuation\">,</span> hashed_password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    check password via pwd_context\n    \"\"\"</span>\n    <span class=\"token keyword\">return</span> pwd_context<span class=\"token punctuation\">.</span>verify<span class=\"token punctuation\">(</span>plain_password<span class=\"token punctuation\">,</span> hashed_password<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">authenticate_user</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    check if username and password is valid,\n    or return False\n    \"\"\"</span>\n    <span class=\"token comment\"># DBì—ì„œ íšŒì› ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ í•„ìš”</span>\n    userRow <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"username\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"helloworld\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\"># https://bcrypt-generator.com/ì—ì„œ '123456' í•´ì‹±í•œ ê²ƒ</span>\n        <span class=\"token string\">\"hashed_password\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$2a$12$f/tQdnxJCXsuwDkY.XzuJeCyatnkxsYvkXmSyGR04QxuC39ZEVs3y\"</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> userRow<span class=\"token punctuation\">[</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> username<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> verify_password<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> userRow<span class=\"token punctuation\">[</span><span class=\"token string\">\"hashed_password\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span>\n    <span class=\"token keyword\">return</span> userRow</code></pre></div>\n<p>íšŒì›ê°€ì… ë¡œì§ê³¼, user DBëŠ” ê°ì êµ¬ì¶•í•˜ë„ë¡ í•˜ìâ€¦(?) ì¼ë‹¨ ë‚˜ëŠ” ë¡œê·¸ì¸ì´ ì„±ê³µí•˜ë©´ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¦¬í„´í•˜ë„ë¡ í•˜ì˜€ë‹¤. íšŒì›ê°€ì…ì‹œ, ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹±í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•  ê²ƒì¸ë°, <code class=\"language-text\">CryptContext</code>ë¥¼ ì´ìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™”ë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, <code class=\"language-text\">verify_password</code> ë¥¼ í†µí•˜ì—¬ ì…ë ¥ê°’ê³¼ ì›ë˜ ê°’ì´ ì¼ì¹˜í•˜ëŠ”ì§€ë¥¼ íŒë³„í•œë‹¤.</p>\n</li>\n<li>\n<p>ë¡œê·¸ì¸ api</p>\n<p>routerë¥¼ ë‹¬ì•„ì£¼ê³ , ì´ë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># main.py</span>\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Annotated\n<span class=\"token keyword\">from</span> fastapi <span class=\"token keyword\">import</span> FastAPI<span class=\"token punctuation\">,</span> Response<span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">,</span> HTTPException\n<span class=\"token keyword\">from</span> fastapi<span class=\"token punctuation\">.</span>security <span class=\"token keyword\">import</span> OAuth2PasswordRequestForm\n<span class=\"token keyword\">from</span> auth <span class=\"token keyword\">import</span> authenticate_user<span class=\"token punctuation\">,</span> create_access_token<span class=\"token punctuation\">,</span> create_refresh_token\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login/\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># OAuth2PasswordBearerì˜ tokenUrlê³¼ ê°™ì•„ì•¼ swaggerì—ì„œ ê¶Œí•œ í…ŒìŠ¤íŠ¸ê°€ ìš©ì´</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">login_for_access_token</span><span class=\"token punctuation\">(</span>\n    response<span class=\"token punctuation\">:</span> Response<span class=\"token punctuation\">,</span>\n    form_data<span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">[</span>OAuth2PasswordRequestForm<span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user <span class=\"token operator\">=</span> authenticate_user<span class=\"token punctuation\">(</span>form_data<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">,</span> form_data<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> user<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> HTTPException<span class=\"token punctuation\">(</span>\n            status_code<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_401_UNAUTHORIZED<span class=\"token punctuation\">,</span>\n            detail<span class=\"token operator\">=</span><span class=\"token string\">\"Incorrect username or password\"</span><span class=\"token punctuation\">,</span>\n            headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"WWW-Authenticate\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span>\n    access_token <span class=\"token operator\">=</span> create_access_token<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"sub\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">[</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    refresh_token <span class=\"token operator\">=</span> create_refresh_token<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"sub\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">[</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># refresh tokenì€ httponly cookieë¡œ ì €ì¥</span>\n    response<span class=\"token punctuation\">.</span>set_cookie<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">=</span>refresh_token<span class=\"token punctuation\">,</span> httponly<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"access_token\"</span><span class=\"token punctuation\">:</span> access_token<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"token_type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer\"</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">uvicorn main:app --reload</code>ë¡œ ì‹¤í–‰í•œ í›„, <code class=\"language-text\">http://localhost:8000/docs</code>ì— ì ‘ê·¼í•˜ì—¬ login apië¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.44444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC5ElEQVQ4y5WTXW/cRBSG/QeBK2iabZLdZLObj01LE0BAhYSqABLiIghaxFWRkOgFEhdcoAq1TYJaQiuUUBq12URtaUP2y2vP2DNjr73OPsiOSBeSlGWkR3PmHev1mXNmrJXmQ7ZFDTdQ2MZDRBoZm8EIPHyvjTSSpnKxtcTac20cLQn2I3TSQXf/TXg8SQcVahzXpi0d6qmP8bAc4+MFiiDpYJLoH2bmBLK9JMLrGJ426+y2Gjxr1GhJF6sVSFqhR8soHO2h4gDVDVFxiIg1TqROJlaIrjnEjTXWnu9QlzZN5dH0BX5kjhimHx5LdPSH1q5osec2kYFERwFhEmfHCrpRVvj/bfintGloQTvUCKPQcXhYK9Fv+CLjPqymkbQ7Pg2jsJVERgY/DjJE1HfkSA9oGHik1JRPU7r40fOmpCbtSGU4A2K5kYff9XBChaMcgsQQ9kI6vRDTM+ieRu/rrEH9mfzd1SMZPpI+6zWPjZpkvSb5rS74vZHG4lC7VxfUjcROr1foZXPDCJrBgdavW+vPHK5tOtysCq5viWxe3ZFZfGNLcP2hYGXbpSZd2lrQUgJbC5qeQ8t3s9hWqe4evBSTBECP/xr7QNLHceuYfaxPLi2Rmx6huFBipJxnaDSX8erQqSO81ke/dmr4NC+98jKLH3+EtXT5M8rnp3jj/TeZfWuOqflpphdmmKyUmayUKM6WyBfHGRsvkD+BQnGCoeHTfPrFJazVu2tcW77B2savrN65zfLaLZZ/ucXKndsDs3r3Z26u/cT61n0skQQ8auyyUd3kwdMdNp9ss/mkOjiPq9x/XOXezgO29/7AMiRc+eZrhnM5xsoFchNnGCmOHjI6OfY8LuWzdT+58TOM5Mcoz8zx5ZWvsAISrn73LZVzZ3n7wru8vjDP5FSJwsR4VptCcfwFHOwXy6WsxkuXP8fyifj+xx+4+MEiFz9c5J33LnBu/jwzcxVmz1aYGYA0mdQ8bfBfv0BS9TlbyBQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"login-test\"\n        title=\"login-test\"\n        src=\"/static/b3b3d03d4c8cc63f2b51e262cd1d7231/37523/login-test.png\"\n        srcset=\"/static/b3b3d03d4c8cc63f2b51e262cd1d7231/e9ff0/login-test.png 180w,\n/static/b3b3d03d4c8cc63f2b51e262cd1d7231/f21e7/login-test.png 360w,\n/static/b3b3d03d4c8cc63f2b51e262cd1d7231/37523/login-test.png 720w,\n/static/b3b3d03d4c8cc63f2b51e262cd1d7231/302a4/login-test.png 1080w,\n/static/b3b3d03d4c8cc63f2b51e262cd1d7231/2a08f/login-test.png 1422w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">try it out!</code>ì„ ëˆŒëŸ¬ ìë™ìœ¼ë¡œ ìƒì„±ëœ Formì„ í†µí•˜ì—¬ usernameê³¼ passwordë¥¼ ì…ë ¥í•´ì£¼ì. Formì€ ìë™ìœ¼ë¡œ login í•¨ìˆ˜ì˜ form_data ì¸ìì— <code class=\"language-text\">OAuth2PasswordRequestForm</code> ì˜ì¡´ì„± ì£¼ì…ì„ í•´ì¤¬ê¸°ì— ê°€ëŠ¥í•˜ë‹¤. ë¡œê·¸ì¸ì´ ì„±ê³µí•œë‹¤ë©´ access_tokenì´ ë¦¬í„´ë˜ê³ , refresh_token ì—­ì‹œ ì¿ í‚¤ë¡œ ì €ì¥ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. (chrome ê¸°ì¤€. F12 - Cookies - <a href=\"http://localhost:8000\">http://localhost:8000</a> ì— ë“¤ì–´ê°€ë©´ <code class=\"language-text\">token</code>ì´ë¼ëŠ” keyë¡œ ì €ì¥ë˜ì–´ ìˆì–´ì•¼ í•¨)</p>\n<p>í‹€ë¦° ê°’ì„ ì¤€ë‹¤ë©´, authenticate_user í•¨ìˆ˜ì—ì„œ exceptionì´ ìƒê²¨ <code class=\"language-text\">401</code> ì—ëŸ¬ê°€ ë°œìƒí•  ê²ƒì´ë‹¤. ì´ê²ƒë„ í…ŒìŠ¤íŠ¸í•´ë³´ì!</p>\n</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"í† í°-í•´ì„-decode-ë°-ì¸ê°€authorization\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0-%ED%95%B4%EC%84%9D-decode-%EB%B0%8F-%EC%9D%B8%EA%B0%80authorization\" aria-label=\"í† í° í•´ì„ decode ë° ì¸ê°€authorization permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>í† í° í•´ì„ (decode) ë° ì¸ê°€(authorization)</h2>\n<p>ì´ì œëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°œê¸‰ ë°›ì€ í† í°ì„ í†µí•˜ì—¬ <strong>ì¸ê°€ê°€ í•„ìš”í•œ ìš”ì²­</strong>ì„ ë³´ë‚¼ ê²ƒì´ë‹¤. ìš°ë¦¬ëŠ” ì´ì œ <code class=\"language-text\">Authorization</code>ì„ í•´ì£¼ë©´ ëœë‹¤. <u>Authorizationì€ access tokenìœ¼ë¡œë§Œ ìˆ˜í–‰</u>í•˜ëŠ” ê²ƒì´ ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ëª©í‘œì˜€ìœ¼ë‹ˆ, êµ¬í˜„í•´ë³´ë„ë¡ í•˜ì.</p>\n<ul>\n<li>\n<p>í† í° ë°›ì•„ì„œ í•´ì„í•˜ê¸°</p>\n<p>ìœ„ì—ì„œ êµ¬í˜„í•œ get_token_dataë¥¼ ì´ìš©í•˜ë©´ í† í°ì˜ ë°ì´í„°ë¥¼ decodeí•˜ê³ , ì¡°ì‘ë˜ì§€ ì•Šì€ ë°ì´í„°ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># main.py</span>\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/payload/\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">check_access_token</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">[</span><span class=\"token builtin\">dict</span><span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">(</span>get_token_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    authenticated ë˜ì–´ìˆë‹¤ë©´ payload dataë¥¼ ë¦¬í„´\n    ì•„ë‹ˆë¼ë©´ ì˜¤ë¥˜ ë°œìƒ\n    \"\"\"</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">:</span> payload<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ë‹¨ìˆœí•˜ê²Œ ì¸ìë¡œ dependency í•¨ìˆ˜ë¥¼ ë„£ì–´ì£¼ë©´ í•´ë‹¹ ê°’ì„ í•¨ìˆ˜ì—ì„œ ë°›ì•„ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. docsì—ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ë©´, <strong>ì˜¤ë¥¸ìª½ì— ë½ ë²„íŠ¼ì´ ìˆëŠ”ë°, ì´ë¥¼ ì´ìš©í•˜ì—¬ ì¸ì¦ì„ í•˜ê³  bearer tokenì„ ìë™ìœ¼ë¡œ ë„£ì–´ì£¼ë„ë¡ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤!</strong>(ì´ë¥¼ ìœ„í•´ ì¸ì¦ì„ ê±°ì³ í† í°ì„ ë°œê¸‰í•´ì£¼ëŠ” token_urlì„ ìœ íš¨í•˜ê²Œ ì ì–´ì£¼ëŠ” ê²ƒì´ ê¶Œì¥ë¨)</p>\n<p>í† í°ì´ ìœ íš¨í•˜ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ payload ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"sub\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"helloworld\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"exp\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1697195035</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ë§Œì•½ ìœ íš¨ê¸°ê°„ì´ ì§€ë‚¬ê±°ë‚˜, payloadê°€ ì¡°ì‘ë˜ì—ˆë‹¤ë©´ <code class=\"language-text\">401 Couldn't validate ~~ </code>ì—ëŸ¬ê°€ ë‚˜ì˜¬ ê²ƒì´ê³ , token ê°’ ìì²´ê°€ ì—†ë‹¤ë©´(ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ìƒíƒœ) <code class=\"language-text\">401 Not Authenticated</code>ì˜¤ë¥˜ê°€ ë‚˜ì™€ì•¼í•  ê²ƒì´ë‹¤.</p>\n</li>\n<li>\n<p>ì‚¬ìš©ì ì‹ë³„í•˜ê¸°</p>\n<p>payloadê°’ì„ ê°€ì ¸ì™”ìœ¼ë‹ˆ, ì´ë¥¼ í†µí•˜ì—¬ ì‚¬ìš©ìë¥¼ ì‹ë³„í•  ìˆ˜ ìˆë‹¤. access tokenì˜ payloadì— ìˆëŠ” <code class=\"language-text\">sub</code>(subject) dataë¥¼ ê°€ì ¸ì™€ DBì—ì„œ í™•ì¸í•œë‹¤. DB êµ¬ì¡°ì— ë”°ë¼ <strong>í•´ë‹¹ ì‚¬ìš©ìê°€ ì ‘ê·¼ì´ ê°€ëŠ¥í•œ ê¶Œí•œ(role or permission)ì¸ì§€ í™•ì¸í•´ë³¼ ìˆ˜ë„ ìˆì„ ê²ƒ</strong>ì´ë‹¤!</p>\n</li>\n<li>\n<p>Authorization</p>\n<p>ë³´í†µ decodeë¥¼ í•´ì„œ subì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ë©´ ì´ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p>\n<blockquote>\n<p>ì´ í† í°ì˜ ë°ì´í„°ëŠ” ìš°ë¦¬ ì„œë²„ì—ì„œ ë°œê¸‰í•˜ì—¬ ì¡°ì‘ë˜ì§€ ì•Šê³  ì•„ì§ ìœ íš¨í•˜ë‹¤</p>\n</blockquote>\n<p>ë”°ë¼ì„œ, permission role (admin, super user, normal user ë“±)ì´ ì¡´ì¬í•˜ëŠ” ì„œë¹„ìŠ¤ê°€ ì•„ë‹ˆë¼ë©´ ê·¸ëƒ¥ ì¸ê°€ë¥¼ í•´ì£¼ë©´ ë˜ì§€ë§Œ, payloadì˜ ë°ì´í„°ë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ëŠ” ê²ƒì´ ë³´ì•ˆì ìœ¼ë¡œ ê¶Œì¥ë˜ëŠ” ë°©ë²•ì´ë‹¤.</p>\n<p>DBê°€ ì—†ëŠ” ìš°ë¦¬ ì„œë¹„ìŠ¤ëŠ” ì—‡ë¹„ìŠ·í•˜ê²Œ êµ¬í˜„í•´ë³¼ ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">is_payload_valid</span><span class=\"token punctuation\">(</span>payload <span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">[</span><span class=\"token builtin\">dict</span><span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">(</span>get_token_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    payloadê°€ ìœ íš¨í•œì§€ í™•ì¸í•œë‹¤\n    \"\"\"</span>\n    invalid_exception <span class=\"token operator\">=</span> HTTPException<span class=\"token punctuation\">(</span>\n        status_code<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_401_UNAUTHORIZED<span class=\"token punctuation\">,</span>\n        detail<span class=\"token operator\">=</span><span class=\"token string\">\"This user is invalid\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># DBì—ì„œ payload['sub']ì— í•´ë‹¹í•˜ëŠ” usernameì´ ìˆë‹¤ë©´ ìœ íš¨í•œ ì‚¬ìš©ìë¼ê³  íŒë‹¨</span>\n    validUserNameRow <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"helloworld\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"hellowordl2\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># ...</span>\n    <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">if</span> payload<span class=\"token punctuation\">[</span><span class=\"token string\">\"sub\"</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">in</span> validUserNameRow<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> invalid_exception\n</code></pre></div>\n<p>ì´ì œ ì´ë¥¼ ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ì— ëŒ€í•˜ì—¬ ì¸ìë¡œ ì£¼ì…í•´ì£¼ë©´ ë  ê²ƒì´ë‹¤!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># main.py</span>\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/authenticated/\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">is_authenticated</span><span class=\"token punctuation\">(</span>valid <span class=\"token punctuation\">:</span> Annotated<span class=\"token punctuation\">[</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">(</span>is_payload_valid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"data\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"authenticated\"</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>validí•˜ì§€ ì•Šì€ ì‚¬ìš©ìë¼ë©´ <code class=\"language-text\">is_payload_valid</code>ì—ì„œ <code class=\"language-text\">This user is invalid</code> ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²ƒì´ë¯€ë¡œ, ì•ìœ¼ë¡œ ì¸ê°€ê°€ í•„ìš”í•œ ëª¨ë“  í•¨ìˆ˜ì— <code class=\"language-text\">is_payload_valid</code>ë¥¼ ì´ìš©í•˜ë„ë¡ í•˜ì.</p>\n<p>ìœ„ì˜ validUserNameRow ë°°ì—´ì„ ë°”ê¿”ê°€ë©° ì•„ë˜ì²˜ëŸ¼ ê²°ê³¼ê°€ ì˜ ë‚˜ì˜¤ë‚˜ í™•ì¸í•˜ì!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBklEQVQY0y2OO0/CcBTF+3141KHibBsGWVSCBGJ01PCqH8rF6MBgfOA72skFFpkUXVikim1p+dMHP9PCTX45597cnBxp7AaYlsC0Z4wswY/jI+YQAeGSeNypz+8k4M8N+RqaDL8txo6/IL57IXGWNLJn9PofHJ+0OW1fcnHzxNXtM517g+u7FzoPBpZlI4I5tk/yW6nuUiyV2NmrUN6vsl0usblVRNXySHGDs/Y5cjbDWi5HeiWFrGRIyymyqwvtdbtJSyeA3ts7G4UCqqah5ResayqqqqEoCpIAHo1XDg5rNFtH1BotGrpOvaVTj7WpMxh8JoF+GBGEERN3iustSbzAm4pk/wcCbvaYUe0R1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"authorization_test\"\n        title=\"authorization_test\"\n        src=\"/static/309795e34d1a724ec0e78043cb96c6b6/37523/authorization_test.png\"\n        srcset=\"/static/309795e34d1a724ec0e78043cb96c6b6/e9ff0/authorization_test.png 180w,\n/static/309795e34d1a724ec0e78043cb96c6b6/f21e7/authorization_test.png 360w,\n/static/309795e34d1a724ec0e78043cb96c6b6/37523/authorization_test.png 720w,\n/static/309795e34d1a724ec0e78043cb96c6b6/302a4/authorization_test.png 1080w,\n/static/309795e34d1a724ec0e78043cb96c6b6/07a9c/authorization_test.png 1440w,\n/static/309795e34d1a724ec0e78043cb96c6b6/d7ceb/authorization_test.png 1446w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n</ul>\n<h2 id=\"refresh-í† í°ì„-ì´ìš©í•œ-access-token-ì¬ë°œê¸‰-with-rtr\" style=\"position:relative;\"><a href=\"#refresh-%ED%86%A0%ED%81%B0%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-access-token-%EC%9E%AC%EB%B0%9C%EA%B8%89-with-rtr\" aria-label=\"refresh í† í°ì„ ì´ìš©í•œ access token ì¬ë°œê¸‰ with rtr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>refresh í† í°ì„ ì´ìš©í•œ access token ì¬ë°œê¸‰ (with RTR)</h2>\n<p>ë¡œê·¸ì¸ì‹œ, refresh tokenì„ ë°œê¸‰í•˜ë©° í•´ë‹¹ refresh tokenì„ ì¶”ê°€í•˜ëŠ” ê²ƒìœ¼ë¡œ ìˆ˜ì •í•˜ì. ì´ëŠ” ì „ì—­ ë³€ìˆ˜ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\nvalid_refresh_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">is_refresh_valid</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> valid_refresh_list\n    <span class=\"token keyword\">return</span> token <span class=\"token keyword\">in</span> valid_refresh_list\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">add_refresh_token</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> valid_refresh_list\n    valid_refresh_list<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">remove_refresh_token</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> valid_refresh_list\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        valid_refresh_list<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># listì— í•´ë‹¹ í† í°ì´ ì—†ëŠ” ê²½ìš°</span>\n        <span class=\"token keyword\">raise</span> credentials_exception\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_refresh_token</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    data : payload dictionary\n    refresh tokenì„ ìƒì„±í•˜ê³ , ë³€ìˆ˜ë¡œ í•´ë‹¹ í† í°ì„ ì €ì¥í•œë‹¤\n    \"\"\"</span>\n    to_encode <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    expire <span class=\"token operator\">=</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span>REFRESH_TOKEN_EXPIRE_MINUTES<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> \\\n        datetime<span class=\"token punctuation\">.</span>utcnow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    to_encode<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"exp\"</span><span class=\"token punctuation\">:</span> expire<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    encoded_jwt <span class=\"token operator\">=</span> jwt<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span>\n        to_encode<span class=\"token punctuation\">,</span> REFRESH_TOKEN_SECRET_KEY<span class=\"token punctuation\">,</span> algorithm<span class=\"token operator\">=</span>ALGORITHM<span class=\"token punctuation\">)</span>\n    add_refresh_token<span class=\"token punctuation\">(</span>encoded_jwt<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># refresh tokenì— ì¶”ê°€í•œë‹¤</span>\n    <span class=\"token keyword\">return</span> encoded_jwt</code></pre></div>\n<p><code class=\"language-text\">remove_refresh_token</code>ì€ python ë°°ì—´ì— ì¡´ì¬í•˜ì§€ ì•Šë‹¤ë©´ ì—ëŸ¬ê°€ ë°œìƒë˜ë¯€ë¡œ ì´ ê²½ìš°ì—ëŠ” ìœ íš¨í•˜ì§€ ì•Šì€ í† í° ëª©ë¡ìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ë„ë¡ í•œë‹¤.</p>\n<p>ì´ì œ í•´ë‹¹ refresh í† í°ì´ ìœ íš¨í•œì§€ í™•ì¸í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># auth.py</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">verify_refresh_token</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    í•´ë‹¹ refresh í† í°ì´ ìœ íš¨í•œì§€ í™•ì¸\n    ìœ íš¨í•˜ë‹¤ë©´ payload return\n    \"\"\"</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        payload <span class=\"token operator\">=</span> jwt<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span>\n            token<span class=\"token punctuation\">,</span> REFRESH_TOKEN_SECRET_KEY<span class=\"token punctuation\">,</span> algorithms<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>ALGORITHM<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> is_refresh_valid<span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> payload\n    <span class=\"token keyword\">except</span> JWTError<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> credentials_exception</code></pre></div>\n<p>ì´ë¥¼ ì´ìš©í•˜ì—¬ í•˜ë‚˜ì˜ refresh tokenìœ¼ë¡œ í•˜ë‚˜ì˜ access tokenë§Œ ìƒì„±ì´ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># main.py</span>\n<span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> Union\n<span class=\"token keyword\">from</span> fastapi <span class=\"token keyword\">import</span> Response<span class=\"token punctuation\">,</span> Cookie\n<span class=\"token keyword\">from</span> auth <span class=\"token keyword\">import</span> verify_refresh_token<span class=\"token punctuation\">,</span> create_refresh_token<span class=\"token punctuation\">,</span> create_access_token\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/refresh/\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">:</span> Response<span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">:</span> Union<span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Cookie<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    http only cookieì—ì„œ refresh_token ê°’ì„ ì–»ì–´ì™€ ê²€ì¦í•˜ê³ , ìœ íš¨í•˜ë‹¤ë©´ ìƒˆë¡œìš´ í† í°ì„ ë°œê¸‰í•œë‹¤\n    \"\"\"</span>\n    prev_token <span class=\"token operator\">=</span> token\n    payload <span class=\"token operator\">=</span> verify_refresh_token<span class=\"token punctuation\">(</span>prev_token<span class=\"token punctuation\">)</span>\n    remove_refresh_token<span class=\"token punctuation\">(</span>prev_token<span class=\"token punctuation\">)</span>\n    refresh_token <span class=\"token operator\">=</span> create_refresh_token<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\n    access_token <span class=\"token operator\">=</span> create_access_token<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\n    response<span class=\"token punctuation\">.</span>set_cookie<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">=</span>refresh_token<span class=\"token punctuation\">,</span> httponly<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"access_token\"</span><span class=\"token punctuation\">:</span> access_token<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"token_type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Bearer\"</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì¿ í‚¤ëŠ” Cookieë¥¼ importí•˜ì—¬ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ í•˜ì.! ë‹¤í–‰íˆ ê³¼ê±°ì—ëŠ” Swagger UIë¥¼ í†µí•œ ì¿ í‚¤ ì ‘ê·¼ì´ ì•ˆëë‹¤ê³  í–ˆë˜ê±° ê°™ì€ë°, ì§€ê¸ˆì€ ê°€ëŠ¥í•œ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.</p>\n<p>localhost:8000/docsì— ì ‘ê·¼í•˜ì—¬ ì‹¤í–‰í•´ë³´ì. ì„œë²„ í”„ë¡œì„¸ìŠ¤ê°€ ì¬ì‹œì‘ ëœ ê²½ìš°ë¼ë©´, global ë³€ìˆ˜ ì—­ì‹œ ì´ˆê¸°í™”ë˜ë¯€ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸ì„ í•œ í›„ì— ì§„í–‰í•˜ë©´ ëœë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABIklEQVQoz43LzW6bQBiFYe7/VlI1URe9hsqJUvW/6sIxBob5ZoznDxgwTt9KOI2UTdrFo/dsTnFvt5SdpkkdevTo0T2T7LFzxPwHe0ro7CnckDjmxHGML3RDxE09ccnEZfy3IRCGQCG9J8zj0/EiLZl+mdam05PldX10hOQo/OSJOTD/npge82p8HAnntIrnhDslDlPiML/i1GPnRPGpdfwwke8SVj9N4Jt4vojnq3g+a8/Oe7opYLK/GD0yuOf9l82B4s1GeLtRXN9qbu6E9x+Fd/d23Td3mqsPLZtfLbXR1EZoDgZlDGWraK3FBId0FiUN+niggDO+s2hVYaXFaEVn9KVW6MMREWFXNuzKerV9qCgrRVW37GvFft9QVYrtruIPIVwQbzkca8MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rtr\"\n        title=\"rtr\"\n        src=\"/static/9e031de77ac1c75a5334cef031f325cf/37523/RTR.png\"\n        srcset=\"/static/9e031de77ac1c75a5334cef031f325cf/e9ff0/RTR.png 180w,\n/static/9e031de77ac1c75a5334cef031f325cf/f21e7/RTR.png 360w,\n/static/9e031de77ac1c75a5334cef031f325cf/37523/RTR.png 720w,\n/static/9e031de77ac1c75a5334cef031f325cf/302a4/RTR.png 1080w,\n/static/9e031de77ac1c75a5334cef031f325cf/07a9c/RTR.png 1440w,\n/static/9e031de77ac1c75a5334cef031f325cf/23814/RTR.png 2856w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Executeë¥¼ ëˆ„ë¥¼ë•Œë§ˆë‹¤ token ê°’ì´ ë°”ë€ŒëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</p>\n<p>tokenì˜ Valueë¥¼ ì„ì˜ë‚˜ ì´ì „ í† í° ê°’ìœ¼ë¡œ ìˆ˜ì •í•˜ë©´ errorê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</p>\n<h3 id=\"í˜„ì‹¤ì ìœ¼ë¡œ-dbì—-ì €ì¥ë˜ì•¼-í•˜ëŠ”-ì´ìœ \" style=\"position:relative;\"><a href=\"#%ED%98%84%EC%8B%A4%EC%A0%81%EC%9C%BC%EB%A1%9C-db%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"í˜„ì‹¤ì ìœ¼ë¡œ dbì— ì €ì¥ë˜ì•¼ í•˜ëŠ” ì´ìœ  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>í˜„ì‹¤ì ìœ¼ë¡œ DBì— ì €ì¥ë˜ì•¼ í•˜ëŠ” ì´ìœ </h3>\n<p>ì‚¬ì‹¤, ëŸ°íƒ€ì„ ë³€ìˆ˜ë¡œ ë°œê¸‰í•œ refresh tokenì„ ê´€ë¦¬í•˜ëŠ” ì¼ì€ ë¹„í˜„ì‹¤ì ì¸ë°, ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì´ ìˆê¸° ë•Œë¬¸ì´ë‹¤</p>\n<ol>\n<li>\n<p>ì‚¬ìš©ì ìˆ˜ê°€ ë§ì•„ ë°°ì—´ì— ë‹´ì„ìˆ˜ë¡ ë©”ëª¨ë¦¬ê°€ ë¬´ê±°ì›Œì§„ë‹¤</p>\n</li>\n<li>\n<p>ë©€í‹° í”„ë¡œì„¸ì‹± í™˜ê²½ì—ì„œëŠ” ëŸ°íƒ€ì„ ë³€ìˆ˜ë¥¼ ê³µìœ í•  ìˆ˜ ì—†ë‹¤</p>\n<p>ì‚¬ì‹¤ ì´ ë°©ë²•ì€ <code class=\"language-text\">fastapi</code>ì˜ ê²½ìš° íŠ¹ì • ìƒí™©ì—ì„œì˜ í•´ê²° ë°©ë²•ì´ ìˆë‹¤. ë³´í†µ gunicornìœ¼ë¡œ uvicorn workerë¥¼ ë‘¬ì„œ ë©€í‹° í”„ë¡œì„¸ì‹±ì„ ì²˜ë¦¬í•˜ëŠ”ë°, ì´ ê²½ìš° process ê°„ì˜ ê³µìœ  ë³€ìˆ˜(shared variable)ì„ ì´ìš©í•˜ë©´ ëœë‹¤. ê°„ë‹¨í•œ ì‚¬ìš©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> multiprocessing <span class=\"token keyword\">import</span> Manager\n\nmanager <span class=\"token operator\">=</span> Manager<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nvalid_refresh_list <span class=\"token operator\">=</span> manager<span class=\"token punctuation\">.</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">add_refresh_token</span><span class=\"token punctuation\">(</span>token <span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    global refresh tokenì„ ì¶”ê°€í•œë‹¤\n    \"\"\"</span>\n    <span class=\"token keyword\">global</span> valid_refresh_list\n    valid_refresh_list<span class=\"token punctuation\">.</span>apped<span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ìƒˆë¡œìš´ í† í°ì´ ë°œê¸‰ë ë•Œë§ˆë‹¤ ê³µìœ  ë³€ìˆ˜ì— ì¶”ê°€í•´ì£¼ëŠ” ë°©ë²•ì´ ìˆë‹¤â€¦ í•˜ì§€ë§Œ ì—­ì‹œ 1ë²ˆ ë¬¸ì œê°€ ë°œìƒí•˜ê¸° ë§ˆë ¨ì´ë‹¤.</p>\n</li>\n<li>\n<p>í° ì„œë¹„ìŠ¤ëŠ” í•˜ë‚˜ì˜ ì„œë²„ ì»´í“¨í„°ì—ì„œ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤</p>\n<p>ëŸ°íƒ€ì„ ë³€ìˆ˜ë¥¼ ì–´ë–»ê²Œë“  ê³µìœ í•˜ì§€ ëª»í•˜ëŠ” í™˜ê²½ì´ ìƒê¸¸ ìˆ˜ë„ ìˆë‹¤. ì´ ê²½ìš°ëŠ” in memory DBë¥¼ ì¨ë„ ë§ˆì°¬ê°€ì§€ë¡œ ë°œìƒí•˜ëŠ” ë¬¸ì œì´ë‹¤.</p>\n</li>\n</ol>\n<p>ê²°ë¡ ì ìœ¼ë¡œ, ì•ˆì •ì ì´ê³  í° ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•´ì•¼í•˜ê³  <code class=\"language-text\">RTR</code> ë°©ì‹ì„ ì„ íƒí•œë‹¤ë©´ ì‚¬ìš©ì DBì— <code class=\"language-text\">refresh</code>ê°™ì€ columnì„ ë§Œë“¤ì–´ì„œ ë³´ê´€í•˜ì. ì•½ê°„ ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ìœ¼ë¡œëŠ” (<strong>ë‚˜ë§Œì˜ ìƒê°ì´ê¸´ í•˜ì§€ë§Œ</strong>) ì¸ë©”ëª¨ë¦¬ DBë¥¼ ë¨¼ì € íƒìƒ‰í•˜ê³  ì´í›„ì— DBë¥¼ íƒìƒ‰í•˜ë„ë¡ refresh token ì •ë³´ë¥¼ ìºì‹±í•´ë‘ëŠ” ì „ëµë„ ê°€ëŠ¥í•  ê²ƒ ê°™ë‹¤.</p>\n<h2 id=\"ë¡œê·¸ì•„ì›ƒ-ë¡œì§\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%95%84%EC%9B%83-%EB%A1%9C%EC%A7%81\" aria-label=\"ë¡œê·¸ì•„ì›ƒ ë¡œì§ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë¡œê·¸ì•„ì›ƒ ë¡œì§</h2>\n<p>refresh tokenì„ ì§€ì›Œì¤˜ì„œ access tokenì„ ë” ì´ìƒ ë°œê¸‰ë°›ì§€ ëª»í•˜ë„ë¡ í•˜ë©´ ëœë‹¤!</p>\n<p>ë¬¼ë¡  í”„ë¡ íŠ¸ì—ì„œë„ ìƒˆë¡œê³ ì¹¨ì„ í•˜ëŠ” ë“±ìœ¼ë¡œ access tokenì„ ë¹„ì›Œì£¼ëŠ” ì‘ì—…ì„ í•˜ë©´ ë  ê²ƒì´ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># main.py</span>\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/logout/\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">:</span> Response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    response<span class=\"token punctuation\">.</span>delete_cookie<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span> httponly<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h1 id=\"ìš”ì•½\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EC%95%BD\" aria-label=\"ìš”ì•½ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ìš”ì•½</h1>\n<p><code class=\"language-text\">JWT</code>ì— ëŒ€í•œ ê°œë… ìì²´ê°€ ìµìˆ™í•´ì¡Œë‹¤ë©´ ì„œë²„ì—ì„œ ì¸ì¦ ì²´ê³„ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ì¬ë¯¸ìˆëŠ” ê²ƒ ê°™ë‹¤! ìœ ëª…í•œ ë¹„ìœ ë¡œ, ë†€ì´ê³µì› í‹°ì¼“ì„ ë°œê¸‰í•œë‹¤ê³  ê²€ì‚¬í•˜ëŠ” ì…ì¥ì´ë¼ê³  ìƒê°í•´ë³´ëŠ” ê²ƒì´ë‹¤â€¦</p>\n<ul>\n<li>\n<p>ê°€ì¥ ì‰¬ìš´ ë°©ë²•ìœ¼ë¡œëŠ” ë„ì¥ì„ ì°ê³  í•´ë‹¹ ë„ì¥ì´ ìˆë‹¤ë©´ í†µê³¼ì‹œì¼œì£¼ëŠ” ê²ƒì´ê² ë‹¤</p>\n</li>\n<li>\n<p>ë¹„êµì  ì•ˆì „í•œ ë°©ë²•ìœ¼ë¡œëŠ” ìœ íš¨ê¸°ê°„ê³¼ ì‚¬ìš©ì ì‹ë³„ ì •ë³´ê°€ í¬í•¨ëœ ì •ë³´ë¥¼ ì¡°ì‘ì´ ë¶ˆê°€í•˜ê²Œ ë°€ë´‰í•˜ê³ , í‹°ì¼“(access token)ì„ í™•ì¸í•˜ì—¬ í•´ë‹¹ ì‚¬ìš©ìê°€ ìœ íš¨í•œì§€ê¹Œì§€ í™•ì¸í•˜ëŠ” ë°©ë²•ë„ ìˆì„ ê²ƒì´ë‹¤.</p>\n</li>\n<li>\n<p>ë˜í•œ, ëˆ„êµ°ê°€ ë²„ë¦¬ê³  ê°„ í‹°ì¼“(refresh token)ì„ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡, ë†€ì´ê¸°êµ¬ë¥¼ í•œë²ˆ íƒˆë•Œë§ˆë‹¤ ìƒˆë¡œìš´ í‹°ì¼“ì„ ë°œê¸‰ë°›ì•„ì•¼ í•˜ë„ë¡(RTR) í•œë‹¤ê³  ìƒê°í•´ë³´ì.</p>\n</li>\n</ul>\n<p>ì •ë¦¬ëœ ì½”ë“œëŠ” <a href=\"https://github.com/choieastsea/jwt-fastapi-react/commit/d53539ab65fb31021397c3030e4e0a99ac7bae6b\">ì—¬ê¸°</a>ì— ì˜¬ë ¤ë†“ì•˜ë‹¤.</p>","frontmatter":{"date":"October 06, 2023","title":"(WEB) JWT token ì¸ì¦ ë„ì…í•˜ê¸° (2)","categories":"WEB","author":"choieastsea","emoji":"ğŸ’¨"},"fields":{"slug":"/WEB-jwt(2)/"}},"prev":{"id":"2197d178-4869-524d-92fd-c5d919db41c0","html":"<p>ì €ë²ˆê¹Œì§€ëŠ” <code class=\"language-text\">fastapi</code>ë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ì‚¬ì´ë“œì˜ jwt í† í° ë¡œì§ì„ êµ¬í˜„í•´ë³´ì•˜ë‹¤. ë¡œì§ ìì²´ë¥¼ ì´í•´í•œë‹¤ë©´ <code class=\"language-text\">flask</code>ë‚˜ ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ì—ë„ ì°¸ê³ í•˜ì—¬ ì ìš©ì´ ê°€ëŠ¥í•  ê²ƒì´ë‹¤. ì˜¤ëŠ˜ì€ í”„ë¡ íŠ¸ì—ì„œ í•´ì¤˜ì•¼í•  ê²ƒë“¤ì„ ìœ„ì£¼ë¡œ êµ¬í˜„í•´ë³´ì.! <code class=\"language-text\">react js</code>ì˜ <code class=\"language-text\">CRA</code>ë¥¼ ì´ìš©í•˜ì—¬ êµ¬í˜„í•  ì˜ˆì •ì´ê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” access tokenì— ëŒ€í•œ íë¦„ì„ ìœ„ì£¼ë¡œ ìƒê°í•˜ë©´ ì¢‹ì„ ê²ƒì´ë‹¤.</p>\n<p>ì´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>\n<ul>\n<li>recoil : context valueë¥¼ ì €ì¥í•˜ê¸° ìœ„í•˜ì—¬ ì‚¬ìš©í•œë‹¤</li>\n<li>axios : fetch apië¥¼ ì´ìš©í•˜ê³  ì´ë¥¼ ëª¨ë“ˆí™”í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤</li>\n</ul>\n<h1 id=\"reactì—ì„œ-í•´ì¤˜ì•¼-í• -ê²ƒë“¤\" style=\"position:relative;\"><a href=\"#react%EC%97%90%EC%84%9C-%ED%95%B4%EC%A4%98%EC%95%BC-%ED%95%A0-%EA%B2%83%EB%93%A4\" aria-label=\"reactì—ì„œ í•´ì¤˜ì•¼ í•  ê²ƒë“¤ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reactì—ì„œ í•´ì¤˜ì•¼ í•  ê²ƒë“¤</h1>\n<p>ëª‡ê°€ì§€ë§Œ ê¸°ì–µí•˜ì.</p>\n<ol>\n<li>ë¡œê·¸ì¸ ì„±ê³µì‹œ, access tokenì€ context ë³€ìˆ˜ë¡œ ê°–ê³  ìˆë„ë¡ í•œë‹¤.</li>\n<li><code class=\"language-text\">Authorization</code>ì´ í•„ìš”í•œ ìš”ì²­ì— ëŒ€í•˜ì—¬ access tokenì„ ì‹¤ì–´ì„œ ë³´ë‚¸ë‹¤.</li>\n<li>ë§Œì•½, access tokenì´ ë§Œë£Œë˜ê±°ë‚˜(401) ì—†ë‹¤ë©´ refresh tokenì„ ì´ìš©í•˜ì—¬ ì¬ë°œê¸‰ ë°›ëŠ”ë‹¤.</li>\n<li>access tokenì„ ì¬ë°œê¸‰ ë°›ì•˜ë‹¤ë©´ ê·¸ê²ƒì„ Bearerì— ì‹¤ì–´ì„œ ë‹¤ì‹œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.</li>\n<li>refresh tokenì´ ë§Œë£Œë˜ê±°ë‚˜ ì—†ë‹¤ë©´(401) ë‹¤ì‹œ ë¡œê·¸ì¸ì„ í•˜ë„ë¡ í•œë‹¤.</li>\n</ol>\n<h3 id=\"proxy\" style=\"position:relative;\"><a href=\"#proxy\" aria-label=\"proxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>proxy</h3>\n<p>api ì„œë²„ì™€ ì†Œí†µí•˜ê¸° ìœ„í•˜ì—¬ proxy ì„¤ì •ì„ í•´ì¤„ í•„ìš”ê°€ ìˆë‹¤. ì¸ì¦ ì„œë²„ëŠ” 8000ë²ˆ, í´ë¼ì´ì–¸íŠ¸ ì„œë²„ëŠ” 3000ë²ˆì— ìœ„ì¹˜í•´ìˆê¸° ë•Œë¬¸ì— <code class=\"language-text\">origin</code>ì´ ë‹¤ë¥´ë‹¤. ë”°ë¼ì„œ, refresh tokenì´ <code class=\"language-text\">set-cookie</code>ë¡œ ì¸í•˜ì—¬ ì„¤ì •ë˜ì§€ ì•Šìœ¼ë‹ˆ <code class=\"language-text\">package.json</code>ìœ¼ë¡œ ê°€ì„œ <code class=\"language-text\">proxy</code> í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•˜ê³  ë¡œì»¬ ì„œë²„ì˜ urlì„ ì ì–´ì£¼ì. proxyë¥¼ í†µí•˜ì—¬ ë¸Œë¼ìš°ì €ê°€ <strong>ê°™ì€ í¬íŠ¸ì˜ ì„œë²„ì—ë‹¤ê°€ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒê³¼ ê°™ì€ ì°©ê°</strong>ì„ ì¤„ ìˆ˜ ìˆë‹¤!</p>\n<p>ë¬¼ë¡ , ì‹¤ì œ ë°°í¬ë¥¼ í•œë‹¤ë©´ ì´ë¥¼ í•´ê²°í•´ì£¼ê¸° ìœ„í•˜ì—¬ <code class=\"language-text\">https</code>ë¥¼ ë„ì…í•´ì•¼í•  ê²ƒì´ë‹¤. ê·¸ë˜ì•¼ cross-originì— ëŒ€í•œ <code class=\"language-text\">set-cookie</code>ê°€ ê°€ëŠ¥í•˜ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n\t...\n\t<span class=\"token property\">\"proxy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:8000/\"</span><span class=\"token punctuation\">,</span>\n\t...\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>í•µì‹¬ì€ access tokenë§Œ ë¦¬ì•¡íŠ¸ì—ì„œ ê´€ì‹¬ì„ ê°–ëŠ” ê²ƒì´ê³ , refresh tokenì€ ì„œë²„ì— ì˜ì¡´ì ì¸ ë¡œì§ì´ë¼ëŠ” ê²ƒì„ ìœ ë…í•˜ì. access tokenì€ recoil stateë¡œ ê´€ë¦¬ë˜ì–´, ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•˜ì.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// recoil.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> accessTokenState <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">atom</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    key<span class=\"token operator\">:</span> <span class=\"token string\">'accessTokenState'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// App.tsx</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>accessToken<span class=\"token punctuation\">,</span> setAccessToken<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRecoilState</span><span class=\"token punctuation\">(</span>accessTokenState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setLogined</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setLogined</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>accessToken<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>access tokenì˜ ê°’ì´ <code class=\"language-text\">''</code>ê°€ ì•„ë‹ˆë¼ë©´ ë¡œê·¸ì¸ì´ ë˜ì–´ìˆë‹¤ê³  íŒë‹¨í•  ê²ƒì´ë‹¤.</p>\n<h2 id=\"ë¡œê·¸ì¸-ìš”ì²­\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%9A%94%EC%B2%AD\" aria-label=\"ë¡œê·¸ì¸ ìš”ì²­ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë¡œê·¸ì¸ ìš”ì²­</h2>\n<p>ë¡œê·¸ì¸ì€ ì¸ì¦ì´ ì—†ì–´ë„ ë˜ëŠ” ìš”ì²­ì´ê³ , ì„±ê³µí•œë‹¤ë©´ <code class=\"language-text\">accessToken</code>ì„ set í•´ì¤€ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleLogin</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> axiosConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string-property property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/x-www-form-urlencoded\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'login/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'username'</span><span class=\"token operator\">:</span> email<span class=\"token punctuation\">,</span> <span class=\"token string-property property\">'password'</span><span class=\"token operator\">:</span> pw <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> axiosConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ë¡œê·¸ì¸ ì„±ê³µ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">?.</span>access_token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AxiosError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>response<span class=\"token operator\">?.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">401</span> <span class=\"token operator\">||</span> <span class=\"token number\">422</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ë¡œê·¸ì¸ ì‹¤íŒ¨'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"ë¡œê·¸ì•„ì›ƒ\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%95%84%EC%9B%83\" aria-label=\"ë¡œê·¸ì•„ì›ƒ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë¡œê·¸ì•„ì›ƒ</h2>\n<p>ë¡œê·¸ì•„ì›ƒì˜ ê²½ìš°, serverì—ì„œ refresh tokenì„ ì§€ì›Œì¤„ ê²ƒì´ê³ , reactì—ì„œëŠ” access tokenë„ ì§€ì›Œì£¼ë©´ ë  ê²ƒì´ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleLogout</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'logout/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ë¡œê·¸ì•„ì›ƒ ì„±ê³µ'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"refresh-ë¡œì§\" style=\"position:relative;\"><a href=\"#refresh-%EB%A1%9C%EC%A7%81\" aria-label=\"refresh ë¡œì§ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>refresh ë¡œì§</h2>\n<p>ë§Œì•½, access tokenì´ ì—†ê±°ë‚˜, ìœ íš¨í•˜ì§€ ì•Šë‹¤ê³  í–ˆì„ ë•Œ <code class=\"language-text\">refresh</code>ë¥¼ í•´ì¤˜ì•¼í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">refresh</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/** \n     *  refreshí•˜ê³ , access tokenì„ ë¦¬í„´\n     */</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'refresh/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> data<span class=\"token operator\">?.</span>access_token<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>refreshì˜ ê²½ìš°, access tokenë§Œì„ ë¦¬í„´í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. access tokenì„ setí•´ì£¼ëŠ” ë¡œì§ì€ ë”°ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">refreshAndSet</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> accessToken <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// refresh or logout</span>\n    <span class=\"token function\">refreshAndSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ì´ì²˜ëŸ¼ ìƒˆë¡œê³ ì¹¨í•œ ê²½ìš° refreshë¥¼ í•´ì£¼ê³ , ë§Œì•½ refreshê°€ ì•ˆëœë‹¤ë©´ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ë¥¼ í•´ì£¼ë©´ ëœë‹¤.</p>\n<h2 id=\"ì¸ì¦ì´-í•„ìš”í•œ-ìš”ì²­-í•¨ìˆ˜\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-%EC%9A%94%EC%B2%AD-%ED%95%A8%EC%88%98\" aria-label=\"ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ í•¨ìˆ˜ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ í•¨ìˆ˜</h2>\n<p>ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ì— ëŒ€í•œ í•˜ë‚˜ì˜ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë†“ê³  í•„ìš”í• ë•Œë§ˆë‹¤ ì“°ë©´ ì¢‹ì„ ê²ƒì´ë‹¤.</p>\n<p>ì¸ì¦ì´ í•„ìš”í•œ í•¨ìˆ˜ì—ì„œ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>\n<ol>\n<li>\n<p>headerì— access tokenì„ ì‹¤ì–´ì„œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤. ë§Œì•½ 401ì´ë¼ë©´, refreshë¥¼ ìˆ˜í–‰í•˜ì—¬ access tokenì„ ì—…ë°ì´íŠ¸í•œë‹¤.</p>\n</li>\n<li>\n<p>ë‹¤ì‹œ ì›ë˜ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">authGet</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>token<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * urlê³¼ tokenì´ ì£¼ì–´ì¡Œì„ ë•Œ, í•´ë‹¹ get í•¨ìˆ˜ë¥¼ ì‹¤í–‰\n     */</span>\n    <span class=\"token keyword\">const</span> config<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">'Authorization'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>token<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AxiosError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>response<span class=\"token operator\">?.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">401</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// need refresh</span>\n          <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> newToken <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> newConfig<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n              headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string-property property\">'Authorization'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Bearer </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newToken<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">// original request</span>\n            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> newConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> <span class=\"token string\">'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>ë‹¨ìˆœí•˜ê²Œ dataë¥¼ ë¦¬í„´í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ëŠ”ë°, <code class=\"language-text\">react query</code>ì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ë” í¸í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 422px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABc0lEQVQ4y5VTya6CQBDk3/0MPXDgTLx5EoMJGqMX0YNL1CAxaDRuuG/1Up03hEWfeZ00PUPP1BQ1hYbfeL1eUp/PJ87nMzabDcIwlPG7UOvToakmgRj1eh25XA66rqPdbqNQKEiWSiUYhoF8Po9msxkdngbW0uw8z8N0OsVut8PlcsF4PMZwOEQQBNLrdrtYLpcRS7VXVe0T9W8R3xcfC0PqREb7/V50Ox6PUvmOWm632yjVnD3m/X5PMuRjtVqhWq2iXC5LdRxHaqPRwOPx+Mjyer3icDhkAdfrNfr9vujFSs0GgwF6vZ5oN5/PM7lYLKSnXJAA5Oe1Wi1YlgXbtmGaJnzfj1gwb7ebVF4Uk3MlTwaQL2ezmdziZDLBaDQSFtSKm5jU7nQ6CSMmQeM+TQDSLjyReinNqGutVhNdK5UKOp2OHEygOGjmlj/Zhqe7rotisShSUNe/7JNgqAwaNyrtQNaqT/3S694a+z//6bceAX8AsajkOgwG5GUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"client\"\n        title=\"client\"\n        src=\"/static/5fa5a057a716e37cdfc96a9294620cf7/fa5c1/client.png\"\n        srcset=\"/static/5fa5a057a716e37cdfc96a9294620cf7/e9ff0/client.png 180w,\n/static/5fa5a057a716e37cdfc96a9294620cf7/f21e7/client.png 360w,\n/static/5fa5a057a716e37cdfc96a9294620cf7/fa5c1/client.png 422w\"\n        sizes=\"(max-width: 422px) 100vw, 422px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzElEQVQY04WPzWoCMRSF8y5uik8oSJ+qy7py1aWCxZZoGBw7OC5czEyTjPn5NFMGBJ164HDDTe6Xc4UxBq011lqapunOxli89yTFGHmmEEJX5x9LhFKK7Vax3/8g5YY8z5FSdvAhYN9LNYSI83/A1ZdClGVJcpZlFEVBVVV3g4/06E7rX0TbtiSn1Y21OOe6x7cphmAhRtaFY7E7833w1HWDePb7f8DaBF6mJaPJgfHrkeOpRvRpbt0PDa3c912IvH9a3haG2bqluia8AMZO0MPrHmdxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"needlogin\" title=\"needlogin\" src=\"/static/b3e7a723dd513ef0cead3c96b869fa1c/37523/needlogin.png\" srcset=\"/static/b3e7a723dd513ef0cead3c96b869fa1c/e9ff0/needlogin.png 180w,\n/static/b3e7a723dd513ef0cead3c96b869fa1c/f21e7/needlogin.png 360w,\n/static/b3e7a723dd513ef0cead3c96b869fa1c/37523/needlogin.png 720w,\n/static/b3e7a723dd513ef0cead3c96b869fa1c/4c42d/needlogin.png 896w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span></p>\n<p>ë¡œê·¸ì¸í•œë‹¤ë©´, logout ë²„íŠ¼ê³¼ <code class=\"language-text\">ìš”ì²­1</code> ë²„íŠ¼ì´ ë³´ì¼ ê²ƒì´ë‹¤. ìš”ì²­ì„ ëˆ„ë¥¸ë‹¤ë©´ ìƒí™©ì— ë”°ë¼</p>\n<ul>\n<li><code class=\"language-text\">authenticated</code> alertê°€ ë‚˜ì˜¤ê±°ë‚˜(ì¸ì¦ ì™„ë£Œ)</li>\n<li>refresh ì´í›„ <code class=\"language-text\">authenticated</code> alertê°€ ë‚˜ì˜¤ê±°ë‚˜ (refresh ì´í›„ ì¬ì‹¤í–‰)</li>\n<li><code class=\"language-text\">loginì´ í•„ìš”í•©ë‹ˆë‹¤.</code> ê°€ ë‚˜ì˜¬ ê²ƒì´ë‹¤.</li>\n</ul>\n<p>ì½”ë“œëŠ” <a href=\"https://github.com/choieastsea/jwt-fastapi-react/commit/05147a825f426e7ce55f47b6e5eef42172e6f5d4\">ê¹ƒí—ˆë¸Œ</a>ë¥¼ ì°¸ê³ í•˜ì.!</p>\n<h1 id=\"ì •ë¦¬\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"ì •ë¦¬ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ì •ë¦¬</h1>\n<p>ì—¬íƒœê¹Œì§€ jwtì˜ ì›ë¦¬ì™€ ì´ë¥¼ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ êµ¬í˜„í•´ë³´ì•˜ë‹¤. ì‚¬ì‹¤ í† í°ì¸ì¦ì´ë¼ëŠ” ê²ƒì€ ë§¤ìš° ê°„ë‹¨í•œ ê°œë…ì¸ë°, ê·¸ë§Œí¼ ì·¨ì•½ì ì´ ë§ìœ¼ë‹ˆ ì´ë¥¼ ê°œì„ í•œ ë°©ë²• (<code class=\"language-text\">refresh token</code>, <code class=\"language-text\">RTR</code>ê³¼ ê°™ì€)ë“¤ì´ ë§ê³  ì´ë¡œ ì¸í•˜ì—¬ ì–´ë ¤ì›Œì§„ ëŠë‚Œì´ ìˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ, ì´ë ‡ê²Œ ì§ì ‘ êµ¬í˜„í•´ë´ì•¼ ëª¨ë‘ì˜ ìƒí™©ì„ ì•Œ ìˆ˜ ìˆê³  ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì´í•´ë„ë„ ì˜¬ë¼ê°ˆ ê²ƒì´ë‹¤!</p>\n<p>ì˜¤ëŠ˜ê¹Œì§€ì˜ ëª¨ë“  ì½”ë“œëŠ” <a href=\"https://github.com/choieastsea/jwt-fastapi-react\">ì—¬ê¸°</a>ì— ìˆìœ¼ë‹ˆ ì°¸ê³ í•œë‹¤.</p>","frontmatter":{"date":"October 14, 2023","title":"(WEB) JWT token ì¸ì¦ ë„ì…í•˜ê¸° (3)","categories":"WEB","author":"choieastsea","emoji":"ğŸ’¨"},"fields":{"slug":"/WEB-jwt(3)/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Alg-BOJ-4803/","nextSlug":"/WEB-jwt(2)/","prevSlug":"/WEB-jwt(3)/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}