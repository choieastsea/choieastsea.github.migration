{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Django(7)-Search&CORS/",
    "result": {"data":{"cur":{"id":"2216b6bb-30a6-5f7e-8c55-546e561f0708","html":"<p>이전까지 DRF의 CBV를 어떻게 구현하는지 알아보았다. ModelViewSet이 가장 간단하게 구현이 가능했는데, 이를 기반으로 검색기능을 만들어보자.</p>\n<p>Item 모델의 이름(name)에 해당 검색어가 포함되는지를 판단하여 리턴하는 api를 기존 ModelViewSet에다가 만들어보려고 한다. 그리고 가능하다면 실제 브라우저와 연결해보도록 하자!!</p>\n<blockquote>\n<p>요구사항</p>\n<p>[GET] localhost:8000/item/search?name=I</p>\n<p>I를 포함한 name을 갖는 item list를 리턴하도록</p>\n</blockquote>\n<p>우선, 앞으로는 ModelViewSet으로만 처리하기 위해 items/urls.py를 간단하게 해주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path<span class=\"token punctuation\">,</span> include\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> routers\n\nrouter <span class=\"token operator\">=</span> routers<span class=\"token punctuation\">.</span>DefaultRouter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nrouter<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span><span class=\"token string\">r'basic'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemModelViewSet<span class=\"token punctuation\">)</span>\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"modelviewset-클래스-수정\" style=\"position:relative;\"><a href=\"#modelviewset-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\" aria-label=\"modelviewset 클래스 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ModelViewSet 클래스 수정</h2>\n<h3 id=\"code-classlanguage-textget_querysetcode-오버라이딩\" style=\"position:relative;\"><a href=\"#code-classlanguage-textget_querysetcode-%EC%98%A4%EB%B2%84%EB%9D%BC%EC%9D%B4%EB%94%A9\" aria-label=\"code classlanguage textget_querysetcode 오버라이딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">get_queryset()</code> 오버라이딩</h3>\n<p>ModelViewSet에서는 질의가 들어왔을 때, 내부적으로 <code class=\"language-text\">get_queryset()</code>함수를 사용한다. 따라서 이를 오버라이딩하여 쿼리 문자열을 처리할 수 있다. 쿼리 문자열은 <code class=\"language-text\">request.query_params.get()</code>으로 접근할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\t\t<span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        name <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>query_params<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> name <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            queryset <span class=\"token operator\">=</span> queryset<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name__icontains<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> queryset</code></pre></div>\n<p>Django ORM에서 <code class=\"language-text\">{fields}__icontains</code>를 하면 해당 문자열(대소문자 구분 없이)이 포함되는지 여부를 판단한다.</p>\n<p>따라서, 결과는 다음과 같이 잘 나올 것이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 115.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVQ4y61V7ZKrIAzlRVpUEAQRUGt39rZ77/s/1dlJqh13q7vtzP2RIcRwyMcJimEY0OeMpmngvUdKCdM04XQ68Xo+n+97kr7v4ZzbFRFTQugirLUM2nUd+JK+Z1n0ZY0xst+eiNY1OA0JhSrQ2FuUdV2jqiq03kM1Ncqq5AvJRofatmU/rTXbab1HOMaAf+cRQ06ojUFZlnxwWdf62lYUBe/XQnZxOByhjeEby/LR6bsQkDGGU9/6Li6XC67XK4f+G9giSimWTcBxHLmTlP9/ATwcDpBS3mv0LCA1bhNwXZtnAcl3z198d/yiz/sFYC17diFXH1+NdDPCPnbQWjFhiaDeeRhnoaxmGzWL7FRnErpQ/pTy37cJH5c/CKFDCIEBaBx961nP85wTrWgsdV3DWQOt1GbqIucexEUiKpGbDhIw6QS0zC7tc043UnsHQ1FvRCkoDaUqdlxSOh6PtxTXupSsc8qy2K25IP5RjWglfhnXogmRL6iIczy7+/R5iHANWBQScXpHGM7IscX724jgGwZ8tvtfAOkgRediho8ZIXUwtuYUn6WUIJBlNmmcboequZbyDlb+QJWHCLle8yz7NKDNI1rv4GwNo9VLhBfciPlhpSja/sSgMQZMU8+gDFi+AGib2/NOHbU+wHWJa9nQM1/rl8ZSLP8JAi2KcubccRb58ox/ApsZjdoRPSStAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"querystring\" title=\"querystring\" src=\"/static/39f017c613310fc6eb18d1a830e339ef/37523/querystring.png\" srcset=\"/static/39f017c613310fc6eb18d1a830e339ef/e9ff0/querystring.png 180w,\n/static/39f017c613310fc6eb18d1a830e339ef/f21e7/querystring.png 360w,\n/static/39f017c613310fc6eb18d1a830e339ef/37523/querystring.png 720w,\n/static/39f017c613310fc6eb18d1a830e339ef/302a4/querystring.png 1080w,\n/static/39f017c613310fc6eb18d1a830e339ef/e6c84/querystring.png 1148w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<h2 id=\"더-알아볼-것-search-filter\" style=\"position:relative;\"><a href=\"#%EB%8D%94-%EC%95%8C%EC%95%84%EB%B3%BC-%EA%B2%83-search-filter\" aria-label=\"더 알아볼 것 search filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>더 알아볼 것… search filter</h2>\n<p>Django에서는 이러한 search에 대한 필터를 제공해준다. <code class=\"language-text\">django-filter</code> 라이브러리를 설치하고, filter_backends와 filterset_fields만 설정해주면 쿼리에 대한 질의를 알아서 해주는 것이다. 이것은 다음에 알아보도록 하자..</p>\n<h2 id=\"drf-정리\" style=\"position:relative;\"><a href=\"#drf-%EC%A0%95%EB%A6%AC\" aria-label=\"drf 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF 정리</h2>\n<p>여태까지 장고에서 데이터를 처리하는 방법에 대하여 간단하게 알아보았다. 복습을 해보도록 하자.</p>\n<ol>\n<li>\n<p>클라이언트의 요청</p>\n<p>웹서버로 요청이 들어오면 <code class=\"language-text\">wsgi</code>인터페이스에서 장고의 맞는 적절한 url에 요청을 전달해준다. (보통 이때 cors middleware등이 필요하다면 개입)</p>\n</li>\n<li>\n<p>urls.py</p>\n<p>요청이 들어오면 <code class=\"language-text\">urls.py</code>에서 처리해준다. sub url이나 router class로 정의된 라우팅은 include를 통하여 <code class=\"language-text\">url patterns</code>에 매핑된다.</p>\n</li>\n<li>\n<p>views.py</p>\n<p>각 요청은 해당 app의 <code class=\"language-text\">views.py</code>에 있는 함수(Function Based View) 또는 클래스(Class Based View)와 매핑되어 실행된다.</p>\n</li>\n<li>\n<p>model.py</p>\n<p>서버에서 다루는 데이터 모델에 대한 스키마를 정의하는 파일로, 하나의 모델 클래스가 RDB에서의 한 테이블이 될 것이다.</p>\n</li>\n<li>\n<p>seraializers.py</p>\n<p>위에서 정의한 모델의 CRUD에 필요한 직렬화와 역직렬화를 위해 serializer클래스를 이용한다. (역)직렬화하는 방법을 정의할 수 있다.</p>\n</li>\n<li>\n<p>ModelViewSet</p>\n<p>CBV로 구현할 때, 모델에 대한 다양한 기능들을 지원해주는 클래스이다. <code class=\"language-text\">GenericViewSet</code> 클래스에서 CRUD에 필요한 기본적인 mixins 클래스까지 상속되어 있어, <code class=\"language-text\">queryset</code>과 <code class=\"language-text\">serializer_class</code>만 지원해주면 기본적인 요청을 처리할 수 있다. 각 요청에 대한 함수는 오버라이딩할 수 있다.</p>\n</li>\n</ol>\n<h1 id=\"브라우저와-연결하기\" style=\"position:relative;\"><a href=\"#%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EC%99%80-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B8%B0\" aria-label=\"브라우저와 연결하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>브라우저와 연결하기</h1>\n<p>이제는 프론트엔드와 연결할 시간이다 ~ !</p>\n<p>오늘 진행할 프론트 소스코드는 <a href=\"https://github.com/choieastsea/market-guri-react/commit/dfb21bae78b94a86360db2135c1081f7e7b31ddb\">여기에 있다</a>. 미숙한 리액트 실력으로 간단하게 메인페이지를 만들어보았다. 메인페이지에서 아이템을 보여주도록 구현하려고 한다. localhost:3000에다가 띄워놓았고, 해당 페이지는 바로 <a href=\"http://localhost:8000/item/basic/\">http://localhost:8000/item/basic/</a> GET request를 보내도록 설계되어있다. 하지만 error가 나오고, 크롬 개발자 도구를 켜서 확인해보면 <code class=\"language-text\">CORS 에러</code>가 나오는 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9ElEQVQoz6WPz0rDQByElyCIeilGSlEDBjyIiicRU1Ra8AU8WNqk3ewm+syhh55CXiLN7idJiaSCf8CBYZbh+w2ssNZSK89zsixjuVxSFAWr1arpatVMy/0m0YJlWW4dGWM+x7r5p8Hu0X8ttvdtxz/pe05UFVSVZb021L80librzlS2ya9vazZMl2s7kaQhSs8IoxekfEXKCbGaopM5Kpmj0wU6lZt8k6gkQqsQrWaNF/EEGU951xFKR4jx6Q7DgcP9wCHwdnk42yfw9nj0XUYXxzxfeozP+4x8lyffZXhywN2RaBz0Bbeu4KYnuOoJrg8dPgC4EtCRtYmZgAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cors\"\n        title=\"cors\"\n        src=\"/static/dba39126733cacb1f110f083cddc369a/37523/cors.png\"\n        srcset=\"/static/dba39126733cacb1f110f083cddc369a/e9ff0/cors.png 180w,\n/static/dba39126733cacb1f110f083cddc369a/f21e7/cors.png 360w,\n/static/dba39126733cacb1f110f083cddc369a/37523/cors.png 720w,\n/static/dba39126733cacb1f110f083cddc369a/302a4/cors.png 1080w,\n/static/dba39126733cacb1f110f083cddc369a/07a9c/cors.png 1440w,\n/static/dba39126733cacb1f110f083cddc369a/09d8d/cors.png 3012w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>chrome의 network 단에 들어가서 더 자세한 내용을 확인해보자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJUlEQVQoz5WS65KCMAyFeREFuZZyl7YgpbKu7vs/0tlJVpzR0dH98U2TXpKTNN7p+4zz5QfTNONwsLCzg3MLjsuJV2sdjBlhzPARniwbuOWCwTroySITJeI0R5JJJooFtn6IzTbExn/gure9Qr5XlC30YNEqjUYplFWHXNaMyCtmFyYvCXbxDfI9PUyY3ReOyxlS1pwpjNLbhdV+hM78IEKaSSg9QhY1+x4pqZo9mk6ByidFeVGzHez+Hr1jTcIBhayw7wd0e4Nej+h6Wg+cJE7E3YNn+EF8F5h7aMYZ2kzcS7IJKnW99Cro4z4rzPKSFXWksh+41CgRiOLsrbpneKkouH9126NpFY8KjQ0Fow9aM38anOeQSlRmupVLiulz1sD/UfgLz/AmkUatklQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cors1\" title=\"cors1\" src=\"/static/06cb82fbbfa0303ce9825476a2efa235/37523/cors1.png\" srcset=\"/static/06cb82fbbfa0303ce9825476a2efa235/e9ff0/cors1.png 180w,\n/static/06cb82fbbfa0303ce9825476a2efa235/f21e7/cors1.png 360w,\n/static/06cb82fbbfa0303ce9825476a2efa235/37523/cors1.png 720w,\n/static/06cb82fbbfa0303ce9825476a2efa235/302a4/cors1.png 1080w,\n/static/06cb82fbbfa0303ce9825476a2efa235/07a9c/cors1.png 1440w,\n/static/06cb82fbbfa0303ce9825476a2efa235/6f464/cors1.png 1464w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p><code class=\"language-text\">postman</code>에서는 잘되는데, 왜이럴까??!!</p>\n<h2 id=\"간단하게-알아보는-cors-에러\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%98%EA%B2%8C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-cors-%EC%97%90%EB%9F%AC\" aria-label=\"간단하게 알아보는 cors 에러 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단하게 알아보는 CORS 에러</h2>\n<blockquote>\n<p>Cross-Origin-Resource-Sharing</p>\n</blockquote>\n<p>api server와 front server를 분리한 경우에는 항상 발생할 수 밖에 없는 브라우저의 보안 정책이다.</p>\n<p>원칙적으로, 브라우저에서 일어나는 <code class=\"language-text\">AJAX request</code>는 <code class=\"language-text\">SOP</code>(Same Orign Policy)정책을 따른다. 즉, 같은 Origin끼리만 리소스를 공유할 수 있는 것이다. 따라서, 우리와 같이 origin이 다른 경우(<a href=\"http://localhost:3000%E2%86%94http://localhost:8000)%EC%97%90%EB%8A%94\">http://localhost:3000↔http://localhost:8000)에는</a> 이 정책에 의하여 정보 교환이 불가능해지는 것이다.</p>\n<p>이러한 정책이 있는 이유는 악의적인 의도에 있어서 서버를 보호하기 위함이다.(특정 사이트에 악성 코드가 우리 서버로 데이터를 마음껏 접근하도록 할 수 있으므로)</p>\n<p><code class=\"language-text\">safe method</code>로 인하여 장고에서 CORS 에러가 발생하는 단계는 간단하게 다음과 같다.</p>\n<ul>\n<li>\n<p>장고에서 origin을 검사한다</p>\n</li>\n<li>\n<p>origin이 현재 서버의 origin과 다르다면, CORS 에러를 발생시킨다</p>\n</li>\n<li>\n<p>이후, <strong>views.py로 연결이 되어 실행이 되기는 한다</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>META<span class=\"token punctuation\">[</span><span class=\"token string\">'HTTP_ORIGIN'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># CORS error가 발생하더라도 view가 실행됨</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이 코드를 통해서 error가 발생하더라도 view 함수가 실행되는 것은 볼 수 있다.</p>\n</li>\n<li>\n<p>Response는 CORS 에러가 나오게 된다!</p>\n</li>\n</ul>\n<p>이러한 과정은 GET, POST와 같은 <code class=\"language-text\">safe method</code>에서 일어나게 된다. <strong>주의해야할 점은, 장고에서는 safe method(혹은 simple request라고도 함)에 있어서는 view 함수가 실행된다는 것이다!!</strong> 따라서, post나 get 요청으로는 (외부 공격을 막기 위해) 상태를 변경하는 것은 자제하도록 하자.</p>\n<p>PUT/UPDATE/DELETE와 같은 <code class=\"language-text\">unsafe method</code>의 경우에는 브라우저에서 요청을 2개(preflight, main request)로 나눠서 보내게 된다. 따라서, <strong>preflight 요청에서 browser에 의하여 본 요청은 수행되지 않고 CORS 에러를 일으키게 된다</strong>.</p>\n<p>CORS에러에 대한 설명은 <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">MDN docs</a>를 참고하도록 한다.</p>\n<blockquote>\n<p>&#x3C;요약></p>\n<ol>\n<li>request를 보내는 브라우저 클라이언트와 response를 처리하는 server의 ORIGIN이 다른 경우 CORS 에러가 발생한다</li>\n<li>SOP 정책을 사용하더라도 safe method의 경우, 장고는 view 함수가 실행될 수 있으니 주의한다</li>\n<li>unsafe method의 경우, 본 요청 이전의 preflight 요청에 의하여 view 함수가 실행되지 않고 CORS 에러가 발생할 것이다</li>\n<li>장고에서는 django-cors-headers 미들웨어의 CORS_ALLOWED_ORIGINS 리스트에 추가해주도록 하자.</li>\n</ol>\n</blockquote>\n<h2 id=\"그래서-django에서의-해결법은\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-django%EC%97%90%EC%84%9C%EC%9D%98-%ED%95%B4%EA%B2%B0%EB%B2%95%EC%9D%80\" aria-label=\"그래서 django에서의 해결법은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 django에서의 해결법은?</h2>\n<p>CORS를 허용하도록 하는 미들웨어를 설치한다. <code class=\"language-text\">pip install django-cors-headers</code></p>\n<p>settings.py에서 MIDDLEWARE에 다음을 추가한다. <code class=\"language-text\">'corsheaders.middleware.CorsMiddleware', </code> 그리고, <code class=\"language-text\">'django.middleware.common.CommonMiddleware',</code>도 없다면 추가해준다(아마 기본적으로 있긴 할 것) 만약 문제가 생긴다면 해당 미들웨어를 최상단으로 올리는 것을 권장한다고 한다.</p>\n<p>이후에 settings.py에다가 다음을 추가해준다. ORIGIN은 <code class=\"language-text\">{protocol}://{hostname}:{port}</code>의 형식을 의미한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">CORS_ORIGIN_WHITELIST <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n<span class=\"token comment\"># 최근 버전에는 이를 사용한다</span>\nCORS_ALLOWED_ORIGINS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>둘 중 하나로 표기하면 된다. 만약 배포 환경이여도 url host를 적어주면 될 것이다. <code class=\"language-text\">\"*\"</code>로 표기하면 모든 요청에 대하여 허용해주는 것이므로 <strong>권장되지 않는다</strong>.</p>\n<p>추가적인 옵션들이 있는데, 이는 다음에 필요할때마다 넣어주도록 하자. <a href=\"https://pypi.org/project/django-cors-headers/\">django-cors-headers의 공식문서</a>를 참고한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmUlEQVQY03WPUQqFIBBF2//WRCL6kxbgV2ipkab3cQUfGjQwIDPOmTOTlBLrukIIAaUUtm3DsiyY5xkpJbQopfzzHX1vOs8TWmscx1EBzOu6EGOEtRbGGDzPM8D4xzlX6znnEcgioYTw3Yf3vi4KIQyDBHIZofd9D5YTQc2wmbRh2u37XgG9xfvswbDpN8O+yRotef4b+AX/ARXJhkzaJ7nwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cors_solved\"\n        title=\"cors_solved\"\n        src=\"/static/7917f961f61be287c7245b807e207b1c/37523/cors_solved.png\"\n        srcset=\"/static/7917f961f61be287c7245b807e207b1c/e9ff0/cors_solved.png 180w,\n/static/7917f961f61be287c7245b807e207b1c/f21e7/cors_solved.png 360w,\n/static/7917f961f61be287c7245b807e207b1c/37523/cors_solved.png 720w,\n/static/7917f961f61be287c7245b807e207b1c/302a4/cors_solved.png 1080w,\n/static/7917f961f61be287c7245b807e207b1c/07a9c/cors_solved.png 1440w,\n/static/7917f961f61be287c7245b807e207b1c/4faaa/cors_solved.png 2308w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이제 잘 나오는 것을 확인할 수 있다.</p>\n<p>오늘까지 아주 기본적인 장고의 개념과 기본적인 CRUD, 그리고 브라우저에 연결하는 방법까지 알아보았다.</p>\n<p>다음부터는 서비스와 관련하여 필요한 기능들(회원, CSRF, session, 권한)과 관련된 기능들을 공부해보도록 하자. 화이팅</p>\n<p><a href=\"https://github.com/choieastsea/market-guri-django/commit/704c0db7b26c0c6f63f15e709225c4ed82db4b47\">소스코드1</a></p>\n<p><a href=\"https://github.com/choieastsea/market-guri-django/commit/601c2a75fde10d60ccccbff724d08bfa1b7baa42\">소스코드2</a> (CORS 관련 수정한 커밋)</p>","excerpt":"이전까지 DRF의 CBV를 어떻게 구현하는지 알아보았다. ModelViewSet이 가장 간단하게 구현이 가능했는데, 이를 기반으로 검색기능을 만들어보자. Item 모델의 이름(name)에 해당 검색어가 포함되는지를 판단하여 리턴하는 api를 기존 ModelViewSet에다가 만들어보려고 한다. 그리고 가능하다면 실제 브라우저와 연결해보도록 하자!! 요구사항 [GET] localhost:8000/item/search?name=I I를 포함한 name을 갖는 item list를 리턴하도록 우선, 앞으로는 ModelViewSet으로만 처리하기 위해 items/urls.py를 간단하게 해주었다. ModelViewSet 클래스 수정  오버라이딩 ModelViewSet에서는 질의가 들어왔을 때, 내부적으로 함수를 사용한다. 따라서 이를 오버라이딩하여 쿼리 문자열을 처리할 수 있다. 쿼리 문자열은 으로 접근할 수 있다. Django ORM에서 를 하면 해당 문자열(대소문자 구분 없이)이 포함되…","frontmatter":{"date":"April 16, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [7-Search, 브라우저와 연결하기]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(7)-Search&CORS/"}},"next":{"id":"14ee35cd-9837-5380-8e94-1042bcaa938f","html":"<p>저번까지는 DRF의 serailizer에 대하여 공부하였고, 새로운 item을 만드는 api까지 간단하게 만들어보았다. 오늘은 좀 더 다양한 method에 대하여 알아보고, DRF(Django Rest Framework)의 <code class=\"language-text\">ViewSet</code>을 도입하여 rest api에 최적화된 간단한 view구조를 설계해보도록 한다.</p>\n<h2 id=\"다양한-request에-대한-response\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%96%91%ED%95%9C-request%EC%97%90-%EB%8C%80%ED%95%9C-response\" aria-label=\"다양한 request에 대한 response permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다양한 request에 대한 response</h2>\n<p>장고에서는 request와 response를 이렇게 처리한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>shortcuts <span class=\"token keyword\">import</span> render\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>http <span class=\"token keyword\">import</span> HttpResponse\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">my_view</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        post_data <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>POST \n        <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>장고에서는 요청을 HttpRequest객체에서 처리하도록 하고, 응답은 HttpResponse객체에서 처리하도록 한다.</p>\n<p>이렇게 요청에 대하여 함수에서 처리하도록 하는 것을 <code class=\"language-text\">Function Based View(FBV)</code>라고 하며, 뷰 클래스에서 처리하도록 하는 <code class=\"language-text\">Class Based View(CBV)</code> 역시 존재한다.</p>\n<h3 id=\"in-drf\" style=\"position:relative;\"><a href=\"#in-drf\" aria-label=\"in drf permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>in drf</h3>\n<p>DRF에서도 request와 response를 받는 방법을 CBV,FBV로 나눠볼 수 있다. 우리가 저번에 <code class=\"language-text\">@api_view(['POST'])</code> 데코레이터를 이용해 처리한 방법이 FBV이며, 오늘은 CBV에 대하여 알아보자.</p>\n<p>가장 기본적인 <code class=\"language-text\">APIView</code> 클래스를 상속하여 뷰 클래스를 만들어보자. 이는 <code class=\"language-text\">from rest_framework.views import APIView</code>로 임포트하고 클래스를 상속받도록 구현하면 된다.</p>\n<p>저번까지는 전체 item list를 얻는 것과 item을 추가하는 것에 대하여 알아보았으니 오늘은 특정 아이템을 다루는 것까지 구현해보자. 클래스 안에서 Rest request Method에 해당하는 이름으로 만들어주면 된다. item/views.py를 다음과 같이 추가해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">import</span> Response\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>views <span class=\"token keyword\">import</span> APIView\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>http <span class=\"token keyword\">import</span> Http404\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> status\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> ItemSerializer\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemListView</span><span class=\"token punctuation\">(</span>APIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    item list를 리턴하거나 새로운 item을 create하는 클래스\n    \"\"\"</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        items <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">,</span> many<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_201_CREATED<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_400_BAD_REQUEST<span class=\"token punctuation\">)</span> \n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemDetailView</span><span class=\"token punctuation\">(</span>APIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    특정 pk의 Item을 Read, Update, Delete하는 클래스\n    요청에 대하여 pk가 주어져야 한다\n    \"\"\"</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_object</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 특정 pk의 Item을 리턴</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>pk<span class=\"token operator\">=</span>pk<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">except</span> Item<span class=\"token punctuation\">.</span>DoesNotExist<span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># Item이 없다면 DoesNotExist error throw</span>\n            <span class=\"token comment\"># 이에 404오류를 발생시키도록 한다</span>\n            <span class=\"token keyword\">raise</span> Http404\n        \n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        item <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_object<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span> <span class=\"token comment\"># error 발생하면 이후 실행되지 않고 바로 404 response</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 직렬화(DB to json) 수행, 하나이므로 many=True일 필요없음</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        item <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_object<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token comment\"># serailizer의 update 함수 수행</span>\n        <span class=\"token keyword\">if</span> serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_400_BAD_REQUEST<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        item <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_object<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span>\n        item<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\"># pk 기반의 삭제는 serializer를 사용하지 않고 ORM의 delete를 수행한다</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_204_NO_CONTENT<span class=\"token punctuation\">)</span></code></pre></div>\n<p>각 메소드 별로 pk가 필요한 경우가 있으므로 이에 따라 url pattern이 달라지므로 별개의 클래스로 나누었다.(하나의 클래스가 하나의 url에 매핑되는 것이 원칙)</p>\n<p>함수 이름은 정해져 있으니 주의해야한다. 또한, pk와 같이 url path이 필요한 경우에는 함수에 인자를 pk와 같이 추가해줘서 가져올 수 있다. 그리고 get_object로 가장 기본적인 함수를 정의한 이후에 해당 인스턴스가 필요한 상황에 이를 가져와 사용하면 된다.</p>\n<p>이제 url로 요청을 보내보기 위해 item/urls.py를 수정해주자. CBV로 구현한다면 url을 <code class=\"language-text\">as_view()</code> 함수로 매핑해줄 수 있다. 이러한 방법으로 여러 method에 대해 대응할 수 있는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'create/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>create_item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'list/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemListView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># get list / create</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'detail/&lt;int:pk>/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemDetailView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># get one / update / delete</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>이제 postman에서 테스트해보자!</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 154.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAABYlAAAWJQFJUiTwAAADTklEQVRIx5VWWXLaQBTUQQzaZh+NdkAC27FxwUfuf59OvSfEkmBwPrpm0Uyr3ypFxhh476GUgtaaQXvW2jOccww6N89pfz5/jej19RWHw4EPFEWBsiwZHx8f+Pz8ZHx9fTGOxyP2+z3Ph2FgYrpzjUhKCSEEaJzxk/W8N8/ndUSm1nXNizzPUVXVWWmWZdBK83NXeIjSII5jPkPmEUkIgdc0ssIilLDO8QF3Go01/FAZDWn1+RmdI//Siwn0QhonhdNetB9WCEYhFwJlCLxJl2gujUbmJKSQ54CQr5MkwXK5xGKxYMWE5WmMhq7BYf+JcRz58GyONgZVWaEswlkhuYFMI/eQBW3b8r5UCm3h4I1G1K9WOByPeH9740Nd151ThOZN00yKyxJ93zMJEdJ6s9lMrtEaDRFag4hkknSpJF98eXlhk9iM5ZLx3Zru0XxaJ4iTBFGappzU12lBe9egC3/vfYeIDs8kFLUsSyGkQug28E0P4wO0ksjo+Q9ewISkcE6BNEkgKDeHV9hQwSmBbV+hLT3awsIo+ZyQFJIyIkziGNJYNOM7XN3Beo/VbsBq7DkvyXezynvEV4QZgxI0y3NWR+aaooI0DkIKKC2f+vNk8oXQWscql4sFI14ueH2j6Bt1d3w4keZSwVUNXNnA+IJTKrkT9bsmT6osL9iHHBQ9+bBqOfvXdYHgDGpnngeFCCmhL4QxpDYTISm0BsNujc3YwzrD5j704aTwQsgmUzNoetiyhi0b2FBDG42i9De+fGoyzamOKQgUjJjK7NRFZqJHZP8S5hkE9TohoZyHsp5zklLmWTAe+pCDsv2F0K2nluYtrJI/qul/fJieokylR0lNdbwZOqyHjpUmPwvKJW3SdCKs1lv4uoNvOhRtDx8cjL2U3kNC5y5BmVv8TSDi5CZdnvgw5cjSSIRc1/ThUZorJlcaaZZx86Qmeh2Y/6qUenibeqL36MsCXitYJSBF/jzKs8kXHyrUmx1MUcLIHLuxxW7bcxlKIW7q+htCd/YhJbJQBtVmNwWlbhH6FUIdYJzBYkHflPQm0a9xNpnUSSn4k8lz+s4Q6A+B/yoyfs6N+NTq7iGaDkqs1h1+//7AZl1gO9YYh/IvVIzt+Bh/ABnQgFeyik5pAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"list\" title=\"list\" src=\"/static/554611d1e389382110cd483f942f8e71/37523/list.png\" srcset=\"/static/554611d1e389382110cd483f942f8e71/e9ff0/list.png 180w,\n/static/554611d1e389382110cd483f942f8e71/f21e7/list.png 360w,\n/static/554611d1e389382110cd483f942f8e71/37523/list.png 720w,\n/static/554611d1e389382110cd483f942f8e71/ef6b9/list.png 832w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>이번에는 특정 pk에 접근하는 클래스를 보도록 하자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 77.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCElEQVQ4y42T2XLbMAxF9SOxVkqkNqra7XgbezxO/eD//5vbuZDpcZp2kocjEsJCAAS9uq7hKMsSTdNgGAaRq6oSmf+DIEAYht/i7XY7bDYb7Pd7bLdbgf8cx+MRbdvC9/0vzjzkb7y3t7en0hnSebVaCdRTF0WREMfxc1VKfcG73++w1qIoimeZ6/Ual8sF5/NZ1tPphOv1+ml/OBzEh+14xeMnyzIhTVNBay3GJM9zwTm7PXH2r3hlWcAYI6W+nkhlGASSMf+rysAPA+hMS1C2gXbU0Yb/WKmXai3ZsScuU2bIgLFKoI1ZZJMhTpa+Ucc+ur3WrE6Jnffet6LkeDDTJEmeo6KsQaRiFPnSX2ZAW14WL86xesC9d5gGGQumrB/Z8lTjMnv0hjJhVjyU9rRNEoVUJTBZioBz+PH7htvtJkG7rhNo3Pc95nl+9nAcR7l97hmYM9q1LUyeo84NNq2FzzmMonA5scjhSykrBI/0X2fTDe6rzJX+IruXwmBsqDEaYRTDVBa6qKC0kUsIglD64wL863V8eikMuDj6UJnGr/UORdOhNAZdlaPUKWqTIUvVj97zEjCOpURmZcd36NJC6xTT3GOaOxi9zKTvB9InWf+DBOTN5bmGyQ269Qa269EMg2CbEpUtkCQR0jT5Fo9zpY3G9XpE3xWYJ4tpsrKOQyVMY/1j/gCQttlqGWE7pAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"detail1\" title=\"detail1\" src=\"/static/a0f6678b10048341c920efd0760afb5c/37523/detail1.png\" srcset=\"/static/a0f6678b10048341c920efd0760afb5c/e9ff0/detail1.png 180w,\n/static/a0f6678b10048341c920efd0760afb5c/f21e7/detail1.png 360w,\n/static/a0f6678b10048341c920efd0760afb5c/37523/detail1.png 720w,\n/static/a0f6678b10048341c920efd0760afb5c/ad12c/detail1.png 856w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>같은 url에 대하여 다양한 method로 접근이 가능한 것도 확인이 가능하다! 예를 들어, PUT 메소드로 보내면 body에 아무것도 적지 않았으므로 error가 나올것이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 73.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1UlEQVQ4y5VTYXOkIAzll6gIBARUUNne3rbTbe///6Z3E1y3N9ftdPrhGYlJeC+JYp5njOMI5xyGYQCfl2VBzhnruu7gc0r1O8cdsf9bhkgpYZqm6vTe10LbtlWUUrBuG9ZSkJcF/pb0FbiGMMaAoZSqDiKClBLWWvSkIHuJMgcoLaEN3RlyPBlTY7mYJYO2bSFCCIgxViezZfn8zqyPdpQlYwwBOYaqgv0cw7ncErIOyq+QyuwMD7pEBpYIWuvKlFkyiEEER7sa9h3KOJfjlXHolYZgyuxgmCFCaYPREcbBQkmJpmnRNM3NPkJTpbY3K2oviJBzxPOfd5xfLnh9f8b17RdyYnnDjyBk11Wpg3fQWsHcZNV3c0CDjK72w/cYQhuDvu/r1NhqpdFrhV6pvTdKoeskuq672R3cqkcQL6cNOc33SU885THAOotpnKqfLzpWS6m+nvmChwXPTye8Xa91PY6i/Ff4f1aHN4DXw/uAyQ/wltC2e8Gd+QcEP/h2srzQfZ1y23V1YkfQkShl96XUO0OWwL3ink2n3whTwpYiUhxgtPrE4DuIYyCMuBS4EJHXjLzMtVffMfrEkKuG4HG5FJQy4+m8opwStm3EtkasS/gR/gLuDbYgvatU4wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"detail2\" title=\"detail2\" src=\"/static/c9772edc8c23ed39d0b4c54bc3a18b96/37523/detail2.png\" srcset=\"/static/c9772edc8c23ed39d0b4c54bc3a18b96/e9ff0/detail2.png 180w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/f21e7/detail2.png 360w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/37523/detail2.png 720w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/302a4/detail2.png 1080w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/cd78c/detail2.png 1236w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>하지만, update는 바꿀 값들만 body에 실어서 보내는 것이 더 편하다. 이는 Serializing을 해줄 때, <strong>partial=True</strong> 옵션을 넣어주면 된다.</p>\n<p><code class=\"language-text\">serializer = ItemSerializer(item, data=request.data, partial=True)</code></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvUlEQVQ4y5VTWW7rMAzUSSJbuyxZ8m4j6Ffvf6d5IGO3CZAAfR9jUjSXEUmJaZowDANCCOi6DvM8Y9s2rOuKfd8Zx75jWRb2iTF+BMWLvu+RUoL3ng2lFAYVqUNlfZwn5L5HDL/BV3KKu87OOQhrLQjGmB9j27YIPkA5A60V9iFD6xbWup9grTX7KqUecdZCSglxsSI5jiOIMenEkFnWinmeUHLGXDK6lNhOPuS7bSuMC9B5hdIW4qpkiZnSUAStmUHbqie0T1AvetO0aE4piLL3DuNUMK0ThqlgPwasW0VKHjn/HwRVIDZd5xGCRQyW5aU/n/8C0TQNCLebhJS/8tJvUkKePmRrzn+fILoYmSGNn6YdvIcJFtY99GvqlPC5j9SqdxDf9wPHvvHEUs4s+1oQYuAJ0wbQSqWu44LeWRitHwVO5s8QtCr3+x05Z2ZEA8opw/vAC38t/VArfAjIMcBbw214nfwDgpaRlpeqa+dhaaFVi0ZKBv1/9O+UJ5N3beCE1D+6Et2/7l9IpeJYBixDD2c079Y7Js0nhvShhIRYRsRckGpF6tNL4KcEbxPye3aWDdqYl5fw10RXwn/OF7Fu812yGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"detail3\" title=\"detail3\" src=\"/static/6a3e47feac01b44b7541a24940afb9cf/37523/detail3.png\" srcset=\"/static/6a3e47feac01b44b7541a24940afb9cf/e9ff0/detail3.png 180w,\n/static/6a3e47feac01b44b7541a24940afb9cf/f21e7/detail3.png 360w,\n/static/6a3e47feac01b44b7541a24940afb9cf/37523/detail3.png 720w,\n/static/6a3e47feac01b44b7541a24940afb9cf/302a4/detail3.png 1080w,\n/static/6a3e47feac01b44b7541a24940afb9cf/636d3/detail3.png 1222w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>여기까지 <code class=\"language-text\">APIView</code>를 이용하여 구현한 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/98e15e109dd411a729244eff3d0c7ede484ee9b8\">여기를 참고</a>한다.</p>\n<p>FBV와 CBV를 모두 구현해보았다. 더 자세한 설명은 <a href=\"https://www.django-rest-framework.org/api-guide/views/\">공식문서</a>를 참고하도록 하자.</p>\n<h2 id=\"drf의-클래스를-이용하여-코드를-짧게-만들기\" style=\"position:relative;\"><a href=\"#drf%EC%9D%98-%ED%81%B4%EB%9E%98%EC%8A%A4%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%A7%A7%EA%B2%8C-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"drf의 클래스를 이용하여 코드를 짧게 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF의 클래스를 이용하여 코드를 짧게 만들기</h2>\n<p>위에서는 APIView를 이용하여 구현해주었다. 하지만, 생각해보면 위에서 구현한 것처럼 매우 간단한 rest api는 다른 모델이라도 모델과 시리얼라이저만 제외하면 같은 코드를 반복적으로 적어야한다. 이는 장고의 설계 원칙 중 하나인 <a href=\"https://docs.djangoproject.com/ko/4.2/misc/design-philosophies/\">DRY</a>에 어긋난다! CBV를 위한 클래스의 상속구조를 알아보자.</p>\n<p>CBV를 위한 클래스는 View > APIView > Mixins > GenericAPIView > ViewSet > ModelViewSet 의 순서로 상속이 되어있다고 보면 될 것 같다. 갈수록 추상화되어있으므로 코드는 줄어들지만 자유도 역시 줄어들 것이다. 따라서, 필요한 기능이 있는 부분을 정리하고 다중 상속을 통하여 기능을 구현할 수 있을 것이다. 순서대로 간단하게 알아보도록 하자.</p>\n<ul>\n<li>\n<p>APIView : pk가 필요한 액션과 그렇지 않은 액션으로 method를 구분하여 구현할 수 있는 클래스. 하지만, 함수들을 보면 공통적으로 모델(혹은 queryset)과 serializer를 선언하는 부분이 겹치는 것을 볼 수 있다.</p>\n</li>\n<li>\n<p>Mixins : APIView의 CRUD 기능들을 각자 구현해 놓은 클래스. queryset과 serializer가 중복되므로 이를 공통으로 해결해준다. 또한 각자 method에서 필요한 mixins 함수를 호출하도록 한다</p>\n</li>\n<li>\n<p>GenericView : GenericAPIView와 mixins의 함수들의 조합으로 구성한 클래스</p>\n</li>\n<li>\n<p>ViewSet</p>\n</li>\n<li>\n<p>ModelViewSet</p>\n</li>\n</ul>\n<h3 id=\"genericapiview--mixins를-이용하여-구현\" style=\"position:relative;\"><a href=\"#genericapiview--mixins%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EA%B5%AC%ED%98%84\" aria-label=\"genericapiview  mixins를 이용하여 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GenericAPIView + mixins를 이용하여 구현</h3>\n<p>get all 또는 post를 담당하던 APIView 기반 클래스를 mixins를 이용하여 구현해보자.</p>\n<p>items/views.py에 다음과 같이 추가해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> generics<span class=\"token punctuation\">,</span> mixins\n\n<span class=\"token comment\"># GenericAPIView + mixins 이용한 CBV</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemListGenericAPIView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>GenericAPIView<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>ListModelMixin<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>CreateModelMixin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    GenericAPIView를 이용하여 item의 리스트를 얻도록 하는 클래스\n    queryset과 serailizer_class 정의해줘야함.\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># get override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.ListModelMixin</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># post override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.CreateModelMixin</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemDetailGenericAPIView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>GenericAPIView<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>RetrieveModelMixin<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>UpdateModelMixin<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>DestroyModelMixin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>retrieve<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.RetrieveModelMixin</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># update override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.UpdateModelMixin</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># delete override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>destroy<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.DestroyModelMixin</span>\n</code></pre></div>\n<p>APIView보다 로직적으로 겹치는 부분이 줄어들었음을 확인할 수 있다.</p>\n<p>mixins 클래스는 기능별로 존재하며, 위에서 사용한 list와 create 이외에도 retrieve, update, destroy에 대한 클래스가 존재하며 해당 클래스의 함수를 호출하면 된다.</p>\n<p>하지만, GenericApiView를 이용하면 필요한 기능의 mixins를 같이 상속해서 구현해줘야 한다. 이를 좀 더 짧게 만들어보자.</p>\n<h3 id=\"generic-views를-이용하여-구현\" style=\"position:relative;\"><a href=\"#generic-views%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EA%B5%AC%ED%98%84\" aria-label=\"generic views를 이용하여 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generic Views를 이용하여 구현</h3>\n<p>결국 역할은 크게 두개로 나눠볼 수 있다.</p>\n<ol>\n<li>list get / create new model -> <code class=\"language-text\">ListCreateAPIView</code></li>\n<li>get/update/delete specific model -> <code class=\"language-text\">RetrieveUpdateDestroyAPIView</code></li>\n</ol>\n<p>이에 대하여 GenericAPIView와 mixins 클래스를 조합한 generic view class가 존재한다. 따라서, 기능에 맞게 이를 가져다 쓰면 될 것같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Generic 이용한 CBV</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemDetailGenericView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>RetrieveUpdateDestroyAPIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    GenericView를 이용하여 item의 특정정보를 얻거나, 업데이트, 삭제 하도록 하는 클래스 \n    queryset, serializer_class를 정의해야함\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemListGenericView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>ListCreateAPIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    GenericView를 이용하여 item의 list얻거나 create 하도록 하는 클래스 \n    queryset, serializer_class를 정의해야함\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer</code></pre></div>\n<p>이러고, urls.py에서도 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">path<span class=\"token punctuation\">(</span><span class=\"token string\">'list/generics/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemListGenericView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\npath<span class=\"token punctuation\">(</span><span class=\"token string\">'detail/generics/&lt;int:pk>/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemDetailGenericView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>단 세줄만으로 이 모든 기능이 가능해지는 것이다!! 여기서는 한번에 update, delete, get을 처리하는 generic view 클래스를 상속받았지만, 상황에 따라 필요한 조합의 method만 갖는 클래스를 상속하면 된다. 그렇다면 해당 method를 알아서 처리해줄 것이다.</p>\n<p>위의 코드는 partial update 등의 기능이 불가능하다. 이는 update함수를 오버라이드하면 될 것이다. 그거까지 포함한 기능을 밑에서 구현해보자.</p>\n<p>상속관계가 좀 어렵게 느껴지는데, 이는 <a href=\"https://www.django-rest-framework.org/api-guide/generic-views/\">공식문서</a>의 extends란을 참고하면 될 것 같다.</p>\n<h3 id=\"viewset과-modelviewset을-이용한-구현\" style=\"position:relative;\"><a href=\"#viewset%EA%B3%BC-modelviewset%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\" aria-label=\"viewset과 modelviewset을 이용한 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ViewSet과 ModelViewSet을 이용한 구현</h3>\n<p>GenericView는 url path에 따라서 url pattern을 추가적으로 적어줘야하는 귀찮음이 있다. 예를 들어, 바로 위의 코드도 보면 내용은 같은데 상속하는 것만 다르고, 이에 따라 url pattern도 여러개가 된다. 따라서, 이를 router 클래스를 이용해서 처리해주고 ModelViewSet에서 한번에 list와 detail의 모든 기능을 수행하도록 할 수 있다.</p>\n<p>ViewSet를 이용하여 구현하려면, <code class=\"language-text\">GenericViewSet</code>과 필요한 기능의 <code class=\"language-text\">mixins</code>들을 임포트해서 사용하면 될 것이다. ModelViewSet은 모델을 다루는데 필요한 모든 mixins들을 넣어놓은 클래스라고 보면 된다.</p>\n<blockquote>\n<p>ModelViewSet은 mixins.CreateModelMixin, mixins.RetrieveModelMixin, mixins.UpdateModelMixin, mixins.ListModelMixin, mixins.DestroyModelMixin,  GenericViewSet를 상속함</p>\n</blockquote>\n<p><a href=\"https://github.com/encode/django-rest-framework/blob/master/rest_framework/viewsets.py\">출처 : DRF github</a></p>\n<p>위의 <code class=\"language-text\">ItemListView</code>와 <code class=\"language-text\">ItemDetailView</code>의 모든 기능을 단 몇줄만으로 구현이 가능하다! (partial update를 위하여 update 함수를 오버라이딩해주었다)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ModelViewSet 이용한 CBV</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    ModelViewSet을 이용하여 item의 모든 기능을 제공하는 클래스\n    queryset, serializer_class만 정의하면 다양한 패턴에 대하여 구현 가능\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        kwargs<span class=\"token punctuation\">[</span><span class=\"token string\">'partial'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span> <span class=\"token comment\"># for partial update</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제 url과 연결해주면 되는데, rest_framework의 router class를 이용하면 매우 간편하게 처리할 수 있다.</p>\n<p>router class에서 제공하는 url 패턴은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">URL pattern: ^users/$ Name: 'user-list'\nURL pattern: ^users/{pk}/$ Name: 'user-detail'</code></pre></div>\n<p>따라서 우리 item/urls.py에 다음과 같이 추가해줄 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path<span class=\"token punctuation\">,</span> include\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> routers\n\nrouter <span class=\"token operator\">=</span> routers<span class=\"token punctuation\">.</span>DefaultRouter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nrouter<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span><span class=\"token string\">r'mvs'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemModelViewSet<span class=\"token punctuation\">)</span>\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>이렇게 하면 다양한 url pattern에 대하여 오늘까지 적용했던 모든 처리가 가능하다! 커밋내용을 보면, APIView부터 ModelViewSet까지의 코드를 다 적어놨으니 이해하기 편할 것이다!</p>\n<blockquote>\n<p>[GET] <a href=\"http://localhost:8000/item/mvs/1/\">http://localhost:8000/item/mvs/1/</a></p>\n<p>{</p>\n<p>​    “item_id”: 1,</p>\n<p>“name”: “Iphone G14”,</p>\n<p>​    “price”: 1700000,</p>\n<p>​    “stock_count”: 10</p>\n<p>}</p>\n</blockquote>\n<p>create도 테스트해보았다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 73.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABz0lEQVQ4y5VT2W7bMBDUl1jiTZGUeIm2gbhG//+npljSDpK0DtKHwVLa5ezswel8PmPfd1hr4b1HKQW11o7WGo7jQMkZ3rkes67rt5jowrZt74Q550+kdE6lYHXu08Wv5Pbxb1JKQQgBsuSQUoIxBmsMFiUgOcclBzDBoLR+J+OcQ2sNxnj/NlphnmdMpI6UOeeQUkIIoZ9jjL0VMe44SkYk9VvAuo44iqHYo1YoYyFcBZcaE2XRj8xPhaRWKd0VDb+BVqqrID/9GzEKxhgIKcGlARcCE0mnkimQHCbsUFLCW41VKwjOcDrNmOell/TVnuYZy7JgediJyCgjZafG1rc7Yq24vl2RUoAUHFJSQv4jTDQArSRaiyglIEWHnANipF45pLgO+0NMQio8y+Zc9LKZ/NAGIfrUl4UNy4Z9hel+aX1aBBpKX/IwVoPONE1KSOQjMQfnrPfrn4S/779wu93wXJ++3Cl1cloPIqUzPQCy0TtY2rlXhFSCtWYsNOd99BRMeKVilP6CsL8S6pXSiNcb/LYjbQ7eaCghBumD/CNe9pAIqS80nK1eYH1AbQXerw8i9hfZd+hr44NDO0e0S8H5WnG0iNY25OxQsv8v/AELbrYcEcFbqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"modelviewset\" title=\"modelviewset\" src=\"/static/983c5db823ccd95d7eba7551db2e2bab/37523/modelviewset.png\" srcset=\"/static/983c5db823ccd95d7eba7551db2e2bab/e9ff0/modelviewset.png 180w,\n/static/983c5db823ccd95d7eba7551db2e2bab/f21e7/modelviewset.png 360w,\n/static/983c5db823ccd95d7eba7551db2e2bab/37523/modelviewset.png 720w,\n/static/983c5db823ccd95d7eba7551db2e2bab/302a4/modelviewset.png 1080w,\n/static/983c5db823ccd95d7eba7551db2e2bab/c929c/modelviewset.png 1218w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>따라서, 복잡한 로직을 처리하는 것이 아니라면 ModelViewSet에서 가장 짧은 코드로 CRUD를 구현할 수 있다.</p>\n<p>만약 CRUD에서 부가적으로 처리해야할 일들이 많다면 상황에 따라 ViewSet의 부모 클래스인 APIView부터 적용해볼 수 있을 것이다. 하지만, ViewSet 혹은 ModelViewSet에서 오버라이딩 하면서 기능들을 구현하는 것이 더 편할 수도 있다.</p>\n<p>물론, 개발자의 자유도에 따라 trade-off가 존재할 것이다. 따라서, DRF의 상속 구조를 어느정도 이해하고, 필요한 상황에 어떤 구조를 사용할지 생각할 수 있도록 공부할 필요가 있다. DRF의 <a href=\"https://www.django-rest-framework.org/tutorial/3-class-based-views/\">CBV 공식문서</a>를 참고하면 좋을 것이다! 간단한 로직에 있어서 장고가 매우 편한 것 같다…</p>\n<p>CBV를 다룬 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/eee0627c2061e4852707e6005e9e15dd3f65803b\">여기를 참고</a>한다.</p>","frontmatter":{"date":"April 15, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [6-DRF CBV(APIView부터 ViewSet까지)]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(6)-request-response/"}},"prev":{"id":"547ad7ca-81ab-59f0-8b59-28fabce02cf6","html":"<p>이전까지 장고와 리액트 서버를 연결해보았고, 이때 생길 수 있는 문제인 CORS 정책을 해결하는 것까지 알아보았다. 오늘은 간단하게 장고에서 지원하는 사용자 모델에 대하여 알아보고, 회원가입과 로그인/로그아웃 등의 기능을 구현해보자.</p>\n<h2 id=\"장고에서-제공하는-user-model\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0%EC%97%90%EC%84%9C-%EC%A0%9C%EA%B3%B5%ED%95%98%EB%8A%94-user-model\" aria-label=\"장고에서 제공하는 user model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고에서 제공하는 User Model</h2>\n<p>장고에서는 사용자와 관련한 많은 기능들이 포함된 User Model class가 기본적으로 제공된다. <a href=\"https://docs.djangoproject.com/en/4.2/ref/contrib/auth/\">공식문서</a></p>\n<p>settings.py에서 User관련한 것들을 추가하지 않고 migration을 진행하였다면 DB에 auth_~로 시작하는 테이블이 만들어져있을 것이다. 하지만, 여기서 제공하는 user의 필드는 id, password, last_login, is_superuser, username, first_name, last_name, email, is_staff, is_active, date_joined 정도이다. 로그인은 username과 password를 기반으로 이루어지며, is_active한 사용자만 authentication이 가능할 것이다.</p>\n<p>만약, 기본적인 user model를 커스텀하고 싶다면 어떻게 해야할까? 크게 몇가지 방법이 있다고 하지만, 마이그레이션까지 완료한 우리의 상태에서는 가장 간단한 1:1 model을 만드는 방법으로 사용자 모델을 확장시켜보도록 하자.</p>\n<h3 id=\"1--1-model을-이용한-user-model-확장\" style=\"position:relative;\"><a href=\"#1--1-model%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-user-model-%ED%99%95%EC%9E%A5\" aria-label=\"1  1 model을 이용한 user model 확장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1 : 1 model을 이용한 user model 확장</h3>\n<p>회원과 관련된 새로운 app을 만들어서 관리하도록 하자.</p>\n<p><code class=\"language-text\">python manage.py startapp myuser</code> 로 새로운 앱을 만들어주었다. settings.py의 INSTALLED_APPS에도 <code class=\"language-text\">myuser</code>를 추가해주었다.</p>\n<p>myuser/model.py에서 다음과 같이 작성하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> User\n<span class=\"token comment\"># Create your models here.</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Profile</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># OneToOne Field로 django의 User model과 연결</span>\n    user <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>OneToOneField<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'계정'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># additional fields</span>\n    phone_number <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'전화번호'</span><span class=\"token punctuation\">)</span>\n    address <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'주소'</span><span class=\"token punctuation\">)</span>\n\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__str__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>username\n    \n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'profile'</span>\n        verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'회원'</span>\n        verbose_name_plural <span class=\"token operator\">=</span> <span class=\"token string\">'회원들'</span>\n</code></pre></div>\n<p>model 클래스의 str 함수는 print와 같이 인스턴스를 문자열로 변환할 때 사용되며, 이는 관리자 페이지에서 식별하기 쉽게 도와준다.</p>\n<p><code class=\"language-text\">python manage.py makemigrations myuser</code> 와 <code class=\"language-text\">python manage.py migrate myuser</code> 명령어로 마이그레이션을 적용해준다.</p>\n<p>이제, 회원을 생성해보자.</p>\n<h3 id=\"관리자페이지에서-custom-user-profile-추가하기\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EB%A6%AC%EC%9E%90%ED%8E%98%EC%9D%B4%EC%A7%80%EC%97%90%EC%84%9C-custom-user-profile-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" aria-label=\"관리자페이지에서 custom user profile 추가하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관리자페이지에서 custom user profile 추가하기</h3>\n<p>myuser/admin.py에서 방금 만들어준 모델을 추가해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib <span class=\"token keyword\">import</span> admin\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Profile\n<span class=\"token comment\"># Register your models here.</span>\n\nadmin<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span>Profile<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이후, 관리자 페이지에 가면 다음과 같이 Profile 객체를 추가할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQoz43STU8TQRjA8f1k6oW7N7+GJJL0ool4MUbjhxAUjXCAKBp5tyLYuvJiW2yh21LqLha6bbfd7szuzN/sQJoQPfAkv8zb7jNPZsYayzzjzuRjbj94wljmKTfuPTduTlx165qszMwqj+bWmJxb5+FclvtvN8i8XmPi1SrjU8uMT68Yd6eWr8Xar3tsFByypTr5qkfO8fh25JJ3PE57IZ4fGO1QGH4o8YfyojXEaC1l2bVTZvNlFvdrvN+rmfbdXpWFnQoiTkikQKuEUWiFiuO0c+lqWJFMCKMYrUGpC4mCdF4pTRAEJEqhtEZrzXAY0en2iGPBUIRm03Qt/TZlbR5WeZPLMZOzmdqymd62ebH1nZfbNgMhEVFEFEWjCjrBEKfRwm0FdEPo9BXtIDaSRGENIhe/fwA4KF1Fa4dEHdGPymgd0x+ECClHVXZ7AU3Xo3Xepu13DSFj4rRSpbB2G+cslZos7jeY36mzsFtnfueYDz9PGESS/4f+R5osPRKrftbFdlwOT33KXpuK53PgnmHXTsyv67u/mM3+YO3ghKXCMcvFBiulBl8PXT4VjlkqNvjTCYilNEdjSSFo+R1ULCG9TZWgE0E/7JmE26UqH/NFto5csuUmXypNNiu/SV/H58vxeW9gEgoh+AvtbMBjOWitOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20230424095336175\"\n        title=\"image-20230424095336175\"\n        src=\"/static/43ab64bbaa96faed5de7682b92bfae37/37523/admin-signup.png\"\n        srcset=\"/static/43ab64bbaa96faed5de7682b92bfae37/e9ff0/admin-signup.png 180w,\n/static/43ab64bbaa96faed5de7682b92bfae37/f21e7/admin-signup.png 360w,\n/static/43ab64bbaa96faed5de7682b92bfae37/37523/admin-signup.png 720w,\n/static/43ab64bbaa96faed5de7682b92bfae37/302a4/admin-signup.png 1080w,\n/static/43ab64bbaa96faed5de7682b92bfae37/07a9c/admin-signup.png 1440w,\n/static/43ab64bbaa96faed5de7682b92bfae37/81315/admin-signup.png 1656w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>하지만, 이는 기존 User Model이 존재해야한다. 여기서는 관리자 계정을 만들면서 user가 생성되었기에 그것에 1:1로 대응되는 커스텀 유저를 만들 수 있다. 이제, 브라우저에서 로그인과 회원가입을 구현해보자.</p>\n<h2 id=\"로그인\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%9D%B8\" aria-label=\"로그인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로그인</h2>\n<p>우리는 django의 user model을 사용하므로, user class에서 제공하는 함수(로그인, 로그아웃, 회원가입 등) 역시 모두 사용할 수 있다. user model이 하나 있으므로, 좀 더 간단한 로그인을 먼저 구현하고 이후에 회원가입을 구현해보자.</p>\n<p><a href=\"\">프런트를 보면 로그인과 회원가입 페이지가 구현되어 있을 것</a>이다.</p>\n<p>api 요구사항은 다음과 같다.</p>\n<blockquote>\n<p>[REQUEST]</p>\n<p>POST <a href=\"http://localhost:8000/user/login/\">http://localhost:8000/user/login/</a>\nbody : { username : string, password: string}</p>\n<p>[RESPONSE]</p>\n<p>정상 케이스 : 202\n유효하지 않은 입력 : 403</p>\n</blockquote>\n<p>우선 관리자 페이지로 만든 회원으로 로그인을 진행해보도록 하자. 로그인에 성공하면, 사용자 이름을 리턴하는 함수를 만들어주자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 59.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABFklEQVQoz6WSvU7DMBDH/RCsfEhdWHk1pkYdWHgEdkYWWvEELCxIfAi5CSM0qFFDSgRS6tqxz/lXDk0ohS7uST+ddb47/886VhQF0jRFnue111rDWVVVXrAkSRBFEeI4RhiGkFK2DX2MNZ2tta0nIi9qhcYYCCGglPIe1ZkT4mCrL/iqa+q+FRJBlRpSldDawBjywtXWCmEJpCXK+cwJh7+58S3Yl9B4nUq85Qrxh/yX0Yb4Opos2Nl1ip3jJ3R6Q+wH/Bd7AcdBwHF0+ozDkxC7Xf4np87rcnR6HC+ZBBuOZzi/meDi9h39+wyXdxn6S5rz1eMUg7W7lmV88JChkAZMlBafgjDX2/zfymL/fGgFstvh1mYB7cWJUeCCIV0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"login\" title=\"login\" src=\"/static/5f0f6168fdf9f1e35a83111aae154b5a/37523/login.png\" srcset=\"/static/5f0f6168fdf9f1e35a83111aae154b5a/e9ff0/login.png 180w,\n/static/5f0f6168fdf9f1e35a83111aae154b5a/f21e7/login.png 360w,\n/static/5f0f6168fdf9f1e35a83111aae154b5a/37523/login.png 720w,\n/static/5f0f6168fdf9f1e35a83111aae154b5a/302a4/login.png 1080w,\n/static/5f0f6168fdf9f1e35a83111aae154b5a/f3a19/login.png 1086w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>우선, <u>클라이언트의 입력을 검증</u>하기 위한 serailizer와 <u>사용자의 정보를 리턴</u>할 때 사용할 serializer가 필요하다. myuser/serializers.py에 다음과 같이 만들어주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Profile\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>exceptions <span class=\"token keyword\">import</span> AuthenticationFailed\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib<span class=\"token punctuation\">.</span>auth <span class=\"token keyword\">import</span> authenticate\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> User\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>Serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    로그인 시, 입력을 검증하기 위한 serializer\n    \"\"\"</span>\n    username <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    password <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        username <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">)</span>\n        password <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token keyword\">or</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            user <span class=\"token operator\">=</span> authenticate<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>username<span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span>password<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> user<span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">if</span> user<span class=\"token punctuation\">.</span>is_active<span class=\"token punctuation\">:</span>\n                    data<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> user\n                <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                    <span class=\"token keyword\">raise</span> AuthenticationFailed<span class=\"token punctuation\">(</span><span class=\"token string\">'비활성화된 사용자입니다'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">raise</span> AuthenticationFailed<span class=\"token punctuation\">(</span><span class=\"token string\">'아이디나 비밀번호가 다릅니다'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> AuthenticationFailed<span class=\"token punctuation\">(</span><span class=\"token string\">'아이디와 비밀번호 모두 입력해야합니다'</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> data\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProfileSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Profile\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span>\n    \n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UserInfoSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  \n    profile <span class=\"token operator\">=</span> ProfileSerializer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">#one to one field이므로, user에 해당하는 profile을 가져오면 됨</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> User\n        fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'profile'</span><span class=\"token punctuation\">)</span>\n        </code></pre></div>\n<p>django에서는 로그인과 관련하여, <code class=\"language-text\">authenticate</code>를 사용할 수 있다. 이는 django user model에 존재하는 username과 password로 사용자를 확인하는 것이다.</p>\n<p>이제, request를 검증하는 <code class=\"language-text\">LoginSerializer</code>와 사용자에게 profile 정보를 제공하기 위한 <code class=\"language-text\">UserInfoSerializer</code>를 이용하여 코드를 간소화할 수 있다. 아래는 myuser/views.py 에서 이를 처리해준 것이다. 로그인은 다른 기능과 url도 다르게 사용하므로 <code class=\"language-text\">@api_view</code>를 이용한 FBV로 구현해보았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">import</span> Response\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>decorators <span class=\"token keyword\">import</span> api_view\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> LoginSerializer<span class=\"token punctuation\">,</span> UserInfoSerializer\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib<span class=\"token punctuation\">.</span>auth <span class=\"token keyword\">import</span> login\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> status\n\n<span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">login_view</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    세션 방식으로 로그인을 처리하는 함수\n    \"\"\"</span>\n    login_serailizer <span class=\"token operator\">=</span> LoginSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> login_serailizer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 유효한 입력의 경우 로그인</span>\n        user <span class=\"token operator\">=</span> login_serailizer<span class=\"token punctuation\">.</span>validated_data<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span>\n        user_info <span class=\"token operator\">=</span> UserInfoSerializer<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n        login<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"detail\"</span> <span class=\"token punctuation\">:</span> user_info<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_202_ACCEPTED<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>login_serailizer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>LoginSerializer를 거친 user는 <code class=\"language-text\">authenticate</code>이 완료되었으므로, <code class=\"language-text\">login</code> 함수로 로그인시켜주면 된다. login함수의 역할은 기본적으로 설정되어있는 <strong>session 방식으로 서버에서 사용자의 로그인 정보를 저장하도록 수행</strong>된다.</p>\n<p>마지막으로, urls.py에서 해당 FBV를 수행하도록 매핑해준다. 프론트에서는 <code class=\"language-text\">/user/login/</code> POST 요청으로 이를 보내므로 아래와 같이 적어주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">urlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'login/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>login_view<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Postman에서 <a href=\"https://github.com/choieastsea/market-guri-django/commit/344f80e5a7d8a198ebe4ab026652490d83e5f17f\">여태까지의 코드</a>를 테스트해보자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 96.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACAElEQVQ4y41TW5KjMAzkJDHYxi8MNhAg1M5U5f6X6i0pgeyyyQ4fHSlt05L1KHLOWNcV3ntG3/dYlgXzPON2u+G2LGyJd87t994hhICCnJQSrLVMtG2LGCNzXU5o2ggKSna7swnQfwpCIN4Yg0JrzY5Sig/okpSSudoZCFWhDw4pWkitdgE6p2/rumbrQ0BVVShIgLLZMt38ruuQU0bqEj83dR2GtkHbNPwKAt2j0oTgUfkeyjYoKJstkvOOs5NSccYbJIH5P/EvV0n5t6AxNULqkeYV1gd03mBOEbbWKKsSUlaQVcW2OtgNLEhZ9H3E19eE65SxrBPGscU0Rqxzh3FokHNAfwIsWJYlg6KVQkCIy84J8To7g13wp4tbgJ9QfDqojv/PZkgDuc2itjU0dds6KKOha73P3FF06+qx08X3NGK5joixhY8B7jmDNrh9HmlWedBpiJVifHwyrdX9fn+sVwicEYlQ5rFpmCcxGm4KGrxD6x3EhzIUQojHqlkDZSy0sXsTBHdc7P6xpu/qW9AP1ZBsbR3iMKEdZxjrEEyNxprXx4euv81wE3xMfQnjA4tSLdWzVrwdZ7v8EqSNkUzm2xfy8gvtcEUbPDpv0QWHxpnzgvyErf1KQ+qauVpJ3pbLReDCNS3/CxakLo5jwjBE3tmcPHJy7Cfyn3uaT+A38uskV5TM6yUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"image-20230427115004800\" title=\"image-20230427115004800\" src=\"/static/d290deded7ab3bf0391d6b3f20c2e1c2/37523/logintest.png\" srcset=\"/static/d290deded7ab3bf0391d6b3f20c2e1c2/e9ff0/logintest.png 180w,\n/static/d290deded7ab3bf0391d6b3f20c2e1c2/f21e7/logintest.png 360w,\n/static/d290deded7ab3bf0391d6b3f20c2e1c2/37523/logintest.png 720w,\n/static/d290deded7ab3bf0391d6b3f20c2e1c2/302a4/logintest.png 1080w,\n/static/d290deded7ab3bf0391d6b3f20c2e1c2/f8836/logintest.png 1214w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>로그인을 수행하고, db에서 django_session table을 보면 세션 레코드가 추가된 것을 볼 수 있다. 각 행은 <code class=\"language-text\">session_key</code>, <code class=\"language-text\">session_data</code>, <code class=\"language-text\">expire_date</code>로 구성되어 있다.</p>\n<h3 id=\"로그인-상태-유지---session-vs-token\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%83%81%ED%83%9C-%EC%9C%A0%EC%A7%80---session-vs-token\" aria-label=\"로그인 상태 유지   session vs token permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로그인 상태 유지 - session vs token</h3>\n<blockquote>\n<p>사용자는 로그인을 하면 당분간 로그인을 다시 하지 않고 서비스를 이용할 수 있다고 생각한다.</p>\n</blockquote>\n<p>로그인과 관련하여 서버는 크게 둘 중 하나의 기능을 제공할 수 있는데, 이는 세션과 토큰이다.</p>\n<p>로그인 성공시,</p>\n<ol>\n<li>\n<p>세션</p>\n<p>서버에서는 보통 로그인된 사용자들을 DB에 기록해놓는다. 해당 테이블에는 sessionId와 같은 세션 키 값과 세션 정보(주로 사용자 계정의 id 등)가 들어있고, 로그인 성공시 sessionId가 생성되며 사용자에게 <code class=\"language-text\">sessionId</code>를 제공한다.</p>\n<p>이후, 사용자는 인증이 필요한 요청을 보낼때마다 서버에게 sesionId를 함께 전송하여 서버에서는 유효한 사용자임을 확인할 수 있다. 요청이 들어온 사용자를 식별할 수 있고, 중복 로그인 방지 등의 기능을 구현할 수 있다.</p>\n</li>\n<li>\n<p>토큰</p>\n<p>서버에서 로그인 성공시 유효한 토큰을 발급하여 사용자에게 제공한다. 해당 토큰은 유효기간이 있으며, 인증이 필요한 요청을 보낼 때 서버에 toekn 정보를 함께 전송하여 서버에서 해당 토큰이 유효한지 여부를 확인할 수 있다.</p>\n</li>\n</ol>\n<p>Django는 기본적으로 session 방식의 로그인을 지원하며, 위의 login함수가 호출되면 db에 존재하는 <code class=\"language-text\">django_session</code> 테이블에 세션 정보가 추가된다. (이는 settings.py의 middleware와 installed_apps에 명시되어 있음)</p>\n<h3 id=\"세션과-관련된-흐름\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98%EA%B3%BC-%EA%B4%80%EB%A0%A8%EB%90%9C-%ED%9D%90%EB%A6%84\" aria-label=\"세션과 관련된 흐름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션과 관련된 흐름</h3>\n<ol>\n<li>\n<p>로그인에 성공한(authenticated) 사용자에게 sessionId를 제공해준다. sessionId는 <strong>중요한 데이터를 담고 있지 않아야 할</strong> 것이다.(db에서 세션 데이터를 찾는 용도로만 사용하면 됨)</p>\n</li>\n<li>\n<p>클라이언트는 이를 브라우저에 저장한다. (쿠키 권장, <code class=\"language-text\">HttpOnly</code> 설정하여 js에서 접근 못하도록) 또한, 사용자가 로그인 되어있는 UI/UX를 제공한다.</p>\n</li>\n<li>\n<p>사용자는 이후 인증이 필요한 요청에 대하여 sessionId를 headers에 실어서 보낸다.</p>\n</li>\n<li>\n<p>장고에서는 request 객체에서 <code class=\"language-text\">request.user</code>를 이용하여 세션을 검증할 수 있다.</p>\n</li>\n<li>\n<p>로그아웃 요청에 대하여 서버는 logout 함수를 통하여 세션을 제거해준다.</p>\n</li>\n<li>\n<p>만약 세션이 만료되었다면 클라이언트는 로그아웃 처리를 해주면 된다.</p>\n</li>\n</ol>\n<h3 id=\"세션과-관련된-설정\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98%EA%B3%BC-%EA%B4%80%EB%A0%A8%EB%90%9C-%EC%84%A4%EC%A0%95\" aria-label=\"세션과 관련된 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션과 관련된 설정</h3>\n<p>사용자 요청이 올때마다 세션을 리프레쉬 할 수 있다.</p>\n<p>세션의 유효기간을 정할 수 있다.</p>\n<h2 id=\"회원가입\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85\" aria-label=\"회원가입 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원가입</h2>\n<p>회원가입까지 완료해보자. api 요구사항은 다음과 같다.</p>\n<blockquote>\n<p>[REQUEST]</p>\n<p>POST <a href=\"http://localhost:8000/user/signup/\">http://localhost:8000/user/signup/</a>\nbody : {</p>\n<p>​\tuser : {username : string, password: string},</p>\n<p>​\tprofile : {first_name : string, last_name : string, phone_number : string, address: string}</p>\n<p>}</p>\n<p>[RESPONSE]</p>\n<p>정상 케이스 : 201\n유효하지 않은 입력 : 401</p>\n</blockquote>\n<p>입력 요청은 user와 profile로 나눠서 보낸다. 생각해보니, 1:1 모델은 매우 귀찮은 것 같다…</p>\n<p>회원가입도 로그인처럼 Serializer를 이용하여 검증을 하고 회원 생성까지 해줄 수 있다.</p>\n<p>우선, myuser/serializers.py 에서 다음과 같이 추가해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> User\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">SignupSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user <span class=\"token operator\">=</span> UserSerializer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Profile\n        fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'phone_number'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'address'</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> validated_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        user_data <span class=\"token operator\">=</span> validated_data<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span> \n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create_user<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>user_data<span class=\"token punctuation\">)</span> <span class=\"token comment\"># create_user 함수에 순차적으로 인자 넣어줌</span>\n        profile <span class=\"token operator\">=</span> Profile<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>user<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>validated_data<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># validated_data에서 user빠진 나머지(phone_number, address) 넣어줌</span>\n        <span class=\"token keyword\">return</span> profile</code></pre></div>\n<p>create 메소드는 serializer에서 검증한 이후에 <code class=\"language-text\">serializer.save()</code>메소드가 호출되면 실행되는 함수이다. validated_data는 dict 형식이므로 spreading해서 인자로 넣어주었다.</p>\n<p>이후 views.py에서 signup함수를 만들어주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">signup_view</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    회원가입을 처리하는 함수\n    \"\"\"</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    signup_serializer <span class=\"token operator\">=</span> SignupSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> signup_serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 유효한 입력의 경우 회원가입 완료</span>\n        signup_serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># create 호출</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"detail\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'signup success'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_201_CREATED<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>signup_serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_401_UNAUTHORIZED<span class=\"token punctuation\">)</span></code></pre></div>\n<p>serializer로 입력을 검증한 후, 입력이 유효하다면 위의 create 함수가 호출 되어 회원(User-Profile)이 만들어질 것이다!</p>\n<p>마지막으로, myuser/urls.py와 연결해주면 된다!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\npath<span class=\"token punctuation\">(</span><span class=\"token string\">'signup/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>signup_view<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이제 브라우저에서 테스트해볼 수 있다. 페이지는 움직이지 않지만 성공하였다는 알림을 확인할 수 있었다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 115.55555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAABdElEQVQ4y6VV26rCMBDM//+Z+KaIrxVB5SC11N43ycis3Z4i5+EkLoyJmzhM9qa7XC7YbrfY7/c4nU7YbDao6xq0GCNSzT0eDxyPR+x2O1RVhcPhgLIs9TCEoKQpcMbMHxOmzHu/+P4Du++macL1esX5fEZRFOi6DrlGUscPg4h8BSXkpu97VUa1Kc/8fPKisG1bPJ9PJbQY5kBjOAyDqrO1aZpsjOMIR3Uk4kq1uUaF5FFCFjLBWPLZObAXOvtCuSTMBcmYYEcia7VvTZNi9beux2+ghCZ3XU/ZhCTixGEccyfMuv+dlcq6QOljslLajveVkBuOK8P9fteMp3aMhUsJOQdJxtlIQvrsUmo/O5uBn2MoNfOWVI3h7XZTZYRN65zhsCSFjd11rPgBXd/Dq/wZ+jfwxuL7E3PZTD5AAuADICHCh4hJgkJ8wDB5lI2gagUj/f59pusa6oskjLohmfgZIS7kgwT81KKkvOfD7/n6nsw8L0/gEOPNLnScAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"signup\" title=\"signup\" src=\"/static/5477e84e4571029dccbac0c5dff6b530/37523/signup.png\" srcset=\"/static/5477e84e4571029dccbac0c5dff6b530/e9ff0/signup.png 180w,\n/static/5477e84e4571029dccbac0c5dff6b530/f21e7/signup.png 360w,\n/static/5477e84e4571029dccbac0c5dff6b530/37523/signup.png 720w,\n/static/5477e84e4571029dccbac0c5dff6b530/bb2fd/signup.png 1058w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>또한 관리자 페이지에서 이를 확인해볼 수 있다. User와 Profile에 모두 적절하게 만들어져있다.</p>\n<p><code class=\"language-text\">create_user</code> 함수를 이용하여 사용자 모델을 만들면, <code class=\"language-text\">비밀번호 해싱</code> 등의 작업도 알아서 해주므로 아주 편하다고 볼 수 있다. 따라서, 장고에서 제공해주는 기능이 있다면 이를 활용하는 방향으로 가는 것이 장고가 추구하는 방향이다.</p>\n<p>하지만, Profile과 같이 1:1 모델로 유저를 연결하는 것은 오늘 한 것처럼 <u>불필요한 참조</u>를 낳는다. 많이 복잡해지지는 않지만, 불필요한 serializer들이 생기고 코딩할 때 자꾸 헷갈리는 것 같다. 따라서, 다음 시간에는 Basic User Model에서 상속하여 유저모델을 커스텀하는 방법을 배워보도록 하자! 아마 그러려면 migration도 다시 세팅해야할텐데, 이 부분 역시 다뤄보면 좋을 것 같다 ^_^</p>\n<p>오늘까지 회원과 관련된 많은 기능들을 직접 구현해보고 공부해보았다. 다음에는 User Model을 가능하다면 바꿔보고, session 기능을 추가하여 브라우저에서 로그인을 유지할 수 있도록 구현해보도록 하자!</p>\n<p><a href=\"https://github.com/choieastsea/market-guri-react/commit/6c2a781a8580aa8a8328be70eac002c3858bdfd4\">프론트 코드</a></p>\n<p><a href=\"https://github.com/choieastsea/market-guri-django/commit/344f80e5a7d8a198ebe4ab026652490d83e5f17f\">백엔드 코드- 로그인</a></p>\n<p><a href=\"https://github.com/choieastsea/market-guri-django/commit/2ee58c7d34062e1d5de6d725a4b8aacc227f504f\">백엔드 코드- 회원가입</a></p>","frontmatter":{"date":"April 23, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [8-django user model (1 to 1)]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(8)-User Model/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Django(7)-Search&CORS/","nextSlug":"/Django(6)-request-response/","prevSlug":"/Django(8)-User Model/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}