{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Django(4)-migration/",
    "result": {"data":{"cur":{"id":"565611de-2914-5d4f-af5d-738fe5e83e69","html":"<p>저번에 item <code class=\"language-text\">model</code>을 정의하는 것까지 해보았다. 이를 우리의 MySQL server에 적용시켜보자! 해야할 일은 크게 3가지로 나뉜다.</p>\n<ol>\n<li>model 정의 / 수정</li>\n<li>migration file 생성</li>\n<li>DB에 적용(migrate)</li>\n</ol>\n<p>이 흐름을 이해하는 것이 중요하며, 직접 해보도록 하자.</p>\n<h2 id=\"migration-file-생성\" style=\"position:relative;\"><a href=\"#migration-file-%EC%83%9D%EC%84%B1\" aria-label=\"migration file 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>migration file 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py makemigrations item\nMigrations <span class=\"token keyword\">for</span> <span class=\"token string\">'item'</span><span class=\"token builtin class-name\">:</span>\n  item/migrations/0001_initial.py\n    - Create model Item</code></pre></div>\n<p>가상환경이 활성화 되어있는 상태에서 위의 명령어를 입력한다. <code class=\"language-text\">python manage.py makemigrations {app_name}</code>을 하면 해당 앱에 존재하는 모델의 변경사항 등을 <code class=\"language-text\">{app_name}/migrations/</code>위치에 저장해준다. (app_name이 없다면 전체 앱을 탐색)</p>\n<p>실제 위의 명령어가 정상 수행되면 <code class=\"language-text\">0001_initial.py</code> 파일이 생성되었다는 메시지가 나오는데, 파일을 열어보면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Generated by Django 4.2 on 2023-04-12 11:38</span>\n\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> migrations<span class=\"token punctuation\">,</span> models\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Migration</span><span class=\"token punctuation\">(</span>migrations<span class=\"token punctuation\">.</span>Migration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    initial <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n\n    dependencies <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">]</span>\n\n    operations <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        migrations<span class=\"token punctuation\">.</span>CreateModel<span class=\"token punctuation\">(</span>\n            name<span class=\"token operator\">=</span><span class=\"token string\">'Item'</span><span class=\"token punctuation\">,</span>\n            fields<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> serialize<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            options<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'verbose_name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'상품'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'verbose_name_plural'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'상품들'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'db_table'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'item'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>이러한 파일을 직접 만들어서 관리할 수도 있지만, 장고의 manage.py는 버전별로 나누어 이에 대한 관리를 용이하게 해준다.</p>\n<h2 id=\"migrate\" style=\"position:relative;\"><a href=\"#migrate\" aria-label=\"migrate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>migrate</h2>\n<p>migration 파일은 아직까지 파이썬 코드단으로 변경사항 등을 기록한 것이고, 이를 DB에 진짜로 반영하기 위해서는 migrate를 수행해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py migrate item\nOperations to perform:\n  Apply all migrations: item\nRunning migrations:\n  Applying item.0001_initial<span class=\"token punctuation\">..</span>. OK</code></pre></div>\n<p>위와 같이 나온다면 된 것이다. 이제 우리의 DB로 가보자.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 560px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABAUlEQVQoz4WQS0+EMBSF+S2MLa+EACkLCNSEEZRBZyYESNioAcGMD9xo4sbffkxrWIyZx+LL7aL39DtV7h97PI07NE2NYRgwTROKokDXdWjbFoZhQNd1iaZpe/MQyu3dButtCdd1EMcxoigC5xxJksD1PBk48z/4YCAlF+jHVzx0z1jlOZqmkYaqqoIQAkrpHucsFcuywPklrvMCjPkIwxBBEMBxHNi2DcYYPM+D7/tymqZ52lBcWCxUvH18oh9fkGWptKyqCmn6d67rGmVZSkSoMD0aKP5GvLgq1shucvl/wnKuNVcV9QVnK4tASgi+vn8w7t7B4xjL5ZVcOLZ0qvIvfmDhlN1S4igAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"db_result1\"\n        title=\"db_result1\"\n        src=\"/static/92b8f7b9be46fc08596eb4b8b934ebf0/b06ae/db_result1.png\"\n        srcset=\"/static/92b8f7b9be46fc08596eb4b8b934ebf0/e9ff0/db_result1.png 180w,\n/static/92b8f7b9be46fc08596eb4b8b934ebf0/f21e7/db_result1.png 360w,\n/static/92b8f7b9be46fc08596eb4b8b934ebf0/b06ae/db_result1.png 560w\"\n        sizes=\"(max-width: 560px) 100vw, 560px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>item 테이블이 잘 생성되었다! <code class=\"language-text\">django_migrations</code> table에는 마이그레이션을 수행한 로그가 남겨져 있으며, item에는 우리가 만든 모델이 잘 적용되어있음을 알 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACf0lEQVQ4y6VU2U7bUBC9v1DVjp2QOBHB2bxvZGkLESHO4hCyWRAKRQp94KFI5aVf1A/oH55qJg1F3YTUh6OZO8uZmes7FrIsI6MoKGoalLIJScmhkM8jmUwwm89xNp1inCTo9/voxzHOZzO2j8ZjJEmCxWKB5XKJ09NTdI+PIYhQURSUikWoug1JzUHTCri4XONyvcb66gqrNOVkJlgucbm+wnKVYrVa4fb2Fnd3d5hOp+j1ehCZjAwilWQZ8utXkGUJmUyGbTvQmYoSdj6SBEmSGORTVXVLuHPu8JzsJXieI34l+1+I3ytuR/iT/SXdCjWb5dlJZhk55HI51lV169vZs08xf4eIByNsNh8xGCWwHA9+ECEejuH5ISZn51ilFzhstuH6IVyPEPwTwnFcBEEIx3VhGCZM04TvB7AsG57nw7I91k2jwT6KMcyfMBnW1m6YEJ5LhAE8z2MZhiHCMAAViqIA06TLPv/wHTw/QhQGHEfwfZ/hui7nRVEEcXR0hMfHR9zf32Oz2bB8ePiETuctklEP375+QbPVQWf2GdGbGO/XF7i5+YA0TflRX19fo91uYzAY8MYIwzBgWRajWq2i0WgwqtUaKhUdlllHo16HruvQ9QP21X+cSaf8SqXCkroVhUKBvyoFUSUipRFs2+YxbNvB/v7+03WUSiU4joNms8kklEc+shGPKBaL2Nvb43uiMWjJT05OQFdBiz8cDrl72uPJZIJarYZut4v5fM6xcRzzHlMONceEBwfbUdSsyuSapvEY9AZpR8mXz+e3P5FSiacgnTqieNLpDRKXoMBWq8UjUHVKKJfLfB+UuBuRSMlOZ/qaVJAKEwnZCHT+Dssu4d74MnNuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"db_result2\"\n        title=\"db_result2\"\n        src=\"/static/38690ccce40b129505e65848fdb21aea/f96db/db_result2.png\"\n        srcset=\"/static/38690ccce40b129505e65848fdb21aea/e9ff0/db_result2.png 180w,\n/static/38690ccce40b129505e65848fdb21aea/f21e7/db_result2.png 360w,\n/static/38690ccce40b129505e65848fdb21aea/f96db/db_result2.png 470w\"\n        sizes=\"(max-width: 470px) 100vw, 470px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>역으로 기존 DB 스키마가 구축된 상태에서 models.py를 정의하도록 역설계하는 방법도 존재한다.</p>\n<p><code class=\"language-text\">python manage.py inspectdb > models.py</code> 이 명령어를 사용하면 된다 ~</p>\n<p>나중에 model을 <em>추가하거나 수정하는 것도 여태까지 했던 방법 그대로 설정해주면 된다</em>. 하지만, 필드를 추가하는 경우에는 default 값을 지정해주는 등의 추가적인 일이 필요할 수 있으니 참고하도록 하자.</p>\n<h2 id=\"migration의-장점\" style=\"position:relative;\"><a href=\"#migration%EC%9D%98-%EC%9E%A5%EC%A0%90\" aria-label=\"migration의 장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>migration의 장점</h2>\n<p>서버 프레임워크에서 마이그레이션을 지원한다는 것은 많이 쓴다는 것이다. 특히, 장고에서는 모델을 다루고, CRUD를 하기위해 migration이 필수적이다. 몇가지 장점을 생각해보자.</p>\n<ol>\n<li>SQL 등 쿼리 언어를 잘 몰라도 된다. DB의 역할정도만 이해하고 있다면, 상황에 따라 많은 종류의 DB를 사용하게 될텐데 각 언어를 배울 필요가 없어진다.</li>\n<li>버전 관리 : 장고에서 migration을 수행하면, 해당 마이그레이션 정보도 버전별로 관리가 된다. 따라서 스키마의 롤백이 가능하다.</li>\n<li>스키마 관리 : DB를 건들다보면, 서버 모델과 DB table을 일치시키지 않아 오류가 생길 수 있다. 또한, 스키마를 건드리다보면 기존에 있던 데이터 때문에 충돌이 나는 경우가 잦다. 장고의 migration은 이를 해결하기 위한 몇가지 도움을 제공한다.</li>\n</ol>\n<h2 id=\"경고문구-없애기\" style=\"position:relative;\"><a href=\"#%EA%B2%BD%EA%B3%A0%EB%AC%B8%EA%B5%AC-%EC%97%86%EC%95%A0%EA%B8%B0\" aria-label=\"경고문구 없애기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>경고문구 없애기</h2>\n<p>마이그레이션까지 할 줄 안다면, <code class=\"language-text\">runserver</code>시 생기는 경고문구도 이해할 수 있어진다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAfklEQVQI142OOw6DMBAFfQ5MEWwI/sRmnQBNwv2PNcgglC5KMXpvt3mjxrxwTyd9fNI5wXihtQHdeVrj0Z2juY00V/5A5ViYYqGkFxIEPyZSEIYhYqyn7wPWntR+3Bc2YOz3V7sq64YsGzK/meYP7jHj84LL62FZV/UfZpfhDvdZVrW2EnJZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"warning\"\n        title=\"warning\"\n        src=\"/static/d30e54d3454315733f7fa3f340999ae6/37523/warning.png\"\n        srcset=\"/static/d30e54d3454315733f7fa3f340999ae6/e9ff0/warning.png 180w,\n/static/d30e54d3454315733f7fa3f340999ae6/f21e7/warning.png 360w,\n/static/d30e54d3454315733f7fa3f340999ae6/37523/warning.png 720w,\n/static/d30e54d3454315733f7fa3f340999ae6/302a4/warning.png 1080w,\n/static/d30e54d3454315733f7fa3f340999ae6/07a9c/warning.png 1440w,\n/static/d30e54d3454315733f7fa3f340999ae6/95be1/warning.png 2574w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>18개의 migration이 적용되지 않았다고 하는 것이다.</p>\n<blockquote>\n<p>근데 우리는 makemigration으로 18개를 만든적이 없지 않는가??</p>\n<p>-> 이것도 장고가 알아서 만들어 준 것이다</p>\n</blockquote>\n<p>처음에 settings.py에서 장고를 세팅하고 runserver를 하면 여러가지 설정들을 통하여 장고에서 기본적으로 제공하는 model들의 정보가 생성된다. 이를 커스텀하여 구현할 수도 있지만, 일단 해당 모델이 무엇인지 모르니까 migrate부터 해주고 관찰해보자.</p>\n<p><code class=\"language-text\">python manage.py migrate</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py migrate\nOperations to perform:\n  Apply all migrations: admin, auth, contenttypes, item, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0001_initial<span class=\"token punctuation\">..</span>. OK\n  Applying admin.0001_initial<span class=\"token punctuation\">..</span>. OK\n  Applying admin.0002_logentry_remove_auto_add<span class=\"token punctuation\">..</span>. OK\n  Applying admin.0003_logentry_add_action_flag_choices<span class=\"token punctuation\">..</span>. OK\n  Applying contenttypes.0002_remove_content_type_name<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0002_alter_permission_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0003_alter_user_email_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0004_alter_user_username_opts<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0005_alter_user_last_login_null<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0006_require_contenttypes_0002<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0007_alter_validators_add_error_messages<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0008_alter_user_username_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0009_alter_user_last_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0010_alter_group_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0011_update_proxy_permissions<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0012_alter_user_first_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying sessions.0001_initial<span class=\"token punctuation\">..</span>. OK</code></pre></div>\n<p>크게보면, contenttypes, auth, admin, 그리고 sessions과 관련된 것임을 알 수 있다.</p>\n<p>처음에 settings.py를 건들지 않았다면, INSTALLED_APPS에 아래와 같은 것들이 들어있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">INSTALLED_APPS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'django.contrib.admin'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.auth'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.contenttypes'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.sessions'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.messages'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.staticfiles'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>기본적으로 제공되는 앱들에서 필요한 모델들을 마이그레이션 해준 것이라고 보면 된다. 각 앱들이 무슨 역할을 하는지는 차차 배워가도록 하자…</p>\n<p>오늘 실행한 소스코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/6a65b2ba32b52d258aacb3e2789722aacf00fcaa\">여기에</a> 있으니 참고하자.</p>\n<h2 id=\"관리자-페이지\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EB%A6%AC%EC%9E%90-%ED%8E%98%EC%9D%B4%EC%A7%80\" aria-label=\"관리자 페이지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관리자 페이지</h2>\n<p>장고에서는 관리자 페이지에 대한 기능을 제공해준다. model을 만들었다면 관리자 페이지 인터페이스를 통하여 데이터를 CRUD할 수 있다. 아직 api가 없으므로, 관리자를 통해서 데이터를 몇개 만들어주자.</p>\n<p>우선 가상환경에서 다음을 입력하고 관리자를 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py createsuperuser</code></pre></div>\n<p>아이디, 이메일, 비밀번호를 입력하면 슈퍼 관리자가 생성될 것이다. 슈퍼 관리자는 모든 권한이 있는 사용자로써 관리에 신중해야 한다.</p>\n<p>그리고, 서버를 켠 상태에서 localhost:8000/admin으로 접속해보자. conf/urls.py에 admin에 대한 설정이 되어있으므로 장고의 어드민 페이지로 연결 될 것이다.</p>\n<p>로그인하였지만, 아직 Item을 생성, 수정할 수 없다. 아직 등록을 안해주었기 때문이다.</p>\n<p>item/admin.py에 가서 Item model을 등록해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib <span class=\"token keyword\">import</span> admin\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n\nadmin<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span>Item<span class=\"token punctuation\">)</span></code></pre></div>\n<p>관리자 페이지에 다시 접근하면 Item 모델에 대한 탭이 생성되어 있음을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABL0lEQVQoz33M30rCYBjH8V1kddwFlFdRRx0aYdAFdGIHHRQJQceBQmiEhK65+W+67dVNt3fv9n7DSWJGPvDhgd/B1yiVK5yUK5QuK5yWrzi+uObg7IbD8/8d7WEIERAEAj8QpKkiz3P0iv6NzdekSiFTRZrlBakyklQVjKfmF7WWVXj+cHhp96m92zw0rT8emxb3byYDsUBniigMiaIQmSTkWUaWKYyW7WL7IT1vjjWdFcyJoOuume6MjuvRsoe0+0Ma3QGzWBYx23EYjUYIIYjjmOVyiZFKCWgg36G3ZCiVgIpJ4rjYoijCcRx830dKWQRXjLtGl2q9Q7WxR33trtHh9vWTnheipMTzvCKYJMmGYboB0zDGnS+Z7PjZxvOInhcw8AO6Y5+FTNk+rfXGN8YC9KwcKKB3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20230413194233810\"\n        title=\"image-20230413194233810\"\n        src=\"/static/1c6195f8da7e7541d87399c2a2452d8b/37523/admin.png\"\n        srcset=\"/static/1c6195f8da7e7541d87399c2a2452d8b/e9ff0/admin.png 180w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/f21e7/admin.png 360w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/37523/admin.png 720w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/302a4/admin.png 1080w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/07a9c/admin.png 1440w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/29beb/admin.png 1830w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Item model을 선언할 때 meta 정보로 적어주었기에 한글로 잘 나온다. Add 버튼을 눌러서 몇개만 추가해보자!</p>\n<p>관리자 페이지는 일단 다음에 다시 다뤄보도록 하고, 해당 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/e3f2f67047a77be071523f3817bdf70208cf84e9\">여기</a>를 참고한다.</p>\n<p>이제 우리는 서비스에 필요한 데이터를 모델 클래스 단위로 묶어 관리할 수 있어졌다. 하지만, 이를 다루기 위해서는 몇가지 알아야할 것들이 있다. 다음에는 DRF의 serializer에 대하여 알아보도록 하자!</p>","excerpt":"저번에 item 을 정의하는 것까지 해보았다. 이를 우리의 MySQL server에 적용시켜보자! 해야할 일은 크게 3가지로 나뉜다. model 정의 / 수정 migration file 생성 DB에 적용(migrate) 이 흐름을 이해하는 것이 중요하며, 직접 해보도록 하자. migration file 생성 가상환경이 활성화 되어있는 상태에서 위의 명령어를 입력한다. 을 하면 해당 앱에 존재하는 모델의 변경사항 등을 위치에 저장해준다. (app_name이 없다면 전체 앱을 탐색) 실제 위의 명령어가 정상 수행되면  파일이 생성되었다는 메시지가 나오는데, 파일을 열어보면 다음과 같다. 이러한 파일을 직접 만들어서 관리할 수도 있지만, 장고의 manage.py는 버전별로 나누어 이에 대한 관리를 용이하게 해준다. migrate migration 파일은 아직까지 파이썬 코드단으로 변경사항 등을 기록한 것이고, 이를 DB에 진짜로 반영하기 위해서는 migrate를 수행해주면 된다. 위와 …","frontmatter":{"date":"April 14, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [4 - DB(migration)]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(4)-migration/"}},"next":{"id":"e34e2492-ff4f-5260-be49-839350a0dc0e","html":"<h2 id=\"장고-모델\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%EB%AA%A8%EB%8D%B8\" aria-label=\"장고 모델 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 모델</h2>\n<p>저번에는 localhost:8000/item/ 를 브라우저에 입력하면 응답하도록 하였다. 이번에는 item <strong>model</strong>을 정의하고, 이를 DB에 적용(<strong>migrate</strong>)시켜보자.</p>\n<p>django에서 제공하는 model은 우리가 다루는 데이터의 객체를 의미한다고 볼 수 있고, 하나의 모델 클래스는 관계형 DB에서의 한 table이라고 볼 수 있다. 우리 프로젝트에서 다루는 ”상품”을 정의해보자.</p>\n<h2 id=\"item-모델-정의\" style=\"position:relative;\"><a href=\"#item-%EB%AA%A8%EB%8D%B8-%EC%A0%95%EC%9D%98\" aria-label=\"item 모델 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>item 모델 정의</h2>\n<table>\n<thead>\n<tr>\n<th>field</th>\n<th>type(mysql)</th>\n<th>info</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>item_id(pk)</td>\n<td>auto increment int</td>\n<td>상품코드(1부터 증가)</td>\n</tr>\n<tr>\n<td>name</td>\n<td>varchar</td>\n<td>상품명</td>\n</tr>\n<tr>\n<td>price</td>\n<td>int(positive)</td>\n<td>상품가격</td>\n</tr>\n<tr>\n<td>stock_count</td>\n<td>int(positive)</td>\n<td>현재 상품의 남은 수량</td>\n</tr>\n</tbody>\n</table>\n<p>우선 간단하게 이정도만 정의해보도록 하자. 이러한 필드들은 언제든지 수정이 가능하며, 충돌이 생긴다면 이에 대한 해결책을 제시해주는 것도 장고의 장점이다!</p>\n<p>위의 모델을 만들기 위해서는 item/models.py 로 가서 클래스를 아래와 같이 추가해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    item_id <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span><span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span><span class=\"token punctuation\">)</span>\n    stock_count <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'item'</span>\n        verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'상품'</span>\n        verbose_name_plural <span class=\"token operator\">=</span> <span class=\"token string\">'상품들'</span>\n</code></pre></div>\n<p>verbose_name은 설명이라고 보면 되고, db의 column_name도 <code class=\"language-text\">db_column=</code> 파라미터로 수정이 가능하다.!</p>\n<p>위의 타입들은 <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/fields/\">공식문서</a>를 참고하여 작성이 가능하다. pk의 경우에는 지정하지 않아도 table에 생성해주지만 이렇게도 생성해줄 수 있다. 외래키, 장고에서만 존재하는 OneToOneField 등 다양한 방법으로 참조타입 역시 구현할 수 있으므로 참고하도록 한다.</p>\n<p>장고의 모델은 DB의 테이블과 매칭되기에, 테이블의 schema에 개입할 수 있도록 <strong>다양한 커스텀 옵션</strong> 또한 주어진다. 대표적으로, verbose_name, column_name, table_name 등이 있으며 이는 검색하여 찾아볼 수 있다.</p>\n<p>직관적으로 <u>DB를 추상화하여(sql등의 DB코드 없이) 다룰 수 있지만, 이에 대한 trade-off로 framework의 문법과 구성을 이해해야 한다는 단점</u>이 있을 것이다. 하지만 익숙해진다면 (유지보수나 보안 측면에서 검증된 코드이므로) 더 편하게 개발할 수 있을 것이라 믿는다.</p>\n<p>다음에는 정의한 모델을 DB에 반영하는 migration에 대하여 알아보도록 하자.</p>","frontmatter":{"date":"April 13, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [3 - Django model]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(3)-model/"}},"prev":{"id":"edcd3751-d5fc-5f9a-9826-0c0da687ecfa","html":"<p>저번까지는 model의 구조를 DB schema에 적용하는 migration을 알아보았다. 오늘은 데이터를 저장하고, 저장된 데이터를 가져와서 사용할 때 필요한 개념인 <strong>직렬화</strong>에 대하여 알아보자! 어렵지만 이해를 해야 다음으로 넘어갈 수 있으니 매우 중요하다고 볼 수 있다.</p>\n<h1 id=\"drf-serializer\" style=\"position:relative;\"><a href=\"#drf-serializer\" aria-label=\"drf serializer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF Serializer</h1>\n<p>장고에는 기본적으로 <code class=\"language-text\">forms</code>이라는 것이 있지만, 앞으로는 DRF(Django Rest Framework)에서 제공하는 <code class=\"language-text\">serializers</code>를 사용할 예정이다.</p>\n<blockquote>\n<p>DRF를 사용하는 이유</p>\n<ol>\n<li>REST api 서버를 구성하기 위해 초점이 맞춰진 기능들이 많음</li>\n<li>장고보다 코드의 중복을 줄이는 몇가지 클래스들이 제공됨</li>\n</ol>\n</blockquote>\n<p>우선 가상환경에 DRF를 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> pip <span class=\"token function\">install</span> djangorestframework</code></pre></div>\n<p>그리고, settings.py의 INSTALLED_APPS에서 <code class=\"language-text\">'rest_framework'</code>를 추가해준다.</p>\n<p>참고로, INSTALLED_APPS에는 pip로 설치해준 것도 추가해야할 경우가 있고, manage.py startapp 등으로 만든 appConfig의 name도 들어가야한다. (모든 pip 모듈을 적어주는 것은 아니므로 해당 라이브러리의 공식문서를 참고)</p>\n<h2 id=\"db에서-json까지의-과정\" style=\"position:relative;\"><a href=\"#db%EC%97%90%EC%84%9C-json%EA%B9%8C%EC%A7%80%EC%9D%98-%EA%B3%BC%EC%A0%95\" aria-label=\"db에서 json까지의 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB에서 JSON까지의 과정</h2>\n<p>클라이언트는 요청을 보내고, 서버는 이에 알맞은 응답을 보내는데, 이때 클라이언트와 서버는 HTTP body에 JSON데이터를 주고 받는다. 장고의 모델과 ORM에서 이를 직접 다룰 수 없으므로, 장고에서 사용할 수 있도록 변환하는 과정이 필요하다.</p>\n<p><strong>DB ↔ QuerySet ↔ OrderdDict ↔ JSON</strong></p>\n<p>QuerySet과 OrderedDict는 python class이며, <strong>최종 목표는 JSON과 DB사이를 연결해주는 것</strong>이다. DRF의 <code class=\"language-text\">serializer</code>는 직렬화와 역직렬화(deserialization)를 도와주는 클래스인 것이다. item/serializers.py를 만들어주자. 해당 파일에는 item과 관련한 serializing 기능을 지원하는 클래스가 들어갈 것이다.</p>\n<p>우선 가장 간단한 ModelSerializer를 이용해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span> <span class=\"token comment\"># 아이템의 모든 필드를 serialize해줄 것임</span></code></pre></div>\n<h2 id=\"db-to-json\" style=\"position:relative;\"><a href=\"#db-to-json\" aria-label=\"db to json permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB to JSON</h2>\n<p>item/views.py 에서 처음 만들었던 index 함수를 item의 리스트를 반환하는 함수로 수정해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">import</span> Response\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>decorators <span class=\"token keyword\">import</span> api_view\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> ItemSerializer\n\n<span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># serialize</span>\n    items <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># return QuerySet(not yet query)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">)</span>\n    itemSerializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">,</span> many<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># return OrderedDict</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span></code></pre></div>\n<p>우선 Request와 Response를 위와 같이 DRF에서 사용하는 방법으로 바꿔주자. (이는 다음에 자세히 알아볼 예정)</p>\n<ul>\n<li>\n<p>@api_view([‘GET’]) &#x26; Response</p>\n<p>http get request를 처리하는 View함수에 달 수 있는 데코레이터이다. 이후 적절하게 Response를 해줘야 한다. (DRF에서 사용하는 방법)</p>\n</li>\n<li>\n<p>Item.objects.all()</p>\n<p>장고에서 model을 통해 DB에 접근할 때 사용하는 Manager가 기본적으로 <code class=\"language-text\">objects</code>이다. 따라서, DB manager 혹은 accesser 정도의 역할로만 알고 있어도 일단은 ok.</p>\n<p>manager에서 all 함수는 <code class=\"language-text\">select *</code>과 같은 의미로 결과로 <strong>QuerySet이 리턴된다.</strong></p>\n<p>참고로 QuerySet은 아직 DB query가 실행되지는 않은 상태이다.</p>\n</li>\n<li>\n<p>ItemSerializer(items, many=True)</p>\n<p>사전에 정의한 시리얼라이저의 인자에다가 <code class=\"language-text\">QuerySet</code>을 넣어주고, <code class=\"language-text\">many=True</code> 옵션을 주면 이를 OrderedDict의 list로 반환해준다.</p>\n</li>\n<li>\n<p>serializer.data</p>\n<p>queryset의 데이터에 접근하여 직렬화된 자료구조를 리턴한다.</p>\n</li>\n</ul>\n<p>이제, localhost:8000/item/에 접근해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Iphone G14\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1500000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Galaxy X25\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1450000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">120</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>저번 포스트에서 2개의 item을 추가했으므로 잘 나오는 것을 볼 수 있다👏👏</p>\n<p>콘솔에는 다음과 같이 프린트 되어있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">&lt;</span>QuerySet <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span>, <span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n\nItemSerializer<span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>QuerySet <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span>, <span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>, <span class=\"token assign-left variable\">many</span><span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span>:\n    item_id <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span>, <span class=\"token assign-left variable\">read_only</span><span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> CharField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span>, <span class=\"token assign-left variable\">max_length</span><span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span>, <span class=\"token assign-left variable\">max_value</span><span class=\"token operator\">=</span><span class=\"token number\">4294967295</span>, <span class=\"token assign-left variable\">min_value</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    stock_count <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span>, <span class=\"token assign-left variable\">max_value</span><span class=\"token operator\">=</span><span class=\"token number\">4294967295</span>, <span class=\"token assign-left variable\">min_value</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span>, <span class=\"token string\">'Iphone G14'</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span>, <span class=\"token number\">1500000</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span>, <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>, OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span>, <span class=\"token string\">'Galaxy X25'</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span>, <span class=\"token number\">1450000</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span>, <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><code class=\"language-text\">ModelSerializer</code>로 정의했고, fields에 <code class=\"language-text\">__all__</code>을 적어주어 자동으로 시리얼라이저의 필드들이 위와 같이 들어가 있는 것을 볼 수 있다. 또한, 아직 serailizer.data로 접근하지 않은 상태에서는 <strong>QuerySet으로 남아있고, 실제 쿼리문이 실행되지는 않은 상태</strong>이다. 즉, QuerySet에서 실제 데이터와 관련된 접근이 일어날 때에만 query가 수행되는 <code class=\"language-text\">lazy</code>한 특성을 보인다.</p>\n<p>또한 Response 함수를 이용하면 ordered dict의 배열을 JSON 형식으로 바꿔서 응답해주는 것으로 보인다. 만약, ordered dict 형태에서 우리가 데이터를 JSON으로 직접 바꿔야 할 필요가 있다면 <code class=\"language-text\">JSONRenderer().render(serializer.data)</code>로 변환해줄 수 있다. (<code class=\"language-text\">from rest_framework.renderers import JSONRenderer</code>로 임포트 후 사용가능)</p>\n<p>다시 직렬화로 돌아와 과정을 정리해보면,</p>\n<blockquote>\n<p>DB instance → <code class=\"language-text\">{model}.objects.all()</code> → QuerySet → <code class=\"language-text\">Serializer(queryset)</code> → OrderedDict → JSON</p>\n</blockquote>\n<p>이라고 볼 수 있다.!</p>\n<h2 id=\"json-to-db\" style=\"position:relative;\"><a href=\"#json-to-db\" aria-label=\"json to db permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JSON to DB</h2>\n<p>이제는 데이터를 DB에 저장하는 코드를 만들어보자.</p>\n<p>POST 요청에 대하여 새로운 item을 만드는 api를 만들어본다. drf에서 body는 <code class=\"language-text\">request.data</code>를 이용하여 받을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_item</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    itemSerializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> itemSerializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># need to call .is_valid() before .save()</span>\n        itemSerializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span> <span class=\"token comment\"># error occured</span></code></pre></div>\n<p>JSON 데이터를 장고에서 사용하기 위해서도 serializer class를 이용하면 된다. 여기서는 인자로 data를 넘겨주면 된다.</p>\n<p>주의해야할 점은, <code class=\"language-text\">is_valid()</code>를 호출하고 <code class=\"language-text\">save()</code> method를 호출해야한다는 점이다. 그렇지 않다면 <code class=\"language-text\">AssertionError: You must call .is_valid() before calling .save().</code> 에러가 나올 것이다. 왜냐하면, save() 메소드는 <code class=\"language-text\">serailizer.validated_data</code>가 들어가야 하는데, 이는 <strong>is_valid()가 수행되어야 <code class=\"language-text\">initial_data</code>와 <code class=\"language-text\">validated_data</code>가 초기화되기</strong> 때문이다.</p>\n<p>만약 데이터가 유효하지 않다면 ModelSerializer 클래스에서 <code class=\"language-text\">serilaizers.ValidationError</code>를 throw 할 것이다.</p>\n<p><code class=\"language-text\">postman</code>으로 테스트해보자. (브라우저에서 하려면 CORS를 해결해야함)</p>\n<ol>\n<li>\n<p>정상 케이스</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 72.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABwUlEQVQ4y41TWbKcMAzkJAHv+wKTqSFD5SP3P1SnJIbJo/J4yUdbsstqJHczbNuGGCNCCGitYV3XN7bnhsfjgfWxopTCdw4cNR8jYSAS5xwfppS4kFBbQy4ZtVaU3uCDPxEeNRSJiKK1FgMtUko+8N5zrrXm/JsSaMHj1gImKeCcf5MopZhACMGEWkmM44hhnme+1HtHax05Z+5w3zcs87wjR/RaEFMC1dAH53nB99sCZQNUfkBIhcEYAwJ1doC+Sh2cIU97uvcnV5BK89lA40kpEEpDbAtKdPhx78jB8fk0TScIcY5HLjiKvUNKfG5I8x2pdbSlw3nLb0IF4/j/4A5jdEjJIkWLlBxioNxxTsjJv+D+Ce4wsCUcco6IOcBGi5wi7723rKDWEsYoaK1gjL7E8OvnhlIrq0vyk//Cy6y9z2yRw2tKaXhrICZxPfLz+cRuHQ9rDBI5PkQ479g+REaGJ4OT72oMUFK+xBB/YaCFza0NbEhQ2rBiuxjjO34U6CD7jJTfcJpGpL4gL3fUHLDeGpLf/6Dpky6uyJiQVCbT+lzZh7FUtKXBOntZ9BUGUs17x26ncXlk/mPEl6NdEf4GKIex+dMgtoUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"postman1\" title=\"postman1\" src=\"/static/66bcc081e719e2c6f893d9639b0d1b6e/37523/postman1.png\" srcset=\"/static/66bcc081e719e2c6f893d9639b0d1b6e/e9ff0/postman1.png 180w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/f21e7/postman1.png 360w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/37523/postman1.png 720w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/302a4/postman1.png 1080w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/636d3/postman1.png 1222w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>item_id는 auto_increment이므로 값을 넣지 않도록 한다.</p>\n<p>DB를 직접 확인해보거나, 관리자 페이지에 접근해보면 데이터가 잘 들어가있음을 확인할 수 있다!</p>\n</li>\n<li>\n<p>에러 케이스</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpUlEQVQ4y41TSZLcMAzTS7xKpBZr8TKpHKb//yykSLs9mar0pA8oiTIJEhJsjuOA9x4hBNRasW2bYhfsu+7X1uBDuPN+gnkSxhjRWlMSORMo4XGgret/iYRDYJxzmOdZA2bGMAwgIlgmdGOPoyQQz5hmexV7WGvxrJPc4BlD32utKaUomciVvRTJWmpFzhkf24pWMlqKWFLSbyklzRMV0mAKKyaKJ6GQSRcip5DuErOeEYgZTmOnU9F1LnlS65zFZBmTdZimCUbGHscRFDOcj1iCR4kebC26vkf/EgO67lxV7lOydnUWMRek2pBywbJEMMsdTbD2L8z/2M9fkHwjY+bsUYtHyXyinHGtAa1FrC3q+g4MOXfeBRFiiKDoYdnddpDr6C85wzAq5OwVzO+PA2lZboKYElh8GQKWJelD3A/nHNhZJR/H4WryHebxeKhlxNjiw6d1xBqtViUSw6tVmBGZ0Cvhiwn1hZkwOwaxvzuLzK7vNP6SPFzT/SBZ/CRPb4kR5F8lB++s2iYxgeys39+FEUmfn79w7An7lnDsyzfsgi29jT8p0phyUNk/4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"postman2\" title=\"postman2\" src=\"/static/485b5278e4c4b9bd41461d14f1b939bd/37523/postman2.png\" srcset=\"/static/485b5278e4c4b9bd41461d14f1b939bd/e9ff0/postman2.png 180w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/f21e7/postman2.png 360w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/37523/postman2.png 720w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/302a4/postman2.png 1080w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/f09ab/postman2.png 1250w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>이 경우는 price 필드를 빼고 요청을 보냈을 때의 결과이다. 우리가 사용한 ModelSerializer를 이용하면 이런 생성(create), 검증(is_valid), 그리고 업데이트(update)까지 기본적으로 지원한다!</p>\n<p>아, 그리고 아직은 status code를 넣지 않아서 200으로 오는데, 이는 다음에 Request와 Response를 공부하면 알게 될 것이다.</p>\n</li>\n</ol>\n<h2 id=\"그래서-serializer의-역할은\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-serializer%EC%9D%98-%EC%97%AD%ED%95%A0%EC%9D%80\" aria-label=\"그래서 serializer의 역할은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 Serializer의 역할은?</h2>\n<p>그래서 serializer는 크게 두가지의 역할을 수행한다고 볼 수 있다.</p>\n<ol>\n<li>\n<p>model to JSON &#x26; JSON to model</p>\n<p>각각 직렬화와 역직렬화에 해당하는 내용이다.</p>\n</li>\n<li>\n<p>validation</p>\n<p>DB에 값을 변경할 때에도 Serializer가 사용된다. is_valid()와 save() 메소드로 DB값을 쉽게 변경할 수 있도록 도움을 준다.</p>\n</li>\n</ol>\n<h2 id=\"serializer-커스텀하기\" style=\"position:relative;\"><a href=\"#serializer-%EC%BB%A4%EC%8A%A4%ED%85%80%ED%95%98%EA%B8%B0\" aria-label=\"serializer 커스텀하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serializer 커스텀하기</h2>\n<p>우리는 시리얼라이저를 간단하게 구현하기 위해 <strong>ModelSerializer</strong> 클래스를 상속받아 구현하였다. 이를 커스텀하여 사용할 수도 있다.</p>\n<ol>\n<li>\n<p>Field custom</p>\n<p>우리는 fields에 <code class=\"language-text\">__all__</code>로 모든 model의 필드를 받았지만, 이를 커스텀할 수 있다. model에 있는 필드의 경우에는 문자열 배열의 형태로 선언하면 된다. 우리는 <code class=\"language-text\">['name', 'price', 'stock_count']</code>로 바꿔볼 수 있을 것이다.</p>\n<p>또한, 모델에는 없는데 필요한 새로운 필드가 필요한 경우가 있다. 이는 <code class=\"language-text\">SerializerMethodField()</code>에 대하여 검색해보자.</p>\n</li>\n<li>\n<p>Validation custom</p>\n<p>data를 검사하는 별개의 로직이 있는 경우에는 serializer 내부에 <code class=\"language-text\">validate(self, data)</code>함수를 오버라이드 하면 된다. 예를 들어, 우리는 price(가격)는 0보다 커야하고, stock_count(재고)는 0이상이여야 한다.</p>\n<p>(<code class=\"language-text\">PositiveIntegerField</code>로 정의되어있긴 하지만 그래도 예외처리를 해보자)</p>\n<p>만약 특정 필드에 대한 validation만 수행하고 싶다면, <code class=\"language-text\">validate_{field}</code> 꼴로 함수를 만들어주면 된다. 다음은 가격이 0인 경우에 에러를 발생시켜주는 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span> <span class=\"token comment\"># 아이템의 모든 필드를 serialize해줄 것임</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">validate_price</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> value <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> serializers<span class=\"token punctuation\">.</span>ValidationError<span class=\"token punctuation\">(</span><span class=\"token string\">\"price must be positive\"</span><span class=\"token punctuation\">)</span> \n        <span class=\"token keyword\">return</span> value</code></pre></div>\n<p>하지만 이 경우에는 기본적으로 Serializer(not ModelSerializer)가 validation을 해주므로, 0인 경우만 처리하면 될 것이다.</p>\n<p>또한, model instance를 생성하는 시점에 validation을 해주는 방법도 있다는 것 같으니, 찾아봐야겠다.</p>\n</li>\n<li>\n<p>create &#x26; update custom</p>\n<p>ModelSerializer 클래스는 기본적으로 create와 update를 제공하지만, 이를 수정하고 싶을때에는 <code class=\"language-text\">create(self, validated_data)</code> 또는 <code class=\"language-text\">update(self, validated_data)</code> 함수를 오버라이딩 해주면 된다. (여기에 인자로 오는 데이터는 is_valid 이후에 온 validated_data이다)</p>\n</li>\n</ol>\n<p>또한, 그냥 Serializer 클래스를 상속받아서 자유도가 높은 시리얼라이저도 만들 수 있다. 다만, 이 경우에는 필드부터 많은 것들을 직접 구현해야할 것이므로 적재적소에 활용하도록 하자.</p>\n<h1 id=\"django-orm\" style=\"position:relative;\"><a href=\"#django-orm\" aria-label=\"django orm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Django ORM</h1>\n<blockquote>\n<p>위에서 다루었던, <code class=\"language-text\">Item.objects.all()</code>가 여기에 해당한다</p>\n<p>이게 뭔 말인지 알아보자</p>\n</blockquote>\n<p>이제 Serializer에 대한 개념은 어느정도 알았으니, django에서 제공하는 ORM(Object Relational Mapper)에 대하여 알아보자. (이는 DRF가 아닌 장고에서 제공하는 기능이다) ORM을 이용하여 관계형 DB에 각각 다른 언어들을 몰라도 python 인터페이스로 DB를 다룰 수 있게 된다.</p>\n<p>ORM 역시 DB와 연결되어 있으므로 모델의 CRUD가 가능하지만 Read, Delete만 권장된다. 우리는 client 요청에 대하여 더 간편하고 예외에 대해 반응할 수 있는 Serializer로 C,U를 처리할 수 있다.</p>\n<p>몇개만 알아보자…</p>\n<ul>\n<li>objects.all() : 해당 모델의 모든 데이터를 담는 쿼리셋을 리턴</li>\n<li>objects.order_by(field) : 해당 필드로 정렬</li>\n<li>objects.filter(field = … , ) : 조건에 맞는 쿼리셋을 리턴. 없다면 빈 쿼리셋 리턴(<code class=\"language-text\">queryset.exists()</code>함수로 판단 가능)</li>\n<li>objects.get(field = … , ) : 조건에 맞는 모델 리턴. 없다면 에러 throw</li>\n<li>objects.create(field = …) : 모델을 생성하여 DB에 저장한다</li>\n<li>obejcts.update() : 업데이트</li>\n<li>objects.delete() : 삭제</li>\n</ul>\n<h2 id=\"objects\" style=\"position:relative;\"><a href=\"#objects\" aria-label=\"objects permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>objects??</h2>\n<p>여기서 항상 나오는 것은 <code class=\"language-text\">objects</code>이다! 이는 모델에서 DB에 접근하기 위해 ORM에서 사용되는 <code class=\"language-text\">Manager object</code>이다. 이는 models.Manager 클래스를 상속하여 커스텀이 가능하며, 위의 함수들을 오버라이드할 수 있게 된다. 커스텀 매니저는 model 클래스에서 <code class=\"language-text\">objects= CustomManager()</code>와 같이 바꿔줄 수 있다고 한다. 이는 더 공부가 필요한 부분이다. <a href=\"https://blog.hwahae.co.kr/all/tech/tech-tech/4108\">참고하기</a></p>\n<h2 id=\"queryset\" style=\"position:relative;\"><a href=\"#queryset\" aria-label=\"queryset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>QuerySet</h2>\n<p>objects의 메소드를 통하여 생성되는 (주로 select) 데이터는 <strong>바로 SQL이 실행되지 않고 <code class=\"language-text\">QuerySet</code>객체에 저장되었다가 필요한 순간에만 실제 쿼리가 수행되는 lazy한 구조</strong>를 갖는다. 이유는 DB 접근은 시간이 오래 걸리고, 반복되면 연산에 낭비가 생길 수 있기 때문이다. 추가적으로, 테이블이 복잡해질 경우에는 의미없는 쿼리가 낭비될 수 있으므로(중복 질의) <code class=\"language-text\">selected_related()</code> 등의 JOIN연산을 처리하여 연산을 줄이는 기법도 있다고 한다.</p>\n<p>QuerySet은 우리가 여태 공부한 Serializer에 의하여 직렬화될 수 있는데, 여러 레코드를 포함한 QuerySet이라면 many=True 옵션으로 가져와야 가능하다는 점도 알고 있도록 하자!</p>\n<p>오늘은 장고와 DRF를 이해하는 핵심 기능 중 하나인 Serializing 기법과 django model과 DB를 손쉽게 연결해주는 ORM을 배워봤다. 다음에는 Request와 Response를 더 공부해보도록 하자! 오늘의 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/5554170cdcb9bef18c2b74522144bfbac2cc92c0\">여기</a>를 참고한다.</p>","frontmatter":{"date":"April 14, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [5-serializer와 Django ORM]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(5)-serailizer-django-orm/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Django(4)-migration/","nextSlug":"/Django(3)-model/","prevSlug":"/Django(5)-serailizer-django-orm/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}