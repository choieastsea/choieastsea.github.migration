{"componentChunkName":"component---src-templates-blog-template-js","path":"/Django(6)-request-response/","result":{"data":{"cur":{"id":"14ee35cd-9837-5380-8e94-1042bcaa938f","html":"<p>저번까지는 DRF의 serailizer에 대하여 공부하였고, 새로운 item을 만드는 api까지 간단하게 만들어보았다. 오늘은 좀 더 다양한 method에 대하여 알아보고, DRF(Django Rest Framework)의 <code class=\"language-text\">ViewSet</code>을 도입하여 rest api에 최적화된 간단한 view구조를 설계해보도록 한다.</p>\n<h2 id=\"다양한-request에-대한-response\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%96%91%ED%95%9C-request%EC%97%90-%EB%8C%80%ED%95%9C-response\" aria-label=\"다양한 request에 대한 response permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다양한 request에 대한 response</h2>\n<p>장고에서는 request와 response를 이렇게 처리한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>shortcuts <span class=\"token keyword\">import</span> render\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>http <span class=\"token keyword\">import</span> HttpResponse\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">my_view</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        post_data <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>POST \n        <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>장고에서는 요청을 HttpRequest객체에서 처리하도록 하고, 응답은 HttpResponse객체에서 처리하도록 한다.</p>\n<p>이렇게 요청에 대하여 함수에서 처리하도록 하는 것을 <code class=\"language-text\">Function Based View(FBV)</code>라고 하며, 뷰 클래스에서 처리하도록 하는 <code class=\"language-text\">Class Based View(CBV)</code> 역시 존재한다.</p>\n<h3 id=\"in-drf\" style=\"position:relative;\"><a href=\"#in-drf\" aria-label=\"in drf permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>in drf</h3>\n<p>DRF에서도 request와 response를 받는 방법을 CBV,FBV로 나눠볼 수 있다. 우리가 저번에 <code class=\"language-text\">@api_view(['POST'])</code> 데코레이터를 이용해 처리한 방법이 FBV이며, 오늘은 CBV에 대하여 알아보자.</p>\n<p>가장 기본적인 <code class=\"language-text\">APIView</code> 클래스를 상속하여 뷰 클래스를 만들어보자. 이는 <code class=\"language-text\">from rest_framework.views import APIView</code>로 임포트하고 클래스를 상속받도록 구현하면 된다.</p>\n<p>저번까지는 전체 item list를 얻는 것과 item을 추가하는 것에 대하여 알아보았으니 오늘은 특정 아이템을 다루는 것까지 구현해보자. 클래스 안에서 Rest request Method에 해당하는 이름으로 만들어주면 된다. item/views.py를 다음과 같이 추가해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">import</span> Response\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>views <span class=\"token keyword\">import</span> APIView\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>http <span class=\"token keyword\">import</span> Http404\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> status\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> ItemSerializer\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemListView</span><span class=\"token punctuation\">(</span>APIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    item list를 리턴하거나 새로운 item을 create하는 클래스\n    \"\"\"</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        items <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">,</span> many<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_201_CREATED<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_400_BAD_REQUEST<span class=\"token punctuation\">)</span> \n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemDetailView</span><span class=\"token punctuation\">(</span>APIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    특정 pk의 Item을 Read, Update, Delete하는 클래스\n    요청에 대하여 pk가 주어져야 한다\n    \"\"\"</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_object</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 특정 pk의 Item을 리턴</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>pk<span class=\"token operator\">=</span>pk<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">except</span> Item<span class=\"token punctuation\">.</span>DoesNotExist<span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># Item이 없다면 DoesNotExist error throw</span>\n            <span class=\"token comment\"># 이에 404오류를 발생시키도록 한다</span>\n            <span class=\"token keyword\">raise</span> Http404\n        \n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        item <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_object<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span> <span class=\"token comment\"># error 발생하면 이후 실행되지 않고 바로 404 response</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 직렬화(DB to json) 수행, 하나이므로 many=True일 필요없음</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        item <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_object<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span>\n        serializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span> <span class=\"token comment\"># serailizer의 update 함수 수행</span>\n        <span class=\"token keyword\">if</span> serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_400_BAD_REQUEST<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> pk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        item <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>get_object<span class=\"token punctuation\">(</span>pk<span class=\"token punctuation\">)</span>\n        item<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\"># pk 기반의 삭제는 serializer를 사용하지 않고 ORM의 delete를 수행한다</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_204_NO_CONTENT<span class=\"token punctuation\">)</span></code></pre></div>\n<p>각 메소드 별로 pk가 필요한 경우가 있으므로 이에 따라 url pattern이 달라지므로 별개의 클래스로 나누었다.(하나의 클래스가 하나의 url에 매핑되는 것이 원칙)</p>\n<p>함수 이름은 정해져 있으니 주의해야한다. 또한, pk와 같이 url path이 필요한 경우에는 함수에 인자를 pk와 같이 추가해줘서 가져올 수 있다. 그리고 get_object로 가장 기본적인 함수를 정의한 이후에 해당 인스턴스가 필요한 상황에 이를 가져와 사용하면 된다.</p>\n<p>이제 url로 요청을 보내보기 위해 item/urls.py를 수정해주자. CBV로 구현한다면 url을 <code class=\"language-text\">as_view()</code> 함수로 매핑해줄 수 있다. 이러한 방법으로 여러 method에 대해 대응할 수 있는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'create/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>create_item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'list/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemListView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># get list / create</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'detail/&lt;int:pk>/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemDetailView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># get one / update / delete</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>이제 postman에서 테스트해보자!</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 154.44444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAABYlAAAWJQFJUiTwAAADTklEQVRIx5VWWXLaQBTUQQzaZh+NdkAC27FxwUfuf59OvSfEkmBwPrpm0Uyr3ypFxhh476GUgtaaQXvW2jOccww6N89pfz5/jej19RWHw4EPFEWBsiwZHx8f+Pz8ZHx9fTGOxyP2+z3Ph2FgYrpzjUhKCSEEaJzxk/W8N8/ndUSm1nXNizzPUVXVWWmWZdBK83NXeIjSII5jPkPmEUkIgdc0ssIilLDO8QF3Go01/FAZDWn1+RmdI//Siwn0QhonhdNetB9WCEYhFwJlCLxJl2gujUbmJKSQ54CQr5MkwXK5xGKxYMWE5WmMhq7BYf+JcRz58GyONgZVWaEswlkhuYFMI/eQBW3b8r5UCm3h4I1G1K9WOByPeH9740Nd151ThOZN00yKyxJ93zMJEdJ6s9lMrtEaDRFag4hkknSpJF98eXlhk9iM5ZLx3Zru0XxaJ4iTBFGappzU12lBe9egC3/vfYeIDs8kFLUsSyGkQug28E0P4wO0ksjo+Q9ewISkcE6BNEkgKDeHV9hQwSmBbV+hLT3awsIo+ZyQFJIyIkziGNJYNOM7XN3Beo/VbsBq7DkvyXezynvEV4QZgxI0y3NWR+aaooI0DkIKKC2f+vNk8oXQWscql4sFI14ueH2j6Bt1d3w4keZSwVUNXNnA+IJTKrkT9bsmT6osL9iHHBQ9+bBqOfvXdYHgDGpnngeFCCmhL4QxpDYTISm0BsNujc3YwzrD5j704aTwQsgmUzNoetiyhi0b2FBDG42i9De+fGoyzamOKQgUjJjK7NRFZqJHZP8S5hkE9TohoZyHsp5zklLmWTAe+pCDsv2F0K2nluYtrJI/qul/fJieokylR0lNdbwZOqyHjpUmPwvKJW3SdCKs1lv4uoNvOhRtDx8cjL2U3kNC5y5BmVv8TSDi5CZdnvgw5cjSSIRc1/ThUZorJlcaaZZx86Qmeh2Y/6qUenibeqL36MsCXitYJSBF/jzKs8kXHyrUmx1MUcLIHLuxxW7bcxlKIW7q+htCd/YhJbJQBtVmNwWlbhH6FUIdYJzBYkHflPQm0a9xNpnUSSn4k8lz+s4Q6A+B/yoyfs6N+NTq7iGaDkqs1h1+//7AZl1gO9YYh/IvVIzt+Bh/ABnQgFeyik5pAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"list\" title=\"list\" src=\"/static/554611d1e389382110cd483f942f8e71/37523/list.png\" srcset=\"/static/554611d1e389382110cd483f942f8e71/e9ff0/list.png 180w,\n/static/554611d1e389382110cd483f942f8e71/f21e7/list.png 360w,\n/static/554611d1e389382110cd483f942f8e71/37523/list.png 720w,\n/static/554611d1e389382110cd483f942f8e71/ef6b9/list.png 832w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>이번에는 특정 pk에 접근하는 클래스를 보도록 하자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 77.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCElEQVQ4y42T2XLbMAxF9SOxVkqkNqra7XgbezxO/eD//5vbuZDpcZp2kocjEsJCAAS9uq7hKMsSTdNgGAaRq6oSmf+DIEAYht/i7XY7bDYb7Pd7bLdbgf8cx+MRbdvC9/0vzjzkb7y3t7en0hnSebVaCdRTF0WREMfxc1VKfcG73++w1qIoimeZ6/Ual8sF5/NZ1tPphOv1+ml/OBzEh+14xeMnyzIhTVNBay3GJM9zwTm7PXH2r3hlWcAYI6W+nkhlGASSMf+rysAPA+hMS1C2gXbU0Yb/WKmXai3ZsScuU2bIgLFKoI1ZZJMhTpa+Ucc+ur3WrE6Jnffet6LkeDDTJEmeo6KsQaRiFPnSX2ZAW14WL86xesC9d5gGGQumrB/Z8lTjMnv0hjJhVjyU9rRNEoVUJTBZioBz+PH7htvtJkG7rhNo3Pc95nl+9nAcR7l97hmYM9q1LUyeo84NNq2FzzmMonA5scjhSykrBI/0X2fTDe6rzJX+IruXwmBsqDEaYRTDVBa6qKC0kUsIglD64wL863V8eikMuDj6UJnGr/UORdOhNAZdlaPUKWqTIUvVj97zEjCOpURmZcd36NJC6xTT3GOaOxi9zKTvB9InWf+DBOTN5bmGyQ269Qa269EMg2CbEpUtkCQR0jT5Fo9zpY3G9XpE3xWYJ4tpsrKOQyVMY/1j/gCQttlqGWE7pAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"detail1\" title=\"detail1\" src=\"/static/a0f6678b10048341c920efd0760afb5c/37523/detail1.png\" srcset=\"/static/a0f6678b10048341c920efd0760afb5c/e9ff0/detail1.png 180w,\n/static/a0f6678b10048341c920efd0760afb5c/f21e7/detail1.png 360w,\n/static/a0f6678b10048341c920efd0760afb5c/37523/detail1.png 720w,\n/static/a0f6678b10048341c920efd0760afb5c/ad12c/detail1.png 856w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>같은 url에 대하여 다양한 method로 접근이 가능한 것도 확인이 가능하다! 예를 들어, PUT 메소드로 보내면 body에 아무것도 적지 않았으므로 error가 나올것이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 73.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1UlEQVQ4y5VTYXOkIAzll6gIBARUUNne3rbTbe///6Z3E1y3N9ftdPrhGYlJeC+JYp5njOMI5xyGYQCfl2VBzhnruu7gc0r1O8cdsf9bhkgpYZqm6vTe10LbtlWUUrBuG9ZSkJcF/pb0FbiGMMaAoZSqDiKClBLWWvSkIHuJMgcoLaEN3RlyPBlTY7mYJYO2bSFCCIgxViezZfn8zqyPdpQlYwwBOYaqgv0cw7ncErIOyq+QyuwMD7pEBpYIWuvKlFkyiEEER7sa9h3KOJfjlXHolYZgyuxgmCFCaYPREcbBQkmJpmnRNM3NPkJTpbY3K2oviJBzxPOfd5xfLnh9f8b17RdyYnnDjyBk11Wpg3fQWsHcZNV3c0CDjK72w/cYQhuDvu/r1NhqpdFrhV6pvTdKoeskuq672R3cqkcQL6cNOc33SU885THAOotpnKqfLzpWS6m+nvmChwXPTye8Xa91PY6i/Ff4f1aHN4DXw/uAyQ/wltC2e8Gd+QcEP/h2srzQfZ1y23V1YkfQkShl96XUO0OWwL3ink2n3whTwpYiUhxgtPrE4DuIYyCMuBS4EJHXjLzMtVffMfrEkKuG4HG5FJQy4+m8opwStm3EtkasS/gR/gLuDbYgvatU4wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"detail2\" title=\"detail2\" src=\"/static/c9772edc8c23ed39d0b4c54bc3a18b96/37523/detail2.png\" srcset=\"/static/c9772edc8c23ed39d0b4c54bc3a18b96/e9ff0/detail2.png 180w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/f21e7/detail2.png 360w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/37523/detail2.png 720w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/302a4/detail2.png 1080w,\n/static/c9772edc8c23ed39d0b4c54bc3a18b96/cd78c/detail2.png 1236w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>하지만, update는 바꿀 값들만 body에 실어서 보내는 것이 더 편하다. 이는 Serializing을 해줄 때, <strong>partial=True</strong> 옵션을 넣어주면 된다.</p>\n<p><code class=\"language-text\">serializer = ItemSerializer(item, data=request.data, partial=True)</code></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvUlEQVQ4y5VTWW7rMAzUSSJbuyxZ8m4j6Ffvf6d5IGO3CZAAfR9jUjSXEUmJaZowDANCCOi6DvM8Y9s2rOuKfd8Zx75jWRb2iTF+BMWLvu+RUoL3ng2lFAYVqUNlfZwn5L5HDL/BV3KKu87OOQhrLQjGmB9j27YIPkA5A60V9iFD6xbWup9grTX7KqUecdZCSglxsSI5jiOIMenEkFnWinmeUHLGXDK6lNhOPuS7bSuMC9B5hdIW4qpkiZnSUAStmUHbqie0T1AvetO0aE4piLL3DuNUMK0ThqlgPwasW0VKHjn/HwRVIDZd5xGCRQyW5aU/n/8C0TQNCLebhJS/8tJvUkKePmRrzn+fILoYmSGNn6YdvIcJFtY99GvqlPC5j9SqdxDf9wPHvvHEUs4s+1oQYuAJ0wbQSqWu44LeWRitHwVO5s8QtCr3+x05Z2ZEA8opw/vAC38t/VArfAjIMcBbw214nfwDgpaRlpeqa+dhaaFVi0ZKBv1/9O+UJ5N3beCE1D+6Et2/7l9IpeJYBixDD2c079Y7Js0nhvShhIRYRsRckGpF6tNL4KcEbxPye3aWDdqYl5fw10RXwn/OF7Fu812yGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"detail3\" title=\"detail3\" src=\"/static/6a3e47feac01b44b7541a24940afb9cf/37523/detail3.png\" srcset=\"/static/6a3e47feac01b44b7541a24940afb9cf/e9ff0/detail3.png 180w,\n/static/6a3e47feac01b44b7541a24940afb9cf/f21e7/detail3.png 360w,\n/static/6a3e47feac01b44b7541a24940afb9cf/37523/detail3.png 720w,\n/static/6a3e47feac01b44b7541a24940afb9cf/302a4/detail3.png 1080w,\n/static/6a3e47feac01b44b7541a24940afb9cf/636d3/detail3.png 1222w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>여기까지 <code class=\"language-text\">APIView</code>를 이용하여 구현한 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/98e15e109dd411a729244eff3d0c7ede484ee9b8\">여기를 참고</a>한다.</p>\n<p>FBV와 CBV를 모두 구현해보았다. 더 자세한 설명은 <a href=\"https://www.django-rest-framework.org/api-guide/views/\">공식문서</a>를 참고하도록 하자.</p>\n<h2 id=\"drf의-클래스를-이용하여-코드를-짧게-만들기\" style=\"position:relative;\"><a href=\"#drf%EC%9D%98-%ED%81%B4%EB%9E%98%EC%8A%A4%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%A7%A7%EA%B2%8C-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"drf의 클래스를 이용하여 코드를 짧게 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF의 클래스를 이용하여 코드를 짧게 만들기</h2>\n<p>위에서는 APIView를 이용하여 구현해주었다. 하지만, 생각해보면 위에서 구현한 것처럼 매우 간단한 rest api는 다른 모델이라도 모델과 시리얼라이저만 제외하면 같은 코드를 반복적으로 적어야한다. 이는 장고의 설계 원칙 중 하나인 <a href=\"https://docs.djangoproject.com/ko/4.2/misc/design-philosophies/\">DRY</a>에 어긋난다! CBV를 위한 클래스의 상속구조를 알아보자.</p>\n<p>CBV를 위한 클래스는 View > APIView > Mixins > GenericAPIView > ViewSet > ModelViewSet 의 순서로 상속이 되어있다고 보면 될 것 같다. 갈수록 추상화되어있으므로 코드는 줄어들지만 자유도 역시 줄어들 것이다. 따라서, 필요한 기능이 있는 부분을 정리하고 다중 상속을 통하여 기능을 구현할 수 있을 것이다. 순서대로 간단하게 알아보도록 하자.</p>\n<ul>\n<li>\n<p>APIView : pk가 필요한 액션과 그렇지 않은 액션으로 method를 구분하여 구현할 수 있는 클래스. 하지만, 함수들을 보면 공통적으로 모델(혹은 queryset)과 serializer를 선언하는 부분이 겹치는 것을 볼 수 있다.</p>\n</li>\n<li>\n<p>Mixins : APIView의 CRUD 기능들을 각자 구현해 놓은 클래스. queryset과 serializer가 중복되므로 이를 공통으로 해결해준다. 또한 각자 method에서 필요한 mixins 함수를 호출하도록 한다</p>\n</li>\n<li>\n<p>GenericView : GenericAPIView와 mixins의 함수들의 조합으로 구성한 클래스</p>\n</li>\n<li>\n<p>ViewSet</p>\n</li>\n<li>\n<p>ModelViewSet</p>\n</li>\n</ul>\n<h3 id=\"genericapiview--mixins를-이용하여-구현\" style=\"position:relative;\"><a href=\"#genericapiview--mixins%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EA%B5%AC%ED%98%84\" aria-label=\"genericapiview  mixins를 이용하여 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GenericAPIView + mixins를 이용하여 구현</h3>\n<p>get all 또는 post를 담당하던 APIView 기반 클래스를 mixins를 이용하여 구현해보자.</p>\n<p>items/views.py에 다음과 같이 추가해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> generics<span class=\"token punctuation\">,</span> mixins\n\n<span class=\"token comment\"># GenericAPIView + mixins 이용한 CBV</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemListGenericAPIView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>GenericAPIView<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>ListModelMixin<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>CreateModelMixin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    GenericAPIView를 이용하여 item의 리스트를 얻도록 하는 클래스\n    queryset과 serailizer_class 정의해줘야함.\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># get override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.ListModelMixin</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># post override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.CreateModelMixin</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemDetailGenericAPIView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>GenericAPIView<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>RetrieveModelMixin<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>UpdateModelMixin<span class=\"token punctuation\">,</span> mixins<span class=\"token punctuation\">.</span>DestroyModelMixin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>retrieve<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.RetrieveModelMixin</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># update override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.UpdateModelMixin</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># delete override</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>destroy<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kargs<span class=\"token punctuation\">)</span> <span class=\"token comment\"># from mixins.DestroyModelMixin</span>\n</code></pre></div>\n<p>APIView보다 로직적으로 겹치는 부분이 줄어들었음을 확인할 수 있다.</p>\n<p>mixins 클래스는 기능별로 존재하며, 위에서 사용한 list와 create 이외에도 retrieve, update, destroy에 대한 클래스가 존재하며 해당 클래스의 함수를 호출하면 된다.</p>\n<p>하지만, GenericApiView를 이용하면 필요한 기능의 mixins를 같이 상속해서 구현해줘야 한다. 이를 좀 더 짧게 만들어보자.</p>\n<h3 id=\"generic-views를-이용하여-구현\" style=\"position:relative;\"><a href=\"#generic-views%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%EA%B5%AC%ED%98%84\" aria-label=\"generic views를 이용하여 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generic Views를 이용하여 구현</h3>\n<p>결국 역할은 크게 두개로 나눠볼 수 있다.</p>\n<ol>\n<li>list get / create new model -> <code class=\"language-text\">ListCreateAPIView</code></li>\n<li>get/update/delete specific model -> <code class=\"language-text\">RetrieveUpdateDestroyAPIView</code></li>\n</ol>\n<p>이에 대하여 GenericAPIView와 mixins 클래스를 조합한 generic view class가 존재한다. 따라서, 기능에 맞게 이를 가져다 쓰면 될 것같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Generic 이용한 CBV</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemDetailGenericView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>RetrieveUpdateDestroyAPIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    GenericView를 이용하여 item의 특정정보를 얻거나, 업데이트, 삭제 하도록 하는 클래스 \n    queryset, serializer_class를 정의해야함\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemListGenericView</span><span class=\"token punctuation\">(</span>generics<span class=\"token punctuation\">.</span>ListCreateAPIView<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    GenericView를 이용하여 item의 list얻거나 create 하도록 하는 클래스 \n    queryset, serializer_class를 정의해야함\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer</code></pre></div>\n<p>이러고, urls.py에서도 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">path<span class=\"token punctuation\">(</span><span class=\"token string\">'list/generics/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemListGenericView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\npath<span class=\"token punctuation\">(</span><span class=\"token string\">'detail/generics/&lt;int:pk>/'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemDetailGenericView<span class=\"token punctuation\">.</span>as_view<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>단 세줄만으로 이 모든 기능이 가능해지는 것이다!! 여기서는 한번에 update, delete, get을 처리하는 generic view 클래스를 상속받았지만, 상황에 따라 필요한 조합의 method만 갖는 클래스를 상속하면 된다. 그렇다면 해당 method를 알아서 처리해줄 것이다.</p>\n<p>위의 코드는 partial update 등의 기능이 불가능하다. 이는 update함수를 오버라이드하면 될 것이다. 그거까지 포함한 기능을 밑에서 구현해보자.</p>\n<p>상속관계가 좀 어렵게 느껴지는데, 이는 <a href=\"https://www.django-rest-framework.org/api-guide/generic-views/\">공식문서</a>의 extends란을 참고하면 될 것 같다.</p>\n<h3 id=\"viewset과-modelviewset을-이용한-구현\" style=\"position:relative;\"><a href=\"#viewset%EA%B3%BC-modelviewset%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B5%AC%ED%98%84\" aria-label=\"viewset과 modelviewset을 이용한 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ViewSet과 ModelViewSet을 이용한 구현</h3>\n<p>GenericView는 url path에 따라서 url pattern을 추가적으로 적어줘야하는 귀찮음이 있다. 예를 들어, 바로 위의 코드도 보면 내용은 같은데 상속하는 것만 다르고, 이에 따라 url pattern도 여러개가 된다. 따라서, 이를 router 클래스를 이용해서 처리해주고 ModelViewSet에서 한번에 list와 detail의 모든 기능을 수행하도록 할 수 있다.</p>\n<p>ViewSet를 이용하여 구현하려면, <code class=\"language-text\">GenericViewSet</code>과 필요한 기능의 <code class=\"language-text\">mixins</code>들을 임포트해서 사용하면 될 것이다. ModelViewSet은 모델을 다루는데 필요한 모든 mixins들을 넣어놓은 클래스라고 보면 된다.</p>\n<blockquote>\n<p>ModelViewSet은 mixins.CreateModelMixin, mixins.RetrieveModelMixin, mixins.UpdateModelMixin, mixins.ListModelMixin, mixins.DestroyModelMixin,  GenericViewSet를 상속함</p>\n</blockquote>\n<p><a href=\"https://github.com/encode/django-rest-framework/blob/master/rest_framework/viewsets.py\">출처 : DRF github</a></p>\n<p>위의 <code class=\"language-text\">ItemListView</code>와 <code class=\"language-text\">ItemDetailView</code>의 모든 기능을 단 몇줄만으로 구현이 가능하다! (partial update를 위하여 update 함수를 오버라이딩해주었다)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ModelViewSet 이용한 CBV</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    ModelViewSet을 이용하여 item의 모든 기능을 제공하는 클래스\n    queryset, serializer_class만 정의하면 다양한 패턴에 대하여 구현 가능\n    \"\"\"</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        kwargs<span class=\"token punctuation\">[</span><span class=\"token string\">'partial'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span> <span class=\"token comment\"># for partial update</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제 url과 연결해주면 되는데, rest_framework의 router class를 이용하면 매우 간편하게 처리할 수 있다.</p>\n<p>router class에서 제공하는 url 패턴은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">URL pattern: ^users/$ Name: 'user-list'\nURL pattern: ^users/{pk}/$ Name: 'user-detail'</code></pre></div>\n<p>따라서 우리 item/urls.py에 다음과 같이 추가해줄 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path<span class=\"token punctuation\">,</span> include\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> routers\n\nrouter <span class=\"token operator\">=</span> routers<span class=\"token punctuation\">.</span>DefaultRouter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nrouter<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span><span class=\"token string\">r'mvs'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemModelViewSet<span class=\"token punctuation\">)</span>\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>이렇게 하면 다양한 url pattern에 대하여 오늘까지 적용했던 모든 처리가 가능하다! 커밋내용을 보면, APIView부터 ModelViewSet까지의 코드를 다 적어놨으니 이해하기 편할 것이다!</p>\n<blockquote>\n<p>[GET] <a href=\"http://localhost:8000/item/mvs/1/\">http://localhost:8000/item/mvs/1/</a></p>\n<p>{</p>\n<p>​    “item_id”: 1,</p>\n<p>“name”: “Iphone G14”,</p>\n<p>​    “price”: 1700000,</p>\n<p>​    “stock_count”: 10</p>\n<p>}</p>\n</blockquote>\n<p>create도 테스트해보았다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 73.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABz0lEQVQ4y5VT2W7bMBDUl1jiTZGUeIm2gbhG//+npljSDpK0DtKHwVLa5ezswel8PmPfd1hr4b1HKQW11o7WGo7jQMkZ3rkes67rt5jowrZt74Q550+kdE6lYHXu08Wv5Pbxb1JKQQgBsuSQUoIxBmsMFiUgOcclBzDBoLR+J+OcQ2sNxnj/NlphnmdMpI6UOeeQUkIIoZ9jjL0VMe44SkYk9VvAuo44iqHYo1YoYyFcBZcaE2XRj8xPhaRWKd0VDb+BVqqrID/9GzEKxhgIKcGlARcCE0mnkimQHCbsUFLCW41VKwjOcDrNmOell/TVnuYZy7JgediJyCgjZafG1rc7Yq24vl2RUoAUHFJSQv4jTDQArSRaiyglIEWHnANipF45pLgO+0NMQio8y+Zc9LKZ/NAGIfrUl4UNy4Z9hel+aX1aBBpKX/IwVoPONE1KSOQjMQfnrPfrn4S/779wu93wXJ++3Cl1cloPIqUzPQCy0TtY2rlXhFSCtWYsNOd99BRMeKVilP6CsL8S6pXSiNcb/LYjbQ7eaCghBumD/CNe9pAIqS80nK1eYH1AbQXerw8i9hfZd+hr44NDO0e0S8H5WnG0iNY25OxQsv8v/AELbrYcEcFbqwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"modelviewset\" title=\"modelviewset\" src=\"/static/983c5db823ccd95d7eba7551db2e2bab/37523/modelviewset.png\" srcset=\"/static/983c5db823ccd95d7eba7551db2e2bab/e9ff0/modelviewset.png 180w,\n/static/983c5db823ccd95d7eba7551db2e2bab/f21e7/modelviewset.png 360w,\n/static/983c5db823ccd95d7eba7551db2e2bab/37523/modelviewset.png 720w,\n/static/983c5db823ccd95d7eba7551db2e2bab/302a4/modelviewset.png 1080w,\n/static/983c5db823ccd95d7eba7551db2e2bab/c929c/modelviewset.png 1218w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>따라서, 복잡한 로직을 처리하는 것이 아니라면 ModelViewSet에서 가장 짧은 코드로 CRUD를 구현할 수 있다.</p>\n<p>만약 CRUD에서 부가적으로 처리해야할 일들이 많다면 상황에 따라 ViewSet의 부모 클래스인 APIView부터 적용해볼 수 있을 것이다. 하지만, ViewSet 혹은 ModelViewSet에서 오버라이딩 하면서 기능들을 구현하는 것이 더 편할 수도 있다.</p>\n<p>물론, 개발자의 자유도에 따라 trade-off가 존재할 것이다. 따라서, DRF의 상속 구조를 어느정도 이해하고, 필요한 상황에 어떤 구조를 사용할지 생각할 수 있도록 공부할 필요가 있다. DRF의 <a href=\"https://www.django-rest-framework.org/tutorial/3-class-based-views/\">CBV 공식문서</a>를 참고하면 좋을 것이다! 간단한 로직에 있어서 장고가 매우 편한 것 같다…</p>\n<p>CBV를 다룬 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/eee0627c2061e4852707e6005e9e15dd3f65803b\">여기를 참고</a>한다.</p>","excerpt":"저번까지는 DRF의 serailizer에 대하여 공부하였고, 새로운 item을 만드는 api까지 간단하게 만들어보았다. 오늘은 좀 더 다양한 method에 대하여 알아보고, DRF(Django Rest Framework)의 을 도입하여 rest api에 최적화된 간단한 view구조를 설계해보도록 한다. 다양한 request에 대한 response 장고에서는 request와 response를 이렇게 처리한다. 장고에서는 요청을 HttpRequest객체에서 처리하도록 하고, 응답은 HttpResponse객체에서 처리하도록 한다. 이렇게 요청에 대하여 함수에서 처리하도록 하는 것을 라고 하며, 뷰 클래스에서 처리하도록 하는  역시 존재한다. in drf DRF에서도 request와 response를 받는 방법을 CBV,FBV로 나눠볼 수 있다. 우리가 저번에  데코레이터를 이용해 처리한 방법이 FBV이며, 오늘은 CBV에 대하여 알아보자. 가장 기본적인  클래스를 상속하여 뷰 클래스를 …","frontmatter":{"date":"April 15, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [6-DRF CBV(APIView부터 ViewSet까지)]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(6)-request-response/"}},"next":{"id":"edcd3751-d5fc-5f9a-9826-0c0da687ecfa","html":"<p>저번까지는 model의 구조를 DB schema에 적용하는 migration을 알아보았다. 오늘은 데이터를 저장하고, 저장된 데이터를 가져와서 사용할 때 필요한 개념인 <strong>직렬화</strong>에 대하여 알아보자! 어렵지만 이해를 해야 다음으로 넘어갈 수 있으니 매우 중요하다고 볼 수 있다.</p>\n<h1 id=\"drf-serializer\" style=\"position:relative;\"><a href=\"#drf-serializer\" aria-label=\"drf serializer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF Serializer</h1>\n<p>장고에는 기본적으로 <code class=\"language-text\">forms</code>이라는 것이 있지만, 앞으로는 DRF(Django Rest Framework)에서 제공하는 <code class=\"language-text\">serializers</code>를 사용할 예정이다.</p>\n<blockquote>\n<p>DRF를 사용하는 이유</p>\n<ol>\n<li>REST api 서버를 구성하기 위해 초점이 맞춰진 기능들이 많음</li>\n<li>장고보다 코드의 중복을 줄이는 몇가지 클래스들이 제공됨</li>\n</ol>\n</blockquote>\n<p>우선 가상환경에 DRF를 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> pip <span class=\"token function\">install</span> djangorestframework</code></pre></div>\n<p>그리고, settings.py의 INSTALLED_APPS에서 <code class=\"language-text\">'rest_framework'</code>를 추가해준다.</p>\n<p>참고로, INSTALLED_APPS에는 pip로 설치해준 것도 추가해야할 경우가 있고, manage.py startapp 등으로 만든 appConfig의 name도 들어가야한다. (모든 pip 모듈을 적어주는 것은 아니므로 해당 라이브러리의 공식문서를 참고)</p>\n<h2 id=\"db에서-json까지의-과정\" style=\"position:relative;\"><a href=\"#db%EC%97%90%EC%84%9C-json%EA%B9%8C%EC%A7%80%EC%9D%98-%EA%B3%BC%EC%A0%95\" aria-label=\"db에서 json까지의 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB에서 JSON까지의 과정</h2>\n<p>클라이언트는 요청을 보내고, 서버는 이에 알맞은 응답을 보내는데, 이때 클라이언트와 서버는 HTTP body에 JSON데이터를 주고 받는다. 장고의 모델과 ORM에서 이를 직접 다룰 수 없으므로, 장고에서 사용할 수 있도록 변환하는 과정이 필요하다.</p>\n<p><strong>DB ↔ QuerySet ↔ OrderdDict ↔ JSON</strong></p>\n<p>QuerySet과 OrderedDict는 python class이며, <strong>최종 목표는 JSON과 DB사이를 연결해주는 것</strong>이다. DRF의 <code class=\"language-text\">serializer</code>는 직렬화와 역직렬화(deserialization)를 도와주는 클래스인 것이다. item/serializers.py를 만들어주자. 해당 파일에는 item과 관련한 serializing 기능을 지원하는 클래스가 들어갈 것이다.</p>\n<p>우선 가장 간단한 ModelSerializer를 이용해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span> <span class=\"token comment\"># 아이템의 모든 필드를 serialize해줄 것임</span></code></pre></div>\n<h2 id=\"db-to-json\" style=\"position:relative;\"><a href=\"#db-to-json\" aria-label=\"db to json permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB to JSON</h2>\n<p>item/views.py 에서 처음 만들었던 index 함수를 item의 리스트를 반환하는 함수로 수정해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">import</span> Response\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>decorators <span class=\"token keyword\">import</span> api_view\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> ItemSerializer\n\n<span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># serialize</span>\n    items <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># return QuerySet(not yet query)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">)</span>\n    itemSerializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">,</span> many<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># return OrderedDict</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span></code></pre></div>\n<p>우선 Request와 Response를 위와 같이 DRF에서 사용하는 방법으로 바꿔주자. (이는 다음에 자세히 알아볼 예정)</p>\n<ul>\n<li>\n<p>@api_view([‘GET’]) &#x26; Response</p>\n<p>http get request를 처리하는 View함수에 달 수 있는 데코레이터이다. 이후 적절하게 Response를 해줘야 한다. (DRF에서 사용하는 방법)</p>\n</li>\n<li>\n<p>Item.objects.all()</p>\n<p>장고에서 model을 통해 DB에 접근할 때 사용하는 Manager가 기본적으로 <code class=\"language-text\">objects</code>이다. 따라서, DB manager 혹은 accesser 정도의 역할로만 알고 있어도 일단은 ok.</p>\n<p>manager에서 all 함수는 <code class=\"language-text\">select *</code>과 같은 의미로 결과로 <strong>QuerySet이 리턴된다.</strong></p>\n<p>참고로 QuerySet은 아직 DB query가 실행되지는 않은 상태이다.</p>\n</li>\n<li>\n<p>ItemSerializer(items, many=True)</p>\n<p>사전에 정의한 시리얼라이저의 인자에다가 <code class=\"language-text\">QuerySet</code>을 넣어주고, <code class=\"language-text\">many=True</code> 옵션을 주면 이를 OrderedDict의 list로 반환해준다.</p>\n</li>\n<li>\n<p>serializer.data</p>\n<p>queryset의 데이터에 접근하여 직렬화된 자료구조를 리턴한다.</p>\n</li>\n</ul>\n<p>이제, localhost:8000/item/에 접근해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Iphone G14\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1500000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Galaxy X25\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1450000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">120</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>저번 포스트에서 2개의 item을 추가했으므로 잘 나오는 것을 볼 수 있다👏👏</p>\n<p>콘솔에는 다음과 같이 프린트 되어있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">&lt;</span>QuerySet <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span>, <span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n\nItemSerializer<span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>QuerySet <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span>, <span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>, <span class=\"token assign-left variable\">many</span><span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span>:\n    item_id <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span>, <span class=\"token assign-left variable\">read_only</span><span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> CharField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span>, <span class=\"token assign-left variable\">max_length</span><span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span>, <span class=\"token assign-left variable\">max_value</span><span class=\"token operator\">=</span><span class=\"token number\">4294967295</span>, <span class=\"token assign-left variable\">min_value</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    stock_count <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span>, <span class=\"token assign-left variable\">max_value</span><span class=\"token operator\">=</span><span class=\"token number\">4294967295</span>, <span class=\"token assign-left variable\">min_value</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span>, <span class=\"token string\">'Iphone G14'</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span>, <span class=\"token number\">1500000</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span>, <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>, OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span>, <span class=\"token string\">'Galaxy X25'</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span>, <span class=\"token number\">1450000</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span>, <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><code class=\"language-text\">ModelSerializer</code>로 정의했고, fields에 <code class=\"language-text\">__all__</code>을 적어주어 자동으로 시리얼라이저의 필드들이 위와 같이 들어가 있는 것을 볼 수 있다. 또한, 아직 serailizer.data로 접근하지 않은 상태에서는 <strong>QuerySet으로 남아있고, 실제 쿼리문이 실행되지는 않은 상태</strong>이다. 즉, QuerySet에서 실제 데이터와 관련된 접근이 일어날 때에만 query가 수행되는 <code class=\"language-text\">lazy</code>한 특성을 보인다.</p>\n<p>또한 Response 함수를 이용하면 ordered dict의 배열을 JSON 형식으로 바꿔서 응답해주는 것으로 보인다. 만약, ordered dict 형태에서 우리가 데이터를 JSON으로 직접 바꿔야 할 필요가 있다면 <code class=\"language-text\">JSONRenderer().render(serializer.data)</code>로 변환해줄 수 있다. (<code class=\"language-text\">from rest_framework.renderers import JSONRenderer</code>로 임포트 후 사용가능)</p>\n<p>다시 직렬화로 돌아와 과정을 정리해보면,</p>\n<blockquote>\n<p>DB instance → <code class=\"language-text\">{model}.objects.all()</code> → QuerySet → <code class=\"language-text\">Serializer(queryset)</code> → OrderedDict → JSON</p>\n</blockquote>\n<p>이라고 볼 수 있다.!</p>\n<h2 id=\"json-to-db\" style=\"position:relative;\"><a href=\"#json-to-db\" aria-label=\"json to db permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JSON to DB</h2>\n<p>이제는 데이터를 DB에 저장하는 코드를 만들어보자.</p>\n<p>POST 요청에 대하여 새로운 item을 만드는 api를 만들어본다. drf에서 body는 <code class=\"language-text\">request.data</code>를 이용하여 받을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_item</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    itemSerializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> itemSerializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># need to call .is_valid() before .save()</span>\n        itemSerializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span> <span class=\"token comment\"># error occured</span></code></pre></div>\n<p>JSON 데이터를 장고에서 사용하기 위해서도 serializer class를 이용하면 된다. 여기서는 인자로 data를 넘겨주면 된다.</p>\n<p>주의해야할 점은, <code class=\"language-text\">is_valid()</code>를 호출하고 <code class=\"language-text\">save()</code> method를 호출해야한다는 점이다. 그렇지 않다면 <code class=\"language-text\">AssertionError: You must call .is_valid() before calling .save().</code> 에러가 나올 것이다. 왜냐하면, save() 메소드는 <code class=\"language-text\">serailizer.validated_data</code>가 들어가야 하는데, 이는 <strong>is_valid()가 수행되어야 <code class=\"language-text\">initial_data</code>와 <code class=\"language-text\">validated_data</code>가 초기화되기</strong> 때문이다.</p>\n<p>만약 데이터가 유효하지 않다면 ModelSerializer 클래스에서 <code class=\"language-text\">serilaizers.ValidationError</code>를 throw 할 것이다.</p>\n<p><code class=\"language-text\">postman</code>으로 테스트해보자. (브라우저에서 하려면 CORS를 해결해야함)</p>\n<ol>\n<li>\n<p>정상 케이스</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 72.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABwUlEQVQ4y41TWbKcMAzkJAHv+wKTqSFD5SP3P1SnJIbJo/J4yUdbsstqJHczbNuGGCNCCGitYV3XN7bnhsfjgfWxopTCdw4cNR8jYSAS5xwfppS4kFBbQy4ZtVaU3uCDPxEeNRSJiKK1FgMtUko+8N5zrrXm/JsSaMHj1gImKeCcf5MopZhACMGEWkmM44hhnme+1HtHax05Z+5w3zcs87wjR/RaEFMC1dAH53nB99sCZQNUfkBIhcEYAwJ1doC+Sh2cIU97uvcnV5BK89lA40kpEEpDbAtKdPhx78jB8fk0TScIcY5HLjiKvUNKfG5I8x2pdbSlw3nLb0IF4/j/4A5jdEjJIkWLlBxioNxxTsjJv+D+Ce4wsCUcco6IOcBGi5wi7723rKDWEsYoaK1gjL7E8OvnhlIrq0vyk//Cy6y9z2yRw2tKaXhrICZxPfLz+cRuHQ9rDBI5PkQ479g+REaGJ4OT72oMUFK+xBB/YaCFza0NbEhQ2rBiuxjjO34U6CD7jJTfcJpGpL4gL3fUHLDeGpLf/6Dpky6uyJiQVCbT+lzZh7FUtKXBOntZ9BUGUs17x26ncXlk/mPEl6NdEf4GKIex+dMgtoUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"postman1\" title=\"postman1\" src=\"/static/66bcc081e719e2c6f893d9639b0d1b6e/37523/postman1.png\" srcset=\"/static/66bcc081e719e2c6f893d9639b0d1b6e/e9ff0/postman1.png 180w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/f21e7/postman1.png 360w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/37523/postman1.png 720w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/302a4/postman1.png 1080w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/636d3/postman1.png 1222w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>item_id는 auto_increment이므로 값을 넣지 않도록 한다.</p>\n<p>DB를 직접 확인해보거나, 관리자 페이지에 접근해보면 데이터가 잘 들어가있음을 확인할 수 있다!</p>\n</li>\n<li>\n<p>에러 케이스</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpUlEQVQ4y41TSZLcMAzTS7xKpBZr8TKpHKb//yykSLs9mar0pA8oiTIJEhJsjuOA9x4hBNRasW2bYhfsu+7X1uBDuPN+gnkSxhjRWlMSORMo4XGgret/iYRDYJxzmOdZA2bGMAwgIlgmdGOPoyQQz5hmexV7WGvxrJPc4BlD32utKaUomciVvRTJWmpFzhkf24pWMlqKWFLSbyklzRMV0mAKKyaKJ6GQSRcip5DuErOeEYgZTmOnU9F1LnlS65zFZBmTdZimCUbGHscRFDOcj1iCR4kebC26vkf/EgO67lxV7lOydnUWMRek2pBywbJEMMsdTbD2L8z/2M9fkHwjY+bsUYtHyXyinHGtAa1FrC3q+g4MOXfeBRFiiKDoYdnddpDr6C85wzAq5OwVzO+PA2lZboKYElh8GQKWJelD3A/nHNhZJR/H4WryHebxeKhlxNjiw6d1xBqtViUSw6tVmBGZ0Cvhiwn1hZkwOwaxvzuLzK7vNP6SPFzT/SBZ/CRPb4kR5F8lB++s2iYxgeys39+FEUmfn79w7An7lnDsyzfsgi29jT8p0phyUNk/4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"postman2\" title=\"postman2\" src=\"/static/485b5278e4c4b9bd41461d14f1b939bd/37523/postman2.png\" srcset=\"/static/485b5278e4c4b9bd41461d14f1b939bd/e9ff0/postman2.png 180w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/f21e7/postman2.png 360w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/37523/postman2.png 720w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/302a4/postman2.png 1080w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/f09ab/postman2.png 1250w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>이 경우는 price 필드를 빼고 요청을 보냈을 때의 결과이다. 우리가 사용한 ModelSerializer를 이용하면 이런 생성(create), 검증(is_valid), 그리고 업데이트(update)까지 기본적으로 지원한다!</p>\n<p>아, 그리고 아직은 status code를 넣지 않아서 200으로 오는데, 이는 다음에 Request와 Response를 공부하면 알게 될 것이다.</p>\n</li>\n</ol>\n<h2 id=\"그래서-serializer의-역할은\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-serializer%EC%9D%98-%EC%97%AD%ED%95%A0%EC%9D%80\" aria-label=\"그래서 serializer의 역할은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 Serializer의 역할은?</h2>\n<p>그래서 serializer는 크게 두가지의 역할을 수행한다고 볼 수 있다.</p>\n<ol>\n<li>\n<p>model to JSON &#x26; JSON to model</p>\n<p>각각 직렬화와 역직렬화에 해당하는 내용이다.</p>\n</li>\n<li>\n<p>validation</p>\n<p>DB에 값을 변경할 때에도 Serializer가 사용된다. is_valid()와 save() 메소드로 DB값을 쉽게 변경할 수 있도록 도움을 준다.</p>\n</li>\n</ol>\n<h2 id=\"serializer-커스텀하기\" style=\"position:relative;\"><a href=\"#serializer-%EC%BB%A4%EC%8A%A4%ED%85%80%ED%95%98%EA%B8%B0\" aria-label=\"serializer 커스텀하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serializer 커스텀하기</h2>\n<p>우리는 시리얼라이저를 간단하게 구현하기 위해 <strong>ModelSerializer</strong> 클래스를 상속받아 구현하였다. 이를 커스텀하여 사용할 수도 있다.</p>\n<ol>\n<li>\n<p>Field custom</p>\n<p>우리는 fields에 <code class=\"language-text\">__all__</code>로 모든 model의 필드를 받았지만, 이를 커스텀할 수 있다. model에 있는 필드의 경우에는 문자열 배열의 형태로 선언하면 된다. 우리는 <code class=\"language-text\">['name', 'price', 'stock_count']</code>로 바꿔볼 수 있을 것이다.</p>\n<p>또한, 모델에는 없는데 필요한 새로운 필드가 필요한 경우가 있다. 이는 <code class=\"language-text\">SerializerMethodField()</code>에 대하여 검색해보자.</p>\n</li>\n<li>\n<p>Validation custom</p>\n<p>data를 검사하는 별개의 로직이 있는 경우에는 serializer 내부에 <code class=\"language-text\">validate(self, data)</code>함수를 오버라이드 하면 된다. 예를 들어, 우리는 price(가격)는 0보다 커야하고, stock_count(재고)는 0이상이여야 한다.</p>\n<p>(<code class=\"language-text\">PositiveIntegerField</code>로 정의되어있긴 하지만 그래도 예외처리를 해보자)</p>\n<p>만약 특정 필드에 대한 validation만 수행하고 싶다면, <code class=\"language-text\">validate_{field}</code> 꼴로 함수를 만들어주면 된다. 다음은 가격이 0인 경우에 에러를 발생시켜주는 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span> <span class=\"token comment\"># 아이템의 모든 필드를 serialize해줄 것임</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">validate_price</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> value <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> serializers<span class=\"token punctuation\">.</span>ValidationError<span class=\"token punctuation\">(</span><span class=\"token string\">\"price must be positive\"</span><span class=\"token punctuation\">)</span> \n        <span class=\"token keyword\">return</span> value</code></pre></div>\n<p>하지만 이 경우에는 기본적으로 Serializer(not ModelSerializer)가 validation을 해주므로, 0인 경우만 처리하면 될 것이다.</p>\n<p>또한, model instance를 생성하는 시점에 validation을 해주는 방법도 있다는 것 같으니, 찾아봐야겠다.</p>\n</li>\n<li>\n<p>create &#x26; update custom</p>\n<p>ModelSerializer 클래스는 기본적으로 create와 update를 제공하지만, 이를 수정하고 싶을때에는 <code class=\"language-text\">create(self, validated_data)</code> 또는 <code class=\"language-text\">update(self, validated_data)</code> 함수를 오버라이딩 해주면 된다. (여기에 인자로 오는 데이터는 is_valid 이후에 온 validated_data이다)</p>\n</li>\n</ol>\n<p>또한, 그냥 Serializer 클래스를 상속받아서 자유도가 높은 시리얼라이저도 만들 수 있다. 다만, 이 경우에는 필드부터 많은 것들을 직접 구현해야할 것이므로 적재적소에 활용하도록 하자.</p>\n<h1 id=\"django-orm\" style=\"position:relative;\"><a href=\"#django-orm\" aria-label=\"django orm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Django ORM</h1>\n<blockquote>\n<p>위에서 다루었던, <code class=\"language-text\">Item.objects.all()</code>가 여기에 해당한다</p>\n<p>이게 뭔 말인지 알아보자</p>\n</blockquote>\n<p>이제 Serializer에 대한 개념은 어느정도 알았으니, django에서 제공하는 ORM(Object Relational Mapper)에 대하여 알아보자. (이는 DRF가 아닌 장고에서 제공하는 기능이다) ORM을 이용하여 관계형 DB에 각각 다른 언어들을 몰라도 python 인터페이스로 DB를 다룰 수 있게 된다.</p>\n<p>ORM 역시 DB와 연결되어 있으므로 모델의 CRUD가 가능하지만 Read, Delete만 권장된다. 우리는 client 요청에 대하여 더 간편하고 예외에 대해 반응할 수 있는 Serializer로 C,U를 처리할 수 있다.</p>\n<p>몇개만 알아보자…</p>\n<ul>\n<li>objects.all() : 해당 모델의 모든 데이터를 담는 쿼리셋을 리턴</li>\n<li>objects.order_by(field) : 해당 필드로 정렬</li>\n<li>objects.filter(field = … , ) : 조건에 맞는 쿼리셋을 리턴. 없다면 빈 쿼리셋 리턴(<code class=\"language-text\">queryset.exists()</code>함수로 판단 가능)</li>\n<li>objects.get(field = … , ) : 조건에 맞는 모델 리턴. 없다면 에러 throw</li>\n<li>objects.create(field = …) : 모델을 생성하여 DB에 저장한다</li>\n<li>obejcts.update() : 업데이트</li>\n<li>objects.delete() : 삭제</li>\n</ul>\n<h2 id=\"objects\" style=\"position:relative;\"><a href=\"#objects\" aria-label=\"objects permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>objects??</h2>\n<p>여기서 항상 나오는 것은 <code class=\"language-text\">objects</code>이다! 이는 모델에서 DB에 접근하기 위해 ORM에서 사용되는 <code class=\"language-text\">Manager object</code>이다. 이는 models.Manager 클래스를 상속하여 커스텀이 가능하며, 위의 함수들을 오버라이드할 수 있게 된다. 커스텀 매니저는 model 클래스에서 <code class=\"language-text\">objects= CustomManager()</code>와 같이 바꿔줄 수 있다고 한다. 이는 더 공부가 필요한 부분이다. <a href=\"https://blog.hwahae.co.kr/all/tech/tech-tech/4108\">참고하기</a></p>\n<h2 id=\"queryset\" style=\"position:relative;\"><a href=\"#queryset\" aria-label=\"queryset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>QuerySet</h2>\n<p>objects의 메소드를 통하여 생성되는 (주로 select) 데이터는 <strong>바로 SQL이 실행되지 않고 <code class=\"language-text\">QuerySet</code>객체에 저장되었다가 필요한 순간에만 실제 쿼리가 수행되는 lazy한 구조</strong>를 갖는다. 이유는 DB 접근은 시간이 오래 걸리고, 반복되면 연산에 낭비가 생길 수 있기 때문이다. 추가적으로, 테이블이 복잡해질 경우에는 의미없는 쿼리가 낭비될 수 있으므로(중복 질의) <code class=\"language-text\">selected_related()</code> 등의 JOIN연산을 처리하여 연산을 줄이는 기법도 있다고 한다.</p>\n<p>QuerySet은 우리가 여태 공부한 Serializer에 의하여 직렬화될 수 있는데, 여러 레코드를 포함한 QuerySet이라면 many=True 옵션으로 가져와야 가능하다는 점도 알고 있도록 하자!</p>\n<p>오늘은 장고와 DRF를 이해하는 핵심 기능 중 하나인 Serializing 기법과 django model과 DB를 손쉽게 연결해주는 ORM을 배워봤다. 다음에는 Request와 Response를 더 공부해보도록 하자! 오늘의 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/5554170cdcb9bef18c2b74522144bfbac2cc92c0\">여기</a>를 참고한다.</p>","frontmatter":{"date":"April 14, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [5-serializer와 Django ORM]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(5)-serailizer-django-orm/"}},"prev":{"id":"2216b6bb-30a6-5f7e-8c55-546e561f0708","html":"<p>이전까지 DRF의 CBV를 어떻게 구현하는지 알아보았다. ModelViewSet이 가장 간단하게 구현이 가능했는데, 이를 기반으로 검색기능을 만들어보자.</p>\n<p>Item 모델의 이름(name)에 해당 검색어가 포함되는지를 판단하여 리턴하는 api를 기존 ModelViewSet에다가 만들어보려고 한다. 그리고 가능하다면 실제 브라우저와 연결해보도록 하자!!</p>\n<blockquote>\n<p>요구사항</p>\n<p>[GET] localhost:8000/item/search?name=I</p>\n<p>I를 포함한 name을 갖는 item list를 리턴하도록</p>\n</blockquote>\n<p>우선, 앞으로는 ModelViewSet으로만 처리하기 위해 items/urls.py를 간단하게 해주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path<span class=\"token punctuation\">,</span> include\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> routers\n\nrouter <span class=\"token operator\">=</span> routers<span class=\"token punctuation\">.</span>DefaultRouter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nrouter<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span><span class=\"token string\">r'basic'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>ItemModelViewSet<span class=\"token punctuation\">)</span>\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"modelviewset-클래스-수정\" style=\"position:relative;\"><a href=\"#modelviewset-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\" aria-label=\"modelviewset 클래스 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ModelViewSet 클래스 수정</h2>\n<h3 id=\"code-classlanguage-textget_querysetcode-오버라이딩\" style=\"position:relative;\"><a href=\"#code-classlanguage-textget_querysetcode-%EC%98%A4%EB%B2%84%EB%9D%BC%EC%9D%B4%EB%94%A9\" aria-label=\"code classlanguage textget_querysetcode 오버라이딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">get_queryset()</code> 오버라이딩</h3>\n<p>ModelViewSet에서는 질의가 들어왔을 때, 내부적으로 <code class=\"language-text\">get_queryset()</code>함수를 사용한다. 따라서 이를 오버라이딩하여 쿼리 문자열을 처리할 수 있다. 쿼리 문자열은 <code class=\"language-text\">request.query_params.get()</code>으로 접근할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\t\t<span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        name <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>query_params<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> name <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            queryset <span class=\"token operator\">=</span> queryset<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>name__icontains<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> queryset</code></pre></div>\n<p>Django ORM에서 <code class=\"language-text\">{fields}__icontains</code>를 하면 해당 문자열(대소문자 구분 없이)이 포함되는지 여부를 판단한다.</p>\n<p>따라서, 결과는 다음과 같이 잘 나올 것이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 115.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVQ4y61V7ZKrIAzlRVpUEAQRUGt39rZ77/s/1dlJqh13q7vtzP2RIcRwyMcJimEY0OeMpmngvUdKCdM04XQ68Xo+n+97kr7v4ZzbFRFTQugirLUM2nUd+JK+Z1n0ZY0xst+eiNY1OA0JhSrQ2FuUdV2jqiq03kM1Ncqq5AvJRofatmU/rTXbab1HOMaAf+cRQ06ojUFZlnxwWdf62lYUBe/XQnZxOByhjeEby/LR6bsQkDGGU9/6Li6XC67XK4f+G9giSimWTcBxHLmTlP9/ATwcDpBS3mv0LCA1bhNwXZtnAcl3z198d/yiz/sFYC17diFXH1+NdDPCPnbQWjFhiaDeeRhnoaxmGzWL7FRnErpQ/pTy37cJH5c/CKFDCIEBaBx961nP85wTrWgsdV3DWQOt1GbqIucexEUiKpGbDhIw6QS0zC7tc043UnsHQ1FvRCkoDaUqdlxSOh6PtxTXupSsc8qy2K25IP5RjWglfhnXogmRL6iIczy7+/R5iHANWBQScXpHGM7IscX724jgGwZ8tvtfAOkgRediho8ZIXUwtuYUn6WUIJBlNmmcboequZbyDlb+QJWHCLle8yz7NKDNI1rv4GwNo9VLhBfciPlhpSja/sSgMQZMU8+gDFi+AGib2/NOHbU+wHWJa9nQM1/rl8ZSLP8JAi2KcubccRb58ox/ApsZjdoRPSStAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"querystring\" title=\"querystring\" src=\"/static/39f017c613310fc6eb18d1a830e339ef/37523/querystring.png\" srcset=\"/static/39f017c613310fc6eb18d1a830e339ef/e9ff0/querystring.png 180w,\n/static/39f017c613310fc6eb18d1a830e339ef/f21e7/querystring.png 360w,\n/static/39f017c613310fc6eb18d1a830e339ef/37523/querystring.png 720w,\n/static/39f017c613310fc6eb18d1a830e339ef/302a4/querystring.png 1080w,\n/static/39f017c613310fc6eb18d1a830e339ef/e6c84/querystring.png 1148w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<h2 id=\"더-알아볼-것-search-filter\" style=\"position:relative;\"><a href=\"#%EB%8D%94-%EC%95%8C%EC%95%84%EB%B3%BC-%EA%B2%83-search-filter\" aria-label=\"더 알아볼 것 search filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>더 알아볼 것… search filter</h2>\n<p>Django에서는 이러한 search에 대한 필터를 제공해준다. <code class=\"language-text\">django-filter</code> 라이브러리를 설치하고, filter_backends와 filterset_fields만 설정해주면 쿼리에 대한 질의를 알아서 해주는 것이다. 이것은 다음에 알아보도록 하자..</p>\n<h2 id=\"drf-정리\" style=\"position:relative;\"><a href=\"#drf-%EC%A0%95%EB%A6%AC\" aria-label=\"drf 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF 정리</h2>\n<p>여태까지 장고에서 데이터를 처리하는 방법에 대하여 간단하게 알아보았다. 복습을 해보도록 하자.</p>\n<ol>\n<li>\n<p>클라이언트의 요청</p>\n<p>웹서버로 요청이 들어오면 <code class=\"language-text\">wsgi</code>인터페이스에서 장고의 맞는 적절한 url에 요청을 전달해준다. (보통 이때 cors middleware등이 필요하다면 개입)</p>\n</li>\n<li>\n<p>urls.py</p>\n<p>요청이 들어오면 <code class=\"language-text\">urls.py</code>에서 처리해준다. sub url이나 router class로 정의된 라우팅은 include를 통하여 <code class=\"language-text\">url patterns</code>에 매핑된다.</p>\n</li>\n<li>\n<p>views.py</p>\n<p>각 요청은 해당 app의 <code class=\"language-text\">views.py</code>에 있는 함수(Function Based View) 또는 클래스(Class Based View)와 매핑되어 실행된다.</p>\n</li>\n<li>\n<p>model.py</p>\n<p>서버에서 다루는 데이터 모델에 대한 스키마를 정의하는 파일로, 하나의 모델 클래스가 RDB에서의 한 테이블이 될 것이다.</p>\n</li>\n<li>\n<p>seraializers.py</p>\n<p>위에서 정의한 모델의 CRUD에 필요한 직렬화와 역직렬화를 위해 serializer클래스를 이용한다. (역)직렬화하는 방법을 정의할 수 있다.</p>\n</li>\n<li>\n<p>ModelViewSet</p>\n<p>CBV로 구현할 때, 모델에 대한 다양한 기능들을 지원해주는 클래스이다. <code class=\"language-text\">GenericViewSet</code> 클래스에서 CRUD에 필요한 기본적인 mixins 클래스까지 상속되어 있어, <code class=\"language-text\">queryset</code>과 <code class=\"language-text\">serializer_class</code>만 지원해주면 기본적인 요청을 처리할 수 있다. 각 요청에 대한 함수는 오버라이딩할 수 있다.</p>\n</li>\n</ol>\n<h1 id=\"브라우저와-연결하기\" style=\"position:relative;\"><a href=\"#%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EC%99%80-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B8%B0\" aria-label=\"브라우저와 연결하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>브라우저와 연결하기</h1>\n<p>이제는 프론트엔드와 연결할 시간이다 ~ !</p>\n<p>오늘 진행할 프론트 소스코드는 <a href=\"https://github.com/choieastsea/market-guri-react/commit/dfb21bae78b94a86360db2135c1081f7e7b31ddb\">여기에 있다</a>. 미숙한 리액트 실력으로 간단하게 메인페이지를 만들어보았다. 메인페이지에서 아이템을 보여주도록 구현하려고 한다. localhost:3000에다가 띄워놓았고, 해당 페이지는 바로 <a href=\"http://localhost:8000/item/basic/\">http://localhost:8000/item/basic/</a> GET request를 보내도록 설계되어있다. 하지만 error가 나오고, 크롬 개발자 도구를 켜서 확인해보면 <code class=\"language-text\">CORS 에러</code>가 나오는 것을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9ElEQVQoz6WPz0rDQByElyCIeilGSlEDBjyIiicRU1Ra8AU8WNqk3ewm+syhh55CXiLN7idJiaSCf8CBYZbh+w2ssNZSK89zsixjuVxSFAWr1arpatVMy/0m0YJlWW4dGWM+x7r5p8Hu0X8ttvdtxz/pe05UFVSVZb021L80librzlS2ya9vazZMl2s7kaQhSs8IoxekfEXKCbGaopM5Kpmj0wU6lZt8k6gkQqsQrWaNF/EEGU951xFKR4jx6Q7DgcP9wCHwdnk42yfw9nj0XUYXxzxfeozP+4x8lyffZXhywN2RaBz0Bbeu4KYnuOoJrg8dPgC4EtCRtYmZgAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cors\"\n        title=\"cors\"\n        src=\"/static/dba39126733cacb1f110f083cddc369a/37523/cors.png\"\n        srcset=\"/static/dba39126733cacb1f110f083cddc369a/e9ff0/cors.png 180w,\n/static/dba39126733cacb1f110f083cddc369a/f21e7/cors.png 360w,\n/static/dba39126733cacb1f110f083cddc369a/37523/cors.png 720w,\n/static/dba39126733cacb1f110f083cddc369a/302a4/cors.png 1080w,\n/static/dba39126733cacb1f110f083cddc369a/07a9c/cors.png 1440w,\n/static/dba39126733cacb1f110f083cddc369a/09d8d/cors.png 3012w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>chrome의 network 단에 들어가서 더 자세한 내용을 확인해보자.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABJUlEQVQoz5WS65KCMAyFeREFuZZyl7YgpbKu7vs/0tlJVpzR0dH98U2TXpKTNN7p+4zz5QfTNONwsLCzg3MLjsuJV2sdjBlhzPARniwbuOWCwTroySITJeI0R5JJJooFtn6IzTbExn/gure9Qr5XlC30YNEqjUYplFWHXNaMyCtmFyYvCXbxDfI9PUyY3ReOyxlS1pwpjNLbhdV+hM78IEKaSSg9QhY1+x4pqZo9mk6ByidFeVGzHez+Hr1jTcIBhayw7wd0e4Nej+h6Wg+cJE7E3YNn+EF8F5h7aMYZ2kzcS7IJKnW99Cro4z4rzPKSFXWksh+41CgRiOLsrbpneKkouH9126NpFY8KjQ0Fow9aM38anOeQSlRmupVLiulz1sD/UfgLz/AmkUatklQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cors1\" title=\"cors1\" src=\"/static/06cb82fbbfa0303ce9825476a2efa235/37523/cors1.png\" srcset=\"/static/06cb82fbbfa0303ce9825476a2efa235/e9ff0/cors1.png 180w,\n/static/06cb82fbbfa0303ce9825476a2efa235/f21e7/cors1.png 360w,\n/static/06cb82fbbfa0303ce9825476a2efa235/37523/cors1.png 720w,\n/static/06cb82fbbfa0303ce9825476a2efa235/302a4/cors1.png 1080w,\n/static/06cb82fbbfa0303ce9825476a2efa235/07a9c/cors1.png 1440w,\n/static/06cb82fbbfa0303ce9825476a2efa235/6f464/cors1.png 1464w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p><code class=\"language-text\">postman</code>에서는 잘되는데, 왜이럴까??!!</p>\n<h2 id=\"간단하게-알아보는-cors-에러\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%98%EA%B2%8C-%EC%95%8C%EC%95%84%EB%B3%B4%EB%8A%94-cors-%EC%97%90%EB%9F%AC\" aria-label=\"간단하게 알아보는 cors 에러 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단하게 알아보는 CORS 에러</h2>\n<blockquote>\n<p>Cross-Origin-Resource-Sharing</p>\n</blockquote>\n<p>api server와 front server를 분리한 경우에는 항상 발생할 수 밖에 없는 브라우저의 보안 정책이다.</p>\n<p>원칙적으로, 브라우저에서 일어나는 <code class=\"language-text\">AJAX request</code>는 <code class=\"language-text\">SOP</code>(Same Orign Policy)정책을 따른다. 즉, 같은 Origin끼리만 리소스를 공유할 수 있는 것이다. 따라서, 우리와 같이 origin이 다른 경우(<a href=\"http://localhost:3000%E2%86%94http://localhost:8000)%EC%97%90%EB%8A%94\">http://localhost:3000↔http://localhost:8000)에는</a> 이 정책에 의하여 정보 교환이 불가능해지는 것이다.</p>\n<p>이러한 정책이 있는 이유는 악의적인 의도에 있어서 서버를 보호하기 위함이다.(특정 사이트에 악성 코드가 우리 서버로 데이터를 마음껏 접근하도록 할 수 있으므로)</p>\n<p><code class=\"language-text\">safe method</code>로 인하여 장고에서 CORS 에러가 발생하는 단계는 간단하게 다음과 같다.</p>\n<ul>\n<li>\n<p>장고에서 origin을 검사한다</p>\n</li>\n<li>\n<p>origin이 현재 서버의 origin과 다르다면, CORS 에러를 발생시킨다</p>\n</li>\n<li>\n<p>이후, <strong>views.py로 연결이 되어 실행이 되기는 한다</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>META<span class=\"token punctuation\">[</span><span class=\"token string\">'HTTP_ORIGIN'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># CORS error가 발생하더라도 view가 실행됨</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이 코드를 통해서 error가 발생하더라도 view 함수가 실행되는 것은 볼 수 있다.</p>\n</li>\n<li>\n<p>Response는 CORS 에러가 나오게 된다!</p>\n</li>\n</ul>\n<p>이러한 과정은 GET, POST와 같은 <code class=\"language-text\">safe method</code>에서 일어나게 된다. <strong>주의해야할 점은, 장고에서는 safe method(혹은 simple request라고도 함)에 있어서는 view 함수가 실행된다는 것이다!!</strong> 따라서, post나 get 요청으로는 (외부 공격을 막기 위해) 상태를 변경하는 것은 자제하도록 하자.</p>\n<p>PUT/UPDATE/DELETE와 같은 <code class=\"language-text\">unsafe method</code>의 경우에는 브라우저에서 요청을 2개(preflight, main request)로 나눠서 보내게 된다. 따라서, <strong>preflight 요청에서 browser에 의하여 본 요청은 수행되지 않고 CORS 에러를 일으키게 된다</strong>.</p>\n<p>CORS에러에 대한 설명은 <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">MDN docs</a>를 참고하도록 한다.</p>\n<blockquote>\n<p>&#x3C;요약></p>\n<ol>\n<li>request를 보내는 브라우저 클라이언트와 response를 처리하는 server의 ORIGIN이 다른 경우 CORS 에러가 발생한다</li>\n<li>SOP 정책을 사용하더라도 safe method의 경우, 장고는 view 함수가 실행될 수 있으니 주의한다</li>\n<li>unsafe method의 경우, 본 요청 이전의 preflight 요청에 의하여 view 함수가 실행되지 않고 CORS 에러가 발생할 것이다</li>\n<li>장고에서는 django-cors-headers 미들웨어의 CORS_ALLOWED_ORIGINS 리스트에 추가해주도록 하자.</li>\n</ol>\n</blockquote>\n<h2 id=\"그래서-django에서의-해결법은\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-django%EC%97%90%EC%84%9C%EC%9D%98-%ED%95%B4%EA%B2%B0%EB%B2%95%EC%9D%80\" aria-label=\"그래서 django에서의 해결법은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 django에서의 해결법은?</h2>\n<p>CORS를 허용하도록 하는 미들웨어를 설치한다. <code class=\"language-text\">pip install django-cors-headers</code></p>\n<p>settings.py에서 MIDDLEWARE에 다음을 추가한다. <code class=\"language-text\">'corsheaders.middleware.CorsMiddleware', </code> 그리고, <code class=\"language-text\">'django.middleware.common.CommonMiddleware',</code>도 없다면 추가해준다(아마 기본적으로 있긴 할 것) 만약 문제가 생긴다면 해당 미들웨어를 최상단으로 올리는 것을 권장한다고 한다.</p>\n<p>이후에 settings.py에다가 다음을 추가해준다. ORIGIN은 <code class=\"language-text\">{protocol}://{hostname}:{port}</code>의 형식을 의미한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">CORS_ORIGIN_WHITELIST <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n<span class=\"token comment\"># 최근 버전에는 이를 사용한다</span>\nCORS_ALLOWED_ORIGINS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>둘 중 하나로 표기하면 된다. 만약 배포 환경이여도 url host를 적어주면 될 것이다. <code class=\"language-text\">\"*\"</code>로 표기하면 모든 요청에 대하여 허용해주는 것이므로 <strong>권장되지 않는다</strong>.</p>\n<p>추가적인 옵션들이 있는데, 이는 다음에 필요할때마다 넣어주도록 하자. <a href=\"https://pypi.org/project/django-cors-headers/\">django-cors-headers의 공식문서</a>를 참고한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmUlEQVQY03WPUQqFIBBF2//WRCL6kxbgV2ipkab3cQUfGjQwIDPOmTOTlBLrukIIAaUUtm3DsiyY5xkpJbQopfzzHX1vOs8TWmscx1EBzOu6EGOEtRbGGDzPM8D4xzlX6znnEcgioYTw3Yf3vi4KIQyDBHIZofd9D5YTQc2wmbRh2u37XgG9xfvswbDpN8O+yRotef4b+AX/ARXJhkzaJ7nwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cors_solved\"\n        title=\"cors_solved\"\n        src=\"/static/7917f961f61be287c7245b807e207b1c/37523/cors_solved.png\"\n        srcset=\"/static/7917f961f61be287c7245b807e207b1c/e9ff0/cors_solved.png 180w,\n/static/7917f961f61be287c7245b807e207b1c/f21e7/cors_solved.png 360w,\n/static/7917f961f61be287c7245b807e207b1c/37523/cors_solved.png 720w,\n/static/7917f961f61be287c7245b807e207b1c/302a4/cors_solved.png 1080w,\n/static/7917f961f61be287c7245b807e207b1c/07a9c/cors_solved.png 1440w,\n/static/7917f961f61be287c7245b807e207b1c/4faaa/cors_solved.png 2308w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이제 잘 나오는 것을 확인할 수 있다.</p>\n<p>오늘까지 아주 기본적인 장고의 개념과 기본적인 CRUD, 그리고 브라우저에 연결하는 방법까지 알아보았다.</p>\n<p>다음부터는 서비스와 관련하여 필요한 기능들(회원, CSRF, session, 권한)과 관련된 기능들을 공부해보도록 하자. 화이팅</p>\n<p><a href=\"https://github.com/choieastsea/market-guri-django/commit/704c0db7b26c0c6f63f15e709225c4ed82db4b47\">소스코드1</a></p>\n<p><a href=\"https://github.com/choieastsea/market-guri-django/commit/601c2a75fde10d60ccccbff724d08bfa1b7baa42\">소스코드2</a> (CORS 관련 수정한 커밋)</p>","frontmatter":{"date":"April 16, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [7-Search, 브라우저와 연결하기]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(7)-Search&CORS/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Django(6)-request-response/","nextSlug":"/Django(5)-serailizer-django-orm/","prevSlug":"/Django(7)-Search&CORS/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}