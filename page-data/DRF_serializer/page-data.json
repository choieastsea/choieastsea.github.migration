{"componentChunkName":"component---src-templates-blog-template-js","path":"/DRF_serializer/","result":{"data":{"cur":{"id":"bb64831b-04c3-554c-a783-af377795429b","html":"<p>Django를 이용하여 서버를 구축하는 과정에 있어서, model을 설계하고 Serailizer를 이용하여 데이터를 CRUD하면서 헷갈리는 개념을 공부해보았다.</p>\n<p>우선, DRF는 설치되어 있어야한다. (가상 환경 만들고, drf project 생성하고, app 생성하고 실행하기)</p>\n<h2 id=\"drf-데이터-흐름\" style=\"position:relative;\"><a href=\"#drf-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%9D%90%EB%A6%84\" aria-label=\"drf 데이터 흐름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF 데이터 흐름</h2>\n<p><strong>DB ↔ QuerySet/Model ↔ OrderdDict(ReturnDict) ↔ JSON</strong></p>\n<p>우리가 사용할 데이터는 보통 DB에 테이블로서 존재하는데, 여기서는 하나의 테이블이 하나의 모델이 될 것이다.</p>\n<p>DB의 값을 바로 가져와 python 코드레벨에서 사용하는 것은 불가능하고, 위의 과정을 거쳐서 JSON으로 사용할 수 있게 된다. (역으로 JSON 데이터를 DB에 넣거나 수정할 때에도 마찬가지)</p>\n<p>DRF에서는 model에서 dictionary로 변환하는 과정을 <code class=\"language-text\">Serialize</code>(직렬화,,, 의역하여 객체화.?) 라고 정의하고, dictionary에서 model로 변환하는 과정을 <code class=\"language-text\">Deserialize</code>라고 정의한다.</p>\n<p>DRF에서는 이 두가지의 과정을 도와주는 <code class=\"language-text\">Serializer</code> 클래스와 <code class=\"language-text\">ModelSerializer</code> 클래스가 제공된다. 따라서, 이 두 클래스를 선택적으로 상속받아 구현하면 된다.! 두 클래스의 차이는 아래를 참고한다.</p>\n<h3 id=\"모델-만들어서-create-read-해보기개념\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%8D%B8-%EB%A7%8C%EB%93%A4%EC%96%B4%EC%84%9C-create-read-%ED%95%B4%EB%B3%B4%EA%B8%B0%EA%B0%9C%EB%85%90\" aria-label=\"모델 만들어서 create read 해보기개념 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모델 만들어서 Create, Read 해보기(개념)</h3>\n<ol>\n<li>\n<p>DB 연결</p>\n<ol>\n<li>settings.py에 db의 정보를 적어준다. timezone 도 현재 위치에 맞게 수정해주는 것이 좋다.</li>\n<li>또한 installed app에다가 만든 app을 추가해준다. appconfig가 있다면 그걸 추가해주는 것으로 보인다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">TIME_ZONE <span class=\"token operator\">=</span> <span class=\"token string\">'Asia/Seoul'</span>\nUSE_TZ <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nDATABASES <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'default'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'ENGINE'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'django.db.backends.mysql'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'NAME'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'your db name'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'USER'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'your user(ex root)'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PASSWORD'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'your pw'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'HOST'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'your db server(ex localhost / aws rds endpoint)'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PORT'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'3306'</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nINSTALLED_APPS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'django.contrib.admin'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.auth'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.contenttypes'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.sessions'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.messages'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.staticfiles'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">'rest_framework'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">#for rest request</span>\n    <span class=\"token string\">'test_app'</span>  <span class=\"token comment\"># your app</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p>모델 정의</p>\n<ol>\n<li>\n<p>models.py에 클래스로 생성</p>\n</li>\n<li>\n<p>이는 우리가 다루는 데이터의 단위이자 DB 테이블의 단위가 될 것임</p>\n</li>\n<li>\n<p>DB schema가 없는 상태에서, 모델을 먼저 정의하고 <code class=\"language-text\">migrate</code>해주면 DB에 테이블이 생성될 것이다! (sql이나 dbms의 코드를 이용하지 않고 테이블을 만들 수 있는 것임)</p>\n<p>DB를 직접 설계하지 않고, migration을 해주는 것의 장점은, 귀찮고 헷갈리는 SQL을 생략할 수 있다는 점과, 버전별로 스키마의 내용을 코드로 갖고 있을 수 있다는 장점이 있을 수 있다. <a href=\"https://tibetsandfox.tistory.com/24\">참고</a></p>\n</li>\n<li>\n<p>만약, DB가 이미 구축되어 있다면, <code class=\"language-text\">inspectdb</code> 커맨드를 이용하여 models.py를 역으로 만들어줄 수도 있다.(<a href=\"https://dev.to/idrisrampurawala/creating-django-models-of-an-existing-db-288m\">관련 링크1</a>, <a href=\"https://hyun-am-coding.tistory.com/entry/Django%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%9B%B9-API-%EB%A7%8C%EB%93%A4%EA%B8%B0\">관련링크2</a>)</p>\n</li>\n</ol>\n</li>\n<li>\n<p>모델을 코드로 다루기 위한, 혹은 DB에 저장하기 위한 Serializer class 정의</p>\n<p>Serializer는 serialize와 deserialize의 두가지 역할을 수행하며, 추가적으로 save()메소드가 실행될 때, 내부적으로 create(), update()을 실행해준다. ModelSerizlizer는 create, update를 기본적으로 제공해주므로 더 간단하게는 구현해볼 수 있다(<a href=\"http://www.incodom.kr/Django/DRF-Serializer\">참고</a>)</p>\n<ol>\n<li>Serializer 클래스 상속하여 만들기(<a href=\"https://www.django-rest-framework.org/tutorial/1-serialization/#creating-a-serializer-class\">공식문서</a>)</li>\n<li>ModelSerializer 클래스 상속하여 만들기(<a href=\"https://www.django-rest-framework.org/tutorial/1-serialization/#using-modelserializers\">공식문서</a>)</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"모델-만들어서-create-read-해보기구현\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%8D%B8-%EB%A7%8C%EB%93%A4%EC%96%B4%EC%84%9C-create-read-%ED%95%B4%EB%B3%B4%EA%B8%B0%EA%B5%AC%ED%98%84\" aria-label=\"모델 만들어서 create read 해보기구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모델 만들어서 Create, Read 해보기(구현)</h2>\n<p>우리는 간단하게 ModelSeirzlizer로 해봅시다!</p>\n<ol>\n<li>\n<p>models.py에 모델 정의</p>\n<p>간단한 회원을 만들어보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user_name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    user_id <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    user_pw <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    created <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>db migrate</p>\n<p><code class=\"language-text\">python manage.py makemigrations ${app_name}</code></p>\n<p>해서 마이그레이션 파일을 생성해주고, 이를 db에 적용한다. (settings.py installed_apps에 해당 app_name 있어야함)</p>\n<p><code class=\"language-text\">python manage.py migrate ${app_name} ${migration_name}</code></p>\n<p>이러고 DB에 가보면 적용되어 있을 것이다!! 추가적으로, 마이그레이션 버전을 위한 것인지 <code class=\"language-text\">django_migrations</code> 테이블도 생성되어 있음을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB20lEQVQoz42S2W7bMBBF9Q+xY8uSI9tRJC4SRa3e0SCL06APQYH2/z/lFKSTuOlTHw4uMAMezGAYNE3DYrFgtVp9IU1TlKkxzcDQKrrWUGQZx74jkyW7/Z66rjkeDhwOR/q2pujvCdq2wdiKXAmkVgglyeWZmyQhjG9IFgmL5ZLlcokUAiElShfkQjCfx0RRRBTNCGcRwdPpmW4zsMpSbkVGKnNSkXOnBNE8ZjSeIJXy01RVhduo61qfWmukkyvl0UoR/Pz1m6eXE8N2w2a/o6wtpa18RnHMaDRiOp1+IQxDz9f6hMlkSvDj7Y3n7y/cPz54qRMZR1MTz2PGozHX19eMx+P/wgu3xz3dZk1hK27z7H1lSTibcXV15ad0XB6OPJf6pRc8v77Sb9ZUbYMsNZkSZEp67rKMJElIFu4gK6IoJornxP/g6mHojhITNEOP0Io7KTwfQjelrWv/JQ77NV0/YJuevuuw1voDGWM8rnc6PfLwbUuQiuxdIsi19OnWPcslZV3RDB3Dbku/3dKuB4bdxpNp6X9FrhWFNchCEjjJhb/WlQJRapQtUbVBN4aiqXzq2mD6mswoUi08tyr3GXxMlSv5OeGn0GgvO1N6nEzakrKzPnOjyI3+5A/yd0MmM3DZLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/18a8b21f0c4713e982f6a23d02752748/37523/img1.png\"\n        srcset=\"/static/18a8b21f0c4713e982f6a23d02752748/e9ff0/img1.png 180w,\n/static/18a8b21f0c4713e982f6a23d02752748/f21e7/img1.png 360w,\n/static/18a8b21f0c4713e982f6a23d02752748/37523/img1.png 720w,\n/static/18a8b21f0c4713e982f6a23d02752748/302a4/img1.png 1080w,\n/static/18a8b21f0c4713e982f6a23d02752748/07a9c/img1.png 1440w,\n/static/18a8b21f0c4713e982f6a23d02752748/ddc6c/img1.png 1534w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>mysql에서 잘 적용되어 있음을 확인하였다. 테이블 이름은 <code class=\"language-text\">${app_name}_${model_name}</code>으로 생성해주더라.</p>\n</li>\n<li>\n<p>DB에 값 추가 (Serializer 이용)</p>\n<p>아주 간단하게 Serializer도 만들어준다. (UserSerializer.py)</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>User\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">'__all__'</span></code></pre></div>\n<p>그리고, 해당 app의 views.py에서 새로운 사용자를 만드는 로직을 만들어주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_user</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'data :</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n    serializer <span class=\"token operator\">=</span> UserSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status <span class=\"token operator\">=</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>여기서 사용하는 serializer는 deserialize를 해주는 것이라고 보면 된다.(파라미터만 잘 넣으면 알아서 db로 넣도록 데이터를 만들어준다)</p>\n<p>이러고 JSON데이터를 post로 보내주면 생성된다. (내가 근데 설정을 잘못한 건지, 한글 필드를 적었다가 에러가 계속 나더라)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVQoz31SuXLCMBTUd+eALk2+IwFmUmUmXQpylanCVeUCGuw4EdZhXd6MhG2EB3gzOyu997zaZ4kURQEPSimSJEGapsiyDJxzWGuPQmsDwGI4+cXF7QKXd0sQX3DOQUoZRGshnyvLsuE2fARho5ExjY+VxPtKgnDOGgGPulFrHdgfUOfraEQDN9nglqzpH4QQwV2e5804tYh3Ln5SiCyDohRWqR3RGq4SJ4xtHCqlYIxpmutRvaBmDDrPYaREWR1Ubq3tHEDQirjRr1XlKB6sLbYjuK8YN2mlcKinfUk+iHEO2hooaxqO12v/fzlHzllAQgUyukYuOKRWKLQO7PdMCBAos5njoM0WXIUyqrtwwYHJ2es9OpMndKfP6FToBry0eD/Ox484eRvidPQQ1uRmMcMgYFrxDP35BNdfI/S+J7j6HKEf1QbLWdj351v4fC98M45u2Vu25QbxO9YWKAxgqpoyOBb/EdiUaBioOx0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/bd52257ccdff86ecf313a7a2583ce84f/37523/img2.png\"\n        srcset=\"/static/bd52257ccdff86ecf313a7a2583ce84f/e9ff0/img2.png 180w,\n/static/bd52257ccdff86ecf313a7a2583ce84f/f21e7/img2.png 360w,\n/static/bd52257ccdff86ecf313a7a2583ce84f/37523/img2.png 720w,\n/static/bd52257ccdff86ecf313a7a2583ce84f/302a4/img2.png 1080w,\n/static/bd52257ccdff86ecf313a7a2583ce84f/07a9c/img2.png 1440w,\n/static/bd52257ccdff86ecf313a7a2583ce84f/7f2ab/img2.png 2236w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>(id는 auto increment라서 없어도 됨)</p>\n<p>이제 getter를 만들어보자.! 여기서 serialize를 해주고, json으로 변환하여 리턴해주면 된다. 위에서 말했다시피, serialize는 model까지만 바꿔주므로, 이를 json으로 다시 바꿔주기 위해서는 JSONRenderer를 이용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_all_user</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    users <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span>\n    serialized_users <span class=\"token operator\">=</span> UserSerializer<span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">,</span> many<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    json_data <span class=\"token operator\">=</span> JSONRenderer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">(</span>serialized_users<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span>json_data<span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz3VS207cMBD1z7LlqR/DT/DcJ6AP/QIKVEJcurRSJVYsu8QO8TW+nWomyXYD1NLRSTwzZ2zPEUoplFJQa51xzpn5f6jEtQIEZPCqGcIYgxgjrLVo2xbUQGuNlNKswUdALWiNx/G3Gxx9ucbyyUFMp/Heo+s6UIPpdMTTNwnXOhfkg/iAn48SV79f0NoE0WmNUofilDPoAvQfU0IuBc573s8lI1ETEqfbjXi7RDAWJfRIziP7AOQyQwoR0TpGb8OHOYw0sPix+oP7dotfWuGhk1h2zQwPWr7DfvxObXArn5mXrw3E5/NTHF6e4dOEq6/Mi4tTLC7PcPD95F9sP2fEYsyd8oT1nsdfxvchxBTRx8hv50MY4jyUOrz3NLCSdzUhBN4TgR49RigpoZSElJInPi2yEFnpZbtlkBMoTvvOWjjnmP2oI8h/PvRoXjWMC3sWGWbYNA2eNxus12usVitIJdH3PQyJec9CBBImGwkqIENrY3Y22AnWCtdHxJjY6FQwGf4tqAld+S8xEESm9vd8GQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/fa702658365502ddae6c50bd2239ea15/37523/img3.png\"\n        srcset=\"/static/fa702658365502ddae6c50bd2239ea15/e9ff0/img3.png 180w,\n/static/fa702658365502ddae6c50bd2239ea15/f21e7/img3.png 360w,\n/static/fa702658365502ddae6c50bd2239ea15/37523/img3.png 720w,\n/static/fa702658365502ddae6c50bd2239ea15/302a4/img3.png 1080w,\n/static/fa702658365502ddae6c50bd2239ea15/07a9c/img3.png 1440w,\n/static/fa702658365502ddae6c50bd2239ea15/3d68f/img3.png 2282w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n</li>\n</ol>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>핵심은 DB의 데이터를 조작하기 위해 Serializer를 거쳐야 한다는 것이다. db에 넣기 위해 deserailize, db에서 값을 가져오기 위해 serailize를 수행하고, 이를 위한 Serailizer 객체를 구현하여 사용하면 된다.</p>\n<p>아직은 간단하게 구현해보았지만, 조건을 부여하여 orm으로 가져오는 QuerySet과 view를 간단하게 처리하기 위한 ViewSet 등의 개념도 배워봐야할 것 같다… 어렵네요.! +django admin도 해봐야한다..!</p>","excerpt":"Django를 이용하여 서버를 구축하는 과정에 있어서, model을 설계하고 Serailizer를 이용하여 데이터를 CRUD하면서 헷갈리는 개념을 공부해보았다. 우선, DRF는 설치되어 있어야한다. (가상 환경 만들고, drf project 생성하고, app 생성하고 실행하기) DRF 데이터 흐름 DB ↔ QuerySet/Model ↔ OrderdDict(ReturnDict) ↔ JSON 우리가 사용할 데이터는 보통 DB에 테이블로서 존재하는데, 여기서는 하나의 테이블이 하나의 모델이 될 것이다. DB의 값을 바로 가져와 python 코드레벨에서 사용하는 것은 불가능하고, 위의 과정을 거쳐서 JSON으로 사용할 수 있게 된다. (역으로 JSON 데이터를 DB에 넣거나 수정할 때에도 마찬가지) DRF에서는 model에서 dictionary로 변환하는 과정을 (직렬화,,, 의역하여 객체화.?) 라고 정의하고, dictionary에서 model로 변환하는 과정을 라고 정의한다. DRF에…","frontmatter":{"date":"January 03, 2023","title":"(DRF) Django Rest Framework, Serialize 개념 이해하기","categories":"WEB","author":"choieastsea","emoji":"😬"},"fields":{"slug":"/DRF_serializer/"}},"next":{"id":"b16b8c18-01f9-539f-9955-57e778d6453e","html":"<h2 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h2>\n<p>CRA를 이용한 <code class=\"language-text\">React.js</code> 프론트 개발, <code class=\"language-text\">node js</code>와 <code class=\"language-text\">MySQL</code>을 이용한 api 서버 개발 모두 할 줄 안다면, 이제 배포를 해볼 차례이다.! 배포까지 해보아야 웹 서비스가 어떤 식으로 구성되는지 알 수 있을 것 같아서 공부해보았고, 그 기록을 남기고자 한다.</p>\n<p>목표는 다음과 같다.</p>\n<ul>\n<li>클라우드 환경을 이용하여 웹서비스(풀스택) 배포하기</li>\n<li>회원제 웹 서비스 풀스택으로 구현하기</li>\n<li>docker 이용하여 배포 환경 구축하기</li>\n<li>(optional) 도메인 구입해서 쉽게 접속하기</li>\n</ul>\n<h2 id=\"web-service-architecture\" style=\"position:relative;\"><a href=\"#web-service-architecture\" aria-label=\"web service architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Service Architecture</h2>\n<p>출처: <a href=\"https://fractalideas.com/blog/making-react-and-django-play-well-together/\">https://fractalideas.com/blog/making-react-and-django-play-well-together/</a></p>\n<p><img src=\"/e435d0a4f61e0bf436d5f37b50c9a8b6/webapp-architectures.svg\" alt=\"asdf\"></p>\n<p>크게 4가지 방법이 있고, 각각에 대하여 이해해보자.</p>\n<ol>\n<li>\n<p>두개(front, api)의 서버를 두는 구조이다. client가 브라우저를 통하여 url(app.example.com)을 입력하면, front-server에서 이를 처리하여 html, css, js 파일을 리턴해준다. 그리고, 해당 사이트에서 클릭 등의 이벤트로 인하여 api가 호출이 될 때에는 다른 url(api.example.com)을 통하여 요청과 응답이 이루어지는 구조이다. 이는 front와 backend가 각각의 서버 프로그램으로 구분되어 있으므로, backend 서버에서는 프론트로부터 오는 cross origin request에 대한 CORS 허용이 되어 있어야 할 것이다.</p>\n<p>대부분의 SPA(리액트도 포함)가 이러한 구조를 이용한다고 한다. React js의 경우에는 front server에서 url요청에 따라 정적인 html, js, css를 (번들링된 상태로 주겠지만 아무튼)리턴할 것이다. 그리고, <code class=\"language-text\">react-router-dom</code>과 같은 라이브러리를 통하여 root를 공유하는 다른 url요청(예를 들어 app.example.com/rank)을 추가적인 프론트서버에 요청보내지 않고 처리할 수 있다.</p>\n</li>\n<li>\n<p>백엔드 서버에서 프론트엔드를 리턴하는 구조이다. 아마, node js에서 express 미들웨어로 hello world를 찍어보려고 할 때,</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span>res</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n\tres<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;h1>Hello World&lt;/h1>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>라던가, sendFile을 이용하여 정적인 html파일을 리턴하도록 한 경험이 있을 것이다. 이러한 방법이라고 보면 될 것 같다.</p>\n</li>\n<li>\n<p>브라우저의 요청에 대하여, 프론트 엔드 서버가 처음으로 받고, 해당하는 내용이 없다면 proxy등을 통하여 백엔드 서버로 넘겨줘 요청을 처리하도록 한다. CRA와 <code class=\"language-text\">npm start</code>를 통하여 개발서버를 연 이후, <code class=\"language-text\">package.json</code>에서 proxy를 api server주소로 설정하여, api 요청에 대하여 백엔드로 넘겨주는 방법을 사용할 수 있다. <a href=\"https://choieastsea.github.io/full-stack-in-js/\">나도 과거에 이러한 방법을</a> 이용한 적이 있으니 참고하면 될 것 같다.</p>\n</li>\n<li>\n<p>이 방법은 리버스 프록시를 이용하는 방법인데, 나도 해본 적은 없어 원문 링크를 참고하여 보면 될 것 같다.</p>\n</li>\n</ol>\n<h2 id=\"-cra를-이용한-리액트-웹서버-웹서버-이해하기\" style=\"position:relative;\"><a href=\"#-cra%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%9B%B9%EC%84%9C%EB%B2%84-%EC%9B%B9%EC%84%9C%EB%B2%84-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0\" aria-label=\" cra를 이용한 리액트 웹서버 웹서버 이해하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>+ CRA를 이용한 리액트 웹서버? 웹서버 이해하기</h2>\n<p>CRA(Create React App)을 이용하여 리액트 개발 공부를 한 나는, React는 분명 front-end library인데, 왜 npm start만 하면 <code class=\"language-text\">localhost:3000</code>과 같이 접속할 수 있지?? 라는 의문을 품었었다. 이는 CRA의 개발모드에서 지원해주는 로컬 웹서버 환경으로 디버깅 등을 편하게 해주기 위해 웹서버를 제공해주는 것이였다. 하지만, 이는 용량이 크고 필요 없는 코드가 존재하여 실제 배포되서 운영되기에는 무리가 있다. 따라서, 우리는 <code class=\"language-text\">npm run build</code>를 이용한다.! 빌드하여 컴팩트해진 정적 파일들을 웹서버(CRA dev server와 거의 같은 일을 하는) 에 올려놓으면 되는 것이다.</p>\n<p>결론은, 1번방법으로 리액트를 배포하려면 웹서버를 구축해놔야한다는 것이다. 이 웹서버는 app.example.com과 같은 url 요청에 대하여 <strong>빌드된 정적 파일들을 제공</strong>하면 되는 것이다.</p>\n<p>자 그러면, 웹서버는 뭐를 사용하면 될까? 우리는 <code class=\"language-text\">nginx</code> 를 이용해보도록 하자. node.js를 이용하여 웹서버의 역할을 구현해 볼 수도 있지만, 엔진엑스가 웹서버의 의미에 더 부합한다고 볼 수 있다. 또한 세팅(configuration)만 하고, nginx server를 켜 놓으면 완성되므로 매우 쉽다~ 이거에 관하여 <a href=\"youtube.com/watch?v=Zimhvf2B7Es\">매우 정리가 잘 되어있는 유튜브</a>를 보면 도움이 될 것이다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<ul>\n<li>\n<p>우리가 사용할 <code class=\"language-text\">웹 서비스 아키텍쳐</code>(이것이 뭐라고 통용되는지는 찾아볼 필요가 있음) : 프<strong>론트 엔드 서버 / api (백엔드)서버</strong>를 분리하여 사용할 예정</p>\n</li>\n<li>\n<p>프론트엔드 서버의 구조 : <code class=\"language-text\">nginx</code> + <code class=\"language-text\">builded react file</code></p>\n<p>모든 http(s) 요청에 대하여, 해당 url에 정적인 내용을 browser에게 리턴한다. <code class=\"language-text\">react-router-dom</code>과 같은 라이브러리를 이용하여, 라우팅은 js가 처리하도록 한다.</p>\n</li>\n<li>\n<p>백엔드 서버의 구조 : <code class=\"language-text\">django rest framework</code> ~ <code class=\"language-text\">MySQL server</code>가 연결되어 있는 구조</p>\n<p>api 요청에 대하여, browser에게 응답한다. 필요하다면, db server를 사용할 수도 있다. 해당 요청은 (특히 DB에 접근하는 경우) 접근 권한에 따라 서비스를 인가해주도록 구현한다.!</p>\n</li>\n</ul>\n<p>이후 글에는 (front)/(server)로 구분하여 각 영역에서 처리해줘야 할 것들을 적어보도록 할 예정이다. 화이팅~</p>","frontmatter":{"date":"December 30, 2022","title":"(배포) 웹서비스 배포하기 (1) 서비스 아키텍쳐","categories":"WEB","author":"choieastsea","emoji":"🚀"},"fields":{"slug":"/deploy-1-basic/"}},"prev":{"id":"63f88978-7671-5bed-a256-0aebaa0739cb","html":"<p>웹서비스의 기본인 회원가입부터 해보자. nest js로 하려다가 db 구축이 매우 쉽다고 판단되는 <code class=\"language-text\">DRF</code>(Django Rest Framework)를 이용하여 만들어보려고 한다.</p>\n<p>회원가입 시, 서버의 요구사항은 회원들의 정보를 구분되도록, 추가적으로 안전하게 저장하는 것이다.</p>\n<h1 id=\"장고-세팅\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%EC%84%B8%ED%8C%85\" aria-label=\"장고 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 세팅</h1>\n<p>장고에 대하여는 <a href=\"https://choieastsea.github.io/DRF_serializer/\">이전글</a>을 참고해보자. 나도 생활코딩님의 <a href=\"https://www.youtube.com/playlist?list=PLuHgQVnccGMDLp4GH-rgQhVKqqZawlNwG\">강의</a>를 보고 약간의 블로그와 공식문서를 읽은 정도의 수준이니 따라올 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">mkdir</span> server \n<span class=\"token builtin class-name\">cd</span> server\npython <span class=\"token parameter variable\">-m</span> venv project_env\n<span class=\"token builtin class-name\">source</span> project_env/bin/activate\npip <span class=\"token function\">install</span> djangorestframework mysqlclient\ndjango-admin startproject auth_project</code></pre></div>\n<p>auth_project/settings.py에서 config(db 세팅) 해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">DATABASES <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'default'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'ENGINE'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'django.db.backends.mysql'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'NAME'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'member_auth'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'USER'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'db_konkuk'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PASSWORD'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'6812'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'HOST'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PORT'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'3306'</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">django-admin startapp member</code> 로 member app을 생성해준다.(회원에 대한 모듈)\nls >> auth_project   member  project_env\nsettings.py의 INSTALLED_APPS에 ‘member’ 추가해줘야 이후 만들 model을 인식할 수 있다.</p>\n<p>auth_project/urls.py 수정 (<code class=\"language-text\">path('', include('member.urls'))</code> 추가)\nmember/urls.py 생성하여 아래와 같이 작성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">urlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>member/views.py 추가</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span><span class=\"token string\">'Hello Django'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">python manage.py runserver</code>로 서버 실행할 수 있다.</p>\n<p>localhost:8000 접속시 나오는 Hello Django 확인\n이러면 장고 기본은 세팅 완료.!</p>\n<h1 id=\"db-세팅\" style=\"position:relative;\"><a href=\"#db-%EC%84%B8%ED%8C%85\" aria-label=\"db 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB 세팅</h1>\n<p>settings.py에서 db_config 적어놓고, 해당 db에서 db를 생성해준다.\n<code class=\"language-text\">create database member_auth;</code>\n스키마를 만들어주기 위해, drf의 migration을 사용하자.</p>\n<p>우선, member app의 models.py에서 회원가입을 위한 사용자 모델을 만들어주자. user_id는 겹치지 않게 unique로 해준다. PK는 따로 지정하지 않으면 장고에서 <code class=\"language-text\">auto increment id</code>로 만들어 줄 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user_name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    user_id <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    user_pw <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    created <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>그러고, migration file을 만들어준다. 해당 migration을 db에 apply시켜주면 스키마가 만들어 질 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span>python manage.py makemigrations member\nMigrations <span class=\"token keyword\">for</span> <span class=\"token string\">'member'</span><span class=\"token builtin class-name\">:</span>\n  member/migrations/0001_initial.py\n    - Create model User\n<span class=\"token operator\">>></span>python manage.py migrate member\nOperations to perform:\n  Apply all migrations: member\nRunning migrations:\n  Applying member.0001_initial<span class=\"token punctuation\">..</span>. OK</code></pre></div>\n<p>db에 member_user 테이블의 스키마가 만들어져있음을 확인할 수 있다.</p>\n<h2 id=\"serializer-구현\" style=\"position:relative;\"><a href=\"#serializer-%EA%B5%AC%ED%98%84\" aria-label=\"serializer 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serializer 구현</h2>\n<p>간단하게, serializer를 만들어보자. ModelSeriallizer를 이용한다.</p>\n<p>serializer.py</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> member <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UserSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>User\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">'__all__'</span>\n</code></pre></div>\n<p>이제 회원가입을 처리하는 기본 메소드를 만들어보자.</p>\n<h1 id=\"회원가입-basic\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-basic\" aria-label=\"회원가입 basic permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원가입-basic</h1>\n<p>우선, member의 urls.py에서 signup url과 views를 매핑해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">urlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'signup'</span><span class=\"token punctuation\">,</span>views<span class=\"token punctuation\">.</span>signup<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>그리고, views에서 signup 함수를 만들어주자.</p>\n<p>(POST method를 받아서 처리해야하므로, <strong>settings.py에 ‘rest_framework’를 추가해줘야한다</strong>)</p>\n<p>member > views.py</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>shortcuts <span class=\"token keyword\">import</span> HttpResponse\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> status\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>decorators <span class=\"token keyword\">import</span> api_view\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">import</span> Response\n<span class=\"token keyword\">from</span> member<span class=\"token punctuation\">.</span>serializer <span class=\"token keyword\">import</span> UserSerializer\n<span class=\"token comment\"># Create your views here.</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span><span class=\"token string\">'Hello Django'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">signup</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user_info <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>data\n    serializer <span class=\"token operator\">=</span> UserSerializer<span class=\"token punctuation\">(</span>data <span class=\"token operator\">=</span> user_info<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span> status <span class=\"token operator\">=</span> status<span class=\"token punctuation\">.</span>HTTP_201_CREATED<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_400_BAD_REQUEST<span class=\"token punctuation\">)</span> </code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABuElEQVQ4y6VUy07kMBD057InLgjtL3BguHDhfxatAHGaESwgVmJmNRKTh/NwYid+FGpnPHiHgCLRUslO2662u7rDqqpCXdew1nporWGM8WMA+Z1zk8CapkHf91BKoW1bZFmGNE2RJIkPRGsUYCoYAM9MRg4iFUJ4ojELe3fzgK35G9JNiCx+WkhBjK7rdmmgoMbagXhL7p+8KXuUZeE30CEpJYri/Ts8JeQ3HJRKQSYJ2tdXD5p7QlogAooe8kgEY0b+HaGU0LRXShipYLfB2H5+vkK8hy7gRoKyqeWwD08YxIhF2VduigXCMeGYIUWdg7YGvZkKjZrEaxoIqhJRoxAt1rwFg2hhawH0BqAq+CbY7OkWJ/dXuFjd4fzfHU6Xc5ytFpit5hEWI5hH4zvY8d8bHD1f4+fzDQ4ff+Pg4RI/JuLgz68PPgbZDc+dYiYS75MzrKgqNFScznphMp4j5zkyzkFrgooXDtpZkIBh7HQP1antucFHYPT7og4Z+tch5aWHVJ2vr7ig45FKZL1eI00ScMlRqWq4IfVsWZaelAh5JaC0/a8LxjqFsHxZYpNukKschSwgtcQbW0Yb2B5KgnAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20230105182137181\"\n        title=\"image-20230105182137181\"\n        src=\"/static/03057a989231151cd330d42b98007c85/37523/basic_signup.png\"\n        srcset=\"/static/03057a989231151cd330d42b98007c85/e9ff0/basic_signup.png 180w,\n/static/03057a989231151cd330d42b98007c85/f21e7/basic_signup.png 360w,\n/static/03057a989231151cd330d42b98007c85/37523/basic_signup.png 720w,\n/static/03057a989231151cd330d42b98007c85/302a4/basic_signup.png 1080w,\n/static/03057a989231151cd330d42b98007c85/07a9c/basic_signup.png 1440w,\n/static/03057a989231151cd330d42b98007c85/80cfc/basic_signup.png 1844w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>db에도 잘 생성되어있지만, pw가 그대로 저장되어 있어 db가 노출되면 문제가 생길 수 있다.!(사용자는 보통 같은 아이디와 비밀번호를 사용하기 때문이다) 이제 비밀번호를 암호화하여 저장하도록 하자.</p>\n<h1 id=\"회원가입---암호화\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85---%EC%95%94%ED%98%B8%ED%99%94\" aria-label=\"회원가입   암호화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원가입 - 암호화</h1>\n<p>장고에서 User모델을 이용하여 비밀번호를 암호화하여 관리하는 방법도 있지만, <code class=\"language-text\">bcrypt</code> 라이브러리를 이용하여 비밀번호를 암호화하여 저장해보도록 하자. 추가적으로, 암호학에 정통한 사람이 아니라면 직접 암호화 알고리즘을 만드는 것은 권장되지 않고, 잘 알려진 최신까지 잘 쓰이는 라이브러리를 사용하는 것이 권장된다.</p>\n<h2 id=\"bcrypt-간단한-사용법\" style=\"position:relative;\"><a href=\"#bcrypt-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"bcrypt 간단한 사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>bcrypt 간단한 사용법</h2>\n<p><code class=\"language-text\">pip install bcrypt</code>로 설치할 수 있다.</p>\n<p>bcrypt를 이용하여 우리가 해볼 것은 크게 1. 회원가입시 비밀번호를 암호화하기 2. 로그인시 입력과 암호화한 비밀번호 비교하기 가 있다.</p>\n<ol>\n<li>\n<p>비밀번호 암호화</p>\n<p><code class=\"language-text\">bcrypt.hashpw(bytes, salt)</code>로 암호화할 수 있다.</p>\n<p>bytes에는 비밀번호를 bytes array로 인코딩하여 넘겨주면 되고, salt에는 추가할 salt값을 넘겨주면 된다. bytes는 python string의 내장함수를 이용하여 <code class=\"language-text\">${string}.encode('utf-8')</code>와 같이 바꿔줄 수 있고, salting값은 <code class=\"language-text\">bcyrpt.gensalt()</code>함수를 이용하여 생성할 수 있다. (default parm=10)</p>\n<p>추가적으로 생성된 암호는 bytes 타입이므로, DB에 저장할 때에는 다시 <code class=\"language-text\">decode('utf-8')</code>함수를 이용하여 문자열로 변환한 후 저장해줘야한다.</p>\n<p>views.py의 signup 함수는 아래와 같이 수정해볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">signup</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user_info <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>data\n    pw <span class=\"token operator\">=</span> user_info<span class=\"token punctuation\">[</span><span class=\"token string\">'user_pw'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'원래 비밀번호: '</span></span><span class=\"token punctuation\">,</span>pw<span class=\"token punctuation\">)</span>\n    mod_pw <span class=\"token operator\">=</span> bcrypt<span class=\"token punctuation\">.</span>hashpw<span class=\"token punctuation\">(</span>pw<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bcrypt<span class=\"token punctuation\">.</span>gensalt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'암호화 후 비밀번호: '</span></span><span class=\"token punctuation\">,</span>mod_pw<span class=\"token punctuation\">)</span>\n    user_info<span class=\"token punctuation\">[</span><span class=\"token string\">'user_pw'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> mod_pw<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span>\n    serializer <span class=\"token operator\">=</span> UserSerializer<span class=\"token punctuation\">(</span>data <span class=\"token operator\">=</span> user_info<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> serializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span> status <span class=\"token operator\">=</span> status<span class=\"token punctuation\">.</span>HTTP_201_CREATED<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>serializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">.</span>HTTP_400_BAD_REQUEST<span class=\"token punctuation\">)</span> \n</code></pre></div>\n<p>실행해보면 같은 비밀번호에 대하여도 다른 암호화값으로 저장됨을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">원래 비밀번호:  <span class=\"token number\">1234</span>\n암호화 후 비밀번호:  b<span class=\"token string\">'$2b$12$Tp9RA7gOCYyXkL4tAcWRAOtiaTl5dlpIM6H8FsDSEnwfGmJzvent6'</span>\n<span class=\"token punctuation\">..</span>.\n원래 비밀번호:  <span class=\"token number\">1234</span>\n암호화 후 비밀번호:  b<span class=\"token string\">'$2b$12$g7H0uBrroFgqkMSgkikkVeEfOO.GVn06XksAfURraBiV3KFo9WtQS'</span></code></pre></div>\n<p>이제 로그인을 처리해보자.</p>\n</li>\n<li>\n<p>로그인</p>\n<p><code class=\"language-text\">bcrypt.checkpw(bytes, 암호화된 bytes)</code>로 로그인을 처리할 수 있다. 간단하게 성공시 hello, 실패시 bye를 출력해보도록 하자.</p>\n<p>views.py에서 login함수를 아래처럼 추가해주고, urls.py에도 <code class=\"language-text\">path('login', views.login)</code>를 추가해주도록 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    idpw <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>data\n    id_input <span class=\"token operator\">=</span> idpw<span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span>\n    pw_input <span class=\"token operator\">=</span> idpw<span class=\"token punctuation\">[</span><span class=\"token string\">'pw'</span><span class=\"token punctuation\">]</span>\n    user_with_id <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>user_id<span class=\"token operator\">=</span>id_input<span class=\"token punctuation\">)</span>\n    serializer <span class=\"token operator\">=</span> UserSerializer<span class=\"token punctuation\">(</span>user_with_id<span class=\"token punctuation\">,</span> many<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    user_pw <span class=\"token operator\">=</span> serializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'user_pw'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>user_pw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#암호화된 string</span>\n    <span class=\"token keyword\">if</span> bcrypt<span class=\"token punctuation\">.</span>checkpw<span class=\"token punctuation\">(</span>pw_input<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> user_pw<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span> \n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span><span class=\"token string\">'bye'</span><span class=\"token punctuation\">)</span>     </code></pre></div>\n<p>실행해보고 로그인이 되는지 postman 등에서 확인해볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">입력 비밀번호: <span class=\"token number\">1234</span>\n암호화 후 비밀번호: <span class=\"token variable\">$b</span><span class=\"token string\">'$2b$12$Nm22Ckx4vMVbZlckUyoodeBdDR2v3ANU8MJs98XJ3jtoJsXZG8sCm'</span></code></pre></div>\n<p>같은 비밀번호(1234)에 대하여 다른 해싱값이 생성됨을 확인할 수 있으며, 각각의 로그인도 잘 수행됨을 확인할 수 있다.</p>\n</li>\n</ol>\n<h3 id=\"bcrypt의-원리\" style=\"position:relative;\"><a href=\"#bcrypt%EC%9D%98-%EC%9B%90%EB%A6%AC\" aria-label=\"bcrypt의 원리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>bcrypt의 원리</h3>\n<p>추가적으로, bcrypt와 같은 단방향 해싱을 이용한 암호화의 원리를 내가 이해한 만큼만 정리해보겠다. 단방향 해싱함수라는 것은 특정 input에 대하여 유일한 output이 나오지만, 역으로는 유추가 불가하도록 설계된 (역함수가 존재하지 않는.?) 함수이다. 따라서, 해시값으로 원본 비밀번호를 알 수 없으며 로그인 과정에서도 checkpw함수는 해시값과 input을 암호화한 값을 비교하여 일치하는지만 알 수 있는 것이다. 이러한 단방향 해싱에도 허점이 없는 건 아닌데, 바로 input 과 해시값을 매칭시켜놓은 표(ranbow table)를 아주 힘들게 만들어 놓고, 해시값으로 비밀번호 원본을 유추하는 방법(brute force로 일일이 대조)도 있긴 하다. 따라서 우리는 소금을 친다(?) gensalt()함수로 솔팅값을 주고 해싱을 돌리고, 이를 반복하여 원본을 유추하기 매우 힘들게 할 수 있다.</p>\n<p>또한, 위의 보면 생성된 비밀번호의 앞부분이 일치함을 알 수 있는데, bcrypt에서 암호화를 어떻게 수행하나를 보면 알 수 있다. <code class=\"language-text\">$&lt;used_algorithm>$&lt;cost_factor>$&lt;generated_salt>&lt;hash>$</code>의 꼴로 생성되므로 암호화된 bytes배열에서 알고리즘과 salt값을 이용하여 checkpw를 수행할 수 있게 되는 것이다.! (따라서, 암호화 생성 알고리즘이 같으므로 앞부분이 같은 것이다) <a href=\"https://stackoverflow.com/questions/69175990/how-does-password-checking-in-bcrypt-work\">출처</a></p>\n<p>회원제 사이트를 만들기 위해 기본적인 회원가입은 끝났다. 이제 해야할 것은, 로그인을 할 때 session이나 token을 만들어 사용자에게 권한에 맞는 요청만 허용하도록 하는 것이다!</p>","frontmatter":{"date":"January 08, 2023","title":"(배포) 웹서비스 배포하기 (2)(backend)회원가입과 암호화","categories":"WEB","author":"choieastsea","emoji":"🚀"},"fields":{"slug":"/deploy-2-drf_signup/README/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/DRF_serializer/","nextSlug":"/deploy-1-basic/","prevSlug":"/deploy-2-drf_signup/README/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}