{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Alg-Dijkstra/",
    "result": {"data":{"cur":{"id":"e1e5d260-58e0-58af-a974-6c589aef1c8d","html":"<p>Dijkstra(다익스트라) Algorithm은 그래프에서, <strong>한 노드에서 출발하여 다른 노드로 가는 최단 거리</strong>를 구할 때 사용할 수 있는 알고리즘이다. 더 나아가, 출발해서 도착할 때까지의 최단 경로를 구할 수도 있다.</p>\n<h2 id=\"문제-설명\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%84%A4%EB%AA%85\" aria-label=\"문제 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 설명</h2>\n<p>input : 첫줄에는 노드갯수와 엣지갯수, 두번째줄부터 엣지 정보(노드 번호 두개와 edge weight)</p>\n<p>output : 1번노드에서 n번노드까지의 최단 거리</p>\n<p>​\t(입력 예시)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">5 6\n1 2 2\n2 5 5\n2 3 4\n1 4 1\n4 3 3\n3 5 1\n</code></pre></div>\n<h1 id=\"그래프를-표현하는-방법\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%ED%94%84%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"그래프를 표현하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래프를 표현하는 방법</h1>\n<p>weighted graph를 표현하는 방법은 크게 두가지로 나눠볼 수 있는데,</p>\n<ol>\n<li>\n<p>노드~노드간의 관계이므로, 노드가 n개일때 n*n matrix를 만들고, cell에 weight를 적는다.</p>\n<p>4번 노드와 3번 노드를 잇는 엣지의 길이가 5이면, <code class=\"language-text\">matrix[4][3]=5</code>와 같이 표현하면 된다. 다만, 이는 두 노드를 잇는 여러 엣지가 존재할 때 구조의 변경이 불가피하다.</p>\n</li>\n<li>\n<p>한 노드에 인접한 노드에 대하여 (weight, 노드번호)를 모든 노드마다 갖도록 한다. (노드번호, weight)로 저장해도 헷갈리지만 않으면 좋다!</p>\n<p>위와 같은 상황일때, <code class=\"language-text\">node_4의 인접노드 : (5, 3번)</code>와 같이 표현할 수 있다.</p>\n</li>\n</ol>\n<p>2의 방법이 공간적으로 효율적이고 여러 엣지가 존재할 경우도 활용이 가능하다. <code class=\"language-text\">c++</code>에서는 pair와 vector배열을 이용하여 입력에 대하여 인접노드를 추가하는 형태로 표현할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include &lt;bits/stdc++.h&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nvector&lt;pair&lt;int, int&gt;&gt; E[100005];\nint main(void)\n{\n    int n, m; // number of nodes, number of edges\n    cin &gt;&gt; n &gt;&gt; m;\n    for (int i = 0; i &lt; m; i++)\n    {\n        int from, to, weight;\n        cin &gt;&gt; from &gt;&gt; to &gt;&gt; weight;\n        E[from].push_back(make_pair(to, weight));\n        E[to].push_back(make_pair(from, weight));\n    }\n   ...\n}</code></pre></div>\n<p>전역변수 E에 모든 엣지의 정보가 저장되어 있으므로, 이를 탐색하며 최단거리를 구할 수 있다.</p>\n<h1 id=\"dijkstra-의사-코드\" style=\"position:relative;\"><a href=\"#dijkstra-%EC%9D%98%EC%82%AC-%EC%BD%94%EB%93%9C\" aria-label=\"dijkstra 의사 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dijkstra 의사 코드</h1>\n<p>위와 같이 그래프를 만들고 나서는 다익스트라 알고리즘을 이용하여 그래프를 탐색하며 최단거리를 구할 수 있다.</p>\n<p>(1번노드에서 출발하여 n번노드까지의 최단거리를 구하는 다익스트라 알고리즘이라고 가정해보자) 우선 출발지부터 i번 노드까지의 최단거리를 기록하는 <code class=\"language-text\">D[i]</code>가 필요하다. D 배열의 각 원소는 처음에 매우 큰 값으로 세팅하도록 하고, 이후 탐색하면서 더 작은 비용의 거리가 발견된다면 업데이트 되도록 하므로, 큰 값으로 초기화를 해준다.</p>\n<ul>\n<li>\n<p>1번노드~1번노드의 거리는 0이므로, 이를 priority queue(이하 pq, 방문할 노드를 엣지의 거리 순으로 저장함)에 저장한다. D[시작노드] = 0 임을 확정짓는다.</p>\n<ul>\n<li>pq가 비어있을때 까지</li>\n</ul>\n<ol>\n<li>\n<p>pq에서 가장 거리가 짧은 엣지를 찾는다. 노드 번호 : <code class=\"language-text\">curNode</code>, 엣지 길이 : <code class=\"language-text\">curDist</code></p>\n</li>\n<li>\n<p>pq에서 해당 엣지(ex. x번 노드까지의 거리)을 제거한다. (방문 처리)</p>\n</li>\n<li>\n<p>만약 <code class=\"language-text\">D[curNode]</code>가 <code class=\"language-text\">curDist</code>보다 작지 않은경우, (D[ ] 업데이트 필요)</p>\n<ol>\n<li>\n<p>curNode의 인접한 노드들을 조사하는데…</p>\n</li>\n<li>\n<p><code class=\"language-text\">D[x]</code>와 <code class=\"language-text\">D[curNode]+curNode~x의 거리</code>를 비교하여 더 작은 값으로 X 노드까지의 최단거리를 업데이트한다.</p>\n</li>\n<li>\n<p>업데이트 되는 경우에는 해당 엣지 정보를 pq에 추가한다.</p>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n</ul>\n<p>주의해야할 점은 크게 두가지가 있다.</p>\n<ul>\n<li>인접한 엣지 중에서 가장 weight가 짧은 것을 추출하는 과정에서, 일반 배열로 저장하는 것(<code class=\"language-text\">O(N)</code>)보다는 PQ로 저장하는 것(<code class=\"language-text\">O(log(N))</code>)이 효율적이다.</li>\n<li>A에서 C까지의 최단경로를 볼 때, 임의의 노드 B에서 A<del>B + B</del>C까지의 거리와 A~C의 거리를 비교하고, 더 짧은 것으로 거리를 확정짓는 것이 다익스트라의 핵심이다.</li>\n</ul>\n<p>코드는 아래와 같다. 만약 endNode가 추가적으로 필요하다면, 인자에 추가하고 endNode탐색시 종료하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">void dijkstra(int startNode)\n{\n    priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; // (weight, nodeNo)\n    // startNode PQ에 추가\n\n    pq.push(make_pair(0, startNode));\n    d[startNode] = 0;\n    while (!pq.empty())\n    {\n        int curNode = pq.top().second;\n        int curDist = pq.top().first;\n        // printf(&quot;curNode : %d, curDist : %lld\\n&quot;, curNode, curDist);\n        //해당 노드 방문 처리\n        pq.pop();\n        if (d[curNode] &gt;= curDist)\n        {\n            for (int i = 0; i &lt; E[curNode].size(); i++)\n            {\n                //최단 거리 노드의 인접노드\n                int nextNode = E[curNode][i].second;\n                int nextDist = E[curNode][i].first;\n                // printf(&quot;nextDist : %lld, nextNode: %d\\n&quot;, nextDist, nextNode);\n                if (d[curNode] + nextDist &lt; d[nextNode])\n                {\n                    // printf(&quot;update needed\\n&quot;);\n                    // update 필요\n                    d[nextNode] = d[curNode] + nextDist;\n                    // pq push\n                    pq.push(make_pair(nextDist, nextNode));\n                }\n            }\n        }\n    }\n}</code></pre></div>\n<h2 id=\"다익스트라에서-경로를-표현하는-방법\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9D%B5%EC%8A%A4%ED%8A%B8%EB%9D%BC%EC%97%90%EC%84%9C-%EA%B2%BD%EB%A1%9C%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"다익스트라에서 경로를 표현하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다익스트라에서 경로를 표현하는 방법</h2>\n<p>위의 코드는 단지 x번 노드부터 n번 노드까지의 최단거리를 의미한다. 따라서, 어떠한 경로를 통하여 갔는지는 추가적인 작업이 필요하다. 이는 최단거리가 업데이트되어 확정되는 순간에 <strong>해당 노드를 방문하기 직전의 노드를 기록하면 된다</strong>! nextNode와 curNode를 통하여 최단거리를 비교하는 과정에서, 업데이트가 일어나면(최단거리 확정이 일어나면) 배열에다가 curNode를 저장하면 될 것이다.</p>\n<p>그렇게 하면 1 -> 4 -> 3 -> 5의 경로로 최단경로가 확정될 때, [0, 1, 0, 5, 0, 3]와 같이 저장될 것이다. 이를 스택에다가 넣어서 출력하면 깔끔하게 나올 것이다. 최종 코드는 다음과 같다. <code class=\"language-text\">codeforces 20C</code>문제에 대한 코드이다.! 결국 다익스트라가 이러한 틀로 구성되니까 참고하면 좋을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include &lt;bits/stdc++.h&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nvector&lt;pair&lt;int, int&gt;&gt; E[100005];\nlong long d[100005];\nint prevNode[100005]; // 최단경로에서 i번째 노드의 이전 노드를 저장\n\nvoid dijkstra(int startNode, int endNode)\n{\n    priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; // (weight, nodeNo)\n    // startNode PQ에 추가\n\n    pq.push(make_pair(0, startNode));\n    d[startNode] = 0;\n    prevNode[startNode] = startNode;\n    while (!pq.empty())\n    {\n        int curNode = pq.top().second;\n        int curDist = pq.top().first;\n        // printf(&quot;curNode : %d, curDist : %lld\\n&quot;, curNode, curDist);\n        //해당 노드 방문 처리\n        pq.pop();\n        if (d[curNode] &gt;= curDist)\n        {\n            for (int i = 0; i &lt; E[curNode].size(); i++)\n            {\n                //최단 거리 노드의 인접노드\n                int nextNode = E[curNode][i].second;\n                int nextDist = E[curNode][i].first;\n                // printf(&quot;nextDist : %lld, nextNode: %d\\n&quot;, nextDist, nextNode);\n                if (d[curNode] + nextDist &lt; d[nextNode])\n                {\n                    // printf(&quot;update needed\\n&quot;);\n                    // update 필요\n                    d[nextNode] = d[curNode] + nextDist;\n                    // for path\n                    prevNode[nextNode] = curNode;\n                    // pq push\n                    pq.push(make_pair(nextDist, nextNode));\n                }\n            }\n        }\n    }\n}\n\nint main(void)\n{\n    ios_base::sync_with_stdio(false);\n    cin.tie(NULL);\n    int n, m, from, to, weight; // n : number of nodes, m : number of edges\n    cin &gt;&gt; n &gt;&gt; m;\n    for (int i = 0; i &lt; m; i++)\n    {\n        cin &gt;&gt; from &gt;&gt; to &gt;&gt; weight; // 1-based-node\n        E[from].push_back(make_pair(weight, to));\n        E[to].push_back(make_pair(weight, from));\n        // printf(&quot;from : %d, to : %d, weight : %lld\\n&quot;, from, to, weight);\n    }\n    for (int i = 1; i &lt;= n; i++)\n    {\n        d[i] = LLONG_MAX;\n    }\n    dijkstra(1, n);\n    if (d[n] == LLONG_MAX)\n    {\n        // update되지 않았다 -&gt; 경로 없다\n        printf(&quot;-1\\n&quot;);\n        return 0;\n    }\n    int c = n;\n    stack&lt;int&gt; path;\n    while (c != 1)\n    {\n        // printf(&quot;%d &quot;, c);\n        path.push(c);\n        c = prevNode[c];\n    }\n    path.push(c);\n    while (!path.empty())\n    {\n        printf(&quot;%d &quot;, path.top());\n        path.pop();\n    }\n    printf(&quot;\\n&quot;);\n    return 0;\n}</code></pre></div>","excerpt":"Dijkstra(다익스트라) Algorithm은 그래프에서, 한 노드에서 출발하여 다른 노드로 가는 최단 거리를 구할 때 사용할 수 있는 알고리즘이다. 더 나아가, 출발해서 도착할 때까지의 최단 경로를 구할 수도 있다. 문제 설명 input : 첫줄에는 노드갯수와 엣지갯수, 두번째줄부터 엣지 정보(노드 번호 두개와 edge weight) output : 1번노드에서 n번노드까지의 최단 거리 ​\t(입력 예시) 그래프를 표현하는 방법 weighted graph를 표현하는 방법은 크게 두가지로 나눠볼 수 있는데, 노드~노드간의 관계이므로, 노드가 n개일때 n*n matrix를 만들고, cell에 weight를 적는다. 4번 노드와 3번 노드를 잇는 엣지의 길이가 5이면, 와 같이 표현하면 된다. 다만, 이는 두 노드를 잇는 여러 엣지가 존재할 때 구조의 변경이 불가피하다. 한 노드에 인접한 노드에 대하여 (weight, 노드번호)를 모든 노드마다 갖도록 한다. (노드번호, weight)…","frontmatter":{"date":"May 28, 2022","title":"(Alg) 그래프 알고리즘 - Dijkstra와 최단 경로 출력","categories":"Alg","author":"choieastsea","emoji":"😬"},"fields":{"slug":"/Alg-Dijkstra/"}},"next":{"id":"743c8dd2-f602-5a45-9e46-65b1f6265e9d","html":"<p>저번까지 Django User model과 이를 처리하는 SessionAuthentication에 대하여 알아보았다.</p>\n<p>오늘은 “상품”에 해당하는 Item model을 구체적으로 구현해보고, 서비스를 위한 몇가지 모델을 추가로 만들어보자. 우선, 상품에 대하여 질문과 답변을 남길 수 있도록 Question 모델과 QNA 모델을 만들어주도록 한다.</p>\n<h1 id=\"model-with-foreignkey\" style=\"position:relative;\"><a href=\"#model-with-foreignkey\" aria-label=\"model with foreignkey permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Model with ForeignKey</h1>\n<p>질문 모델에 대한 정의는 별도의 app을 만들어서 진행하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>conf <span class=\"token keyword\">import</span> settings\n<span class=\"token keyword\">from</span> item<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n\n<span class=\"token comment\"># Create your models here.</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Question</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    item <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Item<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    title <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'질문 제목'</span><span class=\"token punctuation\">,</span> max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    content <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'질문 내용'</span><span class=\"token punctuation\">)</span>\n    user <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">.</span>AUTH_USER_MODEL<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'질문자'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 사용자 삭제되면 질문도 삭제되도록</span>\n    date_created <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'작성일자'</span><span class=\"token punctuation\">,</span> auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 질문 생성되면 자동으로 해당 시간으로 초기화</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'question'</span>\n        verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'질문'</span>\n        verbose_name_plural <span class=\"token operator\">=</span> <span class=\"token string\">'질문들'</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Answer</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    question <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Question<span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'질문'</span><span class=\"token punctuation\">)</span>\n    answer <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>TextField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'판매자 답변'</span><span class=\"token punctuation\">)</span>\n    date_created <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'작성일자'</span><span class=\"token punctuation\">,</span> auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'answer'</span>\n        </code></pre></div>\n<p>질문에 대한 모델과 답변에 대한 모델이 존재하는데, 질문은 2개의 Foriegn key를 가져야 한다.</p>\n<ul>\n<li>어떤 아이템에 대한 질문인지 (item)</li>\n<li>누가 작성한 질문인지 (user)</li>\n</ul>\n<p><code class=\"language-text\">ForeignKey</code>로 정의한 필드들은 origin이 어디에 있는지, 참조하고 있는 데이터가 삭제되었을 때에 대한 정의를 해줄 수 있다. 추가적으로, 우리처럼 custom user model을 사용한 경우에는, <code class=\"language-text\">from django.{프로젝트 앱} import settings</code>를 해주고, <code class=\"language-text\">settings.AUTH_USER_MODEL</code>로 가져와야 한다!! settings.py에서 AUTH_USER_MODEL 적용을 해놨으니 그것을 가져와야 하기 때문이다.</p>\n<p>그리고 마이그레이션을 수행해주자~</p>\n<p>그리고, 이를 기반으로 Question을 작성하는 api를 만들어보도록 하자. 우선, ModelSerializer를 이용하여 ViewSet을 만들어주자.</p>\n<ol>\n<li>\n<p>question/serializers.py</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Question\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">QuestionSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Question\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span></code></pre></div>\n<p>이제 View를 만들어주자.</p>\n</li>\n<li>\n<p>question/views.py</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> viewsets\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> QuestionSerializer\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Question\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>permissions <span class=\"token keyword\">import</span> IsAuthenticatedOrReadOnly\n<span class=\"token comment\"># Create your views here.</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">QuestionModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    queryset <span class=\"token operator\">=</span> Question<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> QuestionSerializer\n    permission_classes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>IsAuthenticatedOrReadOnly<span class=\"token punctuation\">]</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        kwargs<span class=\"token punctuation\">[</span><span class=\"token string\">'partial'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span> <span class=\"token comment\"># for partial update</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span> <span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>queryset과 serializer_class를 정의해주었고, <strong>permission_classes</strong> 를 추가적으로 정의해주었다. 이는 역시 DRF에서 ViewSet을 위해 제공하는 기능으로 해당 View에 접근할 때 필요한 권한에 대하여 명시할 수 있다.</p>\n<p>우리 서비스는 ”<u>회원만 상품에 대한 질문을 남길 수 있</u>“고, <u>비회원은 질문을 볼 수만 있게 하기</u> 위해 <code class=\"language-text\">IsAuthenticatedOrReadOnly</code>를 달아주었다. 이렇게 하면, 요청에 대하여 권한이 없는 사용자는 읽기 요청만 가능할 것이다.</p>\n<p>permission_classes는 배열로 선언하며 여러 권한과 관련한 정책을 달아줄 수 있으므로, <a href=\"https://www.django-rest-framework.org/api-guide/permissions/\">공식 문서</a>를 확인해보자.</p>\n</li>\n<li>\n<p>urls.py</p>\n<p>저번에 item/urls.py처럼 작성해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path<span class=\"token punctuation\">,</span> include\n<span class=\"token keyword\">from</span> question <span class=\"token keyword\">import</span> views\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> routers\n\nrouter <span class=\"token operator\">=</span> routers<span class=\"token punctuation\">.</span>DefaultRouter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nrouter<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span><span class=\"token string\">r'basic'</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>QuestionModelViewSet<span class=\"token punctuation\">)</span>\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span>router<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n</ol>\n<p>추가적으로 root의 urls.py도 question앱을 포함하도록 수정하자.</p>\n<p>이제, 테스트를 해보자!</p>\n<h2 id=\"api-test\" style=\"position:relative;\"><a href=\"#api-test\" aria-label=\"api test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>api test</h2>\n<p><a href=\"http://localhost:8000/question%EB%A5%BC\">http://localhost:8000/question를</a> 입력하면 잘 나오는 것을 확인할 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABsUlEQVQ4y6WRWW/TQBRG/XOI4iROs0AWJSBB/iuvvPAXeElbO0ECgdSqCDdkszOeGS+JOchLyENVlFJLR3OvdH38XY8xGo4ZDUb0X/bpdXu0mx06Fx3azXZOy2pzYbXotLrUq3WqL0zMSg2zYv6lWjGpVeu8ffMO43Wny2QwZNIfMOn1GbfajC9axVnWo7IfWk2GDas4j2R9w2LQsHhl1jDm8znOdMqVbTO9uuTacXBmM64dO69P2NiO85BZMZ8x/zzH+J2mCN9HKYUQAiklSZJw7iOilPeffvDRXvDh0sXQYchqtcbzfJRUOVJqoij+J2F5Kh3xaytZeZKlJzGECPjy9Tv3S4/lNsDbqXxQ64gwI3yMciaMSeKEJErYJ3sMrUPc+xWbncKTIUJF+ddzwriUxo+SSY9kvXFIU6JAoxYb9GKNXvvonUT7AVqFZ0mP4mwzY5+mqM0OceMSLDYod1XIMmkp1E8SHg4oIZGZRIanFcr66cJjwm93BLcu8tZFbXxUtrp8TkIvOL0YJ4TJ/mzZw4Rbgbj5maeTd4s88TMSpigvKC5EqOJCAo2W+r/+4R//6Nm2Rhq6wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"api-test1\" title=\"api-test1\" src=\"/static/0abbe3509e82d758650300290a82ab4b/37523/api-test1.png\" srcset=\"/static/0abbe3509e82d758650300290a82ab4b/e9ff0/api-test1.png 180w,\n/static/0abbe3509e82d758650300290a82ab4b/f21e7/api-test1.png 360w,\n/static/0abbe3509e82d758650300290a82ab4b/37523/api-test1.png 720w,\n/static/0abbe3509e82d758650300290a82ab4b/302a4/api-test1.png 1080w,\n/static/0abbe3509e82d758650300290a82ab4b/07a9c/api-test1.png 1440w,\n/static/0abbe3509e82d758650300290a82ab4b/28b65/api-test1.png 2414w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>로그인되어 있지 않으므로, 새로운 질문을 생성하는 request는 불가능하다. 만약 로그인 되어 있다면 다음과 같은 form도 하단에 나올 것이다. (localhost:8000/admin 으로 로그인 하고 같은 브라우저 내에서 접속하면 나올 것)</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArElEQVQY042Q7QrDIAxF+/7vNNgrjD3CxliLlVq10fhxR+wK/bUZOEgu4ZA41FpRSsFR0h8l+U9qRU4MthZEhBACBmbGtm2Y5xnTNGFdVyilsCxLG/gLEch7WGvhnNuF3vsmGcexhSITcUqpj5zbS/TdUCSC1rqJjDGQPMbYRYgRJTM4noQikpOP7dpgz8khIHHEW1u8lMEgq8rJ8o9nJOvBOo+aAi63B673Jz6fTNJk0D6ESQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"api-test2\" title=\"api-test2\" src=\"/static/27e0713231083ab3a4eb5c77d23f64db/37523/api-test2.png\" srcset=\"/static/27e0713231083ab3a4eb5c77d23f64db/e9ff0/api-test2.png 180w,\n/static/27e0713231083ab3a4eb5c77d23f64db/f21e7/api-test2.png 360w,\n/static/27e0713231083ab3a4eb5c77d23f64db/37523/api-test2.png 720w,\n/static/27e0713231083ab3a4eb5c77d23f64db/302a4/api-test2.png 1080w,\n/static/27e0713231083ab3a4eb5c77d23f64db/07a9c/api-test2.png 1440w,\n/static/27e0713231083ab3a4eb5c77d23f64db/59f0d/api-test2.png 2370w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>하지만, <strong><u><em>문제가 보인다.</em></u></strong></p>\n<p>request에서 질문자를 명시하며, GET에서도 리턴시 질문자의 id가 노출이 된다. 추가적으로 UPDATE, DELETE에 대하여는 본인이 작성하지 않아도 <code class=\"language-text\">IsAuthenticated</code> 이므로 남이 작성한 질문을 수정/삭제할 수 있게 된다.</p>\n<p>우리는 여기서 몇가지를 해줄 수 있다.</p>\n<blockquote>\n<ol>\n<li>질문자를 명시하지 않도록, serializer 수정</li>\n<li>질문자를 자동으로 넣어주도록 perform_create 오버라이드</li>\n<li>본인이 작성한 글만 수정/삭제할 수 있도록 custom permission 추가</li>\n</ol>\n</blockquote>\n<h1 id=\"custom-permission--set-user-automatically-in-viewset\" style=\"position:relative;\"><a href=\"#custom-permission--set-user-automatically-in-viewset\" aria-label=\"custom permission  set user automatically in viewset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custom Permission &#x26; set user automatically in viewset</h1>\n<p>해야할 일들을 차근차근 해보자.</p>\n<ol>\n<li>\n<p>serializer field 조정</p>\n<p><strong>request에서는 user를 적지 못하도록</strong> 해야한다. 이는 <u>read_only로 시리얼라이저 필드를 선언</u>하도록 하면 된다.</p>\n<p>또한, response에서는 user의 id(PK)를 노출하지 않고 이름과 같은 다른 필드를 넘겨주도록 해보자. username을 보내주는데, 마스킹 처리를 serializer 단에서 처리하도록 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Question\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">QuestionSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>source<span class=\"token operator\">=</span><span class=\"token string\">'user.username'</span><span class=\"token punctuation\">,</span> read_only<span class=\"token operator\">=</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Question\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">to_representation</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        data <span class=\"token operator\">=</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to_representation<span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span>\n        username <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token comment\"># 가운데 문자 가리기</span>\n        masked_username <span class=\"token operator\">=</span> username<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">'*'</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> username<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\n        data<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> masked_username\n        <span class=\"token keyword\">return</span> data</code></pre></div>\n<p>우선, user field를 <strong>read_only로 추가</strong>해주면서 어디에서 가져와야하는지 <code class=\"language-text\">source</code> parameter에 적어준다.</p>\n<p>이후에, <strong>to_representation 메소드를 오버라이딩</strong>하여 사용자에게 보여질 username을 일부 가리도록 하였다. 이 함수를 이용하면, raw한 data type을 보기 좋게 바꿔주기에도 좋을 것이다.</p>\n</li>\n<li>\n<p>perform_create</p>\n<p>serializer를 바꾸면 GET은 잘 수행되겠지만 나머지는 잘 안될 것이다. <strong>Question model에서 작성자는 필요하지만, 단지 request body에 있으면 안되기 때문이다</strong>. 우리는 request에서 오는 authentication 정보(<code class=\"language-text\">request.user</code>)를 question모델의 create 단계에서 초기화해서 넣어주면 된다. viewset 내에 <code class=\"language-text\">perform_create</code> 함수를 오버라이딩해준다. create에서 serializer를 검증한 이후에 실제 save가 이루어지는 부분인데, 여기서 user를 <code class=\"language-text\">self.request.user</code>로 넣어주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">perform_create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># 생성되기 전, serializer에 user 정보 넣어줘야함</span>\n  serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span></code></pre></div>\n<p>create할 때 request에서 들어온 user에 맞게 모델이 생성되고 DB에 저장될 것이다.</p>\n<p>마지막으로, 수정과 삭제에 대한 권한을 조정해주자! 본인만 수정과 삭제를 할 수 있어야한다.</p>\n</li>\n<li>\n<p>custom permission</p>\n<p>Permission은 Django에서 제공하는 <code class=\"language-text\">BasePermission</code> 클래스를 상속하여 만들 수 있다. <code class=\"language-text\">IsAuthenticated</code> 등과 같이 제공해주는 permission 함수 역시 이를 기반으로 만들어 져있다. BasePermission 클래스의 내용은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BasePermission</span><span class=\"token punctuation\">(</span>metaclass<span class=\"token operator\">=</span>BasePermissionMetaclass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    A base class from which all permission classes should inherit.\n    \"\"\"</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">has_permission</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> view<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        Return `True` if permission is granted, `False` otherwise.\n        \"\"\"</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">has_object_permission</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> view<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"\n        Return `True` if permission is granted, `False` otherwise.\n        \"\"\"</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n</code></pre></div>\n<p>보면, has_permissoin과 has_object_permission함수가 있는데, 후자는 <code class=\"language-text\">get_object()</code>  함수가 수행될 때 호출될 수 있다. 이는 앞전에 공부했던 <code class=\"language-text\">API_View</code>에에서 제공되는 함수로, get/update/delete와 같이 id를 url로 입력받아 특정 객체에 접근할 때 호출된다. 따라서 <code class=\"language-text\">has_object_permission</code> 함수를 오버라이딩해보자.! <code class=\"language-text\">conf/permissions.py</code> 를 만들어주고 아래와 같이 작성하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> permissions\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">IsOwnerOrReadOnly</span><span class=\"token punctuation\">(</span>permissions<span class=\"token punctuation\">.</span>BasePermission<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">has_object_permission</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> view<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 특정 객체를 접근할 때 사용되는 권한(get, update, delete) &lt;-> APIView 기반의 POST에서는 호출되지 않음</span>\n        <span class=\"token comment\"># GET, HEAD, OPTIONS 요청은 항상 허용</span>\n        <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token keyword\">in</span> permissions<span class=\"token punctuation\">.</span>SAFE_METHODS<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\n\n        <span class=\"token comment\"># 작성자만 수정, 삭제를 허용</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">.</span>user <span class=\"token operator\">==</span> request<span class=\"token punctuation\">.</span>user\n</code></pre></div>\n<p>권한에 대하여 Boolean type으로 리턴하도록 하면 된다. 만약 Question의 작성자 (user)가 요청을 보낸 사람(request.user)과 다르다면 <code class=\"language-text\">False</code>를 리턴하도록 한다. 또한 custom permission을 만들어주었다면 ViewSet의 permission_classes에다가 추가해주면 된다.!</p>\n<p>여기까지 권한에 대하여 잘 알아보았다. 해당 내용까지 커밋한번 하고 가자. <a href=\"https://github.com/choieastsea/market-guri-django/commit/99a1643d42de98db25af3d1aac653a1832d89e02\">코드 참고</a></p>\n<p><a href=\"http://localhost:8000/question/basic\">http://localhost:8000/question/basic</a> 요청에 대하여 다음과 같이 잘 나온다면 성공이다!</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"th*******ae\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"배송 관련 문의\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"해당 상품을 오늘 시키면 언제쯤 도착할까요?\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-13\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"item\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"th*******ae\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"배송 관련 문의2\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"해당 상품을 오늘 시키면 언제쯤 도착할까요?\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-13\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"item\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    ...\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>또한, ~/question/basic/{id} 로 접근해서 <strong>본인이 작성한 글이라면 UPDATE와 DELETE가 가능할 것이고, 아니면 permission 관련 에러가 나올 것이다</strong></p>\n</li>\n</ol>\n<p>이제 개념적인 것들은 거의 끝났다.! 본격적으로 서비스를 구체화해보자.</p>\n<p>우선 Question 모델은 만들었으니, 이에 해당하는 Answer에 대한 api를 구체화해보자.</p>\n<h1 id=\"answer-model\" style=\"position:relative;\"><a href=\"#answer-model\" aria-label=\"answer model permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Answer model</h1>\n<p>우선, Question과 Answer를 굳이 구분할 필요는 없을 것 같아, <code class=\"language-text\">qna</code>라는 한 패키지로 묶어서 관리하도록 하자. 질문에 대한 것은 <code class=\"language-text\">/qna/question</code>. 답변은 <code class=\"language-text\">/qna/answer</code>에서 처리하도록 바꿀 것이다.</p>\n<p>answer model의 작성 및 수정은 <code class=\"language-text\">장고 관리자 페이지</code>에서만 가능하도록 하자. 따라서, api단에서는 <strong>읽기만 가능하도록 하자!</strong> 이는 <code class=\"language-text\">allowed_methods</code>를 GET만 설정해주면 될 것이다.</p>\n<p>또한, item에 대한 <strong>질문과 대답</strong>을 한번에 확인하는 api가 있으면 좋으니 이를 <code class=\"language-text\">AnswerModelViewSet</code>에 넣어주도록 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AnswerModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    queryset <span class=\"token operator\">=</span> Answer<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> AnswerSerializer\n    allowed_methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># only for get (답변은 관리자페이지에서 작성하므로, 사용자에게 보여주기만 하면 됨)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 특정 item_code에 대한 QNA 보여주도록 /qna/answer/?item_code=2</span>\n        queryset <span class=\"token operator\">=</span> Answer<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        item_id <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>query_params<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'item_code'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> item_id <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            queryset <span class=\"token operator\">=</span> queryset<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>question__item<span class=\"token operator\">=</span>item_id<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> queryset</code></pre></div>\n<p>item_code에 대한 query parameter를 입력받아, item_id에 따라 해당하는 Answer queryset을 리턴하도록 하면 된다! <u>언더바(_) 두개로 foreign key에 접근할 수 있다.</u></p>\n<p>마지막으로, answer serializer 클래스를 보자. ModelSerializer로 단순하게 구현하면, question의 id만 보여지게 될 것이다. 기본적으로 장고는 참조 객체의 PK를 보여주기 때문이다. 따라서, 참조 객체를 모두 보여줘야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"answer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"안녕하세요 판매자입니다.\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-14\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"question\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"answer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"답변 테스트입니다.\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-14\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"question\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>AnswerSerializer에서 question field를 QuestionSerializer로 가져오면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AnswerSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    question <span class=\"token operator\">=</span> QuestionSerializer<span class=\"token punctuation\">(</span>read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># question 내용도 보여주기</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Answer\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span></code></pre></div>\n<p>이렇게 하면 아래와 같은 응답을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"question\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"th*******ae\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"배송 관련 문의\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"해당 상품을 오늘 시키면 언제쯤 도착할까요?\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-13\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"item\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"answer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"안녕하세요 판매자입니다.\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-14\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"question\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"th*******ae\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"배송 관련 문의2\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"해당 상품을 오늘 시키면 언제쯤 도착할까요?\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-13\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"item\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"answer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"답변 테스트입니다.\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"date_created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-05-14\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>결과는 위와 같을 것이다! 실제 서비스라면 Serializer를 변경하여 보여줄 필드와 보여지면 안되는 필드를 구분하고 데이터를 정제할 필요가 있다.</p>\n<h1 id=\"item-list-pagination\" style=\"position:relative;\"><a href=\"#item-list-pagination\" aria-label=\"item list pagination permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Item List Pagination</h1>\n<p><code class=\"language-text\">Pagination</code>이란, 많은 양의 배열을 페이지 단위로 나누어서 제공하는 기능을 의미한다. 해당 서비스에서는 메인페이지에서 모든 상품을 보여주는데, 매 시점마다 모든 상품을 가져와서 보여주는 것은 비싸므로, 페이지를 나누어 보여주도록 하는 것이 좋아보인다.!</p>\n<p>DRF에서는 Pagination을 위한 클래스가 제공된다. <a href=\"https://www.django-rest-framework.org/api-guide/pagination/\">공식문서</a></p>\n<p>우리는 <code class=\"language-text\">item/basic/</code> GET 메소드에 대하여만 pagination을 제공할 예정이다. 우선, <code class=\"language-text\">pagination.py</code>에서 우리가 사용할 페이지 정책을 정의한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>pagination <span class=\"token keyword\">import</span> PageNumberPagination\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemPagination</span><span class=\"token punctuation\">(</span>PageNumberPagination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    page_size <span class=\"token operator\">=</span> <span class=\"token number\">10</span></code></pre></div>\n<p>이후, Item View에서 이를 사용하도록 설정하면 된다. item/views.py에 pagination_class를 추가해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    queryset <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> ItemSerializer\n    pagination_class <span class=\"token operator\">=</span> ItemPagination\n    allowed_methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># only for get method</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>그럼, <code class=\"language-text\">/item/basic/</code> 의 결과로 다음과 같이 나오게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">13</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"next\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:8000/item/basic/?page=2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"previous\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"results\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Iphone U14\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1700000</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        ...\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Iphone test3\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1700000</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>기존 api와 다른 점을 보면, count와 next/previous가 제공되어 프론트에서 이를 기반으로 Pagination component를 구성할 수 있고, 기존에 전달되던 데이터는 위에서 설정한 것처럼 10개씩 끊어서 results 배열에 들어가게 된다!</p>\n<p>오늘까지 장고에서 제공하는 기능인 permission, authentication, 그리고 pagination 등을 공부해보았다. 다음에는 아이템 페이지를 구체화하고, <code class=\"language-text\">아이템 구매</code>와 관련한 로직을 만들어보도록 하자! <a href=\"https://github.com/choieastsea/market-guri-django/commit/6763ffd6f0b828a23f97e5437705f16bb43bcc2e\">코드</a></p>","frontmatter":{"date":"May 12, 2022","title":"(Django) 장고 api 서버를 이용한 프로젝트 [11- 모델 구체화, 참조 모델 구현]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(11)- model advanced/"}},"prev":{"id":"8a68c7bf-b012-5c29-b341-56ae615c9eb3","html":"<p>저번까지 Item 모델과 연관된 Question과 Answer 모델을 구현해보았다. 질문을 남긴 사람만 해당 질문을 변경할 수 있고, 답변은 관리자 페이지를 통해서만 달 수 있다.</p>\n<p>오늘은 쇼핑몰의 핵심 기능인 사용자가 물건을 장바구니에 담고, 구매하는 기능을 구현해보도록 하자.</p>\n<h2 id=\"장바구니cart-모델-만들기\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EB%B0%94%EA%B5%AC%EB%8B%88cart-%EB%AA%A8%EB%8D%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"장바구니cart 모델 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장바구니(Cart) 모델 만들기</h2>\n<p>장바구니에 대한 요구사항을 간단하게 정리해보자. 장바구니는 User model과 Item model을 <code class=\"language-text\">N:M</code>으로 연결해주는 테이블이므로, 별도의 모델로 작성하도록 한다. <code class=\"language-text\">python manage.py startapp cart</code>로 장바구니 앱을 만들자.</p>\n<ul>\n<li>사용자</li>\n<li>물건(item) &#x26; 물건의 현재 가격</li>\n<li>수량</li>\n<li>장바구니 추가/업데이트 시점(추가, 수정 등으로 7일 지나면 장바구니 삭제되도록 할 수 있을 것)</li>\n</ul>\n<p>위의 요구사항을 <code class=\"language-text\">cart/models.py</code>에 구현해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Cart</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">.</span>AUTH_USER_MODEL<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'사용자'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 사용자 삭제되면 장바구니도 삭제되도록</span>\n    item <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Item<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품'</span><span class=\"token punctuation\">)</span>\n    amount <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'수량'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    date_created <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'최종 수정 일자'</span><span class=\"token punctuation\">,</span> auto_now<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 추가되거나, 수정되면 update되도록 함</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'cart'</span>\n        verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'장바구니 물건'</span>\n        verbose_name_plural <span class=\"token operator\">=</span> <span class=\"token string\">'장바구니 물건들'</span></code></pre></div>\n<p>다음으로는, serializer를 구현한다. serializer에서는 아래의 두가지 필드가 추가되면 좋을 것 같다.</p>\n<ul>\n<li>총 금액</li>\n<li>주문이 가능한지 여부(품절이 되면 주문이 불가능)</li>\n</ul>\n<p>사용자에게 해당 필드를 제공하면서, 동시에 Create나 Update 할때는 필요 없으므로 <code class=\"language-text\">readonly</code>로 선언하도록 한다. 추가적으로, user 정보 역시 <code class=\"language-text\">request.user</code>로만 받고, <strong>body를 통하여 변경되면 안되므로 readonly여야한다</strong>.</p>\n<h3 id=\"serializermethodfield---set-value-in-serializers-field\" style=\"position:relative;\"><a href=\"#serializermethodfield---set-value-in-serializers-field\" aria-label=\"serializermethodfield   set value in serializers field permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SerializerMethodField - set value in serializer’s field</h3>\n<p>총 금액, 주문 가능 여부와 같은 필드는 참조를 통해 바로 알아낼 수 있는 값이 아니므로, 별도의 함수를 통하여 값을 가져와야 한다. 이는 <code class=\"language-text\">SerializerMethodField</code>로 선언해주면 된다. <a href=\"https://www.django-rest-framework.org/api-guide/fields/#serializermethodfield\">공식문서참고</a></p>\n<p>인자로 <code class=\"language-text\">method_name</code> 을 명시하지 않는다면 <code class=\"language-text\">get_{field_name}</code>의 함수를 오버라이드 하면 되고, 명시한다면 해당 함수를 작성하면 해당 함수를 통하여 값을 가져온다. 해당 함수는 model instance를 <code class=\"language-text\">obj</code>인자로 받아 접근할 수 있다.</p>\n<p><code class=\"language-text\">cart/serializers.py</code>는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CartSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>source<span class=\"token operator\">=</span><span class=\"token string\">'user.username'</span><span class=\"token punctuation\">,</span> read_only<span class=\"token operator\">=</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    total_price <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>SerializerMethodField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    is_available_now <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>SerializerMethodField<span class=\"token punctuation\">(</span>method_name<span class=\"token operator\">=</span><span class=\"token string\">'is_available'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_total_price</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 총 금액 리턴</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">.</span>price <span class=\"token operator\">*</span> obj<span class=\"token punctuation\">.</span>amount\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">is_available</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 현재 수량이 주문 가능한지</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">.</span>stock_count <span class=\"token operator\">>=</span> obj<span class=\"token punctuation\">.</span>amount\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> validated_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># user, itm_info 이미 존재한다면 수량만 누적하는 update</span>\n        cart_exist <span class=\"token operator\">=</span> Cart<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>validated_data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> item<span class=\"token operator\">=</span>validated_data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'item'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> cart_exist<span class=\"token punctuation\">:</span>\n            validated_data<span class=\"token punctuation\">[</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> validated_data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> cart_exist<span class=\"token punctuation\">.</span>amount\n            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>cart_exist<span class=\"token punctuation\">,</span> validated_data<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 존재하지 않는다면 create</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>validated_data<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\"># item을 보여줄 때, id만 보여주는 것이 아닌, 안의 내용들을 ItemCartSerializer 통해서 보여주도록 해야함</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">to_representation</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        response <span class=\"token operator\">=</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to_representation<span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span>\n        response<span class=\"token punctuation\">[</span><span class=\"token string\">'item'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> ItemCartSerializer<span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>data\n        <span class=\"token keyword\">return</span> response\n    \n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Cart\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span></code></pre></div>\n<p>SerializerMethodField를 이용하면 <u>필드마다 동적인 데이터로 처리</u>해줄 수 있다. 또한 이는 <strong>항상</strong> <code class=\"language-text\">read_only</code> 속성이므로, deserialize 과정에서는 필요가 없다.</p>\n<p>이전에 사용자의 이름을 마스킹하기 위해 <code class=\"language-text\">to_representation</code> 함수를 사용했었는데, 여기에 item에 대한 JSON을 보여주기 위해 이를 사용할 수 있다.</p>\n<p>주의해야할 점은, serializer를 통해서 create가 될 때, <strong>해당 사용자에게 이미 있던 item이라면 <code class=\"language-text\">update</code>가 되도록 해야한다!</strong> 따라서 create 함수를 오버라이드 해주었다.</p>\n<p>추가적으로, item은 <code class=\"language-text\">ItemCartSerializer</code>로 가져오지 않으면 item__id만 가져오므로 ItemCartSerializer를 정의하여 장바구니에 담은 아이템의 정보들을 보여줄 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># items/serializers.py</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemCartSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Cart에 들어가는 Item을 위한 serializer (item_id를 제외하고는 read_only로!)\n    \"\"\"</span>\n    item_id <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>IntegerField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span>\n        read_only_fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'stock_count'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'description'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제, ViewSet을 만들어보자!</p>\n<h3 id=\"cartmodelviewset---메소드에-따라-오버라이드\" style=\"position:relative;\"><a href=\"#cartmodelviewset---%EB%A9%94%EC%86%8C%EB%93%9C%EC%97%90-%EB%94%B0%EB%9D%BC-%EC%98%A4%EB%B2%84%EB%9D%BC%EC%9D%B4%EB%93%9C\" aria-label=\"cartmodelviewset   메소드에 따라 오버라이드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CartModelViewSet - 메소드에 따라 오버라이드</h3>\n<p>요구사항은 다음과 같다.</p>\n<ol>\n<li>\n<p>장바구니는 <strong>본인의 것만 보여주도록</strong> 해야한다.</p>\n</li>\n<li>\n<p>또한, 수정에 있어서 <strong>item은 수정이 불가능하고 수량만 수정 가능하도록</strong> 한다. 이러한 요구사항에 맞게 ViewSet을 구성해보도록 하자.</p>\n</li>\n</ol>\n<p>우선, 요청이 들어온 사용자가 갖고 있는 Cart만 보여줘야 하므로, <code class=\"language-text\">queryset</code>을 수정해야한다.! 이는 <code class=\"language-text\">get_queryset()</code>을 오버라이드 하면 될 것이다.</p>\n<p>수정에 있어서는 입력 인자를 <code class=\"language-text\">amount</code>만 가능하게 해야하므로, PUT 요청에 대하여는 다른 <code class=\"language-text\">serializer_class</code>를 선택하도록 한다. Update를 위한 serializer는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CartUpdateSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    item <span class=\"token operator\">=</span> ItemCartSerializer<span class=\"token punctuation\">(</span>read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 아이템 정보 보여주기 read_only</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Cart\n        fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'item'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>amount만 입력받을 것이다. amount가 Cart model에서 <code class=\"language-text\">PositiveIntegerField</code>로 정의되어있기에 serializer에서의 validation은 진행하지 않았다. 이를 이용한 ModelViewSet은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CartModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    queryset <span class=\"token operator\">=</span> Cart<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> CartSerializer\n    permission_classes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>IsAuthenticated<span class=\"token punctuation\">]</span> <span class=\"token comment\"># 인증된 사용자만 접근 가능</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 본인이 장바구니에 포함시킨 것들만 보여주도록 해야함(타인 접근 불가)</span>\n        queryset <span class=\"token operator\">=</span> Cart<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> queryset\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_serializer_class</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>action <span class=\"token operator\">==</span> <span class=\"token string\">'update'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> CartUpdateSerializer\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> CartSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">perform_create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># cart 생성되기 전, serializer에 auth에 해당하는 user 정보 넣어줘야함</span>\n        serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제 테스트를 해보자!</p>\n<ul>\n<li>\n<p>POST (create)</p>\n<p>item_id와 amount를 body에 넣으면 생성된다.</p>\n</li>\n<li>\n<p>GET</p>\n<p>본인이 담은 장바구니만 볼 수 있다.</p>\n</li>\n<li>\n<p>UPDATE</p>\n<p>amount만 수정 가능하다.</p>\n</li>\n<li>\n<p>DELETE</p>\n<p>본인의 것만 삭제할 수 있다.</p>\n</li>\n</ul>\n<p>모두 완료되었음을 확인해보았다~ api 테스트는 DRF에서 localhost:8000으로 접속시 디버깅모드로 확인할 수 있으니, 편하게 이를 사용하였다.</p>\n<p>서버 소스코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/91de4eca0979d470484655ee452d7b5efd158f7f\">여기에</a> 있다.</p>\n<h3 id=\"프론트에서-확인하기\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%90%EC%84%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"프론트에서 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프론트에서 확인하기</h3>\n<p>프론트 코드는 여기를 참고한다.</p>\n<p>다음에는 장바구니를 통하거나 상품 페이지에서의 구매를 할 수 있도록 <code class=\"language-text\">구매</code> 기능을 만들어보자!</p>\n<p>SessionMiddleware를 사용하고,</p>\n<p>SessionAuthentication의 요청에 대하여</p>\n<p>set-cookie를 통한 토큰 갱신이 수행됨..!</p>\n<p><a href=\"https://gaussian37.github.io/python-rest-nested-serializer/\">https://gaussian37.github.io/python-rest-nested-serializer/</a></p>\n<p>nested serializer에 대하여 알아야할듯!</p>","frontmatter":{"date":"June 16, 2022","title":"(Django) 장고 api 서버를 이용한 프로젝트 [12- nested serializer]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(12)/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Alg-Dijkstra/","nextSlug":"/Django(11)- model advanced/","prevSlug":"/Django(12)/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}