{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Django(12)/",
    "result": {"data":{"cur":{"id":"8a68c7bf-b012-5c29-b341-56ae615c9eb3","html":"<p>저번까지 Item 모델과 연관된 Question과 Answer 모델을 구현해보았다. 질문을 남긴 사람만 해당 질문을 변경할 수 있고, 답변은 관리자 페이지를 통해서만 달 수 있다.</p>\n<p>오늘은 쇼핑몰의 핵심 기능인 사용자가 물건을 장바구니에 담고, 구매하는 기능을 구현해보도록 하자.</p>\n<h2 id=\"장바구니cart-모델-만들기\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EB%B0%94%EA%B5%AC%EB%8B%88cart-%EB%AA%A8%EB%8D%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"장바구니cart 모델 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장바구니(Cart) 모델 만들기</h2>\n<p>장바구니에 대한 요구사항을 간단하게 정리해보자. 장바구니는 User model과 Item model을 <code class=\"language-text\">N:M</code>으로 연결해주는 테이블이므로, 별도의 모델로 작성하도록 한다. <code class=\"language-text\">python manage.py startapp cart</code>로 장바구니 앱을 만들자.</p>\n<ul>\n<li>사용자</li>\n<li>물건(item) &#x26; 물건의 현재 가격</li>\n<li>수량</li>\n<li>장바구니 추가/업데이트 시점(추가, 수정 등으로 7일 지나면 장바구니 삭제되도록 할 수 있을 것)</li>\n</ul>\n<p>위의 요구사항을 <code class=\"language-text\">cart/models.py</code>에 구현해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Cart</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">.</span>AUTH_USER_MODEL<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'사용자'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 사용자 삭제되면 장바구니도 삭제되도록</span>\n    item <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Item<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품'</span><span class=\"token punctuation\">)</span>\n    amount <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'수량'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    date_created <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'최종 수정 일자'</span><span class=\"token punctuation\">,</span> auto_now<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 추가되거나, 수정되면 update되도록 함</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'cart'</span>\n        verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'장바구니 물건'</span>\n        verbose_name_plural <span class=\"token operator\">=</span> <span class=\"token string\">'장바구니 물건들'</span></code></pre></div>\n<p>다음으로는, serializer를 구현한다. serializer에서는 아래의 두가지 필드가 추가되면 좋을 것 같다.</p>\n<ul>\n<li>총 금액</li>\n<li>주문이 가능한지 여부(품절이 되면 주문이 불가능)</li>\n</ul>\n<p>사용자에게 해당 필드를 제공하면서, 동시에 Create나 Update 할때는 필요 없으므로 <code class=\"language-text\">readonly</code>로 선언하도록 한다. 추가적으로, user 정보 역시 <code class=\"language-text\">request.user</code>로만 받고, <strong>body를 통하여 변경되면 안되므로 readonly여야한다</strong>.</p>\n<h3 id=\"serializermethodfield---set-value-in-serializers-field\" style=\"position:relative;\"><a href=\"#serializermethodfield---set-value-in-serializers-field\" aria-label=\"serializermethodfield   set value in serializers field permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SerializerMethodField - set value in serializer’s field</h3>\n<p>총 금액, 주문 가능 여부와 같은 필드는 참조를 통해 바로 알아낼 수 있는 값이 아니므로, 별도의 함수를 통하여 값을 가져와야 한다. 이는 <code class=\"language-text\">SerializerMethodField</code>로 선언해주면 된다. <a href=\"https://www.django-rest-framework.org/api-guide/fields/#serializermethodfield\">공식문서참고</a></p>\n<p>인자로 <code class=\"language-text\">method_name</code> 을 명시하지 않는다면 <code class=\"language-text\">get_{field_name}</code>의 함수를 오버라이드 하면 되고, 명시한다면 해당 함수를 작성하면 해당 함수를 통하여 값을 가져온다. 해당 함수는 model instance를 <code class=\"language-text\">obj</code>인자로 받아 접근할 수 있다.</p>\n<p><code class=\"language-text\">cart/serializers.py</code>는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CartSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    user <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>source<span class=\"token operator\">=</span><span class=\"token string\">'user.username'</span><span class=\"token punctuation\">,</span> read_only<span class=\"token operator\">=</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    total_price <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>SerializerMethodField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    is_available_now <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>SerializerMethodField<span class=\"token punctuation\">(</span>method_name<span class=\"token operator\">=</span><span class=\"token string\">'is_available'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_total_price</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 총 금액 리턴</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">.</span>price <span class=\"token operator\">*</span> obj<span class=\"token punctuation\">.</span>amount\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">is_available</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 현재 수량이 주문 가능한지</span>\n        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">.</span>stock_count <span class=\"token operator\">>=</span> obj<span class=\"token punctuation\">.</span>amount\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> validated_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># user, itm_info 이미 존재한다면 수량만 누적하는 update</span>\n        cart_exist <span class=\"token operator\">=</span> Cart<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>validated_data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> item<span class=\"token operator\">=</span>validated_data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'item'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> cart_exist<span class=\"token punctuation\">:</span>\n            validated_data<span class=\"token punctuation\">[</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> validated_data<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> cart_exist<span class=\"token punctuation\">.</span>amount\n            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>cart_exist<span class=\"token punctuation\">,</span> validated_data<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 존재하지 않는다면 create</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>validated_data<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token comment\"># item을 보여줄 때, id만 보여주는 것이 아닌, 안의 내용들을 ItemCartSerializer 통해서 보여주도록 해야함</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">to_representation</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        response <span class=\"token operator\">=</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to_representation<span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span>\n        response<span class=\"token punctuation\">[</span><span class=\"token string\">'item'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> ItemCartSerializer<span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>data\n        <span class=\"token keyword\">return</span> response\n    \n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Cart\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span></code></pre></div>\n<p>SerializerMethodField를 이용하면 <u>필드마다 동적인 데이터로 처리</u>해줄 수 있다. 또한 이는 <strong>항상</strong> <code class=\"language-text\">read_only</code> 속성이므로, deserialize 과정에서는 필요가 없다.</p>\n<p>이전에 사용자의 이름을 마스킹하기 위해 <code class=\"language-text\">to_representation</code> 함수를 사용했었는데, 여기에 item에 대한 JSON을 보여주기 위해 이를 사용할 수 있다.</p>\n<p>주의해야할 점은, serializer를 통해서 create가 될 때, <strong>해당 사용자에게 이미 있던 item이라면 <code class=\"language-text\">update</code>가 되도록 해야한다!</strong> 따라서 create 함수를 오버라이드 해주었다.</p>\n<p>추가적으로, item은 <code class=\"language-text\">ItemCartSerializer</code>로 가져오지 않으면 item__id만 가져오므로 ItemCartSerializer를 정의하여 장바구니에 담은 아이템의 정보들을 보여줄 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># items/serializers.py</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemCartSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    Cart에 들어가는 Item을 위한 serializer (item_id를 제외하고는 read_only로!)\n    \"\"\"</span>\n    item_id <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>IntegerField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span>\n        read_only_fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'stock_count'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'description'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제, ViewSet을 만들어보자!</p>\n<h3 id=\"cartmodelviewset---메소드에-따라-오버라이드\" style=\"position:relative;\"><a href=\"#cartmodelviewset---%EB%A9%94%EC%86%8C%EB%93%9C%EC%97%90-%EB%94%B0%EB%9D%BC-%EC%98%A4%EB%B2%84%EB%9D%BC%EC%9D%B4%EB%93%9C\" aria-label=\"cartmodelviewset   메소드에 따라 오버라이드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CartModelViewSet - 메소드에 따라 오버라이드</h3>\n<p>요구사항은 다음과 같다.</p>\n<ol>\n<li>\n<p>장바구니는 <strong>본인의 것만 보여주도록</strong> 해야한다.</p>\n</li>\n<li>\n<p>또한, 수정에 있어서 <strong>item은 수정이 불가능하고 수량만 수정 가능하도록</strong> 한다. 이러한 요구사항에 맞게 ViewSet을 구성해보도록 하자.</p>\n</li>\n</ol>\n<p>우선, 요청이 들어온 사용자가 갖고 있는 Cart만 보여줘야 하므로, <code class=\"language-text\">queryset</code>을 수정해야한다.! 이는 <code class=\"language-text\">get_queryset()</code>을 오버라이드 하면 될 것이다.</p>\n<p>수정에 있어서는 입력 인자를 <code class=\"language-text\">amount</code>만 가능하게 해야하므로, PUT 요청에 대하여는 다른 <code class=\"language-text\">serializer_class</code>를 선택하도록 한다. Update를 위한 serializer는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CartUpdateSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    item <span class=\"token operator\">=</span> ItemCartSerializer<span class=\"token punctuation\">(</span>read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 아이템 정보 보여주기 read_only</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Cart\n        fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'amount'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'item'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>amount만 입력받을 것이다. amount가 Cart model에서 <code class=\"language-text\">PositiveIntegerField</code>로 정의되어있기에 serializer에서의 validation은 진행하지 않았다. 이를 이용한 ModelViewSet은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CartModelViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    queryset <span class=\"token operator\">=</span> Cart<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    serializer_class <span class=\"token operator\">=</span> CartSerializer\n    permission_classes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>IsAuthenticated<span class=\"token punctuation\">]</span> <span class=\"token comment\"># 인증된 사용자만 접근 가능</span>\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 본인이 장바구니에 포함시킨 것들만 보여주도록 해야함(타인 접근 불가)</span>\n        queryset <span class=\"token operator\">=</span> Cart<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> queryset\n    \n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_serializer_class</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>action <span class=\"token operator\">==</span> <span class=\"token string\">'update'</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> CartUpdateSerializer\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> CartSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">perform_create</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># cart 생성되기 전, serializer에 auth에 해당하는 user 정보 넣어줘야함</span>\n        serializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>user<span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span></code></pre></div>\n<p>이제 테스트를 해보자!</p>\n<ul>\n<li>\n<p>POST (create)</p>\n<p>item_id와 amount를 body에 넣으면 생성된다.</p>\n</li>\n<li>\n<p>GET</p>\n<p>본인이 담은 장바구니만 볼 수 있다.</p>\n</li>\n<li>\n<p>UPDATE</p>\n<p>amount만 수정 가능하다.</p>\n</li>\n<li>\n<p>DELETE</p>\n<p>본인의 것만 삭제할 수 있다.</p>\n</li>\n</ul>\n<p>모두 완료되었음을 확인해보았다~ api 테스트는 DRF에서 localhost:8000으로 접속시 디버깅모드로 확인할 수 있으니, 편하게 이를 사용하였다.</p>\n<p>서버 소스코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/91de4eca0979d470484655ee452d7b5efd158f7f\">여기에</a> 있다.</p>\n<h3 id=\"프론트에서-확인하기\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%90%EC%84%9C-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"프론트에서 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프론트에서 확인하기</h3>\n<p>프론트 코드는 여기를 참고한다.</p>\n<p>다음에는 장바구니를 통하거나 상품 페이지에서의 구매를 할 수 있도록 <code class=\"language-text\">구매</code> 기능을 만들어보자!</p>\n<p>SessionMiddleware를 사용하고,</p>\n<p>SessionAuthentication의 요청에 대하여</p>\n<p>set-cookie를 통한 토큰 갱신이 수행됨..!</p>\n<p><a href=\"https://gaussian37.github.io/python-rest-nested-serializer/\">https://gaussian37.github.io/python-rest-nested-serializer/</a></p>\n<p>nested serializer에 대하여 알아야할듯!</p>","excerpt":"저번까지 Item 모델과 연관된 Question과 Answer 모델을 구현해보았다. 질문을 남긴 사람만 해당 질문을 변경할 수 있고, 답변은 관리자 페이지를 통해서만 달 수 있다. 오늘은 쇼핑몰의 핵심 기능인 사용자가 물건을 장바구니에 담고, 구매하는 기능을 구현해보도록 하자. 장바구니(Cart) 모델 만들기 장바구니에 대한 요구사항을 간단하게 정리해보자. 장바구니는 User model과 Item model을 으로 연결해주는 테이블이므로, 별도의 모델로 작성하도록 한다. 로 장바구니 앱을 만들자. 사용자 물건(item) & 물건의 현재 가격 수량 장바구니 추가/업데이트 시점(추가, 수정 등으로 7일 지나면 장바구니 삭제되도록 할 수 있을 것) 위의 요구사항을 에 구현해보자. 다음으로는, serializer를 구현한다. serializer에서는 아래의 두가지 필드가 추가되면 좋을 것 같다. 총 금액 주문이 가능한지 여부(품절이 되면 주문이 불가능) 사용자에게 해당 필드를 제공하면서,…","frontmatter":{"date":"June 16, 2022","title":"(Django) 장고 api 서버를 이용한 프로젝트 [12- nested serializer]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(12)/"}},"next":{"id":"e1e5d260-58e0-58af-a974-6c589aef1c8d","html":"<p>Dijkstra(다익스트라) Algorithm은 그래프에서, <strong>한 노드에서 출발하여 다른 노드로 가는 최단 거리</strong>를 구할 때 사용할 수 있는 알고리즘이다. 더 나아가, 출발해서 도착할 때까지의 최단 경로를 구할 수도 있다.</p>\n<h2 id=\"문제-설명\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%84%A4%EB%AA%85\" aria-label=\"문제 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 설명</h2>\n<p>input : 첫줄에는 노드갯수와 엣지갯수, 두번째줄부터 엣지 정보(노드 번호 두개와 edge weight)</p>\n<p>output : 1번노드에서 n번노드까지의 최단 거리</p>\n<p>​\t(입력 예시)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">5 6\n1 2 2\n2 5 5\n2 3 4\n1 4 1\n4 3 3\n3 5 1\n</code></pre></div>\n<h1 id=\"그래프를-표현하는-방법\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%ED%94%84%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"그래프를 표현하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래프를 표현하는 방법</h1>\n<p>weighted graph를 표현하는 방법은 크게 두가지로 나눠볼 수 있는데,</p>\n<ol>\n<li>\n<p>노드~노드간의 관계이므로, 노드가 n개일때 n*n matrix를 만들고, cell에 weight를 적는다.</p>\n<p>4번 노드와 3번 노드를 잇는 엣지의 길이가 5이면, <code class=\"language-text\">matrix[4][3]=5</code>와 같이 표현하면 된다. 다만, 이는 두 노드를 잇는 여러 엣지가 존재할 때 구조의 변경이 불가피하다.</p>\n</li>\n<li>\n<p>한 노드에 인접한 노드에 대하여 (weight, 노드번호)를 모든 노드마다 갖도록 한다. (노드번호, weight)로 저장해도 헷갈리지만 않으면 좋다!</p>\n<p>위와 같은 상황일때, <code class=\"language-text\">node_4의 인접노드 : (5, 3번)</code>와 같이 표현할 수 있다.</p>\n</li>\n</ol>\n<p>2의 방법이 공간적으로 효율적이고 여러 엣지가 존재할 경우도 활용이 가능하다. <code class=\"language-text\">c++</code>에서는 pair와 vector배열을 이용하여 입력에 대하여 인접노드를 추가하는 형태로 표현할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include &lt;bits/stdc++.h&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nvector&lt;pair&lt;int, int&gt;&gt; E[100005];\nint main(void)\n{\n    int n, m; // number of nodes, number of edges\n    cin &gt;&gt; n &gt;&gt; m;\n    for (int i = 0; i &lt; m; i++)\n    {\n        int from, to, weight;\n        cin &gt;&gt; from &gt;&gt; to &gt;&gt; weight;\n        E[from].push_back(make_pair(to, weight));\n        E[to].push_back(make_pair(from, weight));\n    }\n   ...\n}</code></pre></div>\n<p>전역변수 E에 모든 엣지의 정보가 저장되어 있으므로, 이를 탐색하며 최단거리를 구할 수 있다.</p>\n<h1 id=\"dijkstra-의사-코드\" style=\"position:relative;\"><a href=\"#dijkstra-%EC%9D%98%EC%82%AC-%EC%BD%94%EB%93%9C\" aria-label=\"dijkstra 의사 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dijkstra 의사 코드</h1>\n<p>위와 같이 그래프를 만들고 나서는 다익스트라 알고리즘을 이용하여 그래프를 탐색하며 최단거리를 구할 수 있다.</p>\n<p>(1번노드에서 출발하여 n번노드까지의 최단거리를 구하는 다익스트라 알고리즘이라고 가정해보자) 우선 출발지부터 i번 노드까지의 최단거리를 기록하는 <code class=\"language-text\">D[i]</code>가 필요하다. D 배열의 각 원소는 처음에 매우 큰 값으로 세팅하도록 하고, 이후 탐색하면서 더 작은 비용의 거리가 발견된다면 업데이트 되도록 하므로, 큰 값으로 초기화를 해준다.</p>\n<ul>\n<li>\n<p>1번노드~1번노드의 거리는 0이므로, 이를 priority queue(이하 pq, 방문할 노드를 엣지의 거리 순으로 저장함)에 저장한다. D[시작노드] = 0 임을 확정짓는다.</p>\n<ul>\n<li>pq가 비어있을때 까지</li>\n</ul>\n<ol>\n<li>\n<p>pq에서 가장 거리가 짧은 엣지를 찾는다. 노드 번호 : <code class=\"language-text\">curNode</code>, 엣지 길이 : <code class=\"language-text\">curDist</code></p>\n</li>\n<li>\n<p>pq에서 해당 엣지(ex. x번 노드까지의 거리)을 제거한다. (방문 처리)</p>\n</li>\n<li>\n<p>만약 <code class=\"language-text\">D[curNode]</code>가 <code class=\"language-text\">curDist</code>보다 작지 않은경우, (D[ ] 업데이트 필요)</p>\n<ol>\n<li>\n<p>curNode의 인접한 노드들을 조사하는데…</p>\n</li>\n<li>\n<p><code class=\"language-text\">D[x]</code>와 <code class=\"language-text\">D[curNode]+curNode~x의 거리</code>를 비교하여 더 작은 값으로 X 노드까지의 최단거리를 업데이트한다.</p>\n</li>\n<li>\n<p>업데이트 되는 경우에는 해당 엣지 정보를 pq에 추가한다.</p>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n</ul>\n<p>주의해야할 점은 크게 두가지가 있다.</p>\n<ul>\n<li>인접한 엣지 중에서 가장 weight가 짧은 것을 추출하는 과정에서, 일반 배열로 저장하는 것(<code class=\"language-text\">O(N)</code>)보다는 PQ로 저장하는 것(<code class=\"language-text\">O(log(N))</code>)이 효율적이다.</li>\n<li>A에서 C까지의 최단경로를 볼 때, 임의의 노드 B에서 A<del>B + B</del>C까지의 거리와 A~C의 거리를 비교하고, 더 짧은 것으로 거리를 확정짓는 것이 다익스트라의 핵심이다.</li>\n</ul>\n<p>코드는 아래와 같다. 만약 endNode가 추가적으로 필요하다면, 인자에 추가하고 endNode탐색시 종료하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">void dijkstra(int startNode)\n{\n    priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; // (weight, nodeNo)\n    // startNode PQ에 추가\n\n    pq.push(make_pair(0, startNode));\n    d[startNode] = 0;\n    while (!pq.empty())\n    {\n        int curNode = pq.top().second;\n        int curDist = pq.top().first;\n        // printf(&quot;curNode : %d, curDist : %lld\\n&quot;, curNode, curDist);\n        //해당 노드 방문 처리\n        pq.pop();\n        if (d[curNode] &gt;= curDist)\n        {\n            for (int i = 0; i &lt; E[curNode].size(); i++)\n            {\n                //최단 거리 노드의 인접노드\n                int nextNode = E[curNode][i].second;\n                int nextDist = E[curNode][i].first;\n                // printf(&quot;nextDist : %lld, nextNode: %d\\n&quot;, nextDist, nextNode);\n                if (d[curNode] + nextDist &lt; d[nextNode])\n                {\n                    // printf(&quot;update needed\\n&quot;);\n                    // update 필요\n                    d[nextNode] = d[curNode] + nextDist;\n                    // pq push\n                    pq.push(make_pair(nextDist, nextNode));\n                }\n            }\n        }\n    }\n}</code></pre></div>\n<h2 id=\"다익스트라에서-경로를-표현하는-방법\" style=\"position:relative;\"><a href=\"#%EB%8B%A4%EC%9D%B5%EC%8A%A4%ED%8A%B8%EB%9D%BC%EC%97%90%EC%84%9C-%EA%B2%BD%EB%A1%9C%EB%A5%BC-%ED%91%9C%ED%98%84%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"다익스트라에서 경로를 표현하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>다익스트라에서 경로를 표현하는 방법</h2>\n<p>위의 코드는 단지 x번 노드부터 n번 노드까지의 최단거리를 의미한다. 따라서, 어떠한 경로를 통하여 갔는지는 추가적인 작업이 필요하다. 이는 최단거리가 업데이트되어 확정되는 순간에 <strong>해당 노드를 방문하기 직전의 노드를 기록하면 된다</strong>! nextNode와 curNode를 통하여 최단거리를 비교하는 과정에서, 업데이트가 일어나면(최단거리 확정이 일어나면) 배열에다가 curNode를 저장하면 될 것이다.</p>\n<p>그렇게 하면 1 -> 4 -> 3 -> 5의 경로로 최단경로가 확정될 때, [0, 1, 0, 5, 0, 3]와 같이 저장될 것이다. 이를 스택에다가 넣어서 출력하면 깔끔하게 나올 것이다. 최종 코드는 다음과 같다. <code class=\"language-text\">codeforces 20C</code>문제에 대한 코드이다.! 결국 다익스트라가 이러한 틀로 구성되니까 참고하면 좋을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include &lt;bits/stdc++.h&gt;\n#include &lt;iostream&gt;\n\nusing namespace std;\n\nvector&lt;pair&lt;int, int&gt;&gt; E[100005];\nlong long d[100005];\nint prevNode[100005]; // 최단경로에서 i번째 노드의 이전 노드를 저장\n\nvoid dijkstra(int startNode, int endNode)\n{\n    priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, greater&lt;pair&lt;int, int&gt;&gt;&gt; pq; // (weight, nodeNo)\n    // startNode PQ에 추가\n\n    pq.push(make_pair(0, startNode));\n    d[startNode] = 0;\n    prevNode[startNode] = startNode;\n    while (!pq.empty())\n    {\n        int curNode = pq.top().second;\n        int curDist = pq.top().first;\n        // printf(&quot;curNode : %d, curDist : %lld\\n&quot;, curNode, curDist);\n        //해당 노드 방문 처리\n        pq.pop();\n        if (d[curNode] &gt;= curDist)\n        {\n            for (int i = 0; i &lt; E[curNode].size(); i++)\n            {\n                //최단 거리 노드의 인접노드\n                int nextNode = E[curNode][i].second;\n                int nextDist = E[curNode][i].first;\n                // printf(&quot;nextDist : %lld, nextNode: %d\\n&quot;, nextDist, nextNode);\n                if (d[curNode] + nextDist &lt; d[nextNode])\n                {\n                    // printf(&quot;update needed\\n&quot;);\n                    // update 필요\n                    d[nextNode] = d[curNode] + nextDist;\n                    // for path\n                    prevNode[nextNode] = curNode;\n                    // pq push\n                    pq.push(make_pair(nextDist, nextNode));\n                }\n            }\n        }\n    }\n}\n\nint main(void)\n{\n    ios_base::sync_with_stdio(false);\n    cin.tie(NULL);\n    int n, m, from, to, weight; // n : number of nodes, m : number of edges\n    cin &gt;&gt; n &gt;&gt; m;\n    for (int i = 0; i &lt; m; i++)\n    {\n        cin &gt;&gt; from &gt;&gt; to &gt;&gt; weight; // 1-based-node\n        E[from].push_back(make_pair(weight, to));\n        E[to].push_back(make_pair(weight, from));\n        // printf(&quot;from : %d, to : %d, weight : %lld\\n&quot;, from, to, weight);\n    }\n    for (int i = 1; i &lt;= n; i++)\n    {\n        d[i] = LLONG_MAX;\n    }\n    dijkstra(1, n);\n    if (d[n] == LLONG_MAX)\n    {\n        // update되지 않았다 -&gt; 경로 없다\n        printf(&quot;-1\\n&quot;);\n        return 0;\n    }\n    int c = n;\n    stack&lt;int&gt; path;\n    while (c != 1)\n    {\n        // printf(&quot;%d &quot;, c);\n        path.push(c);\n        c = prevNode[c];\n    }\n    path.push(c);\n    while (!path.empty())\n    {\n        printf(&quot;%d &quot;, path.top());\n        path.pop();\n    }\n    printf(&quot;\\n&quot;);\n    return 0;\n}</code></pre></div>","frontmatter":{"date":"May 28, 2022","title":"(Alg) 그래프 알고리즘 - Dijkstra와 최단 경로 출력","categories":"Alg","author":"choieastsea","emoji":"😬"},"fields":{"slug":"/Alg-Dijkstra/"}},"prev":{"id":"022c18c1-b2d0-5e01-bc62-931440b696f2","html":"<h1 id=\"운영체제란\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EB%9E%80\" aria-label=\"운영체제란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영체제란?</h1>\n<blockquote>\n<p>OS</p>\n<p>Operating System</p>\n</blockquote>\n<p>운영체제가 없는 컴퓨터도 존재할 수 있지만, 문구점에서 살 수 있는 계산기와 같이 고정된 기능만 수행할 수 있을 것이다. Programmable한 기계에는 운영체제가 필요할 것이다..!</p>\n<p><strong>운영체제는 프로그램들이 실행되고, 사용자와 상호작용하기 위해 자원을 효율적으로 관리하거나, 자원을 보호하는 역할을 수행하는 소프트웨어</strong>이다.</p>\n<h3 id=\"운영체제는-자원을-어떻게-관리하고-보호할까\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EB%8A%94-%EC%9E%90%EC%9B%90%EC%9D%84-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B4%80%EB%A6%AC%ED%95%98%EA%B3%A0-%EB%B3%B4%ED%98%B8%ED%95%A0%EA%B9%8C\" aria-label=\"운영체제는 자원을 어떻게 관리하고 보호할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영체제는 자원을 어떻게 관리하고 보호할까?</h3>\n<p>OS는 physical(cpu, memory, HDD 등 모든 장치)에 대하여 사용자가 <strong>직접 접근할 수 없도록</strong> 한다. 이러한 자원에 접근할 수 있는 <code class=\"language-text\">interface</code>를 통하여 사용자가 자원에 정해진 방법으로 접근할 수 있도록 제공한다. 이러한 역할을 <code class=\"language-text\">Virtualization</code>(가상화)라고 하며, OS를 virtural machine으로 보는 견해도 존재한다.</p>\n<p>자동차를 보면, 사용자가 엔진을 직접 제어한다기 보다는 엑셀과 기어 등으로(정해진 방법을 통해서) 엔진을 컨트롤하고 엔진을 직접 보는 것이 아닌 계기판을 통해 엔진의 상태를 보는 것과 유사하다.</p>\n<p>따라서, 운영체제는 <strong>사용자에게 편리한 인터페이스 환경을 제공하고 컴퓨터 시스템의 자원을 효율적으로 관리하는 소프트웨어</strong>라고 정의할 수 있다. OS의 목적이 이것이므로, 이를 위해 자원을 가상화하고, 인터페이스를 통하여 접근하도록 하고… 등으로 구성된 것이라고 보면 될 것 같다.</p>\n<h1 id=\"운영체제의-구성\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EC%9D%98-%EA%B5%AC%EC%84%B1\" aria-label=\"운영체제의 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영체제의 구성</h1>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 135.55555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEHElEQVRIx42VW0xcVRSGv3MGZoCCtAgVKdIGxLYIQsdSwKHQ4aqUkhYU2oIlXrjaeqEMzB5EKqEasBo11YR4qYnGFxNNTGN8EuOLT76YmBpNfNTEl9YYEVM4y+wzezpTAk13sufszMz59lrrXxe4eaUBI0AvcBJ4ERgFugEFHAf6gWQ2XUrAPxI9J6dvAWaAF8xeMOBzwOvAeWAeSL018EeBMn0xPuBp4BljXQdQA7QBlUATEDaebAr0EVq2OfN7Mu+JvvkBsB4GTgBDYNWCdQjLbsCym7A8Ze57Qz/D0JWoQbFtgEdRMo6SQZRznFXxut/vDKYAfu64B0p6YG8PlJ2C6glYFHhLIHwdIvq5BsqJbpTTTUQ6mPyvnNByFd8IPP+nRuZh2UNM/JtGz1d3MvzrdoZ/yWPsai6fylYuShaTK9uZFg9qLWqhhjMjSYRXg8xKkHlpcPf7EmDoygkaXlvgI6nhggSZlkeYlRaU00b35RF6l07xknS570Zcl+0o8Oxf2cxIOzsbiihsbaX4SBsF9X3kB7rIKa3F8jwBVLlCiBunY0AE2E92SSYz0sCHxjo3js/+kcOr8pBRsd+o+A5wGtCwL4Hn8PjqsJNewfJ8jcd7Go/vKBn5dzMndYxdS4sLM3Y1izk5BOwiIz8Lyw5g2XX4MlPxeDNdgXZ3gmXrZN5mUiYTb3oxEyvasibUWlYcOCXZhK+30n4plkhJ5nkv0GDO9oYpp1VWThMRyYkDlZNDRFpYEGi9mJTw91zj8vqLoqvjY4+JWzPKyb4ZqKSFc7HEZKupVQ9QDGQAO4DOdQVhG0gjSu5KAEoUuHgDeNA0hHeBWeAz4AMjWNx9JZaB1KCkMJrYYsWBF24Ai4w1A0ApUA00a2nWWRgD+lGy15xvAFujN6ytD77fNIyNekAMWIaS8o2BEyv2OlV1DFM2B7puFqOkKhGY7QK1Yt2Xo0p6Uu7HTurFk7IPb/ou7ORGkrcUuL89+YPF+N9WgiiFKKk1Z1t/bENJkwtcE6gYxMRQN1Kd8GeARbet1U7DpYQyi+4dKAkkWOj4UNKJkjxCy7nMSwFdn9fz6BfN9C4F6f++nrFrfpRTypSUoBwtwB4Tu0qUPI6S/XGge5tThnIOu2UUXj3ItPhZkgIqBsbZfewNPpEiQsuVKEe/eADlHDDq3mc0sOJ5GDM/YnZ4FX4T6PtWu54DBKgOwXcC5wVmRbc8eNk85wS3Cz04atSKmIScEpvQPzbz2uxYsaXuwUo66Z5F4grHzgM/WdzGsky1BM2g0hVzBNgHpJtuYyeMUp0ZXnPO2gioa3cYqDAQnS7lZlY3m/GqL3obeNM02wngKWDwVsBuN37RwT8JHDYjNWA6eKMZr8Xmcp1i7RsBtUtngT4DGzVWPXY78foffO+o6MyDxioAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"os\" title=\"os\" src=\"/static/8899fcdb131df900902558feb87eaaf1/37523/os-1.png\" srcset=\"/static/8899fcdb131df900902558feb87eaaf1/e9ff0/os-1.png 180w,\n/static/8899fcdb131df900902558feb87eaaf1/f21e7/os-1.png 360w,\n/static/8899fcdb131df900902558feb87eaaf1/37523/os-1.png 720w,\n/static/8899fcdb131df900902558feb87eaaf1/00d43/os-1.png 1000w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>운영체제에서 자원을 관리하는 핵심은 <code class=\"language-text\">kernel</code>(커널)에서 담당한다. application(응용 프로그램)에서는 resource에 접근하기 위해 kernel을 통해야(커널 모드) 하며, 이는 <code class=\"language-text\">system call</code>을 호출하여 가능한 것이다. 예를 들어, C언어에서 표준 쉘 입출력에 사용되는 <code class=\"language-text\">printf</code>함수는 OS의 입출력을 담당하는 어떠한 시스템 콜을 호출할 것이다.</p>\n<p>커널은 자원(장치)을 driver를 통해 장치를 독점하는 것처럼 가상화하여 접근한다. driver는 하드웨어마다 달라 이미 OS에 구현이 되어있을수도 있고, 추가적으로 설치하거나 업데이트해야할 수도 있다. 또한, 드라이버는 커널 내부에 구현이 되어 있어 커널에서 바로 접근할 수도 있다.</p>\n<h1 id=\"운영체제의-3가지-개념\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EC%9D%98-3%EA%B0%80%EC%A7%80-%EA%B0%9C%EB%85%90\" aria-label=\"운영체제의 3가지 개념 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영체제의 3가지 개념</h1>\n<p><code class=\"language-text\">OSTEP</code>이라는 책에서는 OS에서 가장 중요한 개념으로 <code class=\"language-text\">Virtualization</code>, <code class=\"language-text\">Concurrency</code>, <code class=\"language-text\">Persistence</code>를 언급한다. 간단하게 의미를 생각해보면서 운영체제 복습을 본격적으로 시작해보자.</p>\n<ol>\n<li>\n<p>Virtualization(가상화)</p>\n<ol>\n<li>\n<p>CPU 가상화</p>\n<p>Processor(CPU)가 하나여도 동시에 여러 프로그램을 실행할 수 있다! CPU는 한번에 한가지 일만 처리한다고 배웠는데, 마치 많은 수의 가상의 CPU가 존재하는 듯한 illusion이 보인다. 이를 CPU 가상화라고 하며, 프로세스를 실행하고 멈추고 어떤 프로세스를 선택할 지 등을 OS가 선택하기 위해서는 많은 규칙들이 존재하며 이것을 배울 필요가 있다.</p>\n</li>\n<li>\n<p>메모리 가상화</p>\n<p>메모리 역시 process가 하나의 독립적인 메모리 주소를 보장받아서 사용하는 것처럼  보이는데, 이는 Memory virtualization이 되어있기 때문이다. 이러한 가상화를 통하여 OS는 목표(편리하고 안전하고 효율적으로 자원을 관리)를 달성할 수 있게 된다.</p>\n</li>\n</ol>\n</li>\n<li>\n<p>Concurrency(동시성)</p>\n<p>Process는 동시에 많은 일들을 처리하기 위해 <code class=\"language-text\">Thread</code>를 만들어서 처리한다. 이러한 multi thread환경에서는 공유되는 데이터를 정말 잘 공유하는 것처럼 보여야 동시성이 만족되는 것으로 보인다. 동시성을 활용하여 작업단위를 분할하고 병렬로 처리할 수 있게 된다.</p>\n</li>\n<li>\n<p>Persistence(영속성)</p>\n<p>메모리와 달리 보조 기억 장치는 컴퓨터가 종료되더라도 데이터가 남아있는다. 이는 <code class=\"language-text\">file system</code>으로 디스크 등의 저장장치가 추상화되어 구현되어있기 때문이다. 하지만 저장장치와의 I/O는 별도의 가상화를 거치지 않으며 영속적으로 데이터를 관리할 필요가 있다.</p>\n</li>\n</ol>\n<h2 id=\"운영체제의-목표\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EC%9D%98-%EB%AA%A9%ED%91%9C\" aria-label=\"운영체제의 목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영체제의 목표</h2>\n<p>운영체제의 목표에 대하여 구체적으로 생각해보자. 해당 내용은 OSTEP의 번역본에서 발췌했다.</p>\n<p>가장 기본적인 목표는 시스템을 편리하고 사용하기 쉽게 만드는 데 필요한 <code class=\"language-text\">개념</code>(abstraciton)들을 정의하는 것이다. 해당 추상화로 많은 것들을 직접 구현하고 생각하지 않아도 된다.</p>\n<p>다음으로는 <code class=\"language-text\">성능</code>이다. 성능은 주로 minimize overhead에 초점을 맞춘다. silver bullet은 없으므로, 최대한의 절충안을 찾아서 가야할 것이다.</p>\n<p>또한, OS와 프로그램, 혹은 프로그램들 간의 <code class=\"language-text\">보호</code>이다. 각 프로세스들은 다른 프로세스들로부터 고립(isolation)되어있어야 하며, 이는 보호의 핵심이다.</p>\n<p>그리고, <code class=\"language-text\">신뢰성</code>이다. 운영체제는 컴퓨터의 실행과 동시에 계속 실행중이여야하므로, 높은 신뢰성을 제공해야 한다. 추가적으로 에너지 효율성, 보안, 네트워크에서의 이동성 등이 있다.</p>\n<p>위의 목표를 달성하기 위해 우리는 운영체제가 어떤 기능들이 제공되고, 어떤 고민들을 해서 만들어졌는지 공부해볼 필요가 있다!</p>\n<p>우리는 운영체제 개발자가 아니지만, 보통 운영체제 위에서 돌아가는 프로그램을 만드므로 운영체제를 알아야 할 것이다.</p>\n<h3 id=\"출처\" style=\"position:relative;\"><a href=\"#%EC%B6%9C%EC%B2%98\" aria-label=\"출처 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>출처</h3>\n<p><a href=\"https://pages.cs.wisc.edu/~remzi/OSTEP/\">OSTEP</a></p>\n<p>쉽게 배우는 운영체제 ‘조성호’</p>","frontmatter":{"date":"June 26, 2022","title":"(OS) 운영체제 복습 [1. 운영체제의 개요]","categories":"OS","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/OS(1)-intro/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Django(12)/","nextSlug":"/Alg-Dijkstra/","prevSlug":"/OS(1)-intro/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}