{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Django(3)-model/",
    "result": {"data":{"cur":{"id":"e34e2492-ff4f-5260-be49-839350a0dc0e","html":"<h2 id=\"장고-모델\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%EB%AA%A8%EB%8D%B8\" aria-label=\"장고 모델 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 모델</h2>\n<p>저번에는 localhost:8000/item/ 를 브라우저에 입력하면 응답하도록 하였다. 이번에는 item <strong>model</strong>을 정의하고, 이를 DB에 적용(<strong>migrate</strong>)시켜보자.</p>\n<p>django에서 제공하는 model은 우리가 다루는 데이터의 객체를 의미한다고 볼 수 있고, 하나의 모델 클래스는 관계형 DB에서의 한 table이라고 볼 수 있다. 우리 프로젝트에서 다루는 ”상품”을 정의해보자.</p>\n<h2 id=\"item-모델-정의\" style=\"position:relative;\"><a href=\"#item-%EB%AA%A8%EB%8D%B8-%EC%A0%95%EC%9D%98\" aria-label=\"item 모델 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>item 모델 정의</h2>\n<table>\n<thead>\n<tr>\n<th>field</th>\n<th>type(mysql)</th>\n<th>info</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>item_id(pk)</td>\n<td>auto increment int</td>\n<td>상품코드(1부터 증가)</td>\n</tr>\n<tr>\n<td>name</td>\n<td>varchar</td>\n<td>상품명</td>\n</tr>\n<tr>\n<td>price</td>\n<td>int(positive)</td>\n<td>상품가격</td>\n</tr>\n<tr>\n<td>stock_count</td>\n<td>int(positive)</td>\n<td>현재 상품의 남은 수량</td>\n</tr>\n</tbody>\n</table>\n<p>우선 간단하게 이정도만 정의해보도록 하자. 이러한 필드들은 언제든지 수정이 가능하며, 충돌이 생긴다면 이에 대한 해결책을 제시해주는 것도 장고의 장점이다!</p>\n<p>위의 모델을 만들기 위해서는 item/models.py 로 가서 클래스를 아래와 같이 추가해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    item_id <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span><span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span><span class=\"token punctuation\">)</span>\n    stock_count <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'item'</span>\n        verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'상품'</span>\n        verbose_name_plural <span class=\"token operator\">=</span> <span class=\"token string\">'상품들'</span>\n</code></pre></div>\n<p>verbose_name은 설명이라고 보면 되고, db의 column_name도 <code class=\"language-text\">db_column=</code> 파라미터로 수정이 가능하다.!</p>\n<p>위의 타입들은 <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/fields/\">공식문서</a>를 참고하여 작성이 가능하다. pk의 경우에는 지정하지 않아도 table에 생성해주지만 이렇게도 생성해줄 수 있다. 외래키, 장고에서만 존재하는 OneToOneField 등 다양한 방법으로 참조타입 역시 구현할 수 있으므로 참고하도록 한다.</p>\n<p>장고의 모델은 DB의 테이블과 매칭되기에, 테이블의 schema에 개입할 수 있도록 <strong>다양한 커스텀 옵션</strong> 또한 주어진다. 대표적으로, verbose_name, column_name, table_name 등이 있으며 이는 검색하여 찾아볼 수 있다.</p>\n<p>직관적으로 <u>DB를 추상화하여(sql등의 DB코드 없이) 다룰 수 있지만, 이에 대한 trade-off로 framework의 문법과 구성을 이해해야 한다는 단점</u>이 있을 것이다. 하지만 익숙해진다면 (유지보수나 보안 측면에서 검증된 코드이므로) 더 편하게 개발할 수 있을 것이라 믿는다.</p>\n<p>다음에는 정의한 모델을 DB에 반영하는 migration에 대하여 알아보도록 하자.</p>","excerpt":"장고 모델 저번에는 localhost:8000/item/ 를 브라우저에 입력하면 응답하도록 하였다. 이번에는 item model을 정의하고, 이를 DB에 적용(migrate)시켜보자. django에서 제공하는 model은 우리가 다루는 데이터의 객체를 의미한다고 볼 수 있고, 하나의 모델 클래스는 관계형 DB에서의 한 table이라고 볼 수 있다. 우리 프로젝트에서 다루는 ”상품”을 정의해보자. item 모델 정의 field type(mysql) info item_id(pk) auto increment int 상품코드(1부터 증가) name varchar 상품명 price int(positive) 상품가격 stock_count int(positive) 현재 상품의 남은 수량 우선 간단하게 이정도만 정의해보도록 하자. 이러한 필드들은 언제든지 수정이 가능하며, 충돌이 생긴다면 이에 대한 해결책을 제시해주는 것도 장고의 장점이다! 위의 모델을 만들기 위해서는 item/models.py…","frontmatter":{"date":"April 13, 2022","title":"(Django) 장고 api 서버를 이용한 프로젝트 [3 - Django model]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(3)-model/"}},"next":{"id":"712a6369-c9cf-5e78-bf02-5ff42e5f5177","html":"<p>프로젝트를 시작하기에 앞서, 장고에 대하여 개략적으로 알아보고, 첫 장고 앱을 만들어보자!</p>\n<h2 id=\"장고란\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0%EB%9E%80\" aria-label=\"장고란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고란</h2>\n<p>장고는 간단하고 빠르게 웹 서비스를 구현할 수 있는 파이썬 기반의 웹 프레임워크이다.</p>\n<p>다양하고 많은 기능들이 제공되지만, 우리는 프로젝트를 위한 기능들을 위주로 공부한다.</p>\n<p>장고 서버가 http 요청에 대하여 응답을 하는 과정은 다음과 같다.</p>\n<ol>\n<li>urls.py (해당 app과 매핑)</li>\n<li>app의 어떤 기능을 사용할지 매핑</li>\n<li>views.py 에서 로직의 결과를 리턴</li>\n</ol>\n<h2 id=\"장고-세팅\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%EC%84%B8%ED%8C%85\" aria-label=\"장고 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 세팅</h2>\n<p>우선, <code class=\"language-text\">Python</code>이 설치되어 있어야 한다.</p>\n<p>프로젝트를 위한 디렉토리를 만들고, 아래와 같이 수행한다.</p>\n<ol>\n<li>\n<p>가상환경 만들기</p>\n<p>다른 프로젝트들과 충돌이 나지 않게 해당 프로젝트를 위한 virtual environment가 구성되어야 한다. 가상환경에서 python library들을 설치하면 해당 환경에서만 유효한 독립적인 환경을 만들 수 있다.</p>\n<p>(참고로 깃으로 관리한다면 가상환경은 <code class=\"language-text\">.gitignore</code>에다가 넣어놓는 것을 권장함)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python3 -m venv guri-venv\n<span class=\"token operator\">>></span> <span class=\"token builtin class-name\">source</span> guri-venv/bin/activate <span class=\"token comment\">#for mac</span></code></pre></div>\n<p>(guri-venv)로 시작하는 환경이 나온다면 성공한 것이다. 만약 가상환경을 종료하고 싶다면 <code class=\"language-text\">deactivate</code> 해주면 된다.</p>\n</li>\n<li>\n<p>필요한 종속성 라이브러리 설치하기</p>\n<p>우선, django만 설치해도 실행하는데 무리가 없다. 만약, git에서 pull 받아서 사용하고, <code class=\"language-text\">requirements.txt</code>와 같은 종속성 리스트 파일이 존재한다면, <code class=\"language-text\">pip install -r requirements.txt</code> 로 한번에 해당 파일의 라이브러리를 다운 받을 수 있다.</p>\n<p>역으로 현재 리스트를 종속성 리스트 파일로 남기고 싶다면 <code class=\"language-text\">pip freeze </code> 명령어를 이용하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> pip <span class=\"token function\">install</span> django mysqlclient django-environ</code></pre></div>\n<p>mysqlclient는 기본적으로 sqlite인 장고에서 mysql로 바꿔주기 위해서이고, django-environ은 .env 파일에 접근하기 위해서이다. <a href=\"https://django-environ.readthedocs.io/en/latest/quickstart.html\">env 참고</a></p>\n</li>\n<li>\n<p>장고 init</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> django-admin startproject config <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>장고를 설치하였다면, 위와 같이 config라는 프로젝트를 생성할 수 있다.</p>\n</li>\n<li>\n<p>runserver를 이용하여 서버 실행</p>\n<p>가상환경이 activate 된 상태에서 아래 명령어를 입력하면 된다. 뒤의 포트를 명시하지 않으면 default로 8000포트에 열린다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py runserver <span class=\"token number\">0.0</span>.0.0:8080\n\nWatching <span class=\"token keyword\">for</span> <span class=\"token function\">file</span> changes with StatReloader\nPerforming system checks<span class=\"token punctuation\">..</span>.\n\nSystem check identified no issues <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> silenced<span class=\"token punctuation\">)</span>.\n\nYou have <span class=\"token number\">18</span> unapplied migration<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>. Your project may not work properly <span class=\"token keyword\">until</span> you apply the migrations <span class=\"token keyword\">for</span> app<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>: admin, auth, contenttypes, sessions.\nRun <span class=\"token string\">'python manage.py migrate'</span> to apply them.\nApril <span class=\"token number\">11</span>, <span class=\"token number\">2023</span> - <span class=\"token number\">16</span>:07:46\nDjango version <span class=\"token number\">4.2</span>, using settings <span class=\"token string\">'config.settings'</span>\nStarting development server at http://0.0.0.0:8080/\nQuit the server with CONTROL-C.</code></pre></div>\n<p>이렇게 나온다면 장고 시작하기 (경고 메시지가 나오긴 하지만) 성공이다. 브라우저에서 <code class=\"language-text\">localhost:8080</code>으로 들어가면 뭐가 나올 것이다.</p>\n<p>실제 배포환경에서는 <code class=\"language-text\">runserver</code>를 이용하진 않는다고 한다. react js에서 <code class=\"language-text\">npm start</code>로 배포하지 않듯, 배포에 최적화된 <code class=\"language-text\">gunicorn</code> 이나 <code class=\"language-text\">uwsgi</code>등의 웹서버를 이용한다고 한다. 하지만 개발단계에서는 debugging 등을 위하여 runserver 커맨드로 개발하도록 하자.</p>\n</li>\n</ol>\n<h3 id=\"환경변수-세팅\" style=\"position:relative;\"><a href=\"#%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%B8%ED%8C%85\" aria-label=\"환경변수 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>환경변수 세팅</h3>\n<p>django-environ을 이용하여 환경변수를 세팅해준다. manage.py가 있는 루트 디렉토리에 <code class=\"language-text\">.env</code>파일을 만들고, key=value를 공백없이 적어주면 된다.</p>\n<p>그리고, settings.py에 아래를 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> environ\n\n<span class=\"token comment\"># Build paths inside the project like this: BASE_DIR / 'subdir'.</span>\nBASE_DIR <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">(</span>__file__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">.</span>parent\n\n<span class=\"token comment\"># for django-environ</span>\nenv <span class=\"token operator\">=</span> environ<span class=\"token punctuation\">.</span>Env<span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># set casting, default value</span>\n    DEBUG<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\nenviron<span class=\"token punctuation\">.</span>Env<span class=\"token punctuation\">.</span>read_env<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_DIR<span class=\"token punctuation\">,</span> <span class=\"token string\">'.env'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이후에는 env(‘key_name’)으로 가져와서 사용할 수 있다.</p>\n<h3 id=\"db-세팅\" style=\"position:relative;\"><a href=\"#db-%EC%84%B8%ED%8C%85\" aria-label=\"db 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB 세팅</h3>\n<p>기본적으로 sqlite 서버를 사용하지만, 나는 <code class=\"language-text\">mysql</code>을 사용할 것이다(이유는 익숙하고 관리하기가 편해서…) maria db를 사용해도 엔진은 같으므로 아래와 같이 바꿔주면 된다. 우선, config/settings.py에 가서 DATABASES= { … }라고 적혀있는 곳을 수정하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">DATABASES <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'default'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'ENGINE'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'django.db.backends.mysql'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'NAME'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_NANE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'USER'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_USER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PASSWORD'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_PW'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'HOST'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_HOST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PORT'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_PORT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>참고로, 해당 이름의 DB는 먼저 만들어져있어야 할 것이다.</p>\n<h2 id=\"app-추가하기\" style=\"position:relative;\"><a href=\"#app-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" aria-label=\"app 추가하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>app 추가하기</h2>\n<p>쇼핑몰을 만들기 위해, 가장 기본이 되는 상품(item)에 대한 기능을 만들어보자.</p>\n<p>장고에서는 독립적인 기능을 수행하거나, 독립적인 모델(model)에 대하여 별개의 app을 만들어서 수행하도록 한다. 앱을 만들기 위해서는 <code class=\"language-text\">python manage.py startapp {app_name}</code>과 같이 만들 수 있다. item 앱을 만들어보자!</p>\n<h2 id=\"장고-훑어보기\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%ED%9B%91%EC%96%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"장고 훑어보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 훑어보기</h2>\n<p>큰 구조는 아래와 같다. 우리는 startproject로 메인 앱인 config를 생성하였다. 여기서 프로젝트의 기본 세팅등을 해줄 수 있다고 보면 된다. 또한, 8080포트로 오는 request는 <code class=\"language-text\">config/urls.py</code>에서 부터 시작한다고 보면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">├── config\n│   ├── __init__.py\n│   ├── __pycache__\n│   ├── asgi.py\n│   ├── settings.py\n│   ├── urls.py\n│   └── wsgi.py\n├── item\n│   ├── __init__.py\n│   ├── admin.py\n│   ├── apps.py\n│   ├── migrations\n│   ├── models.py\n│   ├── tests.py\n│   └── views.py\n├── manage.py\n└── guri-venv</code></pre></div>\n<p>config의 url.py에서 요청에 따라 각 앱의 서비스로 연결시켜주면 된다. (url은 Controller와 유사한 역할이라고 볼 수 있음)</p>\n<p>이제 app의 구조를 살펴보자.</p>\n<ul>\n<li>apps.py : app의 설정</li>\n<li>models.py : app에서 정의하는 모델에 대한 내용</li>\n<li>views.py : 해당 앱으로 request가 들어왔을 때, 이를 처리하는 부분 (View에 대응)</li>\n<li>admin.py : 관리자 페이지로 접근했을 때의 내용</li>\n<li>tests.py : 테스트시 사용</li>\n<li>migrations : models.py의 내용을 DB로 변환할 때 필요한 부분</li>\n</ul>\n<p>가장 중요한 부분은 <strong>해당 기능을 위한 models을 정의하고, 이를 view에서 처리하여 응답하는 것이다.</strong> 장고에서는 모델을 정의하여 DB와 일치시키도록 할 수 있으며, 이를 <code class=\"language-text\">migrate</code>라고 한다. 또한, 장고에서 제공하는 관리자 페이지에서 model을 CRUD하기 위해 admin.py가 존재한다.</p>\n<h2 id=\"app-연결하고-테스트해보기\" style=\"position:relative;\"><a href=\"#app-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B3%A0-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"app 연결하고 테스트해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>app 연결하고 테스트해보기</h2>\n<p>conf/urls.py 에서 요청에 대하여 처리를 해주는데, 이를 item앱으로 연결시켜주자.</p>\n<ol>\n<li>\n<p>installed app에 추가</p>\n<p>우선, settings.py에서 앱을 추가해줘야 한다. 앞으로도 startapp으로 앱을 만들고, INSTALLED_APPS에 추가해주도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">INSTALLED_APPS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'django.contrib.admin'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.auth'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.contenttypes'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.sessions'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.messages'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.staticfiles'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'item.apps.ItemConfig'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># or just 'item'</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>app 이름 또는 apps.py에 있는 config class이름을 넣어줘도 된다. <strong>추가할 때 컴마(,)를 잊지 않도록 하자!</strong></p>\n</li>\n<li>\n<p>urls.py 수정</p>\n<p>config/urls.py에 아래와 같이 수정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib <span class=\"token keyword\">import</span> admin\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path<span class=\"token punctuation\">,</span> include\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'admin/'</span><span class=\"token punctuation\">,</span> admin<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'item/'</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span><span class=\"token string\">'item.urls'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p>item/urls.py 생성</p>\n<p>item/urls.py를 만들고, 아래와 같이 작성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p>item/views.py 수정</p>\n<p>위에서 해준 라우팅 처리를 받아줄 view 함수를 만들어준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>http <span class=\"token keyword\">import</span> JsonResponse\n<span class=\"token comment\"># Create your views here.</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'info'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'hello'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<p>이러고 localhost:8000/item을 브라우저에 입력하면 위의 응답결과가 나오는 것을 확인할 수 있다. 참고로 view 함수는 request를 첫번째 인자로 받도록 한다.</p>\n<p>오늘은 url 입력에 대하여 response를 주는 흐름을 그려보았다. 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/aa366d767b3eb62bd25041d7d5c2bebbff34aae0\">이곳</a>을 참고하면 된다.</p>","frontmatter":{"date":"April 12, 2022","title":"(Django) 장고 api 서버를 이용한 프로젝트 [2-django 기초]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(2)-django-intro/"}},"prev":{"id":"edcd3751-d5fc-5f9a-9826-0c0da687ecfa","html":"<p>저번까지는 model의 구조를 DB schema에 적용하는 migration을 알아보았다. 오늘은 데이터를 저장하고, 저장된 데이터를 가져와서 사용할 때 필요한 개념인 <strong>직렬화</strong>에 대하여 알아보자! 어렵지만 이해를 해야 다음으로 넘어갈 수 있으니 매우 중요하다고 볼 수 있다.</p>\n<h1 id=\"drf-serializer\" style=\"position:relative;\"><a href=\"#drf-serializer\" aria-label=\"drf serializer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DRF Serializer</h1>\n<p>장고에는 기본적으로 <code class=\"language-text\">forms</code>이라는 것이 있지만, 앞으로는 DRF(Django Rest Framework)에서 제공하는 <code class=\"language-text\">serializers</code>를 사용할 예정이다.</p>\n<blockquote>\n<p>DRF를 사용하는 이유</p>\n<ol>\n<li>REST api 서버를 구성하기 위해 초점이 맞춰진 기능들이 많음</li>\n<li>장고보다 코드의 중복을 줄이는 몇가지 클래스들이 제공됨</li>\n</ol>\n</blockquote>\n<p>우선 가상환경에 DRF를 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> pip <span class=\"token function\">install</span> djangorestframework</code></pre></div>\n<p>그리고, settings.py의 INSTALLED_APPS에서 <code class=\"language-text\">'rest_framework'</code>를 추가해준다.</p>\n<p>참고로, INSTALLED_APPS에는 pip로 설치해준 것도 추가해야할 경우가 있고, manage.py startapp 등으로 만든 appConfig의 name도 들어가야한다. (모든 pip 모듈을 적어주는 것은 아니므로 해당 라이브러리의 공식문서를 참고)</p>\n<h2 id=\"db에서-json까지의-과정\" style=\"position:relative;\"><a href=\"#db%EC%97%90%EC%84%9C-json%EA%B9%8C%EC%A7%80%EC%9D%98-%EA%B3%BC%EC%A0%95\" aria-label=\"db에서 json까지의 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB에서 JSON까지의 과정</h2>\n<p>클라이언트는 요청을 보내고, 서버는 이에 알맞은 응답을 보내는데, 이때 클라이언트와 서버는 HTTP body에 JSON데이터를 주고 받는다. 장고의 모델과 ORM에서 이를 직접 다룰 수 없으므로, 장고에서 사용할 수 있도록 변환하는 과정이 필요하다.</p>\n<p><strong>DB ↔ QuerySet ↔ OrderdDict ↔ JSON</strong></p>\n<p>QuerySet과 OrderedDict는 python class이며, <strong>최종 목표는 JSON과 DB사이를 연결해주는 것</strong>이다. DRF의 <code class=\"language-text\">serializer</code>는 직렬화와 역직렬화(deserialization)를 도와주는 클래스인 것이다. item/serializers.py를 만들어주자. 해당 파일에는 item과 관련한 serializing 기능을 지원하는 클래스가 들어갈 것이다.</p>\n<p>우선 가장 간단한 ModelSerializer를 이용해보자!</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span> <span class=\"token comment\"># 아이템의 모든 필드를 serialize해줄 것임</span></code></pre></div>\n<h2 id=\"db-to-json\" style=\"position:relative;\"><a href=\"#db-to-json\" aria-label=\"db to json permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB to JSON</h2>\n<p>item/views.py 에서 처음 만들었던 index 함수를 item의 리스트를 반환하는 함수로 수정해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>response <span class=\"token keyword\">import</span> Response\n<span class=\"token keyword\">from</span> rest_framework<span class=\"token punctuation\">.</span>decorators <span class=\"token keyword\">import</span> api_view\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> ItemSerializer\n\n<span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># serialize</span>\n    items <span class=\"token operator\">=</span> Item<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># return QuerySet(not yet query)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">)</span>\n    itemSerializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">,</span> many<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># return OrderedDict</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span></code></pre></div>\n<p>우선 Request와 Response를 위와 같이 DRF에서 사용하는 방법으로 바꿔주자. (이는 다음에 자세히 알아볼 예정)</p>\n<ul>\n<li>\n<p>@api_view([‘GET’]) &#x26; Response</p>\n<p>http get request를 처리하는 View함수에 달 수 있는 데코레이터이다. 이후 적절하게 Response를 해줘야 한다. (DRF에서 사용하는 방법)</p>\n</li>\n<li>\n<p>Item.objects.all()</p>\n<p>장고에서 model을 통해 DB에 접근할 때 사용하는 Manager가 기본적으로 <code class=\"language-text\">objects</code>이다. 따라서, DB manager 혹은 accesser 정도의 역할로만 알고 있어도 일단은 ok.</p>\n<p>manager에서 all 함수는 <code class=\"language-text\">select *</code>과 같은 의미로 결과로 <strong>QuerySet이 리턴된다.</strong></p>\n<p>참고로 QuerySet은 아직 DB query가 실행되지는 않은 상태이다.</p>\n</li>\n<li>\n<p>ItemSerializer(items, many=True)</p>\n<p>사전에 정의한 시리얼라이저의 인자에다가 <code class=\"language-text\">QuerySet</code>을 넣어주고, <code class=\"language-text\">many=True</code> 옵션을 주면 이를 OrderedDict의 list로 반환해준다.</p>\n</li>\n<li>\n<p>serializer.data</p>\n<p>queryset의 데이터에 접근하여 직렬화된 자료구조를 리턴한다.</p>\n</li>\n</ul>\n<p>이제, localhost:8000/item/에 접근해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Iphone G14\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1500000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Galaxy X25\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1450000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"stock_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">120</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>저번 포스트에서 2개의 item을 추가했으므로 잘 나오는 것을 볼 수 있다👏👏</p>\n<p>콘솔에는 다음과 같이 프린트 되어있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">&lt;</span>QuerySet <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span>, <span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n\nItemSerializer<span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>QuerySet <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span>, <span class=\"token operator\">&lt;</span>Item: Item object <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>, <span class=\"token assign-left variable\">many</span><span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span>:\n    item_id <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span>, <span class=\"token assign-left variable\">read_only</span><span class=\"token operator\">=</span>True<span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> CharField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span>, <span class=\"token assign-left variable\">max_length</span><span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span>, <span class=\"token assign-left variable\">max_value</span><span class=\"token operator\">=</span><span class=\"token number\">4294967295</span>, <span class=\"token assign-left variable\">min_value</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    stock_count <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span>, <span class=\"token assign-left variable\">max_value</span><span class=\"token operator\">=</span><span class=\"token number\">4294967295</span>, <span class=\"token assign-left variable\">min_value</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span>, <span class=\"token string\">'Iphone G14'</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span>, <span class=\"token number\">1500000</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span>, <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>, OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span>, <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span>, <span class=\"token string\">'Galaxy X25'</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span>, <span class=\"token number\">1450000</span><span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span>, <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><code class=\"language-text\">ModelSerializer</code>로 정의했고, fields에 <code class=\"language-text\">__all__</code>을 적어주어 자동으로 시리얼라이저의 필드들이 위와 같이 들어가 있는 것을 볼 수 있다. 또한, 아직 serailizer.data로 접근하지 않은 상태에서는 <strong>QuerySet으로 남아있고, 실제 쿼리문이 실행되지는 않은 상태</strong>이다. 즉, QuerySet에서 실제 데이터와 관련된 접근이 일어날 때에만 query가 수행되는 <code class=\"language-text\">lazy</code>한 특성을 보인다.</p>\n<p>또한 Response 함수를 이용하면 ordered dict의 배열을 JSON 형식으로 바꿔서 응답해주는 것으로 보인다. 만약, ordered dict 형태에서 우리가 데이터를 JSON으로 직접 바꿔야 할 필요가 있다면 <code class=\"language-text\">JSONRenderer().render(serializer.data)</code>로 변환해줄 수 있다. (<code class=\"language-text\">from rest_framework.renderers import JSONRenderer</code>로 임포트 후 사용가능)</p>\n<p>다시 직렬화로 돌아와 과정을 정리해보면,</p>\n<blockquote>\n<p>DB instance → <code class=\"language-text\">{model}.objects.all()</code> → QuerySet → <code class=\"language-text\">Serializer(queryset)</code> → OrderedDict → JSON</p>\n</blockquote>\n<p>이라고 볼 수 있다.!</p>\n<h2 id=\"json-to-db\" style=\"position:relative;\"><a href=\"#json-to-db\" aria-label=\"json to db permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JSON to DB</h2>\n<p>이제는 데이터를 DB에 저장하는 코드를 만들어보자.</p>\n<p>POST 요청에 대하여 새로운 item을 만드는 api를 만들어본다. drf에서 body는 <code class=\"language-text\">request.data</code>를 이용하여 받을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@api_view</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_item</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    itemSerializer <span class=\"token operator\">=</span> ItemSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>request<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> itemSerializer<span class=\"token punctuation\">.</span>is_valid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># need to call .is_valid() before .save()</span>\n        itemSerializer<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> Response<span class=\"token punctuation\">(</span>itemSerializer<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">)</span> <span class=\"token comment\"># error occured</span></code></pre></div>\n<p>JSON 데이터를 장고에서 사용하기 위해서도 serializer class를 이용하면 된다. 여기서는 인자로 data를 넘겨주면 된다.</p>\n<p>주의해야할 점은, <code class=\"language-text\">is_valid()</code>를 호출하고 <code class=\"language-text\">save()</code> method를 호출해야한다는 점이다. 그렇지 않다면 <code class=\"language-text\">AssertionError: You must call .is_valid() before calling .save().</code> 에러가 나올 것이다. 왜냐하면, save() 메소드는 <code class=\"language-text\">serailizer.validated_data</code>가 들어가야 하는데, 이는 <strong>is_valid()가 수행되어야 <code class=\"language-text\">initial_data</code>와 <code class=\"language-text\">validated_data</code>가 초기화되기</strong> 때문이다.</p>\n<p>만약 데이터가 유효하지 않다면 ModelSerializer 클래스에서 <code class=\"language-text\">serilaizers.ValidationError</code>를 throw 할 것이다.</p>\n<p><code class=\"language-text\">postman</code>으로 테스트해보자. (브라우저에서 하려면 CORS를 해결해야함)</p>\n<ol>\n<li>\n<p>정상 케이스</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 72.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABwUlEQVQ4y41TWbKcMAzkJAHv+wKTqSFD5SP3P1SnJIbJo/J4yUdbsstqJHczbNuGGCNCCGitYV3XN7bnhsfjgfWxopTCdw4cNR8jYSAS5xwfppS4kFBbQy4ZtVaU3uCDPxEeNRSJiKK1FgMtUko+8N5zrrXm/JsSaMHj1gImKeCcf5MopZhACMGEWkmM44hhnme+1HtHax05Z+5w3zcs87wjR/RaEFMC1dAH53nB99sCZQNUfkBIhcEYAwJ1doC+Sh2cIU97uvcnV5BK89lA40kpEEpDbAtKdPhx78jB8fk0TScIcY5HLjiKvUNKfG5I8x2pdbSlw3nLb0IF4/j/4A5jdEjJIkWLlBxioNxxTsjJv+D+Ce4wsCUcco6IOcBGi5wi7723rKDWEsYoaK1gjL7E8OvnhlIrq0vyk//Cy6y9z2yRw2tKaXhrICZxPfLz+cRuHQ9rDBI5PkQ479g+REaGJ4OT72oMUFK+xBB/YaCFza0NbEhQ2rBiuxjjO34U6CD7jJTfcJpGpL4gL3fUHLDeGpLf/6Dpky6uyJiQVCbT+lzZh7FUtKXBOntZ9BUGUs17x26ncXlk/mPEl6NdEf4GKIex+dMgtoUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"postman1\" title=\"postman1\" src=\"/static/66bcc081e719e2c6f893d9639b0d1b6e/37523/postman1.png\" srcset=\"/static/66bcc081e719e2c6f893d9639b0d1b6e/e9ff0/postman1.png 180w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/f21e7/postman1.png 360w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/37523/postman1.png 720w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/302a4/postman1.png 1080w,\n/static/66bcc081e719e2c6f893d9639b0d1b6e/636d3/postman1.png 1222w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>item_id는 auto_increment이므로 값을 넣지 않도록 한다.</p>\n<p>DB를 직접 확인해보거나, 관리자 페이지에 접근해보면 데이터가 잘 들어가있음을 확인할 수 있다!</p>\n</li>\n<li>\n<p>에러 케이스</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpUlEQVQ4y41TSZLcMAzTS7xKpBZr8TKpHKb//yykSLs9mar0pA8oiTIJEhJsjuOA9x4hBNRasW2bYhfsu+7X1uBDuPN+gnkSxhjRWlMSORMo4XGgret/iYRDYJxzmOdZA2bGMAwgIlgmdGOPoyQQz5hmexV7WGvxrJPc4BlD32utKaUomciVvRTJWmpFzhkf24pWMlqKWFLSbyklzRMV0mAKKyaKJ6GQSRcip5DuErOeEYgZTmOnU9F1LnlS65zFZBmTdZimCUbGHscRFDOcj1iCR4kebC26vkf/EgO67lxV7lOydnUWMRek2pBywbJEMMsdTbD2L8z/2M9fkHwjY+bsUYtHyXyinHGtAa1FrC3q+g4MOXfeBRFiiKDoYdnddpDr6C85wzAq5OwVzO+PA2lZboKYElh8GQKWJelD3A/nHNhZJR/H4WryHebxeKhlxNjiw6d1xBqtViUSw6tVmBGZ0Cvhiwn1hZkwOwaxvzuLzK7vNP6SPFzT/SBZ/CRPb4kR5F8lB++s2iYxgeys39+FEUmfn79w7An7lnDsyzfsgi29jT8p0phyUNk/4gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"postman2\" title=\"postman2\" src=\"/static/485b5278e4c4b9bd41461d14f1b939bd/37523/postman2.png\" srcset=\"/static/485b5278e4c4b9bd41461d14f1b939bd/e9ff0/postman2.png 180w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/f21e7/postman2.png 360w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/37523/postman2.png 720w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/302a4/postman2.png 1080w,\n/static/485b5278e4c4b9bd41461d14f1b939bd/f09ab/postman2.png 1250w\" sizes=\"(max-width: 720px) 100vw, 720px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>이 경우는 price 필드를 빼고 요청을 보냈을 때의 결과이다. 우리가 사용한 ModelSerializer를 이용하면 이런 생성(create), 검증(is_valid), 그리고 업데이트(update)까지 기본적으로 지원한다!</p>\n<p>아, 그리고 아직은 status code를 넣지 않아서 200으로 오는데, 이는 다음에 Request와 Response를 공부하면 알게 될 것이다.</p>\n</li>\n</ol>\n<h2 id=\"그래서-serializer의-역할은\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-serializer%EC%9D%98-%EC%97%AD%ED%95%A0%EC%9D%80\" aria-label=\"그래서 serializer의 역할은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 Serializer의 역할은?</h2>\n<p>그래서 serializer는 크게 두가지의 역할을 수행한다고 볼 수 있다.</p>\n<ol>\n<li>\n<p>model to JSON &#x26; JSON to model</p>\n<p>각각 직렬화와 역직렬화에 해당하는 내용이다.</p>\n</li>\n<li>\n<p>validation</p>\n<p>DB에 값을 변경할 때에도 Serializer가 사용된다. is_valid()와 save() 메소드로 DB값을 쉽게 변경할 수 있도록 도움을 준다.</p>\n</li>\n</ol>\n<h2 id=\"serializer-커스텀하기\" style=\"position:relative;\"><a href=\"#serializer-%EC%BB%A4%EC%8A%A4%ED%85%80%ED%95%98%EA%B8%B0\" aria-label=\"serializer 커스텀하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serializer 커스텀하기</h2>\n<p>우리는 시리얼라이저를 간단하게 구현하기 위해 <strong>ModelSerializer</strong> 클래스를 상속받아 구현하였다. 이를 커스텀하여 사용할 수도 있다.</p>\n<ol>\n<li>\n<p>Field custom</p>\n<p>우리는 fields에 <code class=\"language-text\">__all__</code>로 모든 model의 필드를 받았지만, 이를 커스텀할 수 있다. model에 있는 필드의 경우에는 문자열 배열의 형태로 선언하면 된다. 우리는 <code class=\"language-text\">['name', 'price', 'stock_count']</code>로 바꿔볼 수 있을 것이다.</p>\n<p>또한, 모델에는 없는데 필요한 새로운 필드가 필요한 경우가 있다. 이는 <code class=\"language-text\">SerializerMethodField()</code>에 대하여 검색해보자.</p>\n</li>\n<li>\n<p>Validation custom</p>\n<p>data를 검사하는 별개의 로직이 있는 경우에는 serializer 내부에 <code class=\"language-text\">validate(self, data)</code>함수를 오버라이드 하면 된다. 예를 들어, 우리는 price(가격)는 0보다 커야하고, stock_count(재고)는 0이상이여야 한다.</p>\n<p>(<code class=\"language-text\">PositiveIntegerField</code>로 정의되어있긴 하지만 그래도 예외처리를 해보자)</p>\n<p>만약 특정 필드에 대한 validation만 수행하고 싶다면, <code class=\"language-text\">validate_{field}</code> 꼴로 함수를 만들어주면 된다. 다음은 가격이 0인 경우에 에러를 발생시켜주는 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ItemSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Item\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">\"__all__\"</span> <span class=\"token comment\"># 아이템의 모든 필드를 serialize해줄 것임</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">validate_price</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> value <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> serializers<span class=\"token punctuation\">.</span>ValidationError<span class=\"token punctuation\">(</span><span class=\"token string\">\"price must be positive\"</span><span class=\"token punctuation\">)</span> \n        <span class=\"token keyword\">return</span> value</code></pre></div>\n<p>하지만 이 경우에는 기본적으로 Serializer(not ModelSerializer)가 validation을 해주므로, 0인 경우만 처리하면 될 것이다.</p>\n<p>또한, model instance를 생성하는 시점에 validation을 해주는 방법도 있다는 것 같으니, 찾아봐야겠다.</p>\n</li>\n<li>\n<p>create &#x26; update custom</p>\n<p>ModelSerializer 클래스는 기본적으로 create와 update를 제공하지만, 이를 수정하고 싶을때에는 <code class=\"language-text\">create(self, validated_data)</code> 또는 <code class=\"language-text\">update(self, validated_data)</code> 함수를 오버라이딩 해주면 된다. (여기에 인자로 오는 데이터는 is_valid 이후에 온 validated_data이다)</p>\n</li>\n</ol>\n<p>또한, 그냥 Serializer 클래스를 상속받아서 자유도가 높은 시리얼라이저도 만들 수 있다. 다만, 이 경우에는 필드부터 많은 것들을 직접 구현해야할 것이므로 적재적소에 활용하도록 하자.</p>\n<h1 id=\"django-orm\" style=\"position:relative;\"><a href=\"#django-orm\" aria-label=\"django orm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Django ORM</h1>\n<blockquote>\n<p>위에서 다루었던, <code class=\"language-text\">Item.objects.all()</code>가 여기에 해당한다</p>\n<p>이게 뭔 말인지 알아보자</p>\n</blockquote>\n<p>이제 Serializer에 대한 개념은 어느정도 알았으니, django에서 제공하는 ORM(Object Relational Mapper)에 대하여 알아보자. (이는 DRF가 아닌 장고에서 제공하는 기능이다) ORM을 이용하여 관계형 DB에 각각 다른 언어들을 몰라도 python 인터페이스로 DB를 다룰 수 있게 된다.</p>\n<p>ORM 역시 DB와 연결되어 있으므로 모델의 CRUD가 가능하지만 Read, Delete만 권장된다. 우리는 client 요청에 대하여 더 간편하고 예외에 대해 반응할 수 있는 Serializer로 C,U를 처리할 수 있다.</p>\n<p>몇개만 알아보자…</p>\n<ul>\n<li>objects.all() : 해당 모델의 모든 데이터를 담는 쿼리셋을 리턴</li>\n<li>objects.order_by(field) : 해당 필드로 정렬</li>\n<li>objects.filter(field = … , ) : 조건에 맞는 쿼리셋을 리턴. 없다면 빈 쿼리셋 리턴(<code class=\"language-text\">queryset.exists()</code>함수로 판단 가능)</li>\n<li>objects.get(field = … , ) : 조건에 맞는 모델 리턴. 없다면 에러 throw</li>\n<li>objects.create(field = …) : 모델을 생성하여 DB에 저장한다</li>\n<li>obejcts.update() : 업데이트</li>\n<li>objects.delete() : 삭제</li>\n</ul>\n<h2 id=\"objects\" style=\"position:relative;\"><a href=\"#objects\" aria-label=\"objects permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>objects??</h2>\n<p>여기서 항상 나오는 것은 <code class=\"language-text\">objects</code>이다! 이는 모델에서 DB에 접근하기 위해 ORM에서 사용되는 <code class=\"language-text\">Manager object</code>이다. 이는 models.Manager 클래스를 상속하여 커스텀이 가능하며, 위의 함수들을 오버라이드할 수 있게 된다. 커스텀 매니저는 model 클래스에서 <code class=\"language-text\">objects= CustomManager()</code>와 같이 바꿔줄 수 있다고 한다. 이는 더 공부가 필요한 부분이다. <a href=\"https://blog.hwahae.co.kr/all/tech/tech-tech/4108\">참고하기</a></p>\n<h2 id=\"queryset\" style=\"position:relative;\"><a href=\"#queryset\" aria-label=\"queryset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>QuerySet</h2>\n<p>objects의 메소드를 통하여 생성되는 (주로 select) 데이터는 <strong>바로 SQL이 실행되지 않고 <code class=\"language-text\">QuerySet</code>객체에 저장되었다가 필요한 순간에만 실제 쿼리가 수행되는 lazy한 구조</strong>를 갖는다. 이유는 DB 접근은 시간이 오래 걸리고, 반복되면 연산에 낭비가 생길 수 있기 때문이다. 추가적으로, 테이블이 복잡해질 경우에는 의미없는 쿼리가 낭비될 수 있으므로(중복 질의) <code class=\"language-text\">selected_related()</code> 등의 JOIN연산을 처리하여 연산을 줄이는 기법도 있다고 한다.</p>\n<p>QuerySet은 우리가 여태 공부한 Serializer에 의하여 직렬화될 수 있는데, 여러 레코드를 포함한 QuerySet이라면 many=True 옵션으로 가져와야 가능하다는 점도 알고 있도록 하자!</p>\n<p>오늘은 장고와 DRF를 이해하는 핵심 기능 중 하나인 Serializing 기법과 django model과 DB를 손쉽게 연결해주는 ORM을 배워봤다. 다음에는 Request와 Response를 더 공부해보도록 하자! 오늘의 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/5554170cdcb9bef18c2b74522144bfbac2cc92c0\">여기</a>를 참고한다.</p>","frontmatter":{"date":"April 14, 2022","title":"(Django) 장고 api 서버를 이용한 프로젝트 [5-serializer와 Django ORM]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(5)-serailizer-django-orm/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Django(3)-model/","nextSlug":"/Django(2)-django-intro/","prevSlug":"/Django(5)-serailizer-django-orm/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}