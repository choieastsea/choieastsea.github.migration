{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Django(3)-model/",
    "result": {"data":{"cur":{"id":"e34e2492-ff4f-5260-be49-839350a0dc0e","html":"<h2 id=\"장고-모델\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%EB%AA%A8%EB%8D%B8\" aria-label=\"장고 모델 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 모델</h2>\n<p>저번에는 localhost:8000/item/ 를 브라우저에 입력하면 응답하도록 하였다. 이번에는 item <strong>model</strong>을 정의하고, 이를 DB에 적용(<strong>migrate</strong>)시켜보자.</p>\n<p>django에서 제공하는 model은 우리가 다루는 데이터의 객체를 의미한다고 볼 수 있고, 하나의 모델 클래스는 관계형 DB에서의 한 table이라고 볼 수 있다. 우리 프로젝트에서 다루는 ”상품”을 정의해보자.</p>\n<h2 id=\"item-모델-정의\" style=\"position:relative;\"><a href=\"#item-%EB%AA%A8%EB%8D%B8-%EC%A0%95%EC%9D%98\" aria-label=\"item 모델 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>item 모델 정의</h2>\n<table>\n<thead>\n<tr>\n<th>field</th>\n<th>type(mysql)</th>\n<th>info</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>item_id(pk)</td>\n<td>auto increment int</td>\n<td>상품코드(1부터 증가)</td>\n</tr>\n<tr>\n<td>name</td>\n<td>varchar</td>\n<td>상품명</td>\n</tr>\n<tr>\n<td>price</td>\n<td>int(positive)</td>\n<td>상품가격</td>\n</tr>\n<tr>\n<td>stock_count</td>\n<td>int(positive)</td>\n<td>현재 상품의 남은 수량</td>\n</tr>\n</tbody>\n</table>\n<p>우선 간단하게 이정도만 정의해보도록 하자. 이러한 필드들은 언제든지 수정이 가능하며, 충돌이 생긴다면 이에 대한 해결책을 제시해주는 것도 장고의 장점이다!</p>\n<p>위의 모델을 만들기 위해서는 item/models.py 로 가서 클래스를 아래와 같이 추가해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Item</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    item_id <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span><span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span><span class=\"token punctuation\">)</span>\n    stock_count <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        db_table <span class=\"token operator\">=</span> <span class=\"token string\">'item'</span>\n        verbose_name <span class=\"token operator\">=</span> <span class=\"token string\">'상품'</span>\n        verbose_name_plural <span class=\"token operator\">=</span> <span class=\"token string\">'상품들'</span>\n</code></pre></div>\n<p>verbose_name은 설명이라고 보면 되고, db의 column_name도 <code class=\"language-text\">db_column=</code> 파라미터로 수정이 가능하다.!</p>\n<p>위의 타입들은 <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/fields/\">공식문서</a>를 참고하여 작성이 가능하다. pk의 경우에는 지정하지 않아도 table에 생성해주지만 이렇게도 생성해줄 수 있다. 외래키, 장고에서만 존재하는 OneToOneField 등 다양한 방법으로 참조타입 역시 구현할 수 있으므로 참고하도록 한다.</p>\n<p>장고의 모델은 DB의 테이블과 매칭되기에, 테이블의 schema에 개입할 수 있도록 <strong>다양한 커스텀 옵션</strong> 또한 주어진다. 대표적으로, verbose_name, column_name, table_name 등이 있으며 이는 검색하여 찾아볼 수 있다.</p>\n<p>직관적으로 <u>DB를 추상화하여(sql등의 DB코드 없이) 다룰 수 있지만, 이에 대한 trade-off로 framework의 문법과 구성을 이해해야 한다는 단점</u>이 있을 것이다. 하지만 익숙해진다면 (유지보수나 보안 측면에서 검증된 코드이므로) 더 편하게 개발할 수 있을 것이라 믿는다.</p>\n<p>다음에는 정의한 모델을 DB에 반영하는 migration에 대하여 알아보도록 하자.</p>","excerpt":"장고 모델 저번에는 localhost:8000/item/ 를 브라우저에 입력하면 응답하도록 하였다. 이번에는 item model을 정의하고, 이를 DB에 적용(migrate)시켜보자. django에서 제공하는 model은 우리가 다루는 데이터의 객체를 의미한다고 볼 수 있고, 하나의 모델 클래스는 관계형 DB에서의 한 table이라고 볼 수 있다. 우리 프로젝트에서 다루는 ”상품”을 정의해보자. item 모델 정의 field type(mysql) info item_id(pk) auto increment int 상품코드(1부터 증가) name varchar 상품명 price int(positive) 상품가격 stock_count int(positive) 현재 상품의 남은 수량 우선 간단하게 이정도만 정의해보도록 하자. 이러한 필드들은 언제든지 수정이 가능하며, 충돌이 생긴다면 이에 대한 해결책을 제시해주는 것도 장고의 장점이다! 위의 모델을 만들기 위해서는 item/models.py…","frontmatter":{"date":"April 13, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [3 - Django model]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(3)-model/"}},"next":{"id":"712a6369-c9cf-5e78-bf02-5ff42e5f5177","html":"<p>프로젝트를 시작하기에 앞서, 장고에 대하여 개략적으로 알아보고, 첫 장고 앱을 만들어보자!</p>\n<h2 id=\"장고란\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0%EB%9E%80\" aria-label=\"장고란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고란</h2>\n<p>장고는 간단하고 빠르게 웹 서비스를 구현할 수 있는 파이썬 기반의 웹 프레임워크이다.</p>\n<p>다양하고 많은 기능들이 제공되지만, 우리는 프로젝트를 위한 기능들을 위주로 공부한다.</p>\n<p>장고 서버가 http 요청에 대하여 응답을 하는 과정은 다음과 같다.</p>\n<ol>\n<li>urls.py (해당 app과 매핑)</li>\n<li>app의 어떤 기능을 사용할지 매핑</li>\n<li>views.py 에서 로직의 결과를 리턴</li>\n</ol>\n<h2 id=\"장고-세팅\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%EC%84%B8%ED%8C%85\" aria-label=\"장고 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 세팅</h2>\n<p>우선, <code class=\"language-text\">Python</code>이 설치되어 있어야 한다.</p>\n<p>프로젝트를 위한 디렉토리를 만들고, 아래와 같이 수행한다.</p>\n<ol>\n<li>\n<p>가상환경 만들기</p>\n<p>다른 프로젝트들과 충돌이 나지 않게 해당 프로젝트를 위한 virtual environment가 구성되어야 한다. 가상환경에서 python library들을 설치하면 해당 환경에서만 유효한 독립적인 환경을 만들 수 있다.</p>\n<p>(참고로 깃으로 관리한다면 가상환경은 <code class=\"language-text\">.gitignore</code>에다가 넣어놓는 것을 권장함)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python3 -m venv guri-venv\n<span class=\"token operator\">>></span> <span class=\"token builtin class-name\">source</span> guri-venv/bin/activate <span class=\"token comment\">#for mac</span></code></pre></div>\n<p>(guri-venv)로 시작하는 환경이 나온다면 성공한 것이다. 만약 가상환경을 종료하고 싶다면 <code class=\"language-text\">deactivate</code> 해주면 된다.</p>\n</li>\n<li>\n<p>필요한 종속성 라이브러리 설치하기</p>\n<p>우선, django만 설치해도 실행하는데 무리가 없다. 만약, git에서 pull 받아서 사용하고, <code class=\"language-text\">requirements.txt</code>와 같은 종속성 리스트 파일이 존재한다면, <code class=\"language-text\">pip install -r requirements.txt</code> 로 한번에 해당 파일의 라이브러리를 다운 받을 수 있다.</p>\n<p>역으로 현재 리스트를 종속성 리스트 파일로 남기고 싶다면 <code class=\"language-text\">pip freeze </code> 명령어를 이용하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> pip <span class=\"token function\">install</span> django mysqlclient django-environ</code></pre></div>\n<p>mysqlclient는 기본적으로 sqlite인 장고에서 mysql로 바꿔주기 위해서이고, django-environ은 .env 파일에 접근하기 위해서이다. <a href=\"https://django-environ.readthedocs.io/en/latest/quickstart.html\">env 참고</a></p>\n</li>\n<li>\n<p>장고 init</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> django-admin startproject config <span class=\"token builtin class-name\">.</span></code></pre></div>\n<p>장고를 설치하였다면, 위와 같이 config라는 프로젝트를 생성할 수 있다.</p>\n</li>\n<li>\n<p>runserver를 이용하여 서버 실행</p>\n<p>가상환경이 activate 된 상태에서 아래 명령어를 입력하면 된다. 뒤의 포트를 명시하지 않으면 default로 8000포트에 열린다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py runserver <span class=\"token number\">0.0</span>.0.0:8080\n\nWatching <span class=\"token keyword\">for</span> <span class=\"token function\">file</span> changes with StatReloader\nPerforming system checks<span class=\"token punctuation\">..</span>.\n\nSystem check identified no issues <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> silenced<span class=\"token punctuation\">)</span>.\n\nYou have <span class=\"token number\">18</span> unapplied migration<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>. Your project may not work properly <span class=\"token keyword\">until</span> you apply the migrations <span class=\"token keyword\">for</span> app<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>: admin, auth, contenttypes, sessions.\nRun <span class=\"token string\">'python manage.py migrate'</span> to apply them.\nApril <span class=\"token number\">11</span>, <span class=\"token number\">2023</span> - <span class=\"token number\">16</span>:07:46\nDjango version <span class=\"token number\">4.2</span>, using settings <span class=\"token string\">'config.settings'</span>\nStarting development server at http://0.0.0.0:8080/\nQuit the server with CONTROL-C.</code></pre></div>\n<p>이렇게 나온다면 장고 시작하기 (경고 메시지가 나오긴 하지만) 성공이다. 브라우저에서 <code class=\"language-text\">localhost:8080</code>으로 들어가면 뭐가 나올 것이다.</p>\n<p>실제 배포환경에서는 <code class=\"language-text\">runserver</code>를 이용하진 않는다고 한다. react js에서 <code class=\"language-text\">npm start</code>로 배포하지 않듯, 배포에 최적화된 <code class=\"language-text\">gunicorn</code> 이나 <code class=\"language-text\">uwsgi</code>등의 웹서버를 이용한다고 한다. 하지만 개발단계에서는 debugging 등을 위하여 runserver 커맨드로 개발하도록 하자.</p>\n</li>\n</ol>\n<h3 id=\"환경변수-세팅\" style=\"position:relative;\"><a href=\"#%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%B8%ED%8C%85\" aria-label=\"환경변수 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>환경변수 세팅</h3>\n<p>django-environ을 이용하여 환경변수를 세팅해준다. manage.py가 있는 루트 디렉토리에 <code class=\"language-text\">.env</code>파일을 만들고, key=value를 공백없이 적어주면 된다.</p>\n<p>그리고, settings.py에 아래를 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">import</span> environ\n\n<span class=\"token comment\"># Build paths inside the project like this: BASE_DIR / 'subdir'.</span>\nBASE_DIR <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">(</span>__file__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">.</span>parent\n\n<span class=\"token comment\"># for django-environ</span>\nenv <span class=\"token operator\">=</span> environ<span class=\"token punctuation\">.</span>Env<span class=\"token punctuation\">(</span>\n    <span class=\"token comment\"># set casting, default value</span>\n    DEBUG<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\nenviron<span class=\"token punctuation\">.</span>Env<span class=\"token punctuation\">.</span>read_env<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_DIR<span class=\"token punctuation\">,</span> <span class=\"token string\">'.env'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이후에는 env(‘key_name’)으로 가져와서 사용할 수 있다.</p>\n<h3 id=\"db-세팅\" style=\"position:relative;\"><a href=\"#db-%EC%84%B8%ED%8C%85\" aria-label=\"db 세팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB 세팅</h3>\n<p>기본적으로 sqlite 서버를 사용하지만, 나는 <code class=\"language-text\">mysql</code>을 사용할 것이다(이유는 익숙하고 관리하기가 편해서…) maria db를 사용해도 엔진은 같으므로 아래와 같이 바꿔주면 된다. 우선, config/settings.py에 가서 DATABASES= { … }라고 적혀있는 곳을 수정하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">DATABASES <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'default'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'ENGINE'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'django.db.backends.mysql'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'NAME'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_NANE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'USER'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_USER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PASSWORD'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_PW'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'HOST'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_HOST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'PORT'</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">(</span><span class=\"token string\">'DB_PORT'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>참고로, 해당 이름의 DB는 먼저 만들어져있어야 할 것이다.</p>\n<h2 id=\"app-추가하기\" style=\"position:relative;\"><a href=\"#app-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" aria-label=\"app 추가하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>app 추가하기</h2>\n<p>쇼핑몰을 만들기 위해, 가장 기본이 되는 상품(item)에 대한 기능을 만들어보자.</p>\n<p>장고에서는 독립적인 기능을 수행하거나, 독립적인 모델(model)에 대하여 별개의 app을 만들어서 수행하도록 한다. 앱을 만들기 위해서는 <code class=\"language-text\">python manage.py startapp {app_name}</code>과 같이 만들 수 있다. item 앱을 만들어보자!</p>\n<h2 id=\"장고-훑어보기\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EA%B3%A0-%ED%9B%91%EC%96%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"장고 훑어보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장고 훑어보기</h2>\n<p>큰 구조는 아래와 같다. 우리는 startproject로 메인 앱인 config를 생성하였다. 여기서 프로젝트의 기본 세팅등을 해줄 수 있다고 보면 된다. 또한, 8080포트로 오는 request는 <code class=\"language-text\">config/urls.py</code>에서 부터 시작한다고 보면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">├── config\n│   ├── __init__.py\n│   ├── __pycache__\n│   ├── asgi.py\n│   ├── settings.py\n│   ├── urls.py\n│   └── wsgi.py\n├── item\n│   ├── __init__.py\n│   ├── admin.py\n│   ├── apps.py\n│   ├── migrations\n│   ├── models.py\n│   ├── tests.py\n│   └── views.py\n├── manage.py\n└── guri-venv</code></pre></div>\n<p>config의 url.py에서 요청에 따라 각 앱의 서비스로 연결시켜주면 된다. (url은 Controller와 유사한 역할이라고 볼 수 있음)</p>\n<p>이제 app의 구조를 살펴보자.</p>\n<ul>\n<li>apps.py : app의 설정</li>\n<li>models.py : app에서 정의하는 모델에 대한 내용</li>\n<li>views.py : 해당 앱으로 request가 들어왔을 때, 이를 처리하는 부분 (View에 대응)</li>\n<li>admin.py : 관리자 페이지로 접근했을 때의 내용</li>\n<li>tests.py : 테스트시 사용</li>\n<li>migrations : models.py의 내용을 DB로 변환할 때 필요한 부분</li>\n</ul>\n<p>가장 중요한 부분은 <strong>해당 기능을 위한 models을 정의하고, 이를 view에서 처리하여 응답하는 것이다.</strong> 장고에서는 모델을 정의하여 DB와 일치시키도록 할 수 있으며, 이를 <code class=\"language-text\">migrate</code>라고 한다. 또한, 장고에서 제공하는 관리자 페이지에서 model을 CRUD하기 위해 admin.py가 존재한다.</p>\n<h2 id=\"app-연결하고-테스트해보기\" style=\"position:relative;\"><a href=\"#app-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B3%A0-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"app 연결하고 테스트해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>app 연결하고 테스트해보기</h2>\n<p>conf/urls.py 에서 요청에 대하여 처리를 해주는데, 이를 item앱으로 연결시켜주자.</p>\n<ol>\n<li>\n<p>installed app에 추가</p>\n<p>우선, settings.py에서 앱을 추가해줘야 한다. 앞으로도 startapp으로 앱을 만들고, INSTALLED_APPS에 추가해주도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">INSTALLED_APPS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'django.contrib.admin'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.auth'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.contenttypes'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.sessions'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.messages'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.staticfiles'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'item.apps.ItemConfig'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># or just 'item'</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>app 이름 또는 apps.py에 있는 config class이름을 넣어줘도 된다. <strong>추가할 때 컴마(,)를 잊지 않도록 하자!</strong></p>\n</li>\n<li>\n<p>urls.py 수정</p>\n<p>config/urls.py에 아래와 같이 수정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib <span class=\"token keyword\">import</span> admin\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path<span class=\"token punctuation\">,</span> include\n\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'admin/'</span><span class=\"token punctuation\">,</span> admin<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">'item/'</span><span class=\"token punctuation\">,</span> include<span class=\"token punctuation\">(</span><span class=\"token string\">'item.urls'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p>item/urls.py 생성</p>\n<p>item/urls.py를 만들고, 아래와 같이 작성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>urls <span class=\"token keyword\">import</span> path\n<span class=\"token keyword\">from</span> item <span class=\"token keyword\">import</span> views\nurlpatterns <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    path<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> views<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n<li>\n<p>item/views.py 수정</p>\n<p>위에서 해준 라우팅 처리를 받아줄 view 함수를 만들어준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>http <span class=\"token keyword\">import</span> JsonResponse\n<span class=\"token comment\"># Create your views here.</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">'info'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'hello'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> status<span class=\"token operator\">=</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<p>이러고 localhost:8000/item을 브라우저에 입력하면 위의 응답결과가 나오는 것을 확인할 수 있다. 참고로 view 함수는 request를 첫번째 인자로 받도록 한다.</p>\n<p>오늘은 url 입력에 대하여 response를 주는 흐름을 그려보았다. 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/aa366d767b3eb62bd25041d7d5c2bebbff34aae0\">이곳</a>을 참고하면 된다.</p>","frontmatter":{"date":"April 12, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [2-django 기초]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(2)-django-intro/"}},"prev":{"id":"565611de-2914-5d4f-af5d-738fe5e83e69","html":"<p>저번에 item <code class=\"language-text\">model</code>을 정의하는 것까지 해보았다. 이를 우리의 MySQL server에 적용시켜보자! 해야할 일은 크게 3가지로 나뉜다.</p>\n<ol>\n<li>model 정의 / 수정</li>\n<li>migration file 생성</li>\n<li>DB에 적용(migrate)</li>\n</ol>\n<p>이 흐름을 이해하는 것이 중요하며, 직접 해보도록 하자.</p>\n<h2 id=\"migration-file-생성\" style=\"position:relative;\"><a href=\"#migration-file-%EC%83%9D%EC%84%B1\" aria-label=\"migration file 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>migration file 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py makemigrations item\nMigrations <span class=\"token keyword\">for</span> <span class=\"token string\">'item'</span><span class=\"token builtin class-name\">:</span>\n  item/migrations/0001_initial.py\n    - Create model Item</code></pre></div>\n<p>가상환경이 활성화 되어있는 상태에서 위의 명령어를 입력한다. <code class=\"language-text\">python manage.py makemigrations {app_name}</code>을 하면 해당 앱에 존재하는 모델의 변경사항 등을 <code class=\"language-text\">{app_name}/migrations/</code>위치에 저장해준다. (app_name이 없다면 전체 앱을 탐색)</p>\n<p>실제 위의 명령어가 정상 수행되면 <code class=\"language-text\">0001_initial.py</code> 파일이 생성되었다는 메시지가 나오는데, 파일을 열어보면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Generated by Django 4.2 on 2023-04-12 11:38</span>\n\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> migrations<span class=\"token punctuation\">,</span> models\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Migration</span><span class=\"token punctuation\">(</span>migrations<span class=\"token punctuation\">.</span>Migration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    initial <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n\n    dependencies <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">]</span>\n\n    operations <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        migrations<span class=\"token punctuation\">.</span>CreateModel<span class=\"token punctuation\">(</span>\n            name<span class=\"token operator\">=</span><span class=\"token string\">'Item'</span><span class=\"token punctuation\">,</span>\n            fields<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'item_id'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> serialize<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품코드'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품명'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'상품가격'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">(</span><span class=\"token string\">'stock_count'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>PositiveIntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'남은수량'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            options<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'verbose_name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'상품'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'verbose_name_plural'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'상품들'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'db_table'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'item'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n</code></pre></div>\n<p>이러한 파일을 직접 만들어서 관리할 수도 있지만, 장고의 manage.py는 버전별로 나누어 이에 대한 관리를 용이하게 해준다.</p>\n<h2 id=\"migrate\" style=\"position:relative;\"><a href=\"#migrate\" aria-label=\"migrate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>migrate</h2>\n<p>migration 파일은 아직까지 파이썬 코드단으로 변경사항 등을 기록한 것이고, 이를 DB에 진짜로 반영하기 위해서는 migrate를 수행해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py migrate item\nOperations to perform:\n  Apply all migrations: item\nRunning migrations:\n  Applying item.0001_initial<span class=\"token punctuation\">..</span>. OK</code></pre></div>\n<p>위와 같이 나온다면 된 것이다. 이제 우리의 DB로 가보자.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 560px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABAUlEQVQoz4WQS0+EMBSF+S2MLa+EACkLCNSEEZRBZyYESNioAcGMD9xo4sbffkxrWIyZx+LL7aL39DtV7h97PI07NE2NYRgwTROKokDXdWjbFoZhQNd1iaZpe/MQyu3dButtCdd1EMcxoigC5xxJksD1PBk48z/4YCAlF+jHVzx0z1jlOZqmkYaqqoIQAkrpHucsFcuywPklrvMCjPkIwxBBEMBxHNi2DcYYPM+D7/tymqZ52lBcWCxUvH18oh9fkGWptKyqCmn6d67rGmVZSkSoMD0aKP5GvLgq1shucvl/wnKuNVcV9QVnK4tASgi+vn8w7t7B4xjL5ZVcOLZ0qvIvfmDhlN1S4igAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"db_result1\"\n        title=\"db_result1\"\n        src=\"/static/92b8f7b9be46fc08596eb4b8b934ebf0/b06ae/db_result1.png\"\n        srcset=\"/static/92b8f7b9be46fc08596eb4b8b934ebf0/e9ff0/db_result1.png 180w,\n/static/92b8f7b9be46fc08596eb4b8b934ebf0/f21e7/db_result1.png 360w,\n/static/92b8f7b9be46fc08596eb4b8b934ebf0/b06ae/db_result1.png 560w\"\n        sizes=\"(max-width: 560px) 100vw, 560px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>item 테이블이 잘 생성되었다! <code class=\"language-text\">django_migrations</code> table에는 마이그레이션을 수행한 로그가 남겨져 있으며, item에는 우리가 만든 모델이 잘 적용되어있음을 알 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACf0lEQVQ4y6VU2U7bUBC9v1DVjp2QOBHB2bxvZGkLESHO4hCyWRAKRQp94KFI5aVf1A/oH55qJg1F3YTUh6OZO8uZmes7FrIsI6MoKGoalLIJScmhkM8jmUwwm89xNp1inCTo9/voxzHOZzO2j8ZjJEmCxWKB5XKJ09NTdI+PIYhQURSUikWoug1JzUHTCri4XONyvcb66gqrNOVkJlgucbm+wnKVYrVa4fb2Fnd3d5hOp+j1ehCZjAwilWQZ8utXkGUJmUyGbTvQmYoSdj6SBEmSGORTVXVLuHPu8JzsJXieI34l+1+I3ytuR/iT/SXdCjWb5dlJZhk55HI51lV169vZs08xf4eIByNsNh8xGCWwHA9+ECEejuH5ISZn51ilFzhstuH6IVyPEPwTwnFcBEEIx3VhGCZM04TvB7AsG57nw7I91k2jwT6KMcyfMBnW1m6YEJ5LhAE8z2MZhiHCMAAViqIA06TLPv/wHTw/QhQGHEfwfZ/hui7nRVEEcXR0hMfHR9zf32Oz2bB8ePiETuctklEP375+QbPVQWf2GdGbGO/XF7i5+YA0TflRX19fo91uYzAY8MYIwzBgWRajWq2i0WgwqtUaKhUdlllHo16HruvQ9QP21X+cSaf8SqXCkroVhUKBvyoFUSUipRFs2+YxbNvB/v7+03WUSiU4joNms8kklEc+shGPKBaL2Nvb43uiMWjJT05OQFdBiz8cDrl72uPJZIJarYZut4v5fM6xcRzzHlMONceEBwfbUdSsyuSapvEY9AZpR8mXz+e3P5FSiacgnTqieNLpDRKXoMBWq8UjUHVKKJfLfB+UuBuRSMlOZ/qaVJAKEwnZCHT+Dssu4d74MnNuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"db_result2\"\n        title=\"db_result2\"\n        src=\"/static/38690ccce40b129505e65848fdb21aea/f96db/db_result2.png\"\n        srcset=\"/static/38690ccce40b129505e65848fdb21aea/e9ff0/db_result2.png 180w,\n/static/38690ccce40b129505e65848fdb21aea/f21e7/db_result2.png 360w,\n/static/38690ccce40b129505e65848fdb21aea/f96db/db_result2.png 470w\"\n        sizes=\"(max-width: 470px) 100vw, 470px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>역으로 기존 DB 스키마가 구축된 상태에서 models.py를 정의하도록 역설계하는 방법도 존재한다.</p>\n<p><code class=\"language-text\">python manage.py inspectdb > models.py</code> 이 명령어를 사용하면 된다 ~</p>\n<p>나중에 model을 <em>추가하거나 수정하는 것도 여태까지 했던 방법 그대로 설정해주면 된다</em>. 하지만, 필드를 추가하는 경우에는 default 값을 지정해주는 등의 추가적인 일이 필요할 수 있으니 참고하도록 하자.</p>\n<h2 id=\"migration의-장점\" style=\"position:relative;\"><a href=\"#migration%EC%9D%98-%EC%9E%A5%EC%A0%90\" aria-label=\"migration의 장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>migration의 장점</h2>\n<p>서버 프레임워크에서 마이그레이션을 지원한다는 것은 많이 쓴다는 것이다. 특히, 장고에서는 모델을 다루고, CRUD를 하기위해 migration이 필수적이다. 몇가지 장점을 생각해보자.</p>\n<ol>\n<li>SQL 등 쿼리 언어를 잘 몰라도 된다. DB의 역할정도만 이해하고 있다면, 상황에 따라 많은 종류의 DB를 사용하게 될텐데 각 언어를 배울 필요가 없어진다.</li>\n<li>버전 관리 : 장고에서 migration을 수행하면, 해당 마이그레이션 정보도 버전별로 관리가 된다. 따라서 스키마의 롤백이 가능하다.</li>\n<li>스키마 관리 : DB를 건들다보면, 서버 모델과 DB table을 일치시키지 않아 오류가 생길 수 있다. 또한, 스키마를 건드리다보면 기존에 있던 데이터 때문에 충돌이 나는 경우가 잦다. 장고의 migration은 이를 해결하기 위한 몇가지 도움을 제공한다.</li>\n</ol>\n<h2 id=\"경고문구-없애기\" style=\"position:relative;\"><a href=\"#%EA%B2%BD%EA%B3%A0%EB%AC%B8%EA%B5%AC-%EC%97%86%EC%95%A0%EA%B8%B0\" aria-label=\"경고문구 없애기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>경고문구 없애기</h2>\n<p>마이그레이션까지 할 줄 안다면, <code class=\"language-text\">runserver</code>시 생기는 경고문구도 이해할 수 있어진다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAfklEQVQI142OOw6DMBAFfQ5MEWwI/sRmnQBNwv2PNcgglC5KMXpvt3mjxrxwTyd9fNI5wXihtQHdeVrj0Z2juY00V/5A5ViYYqGkFxIEPyZSEIYhYqyn7wPWntR+3Bc2YOz3V7sq64YsGzK/meYP7jHj84LL62FZV/UfZpfhDvdZVrW2EnJZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"warning\"\n        title=\"warning\"\n        src=\"/static/d30e54d3454315733f7fa3f340999ae6/37523/warning.png\"\n        srcset=\"/static/d30e54d3454315733f7fa3f340999ae6/e9ff0/warning.png 180w,\n/static/d30e54d3454315733f7fa3f340999ae6/f21e7/warning.png 360w,\n/static/d30e54d3454315733f7fa3f340999ae6/37523/warning.png 720w,\n/static/d30e54d3454315733f7fa3f340999ae6/302a4/warning.png 1080w,\n/static/d30e54d3454315733f7fa3f340999ae6/07a9c/warning.png 1440w,\n/static/d30e54d3454315733f7fa3f340999ae6/95be1/warning.png 2574w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>18개의 migration이 적용되지 않았다고 하는 것이다.</p>\n<blockquote>\n<p>근데 우리는 makemigration으로 18개를 만든적이 없지 않는가??</p>\n<p>-> 이것도 장고가 알아서 만들어 준 것이다</p>\n</blockquote>\n<p>처음에 settings.py에서 장고를 세팅하고 runserver를 하면 여러가지 설정들을 통하여 장고에서 기본적으로 제공하는 model들의 정보가 생성된다. 이를 커스텀하여 구현할 수도 있지만, 일단 해당 모델이 무엇인지 모르니까 migrate부터 해주고 관찰해보자.</p>\n<p><code class=\"language-text\">python manage.py migrate</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py migrate\nOperations to perform:\n  Apply all migrations: admin, auth, contenttypes, item, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0001_initial<span class=\"token punctuation\">..</span>. OK\n  Applying admin.0001_initial<span class=\"token punctuation\">..</span>. OK\n  Applying admin.0002_logentry_remove_auto_add<span class=\"token punctuation\">..</span>. OK\n  Applying admin.0003_logentry_add_action_flag_choices<span class=\"token punctuation\">..</span>. OK\n  Applying contenttypes.0002_remove_content_type_name<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0002_alter_permission_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0003_alter_user_email_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0004_alter_user_username_opts<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0005_alter_user_last_login_null<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0006_require_contenttypes_0002<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0007_alter_validators_add_error_messages<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0008_alter_user_username_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0009_alter_user_last_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0010_alter_group_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0011_update_proxy_permissions<span class=\"token punctuation\">..</span>. OK\n  Applying auth.0012_alter_user_first_name_max_length<span class=\"token punctuation\">..</span>. OK\n  Applying sessions.0001_initial<span class=\"token punctuation\">..</span>. OK</code></pre></div>\n<p>크게보면, contenttypes, auth, admin, 그리고 sessions과 관련된 것임을 알 수 있다.</p>\n<p>처음에 settings.py를 건들지 않았다면, INSTALLED_APPS에 아래와 같은 것들이 들어있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">INSTALLED_APPS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'django.contrib.admin'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.auth'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.contenttypes'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.sessions'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.messages'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'django.contrib.staticfiles'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>기본적으로 제공되는 앱들에서 필요한 모델들을 마이그레이션 해준 것이라고 보면 된다. 각 앱들이 무슨 역할을 하는지는 차차 배워가도록 하자…</p>\n<p>오늘 실행한 소스코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/6a65b2ba32b52d258aacb3e2789722aacf00fcaa\">여기에</a> 있으니 참고하자.</p>\n<h2 id=\"관리자-페이지\" style=\"position:relative;\"><a href=\"#%EA%B4%80%EB%A6%AC%EC%9E%90-%ED%8E%98%EC%9D%B4%EC%A7%80\" aria-label=\"관리자 페이지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>관리자 페이지</h2>\n<p>장고에서는 관리자 페이지에 대한 기능을 제공해준다. model을 만들었다면 관리자 페이지 인터페이스를 통하여 데이터를 CRUD할 수 있다. 아직 api가 없으므로, 관리자를 통해서 데이터를 몇개 만들어주자.</p>\n<p>우선 가상환경에서 다음을 입력하고 관리자를 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">>></span> python manage.py createsuperuser</code></pre></div>\n<p>아이디, 이메일, 비밀번호를 입력하면 슈퍼 관리자가 생성될 것이다. 슈퍼 관리자는 모든 권한이 있는 사용자로써 관리에 신중해야 한다.</p>\n<p>그리고, 서버를 켠 상태에서 localhost:8000/admin으로 접속해보자. conf/urls.py에 admin에 대한 설정이 되어있으므로 장고의 어드민 페이지로 연결 될 것이다.</p>\n<p>로그인하였지만, 아직 Item을 생성, 수정할 수 없다. 아직 등록을 안해주었기 때문이다.</p>\n<p>item/admin.py에 가서 Item model을 등록해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>contrib <span class=\"token keyword\">import</span> admin\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Item\n\nadmin<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span>Item<span class=\"token punctuation\">)</span></code></pre></div>\n<p>관리자 페이지에 다시 접근하면 Item 모델에 대한 탭이 생성되어 있음을 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABL0lEQVQoz33M30rCYBjH8V1kddwFlFdRRx0aYdAFdGIHHRQJQceBQmiEhK65+W+67dVNt3fv9n7DSWJGPvDhgd/B1yiVK5yUK5QuK5yWrzi+uObg7IbD8/8d7WEIERAEAj8QpKkiz3P0iv6NzdekSiFTRZrlBakyklQVjKfmF7WWVXj+cHhp96m92zw0rT8emxb3byYDsUBniigMiaIQmSTkWUaWKYyW7WL7IT1vjjWdFcyJoOuume6MjuvRsoe0+0Ma3QGzWBYx23EYjUYIIYjjmOVyiZFKCWgg36G3ZCiVgIpJ4rjYoijCcRx830dKWQRXjLtGl2q9Q7WxR33trtHh9vWTnheipMTzvCKYJMmGYboB0zDGnS+Z7PjZxvOInhcw8AO6Y5+FTNk+rfXGN8YC9KwcKKB3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20230413194233810\"\n        title=\"image-20230413194233810\"\n        src=\"/static/1c6195f8da7e7541d87399c2a2452d8b/37523/admin.png\"\n        srcset=\"/static/1c6195f8da7e7541d87399c2a2452d8b/e9ff0/admin.png 180w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/f21e7/admin.png 360w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/37523/admin.png 720w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/302a4/admin.png 1080w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/07a9c/admin.png 1440w,\n/static/1c6195f8da7e7541d87399c2a2452d8b/29beb/admin.png 1830w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Item model을 선언할 때 meta 정보로 적어주었기에 한글로 잘 나온다. Add 버튼을 눌러서 몇개만 추가해보자!</p>\n<p>관리자 페이지는 일단 다음에 다시 다뤄보도록 하고, 해당 코드는 <a href=\"https://github.com/choieastsea/market-guri-django/commit/e3f2f67047a77be071523f3817bdf70208cf84e9\">여기</a>를 참고한다.</p>\n<p>이제 우리는 서비스에 필요한 데이터를 모델 클래스 단위로 묶어 관리할 수 있어졌다. 하지만, 이를 다루기 위해서는 몇가지 알아야할 것들이 있다. 다음에는 DRF의 serializer에 대하여 알아보도록 하자!</p>","frontmatter":{"date":"April 14, 2023","title":"(Django) 장고 api 서버를 이용한 프로젝트 [4 - DB(migration)]","categories":"BE","author":"choieastsea","emoji":"🙄"},"fields":{"slug":"/Django(4)-migration/"}},"site":{"siteMetadata":{"siteUrl":"https://choieastsea.github.io","comments":{"utterances":{"repo":"choieastsea/choieastsea.github.io"}}}}},"pageContext":{"slug":"/Django(3)-model/","nextSlug":"/Django(2)-django-intro/","prevSlug":"/Django(4)-migration/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}